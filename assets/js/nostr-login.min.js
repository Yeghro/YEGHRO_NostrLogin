/*! For license information please see nostr-login.min.js.LICENSE.txt */
(()=>{var __webpack_modules__={833:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(736)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},736:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,o,s=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];n=o.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e);(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(585),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},705:(e,t,n)=>{const{bech32:r,hex:i,utf8:o}=n(746),s={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},h={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},u=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],d={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},f=BigInt("2100000000000000000"),p=BigInt(1e11),g={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},y={};for(let e=0,t=Object.keys(g);e<t.length;e++){const n=t[e],r=g[t[e]].toString();y[r]=n}const w={1:e=>i.encode(r.fromWordsUnsafe(e)),16:e=>i.encode(r.fromWordsUnsafe(e)),13:e=>o.encode(r.fromWordsUnsafe(e)),19:e=>i.encode(r.fromWordsUnsafe(e)),23:e=>i.encode(r.fromWordsUnsafe(e)),27:e=>i.encode(r.fromWordsUnsafe(e)),6:m,24:m,3:function(e){const t=[];let n,o,s,a,c,h=r.fromWordsUnsafe(e);for(;h.length>0;)n=i.encode(h.slice(0,33)),o=i.encode(h.slice(33,41)),s=parseInt(i.encode(h.slice(41,45)),16),a=parseInt(i.encode(h.slice(45,49)),16),c=parseInt(i.encode(h.slice(49,51)),16),h=h.slice(51),t.push({pubkey:n,short_channel_id:o,fee_base_msat:s,fee_proportional_millionths:a,cltv_expiry_delta:c});return t},5:function(e){const t=e.slice().reverse().map((e=>[!!(1&e),!!(2&e),!!(4&e),!!(8&e),!!(16&e)])).reduce(((e,t)=>e.concat(t)),[]);for(;t.length<2*u.length;)t.push(!1);const n={};u.forEach(((e,r)=>{let i;i=t[2*r]?"required":t[2*r+1]?"supported":"unsupported",n[e]=i}));const r=t.slice(2*u.length);return n.extra_bits={start_bit:2*u.length,bits:r,has_required:r.reduce(((e,t,n)=>n%2!=0?e||!1:e||t),!1)},n}};function b(e){return t=>({tagCode:parseInt(e),words:r.encode("unknown",t,Number.MAX_SAFE_INTEGER)})}function m(e){return e.reverse().reduce(((e,t,n)=>e+t*Math.pow(32,n)),0)}function E(e,t){let n,r;if(e.slice(-1).match(/^[munp]$/))n=e.slice(-1),r=e.slice(0,-1);else{if(e.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=e}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const i=BigInt(r),o=n?i*p/d[n]:i*p;if("p"===n&&i%BigInt(10)!==BigInt(0)||o>f)throw new Error("Amount is outside of valid range");return t?o.toString():o}e.exports={decode:function(e,t){if("string"!=typeof e)throw new Error("Lightning Payment Request must be string");if("ln"!==e.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],o=r.decode(e,Number.MAX_SAFE_INTEGER);e=e.toLowerCase();const u=o.prefix;let d=o.words,f=e.slice(u.length+1),p=d.slice(-104);d=d.slice(0,-104);let v=u.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(v&&!v[2]&&(v=u.match(/^ln(\S+)$/)),!v)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const x=v[1];let k;if(t){if(void 0===t.bech32||void 0===t.pubKeyHash||void 0===t.scriptHash||!Array.isArray(t.validWitnessVersions))throw new Error("Invalid network");k=t}else switch(x){case s.bech32:k=s;break;case a.bech32:k=a;break;case c.bech32:k=c;break;case h.bech32:k=h;break;case l.bech32:k=l}if(!k||k.bech32!==x)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:x,value:k});const A=v[2];let S;if(A){S=E(A+v[3],!0),n.push({name:"amount",letters:v[2]+v[3],value:S})}else S=null;n.push({name:"separator",letters:"1"});const B=m(d.slice(0,7));let _,I,R,C;for(d=d.slice(7),n.push({name:"timestamp",letters:f.slice(0,7),value:B}),f=f.slice(7);d.length>0;){const e=d[0].toString();_=y[e]||"unknown_tag",I=w[e]||b(e),d=d.slice(1),R=m(d.slice(0,2)),d=d.slice(2),C=d.slice(0,R),d=d.slice(R),n.push({name:_,tag:f[0],letters:f.slice(0,3+R),value:I(C)}),f=f.slice(3+R)}n.push({name:"signature",letters:f.slice(0,104),value:i.encode(r.fromWordsUnsafe(p))}),f=f.slice(104),n.push({name:"checksum",letters:f});let U={paymentRequest:e,sections:n,get expiry(){let e=n.find((e=>"expiry"===e.name));if(e)return L("timestamp")+e.value},get route_hints(){return n.filter((e=>"route_hint"===e.name)).map((e=>e.value))}};for(let e in g)"route_hint"!==e&&Object.defineProperty(U,e,{get:()=>L(e)});return U;function L(e){let t=n.find((t=>t.name===e));return t?t.value:void 0}},hrpToMillisat:E}},746:(e,t)=>{"use strict";function n(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function r(...e){const t=(e,t)=>n=>e(t(n));return{encode:Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),decode:e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0)}}function i(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(n(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function o(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function s(e,t="="){if(n(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function a(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function c(e,t,r){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let i=0;const o=[],s=Array.from(e);for(s.forEach((e=>{if(n(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,n=!0;for(let o=i;o<s.length;o++){const a=s[o],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");if(e=c%r,s[o]=Math.floor(c/r),!Number.isSafeInteger(s[o])||s[o]*r+e!==c)throw new Error("convertRadix: carry overflow");n&&(s[o]?n=!1:i=o)}if(o.push(e),n)break}for(let t=0;t<e.length-1&&0===e[t];t++)o.push(0);return o.reverse()}Object.defineProperty(t,"__esModule",{value:!0}),t.bytes=t.stringToBytes=t.str=t.bytesToString=t.hex=t.utf8=t.bech32m=t.bech32=t.base58check=t.base58xmr=t.base58xrp=t.base58flickr=t.base58=t.base64url=t.base64=t.base32crockford=t.base32hex=t.base32=t.base16=t.utils=t.assertNumber=void 0,t.assertNumber=n;const h=(e,t)=>t?h(t,e%t):e,l=(e,t)=>e+(t-h(e,t));function u(e,t,r,i){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(l(t,r)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${l(t,r)}`);let o=0,s=0;const a=2**r-1,c=[];for(const i of e){if(n(i),i>=2**t)throw new Error(`convertRadix2: invalid data word=${i} from=${t}`);if(o=o<<t|i,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=r;s-=r)c.push((o>>s-r&a)>>>0);o&=2**s-1}if(o=o<<r-s&a,!i&&s>=t)throw new Error("Excess padding");if(!i&&o)throw new Error(`Non-zero padding: ${o}`);return i&&s>0&&c.push(o>>>0),c}function d(e){return n(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return c(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(c(t,e,256))}}}function f(e,t=!1){if(n(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(l(8,e)>32||l(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return u(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(u(n,e,8,t))}}}function p(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}function g(e,t){if(n(e),"function"!=typeof t)throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=t(n).slice(0,e),i=new Uint8Array(n.length+e);return i.set(n),i.set(r,n.length),i},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-e),i=t(r).slice(0,e),o=n.slice(-e);for(let t=0;t<e;t++)if(i[t]!==o[t])throw new Error("Invalid checksum");return r}}}t.utils={alphabet:i,chain:r,checksum:g,radix:d,radix2:f,join:o,padding:s},t.base16=r(f(4),i("0123456789ABCDEF"),o("")),t.base32=r(f(5),i("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),s(5),o("")),t.base32hex=r(f(5),i("0123456789ABCDEFGHIJKLMNOPQRSTUV"),s(5),o("")),t.base32crockford=r(f(5),i("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),a((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),t.base64=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),s(6),o("")),t.base64url=r(f(6),i("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),s(6),o(""));const y=e=>r(d(58),i(e),o(""));t.base58=y("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),t.base58flickr=y("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),t.base58xrp=y("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const w=[0,2,3,5,6,7,9,10,11];t.base58xmr={encode(e){let n="";for(let r=0;r<e.length;r+=8){const i=e.subarray(r,r+8);n+=t.base58.encode(i).padStart(w[i.length],"1")}return n},decode(e){let n=[];for(let r=0;r<e.length;r+=11){const i=e.slice(r,r+11),o=w.indexOf(i.length),s=t.base58.decode(i);for(let e=0;e<s.length-o;e++)if(0!==s[e])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(n)}};t.base58check=e=>r(g(4,(t=>e(e(t)))),t.base58);const b=r(i("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),m=[996825010,642813549,513874426,1027748829,705979059];function E(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<m.length;e++)1==(t>>e&1)&&(n^=m[e]);return n}function v(e,t,n=1){const r=e.length;let i=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);i=E(i)^n>>5}i=E(i);for(let t=0;t<r;t++)i=E(i)^31&e.charCodeAt(t);for(let e of t)i=E(i)^e;for(let e=0;e<6;e++)i=E(i);return i^=n,b.encode(u([i%2**30],30,5,!1))}function x(e){const t="bech32"===e?1:734539939,n=f(5),r=n.decode,i=n.encode,o=p(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(e=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const o=e.slice(0,i),s=e.slice(i+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=b.decode(s).slice(0,-6),c=v(o,a,t);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:o,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=e.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${b.encode(n)}${v(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:p(s),fromWords:r,fromWordsUnsafe:o,toWords:i}}t.bech32=x("bech32"),t.bech32m=x("bech32m"),t.utf8={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},t.hex=r(f(4),i("0123456789abcdef"),o(""),a((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));const k={utf8:t.utf8,hex:t.hex,base16:t.base16,base32:t.base32,base64:t.base64,base64url:t.base64url,base58:t.base58,base58xmr:t.base58xmr},A=`Invalid encoding type. Available types: ${Object.keys(k).join(", ")}`;t.bytesToString=(e,t)=>{if("string"!=typeof e||!k.hasOwnProperty(e))throw new TypeError(A);if(!(t instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return k[e].encode(t)},t.str=t.bytesToString;t.stringToBytes=(e,t)=>{if(!k.hasOwnProperty(e))throw new TypeError(A);if("string"!=typeof t)throw new TypeError("stringToBytes() expects string");return k[e].decode(t)},t.bytes=t.stringToBytes},585:e=>{var t=1e3,n=60*t,r=60*n,i=24*r,o=7*i,s=365.25*i;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,c){c=c||{};var h=typeof e;if("string"===h&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*s;case"weeks":case"week":case"w":return c*o;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(e);if("number"===h&&isFinite(e))return c.long?function(e){var o=Math.abs(e);if(o>=i)return a(e,o,i,"day");if(o>=r)return a(e,o,r,"hour");if(o>=n)return a(e,o,n,"minute");if(o>=t)return a(e,o,t,"second");return e+" ms"}(e):function(e){var o=Math.abs(e);if(o>=i)return Math.round(e/i)+"d";if(o>=r)return Math.round(e/r)+"h";if(o>=n)return Math.round(e/n)+"m";if(o>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},30:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.EventEmitter=void 0;var i=n(857),o=n(547);function s(e,t,n,r,i,o){var s=this.events[e];return!!s&&(0!==s.length&&(s.argsNum<6?s.call(t,n,r,i,o):s.call.apply(void 0,arguments),!0))}function a(e,t,n,r,i,o){var s=this.events[e];if(s){if(0===s.length)return!1;s.argsNum<6?s.call(t,n,r,i,o):s.call.apply(void 0,arguments)}var a=this.onceEvents[e];if(a){if("function"==typeof a)this.onceEvents[e]=void 0,arguments.length<6?a(t,n,r,i,o):a.apply(void 0,arguments);else{var c=a;if(this.onceEvents[e]=void 0,arguments.length<6)for(var h=0;h<c.length;++h)c[h](t,n,r,i,o);else for(h=0;h<c.length;++h)c[h].apply(void 0,arguments)}return!0}return!!s}var c=function(){function e(){this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(e.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),e}();function h(e,t,n){if(void 0===n&&(n=t.length),"function"!=typeof t)throw new TypeError("The listener must be a function");var r=this.events[e];return r?(r.push(t),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" event!'))):(this.events[e]=new i.TaskCollection(n,!0,t,!1),"symbol"==typeof e&&this._symbolKeys.add(e)),this}function l(e,t){var n=this.events[e];n&&n.removeLast(t);var r=this.onceEvents[e];return r&&("function"==typeof r?this.onceEvents[e]=void 0:"object"==typeof r&&(1===r.length&&r[0]===t?this.onceEvents[e]=void 0:(0,i._fast_remove_single)(r,r.lastIndexOf(t)))),this}t.EventEmitter=c,c.prototype.emit=s,c.prototype.on=h,c.prototype.once=function(e,t){switch(this.emit===s&&(this.emit=a),typeof this.onceEvents[e]){case"undefined":this.onceEvents[e]=t,"symbol"==typeof e&&this._symbolKeys.add(e);break;case"function":this.onceEvents[e]=[this.onceEvents[e],t];break;case"object":this.onceEvents[e].push(t)}return this},c.prototype.addListener=h,c.prototype.removeListener=l,c.prototype.addListenerBound=function(e,t,n,r){void 0===n&&(n=this),void 0===r&&(r=t.length),this.boundFuncs||(this.boundFuncs=new Map);var i=t.bind(n);return this.boundFuncs.set(t,i),this.addListener(e,i,r)},c.prototype.removeListenerBound=function(e,t){var n,r,i=null===(n=this.boundFuncs)||void 0===n?void 0:n.get(t);return null===(r=this.boundFuncs)||void 0===r||r.delete(t),this.removeListener(e,i)},c.prototype.hasListeners=function(e){return this.events[e]&&!!this.events[e].length},c.prototype.prependListener=function(e,t,n){if(void 0===n&&(n=t.length),"function"!=typeof t)throw new TypeError("The listener must be a function");var r=this.events[e];return r&&r instanceof i.TaskCollection?(r.insert(0,t),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" event!'))):(r=this.events[e]=new i.TaskCollection(n,!0,t,!1),"symbol"==typeof e&&this._symbolKeys.add(e)),this},c.prototype.prependOnceListener=function(e,t){this.emit===s&&(this.emit=a);var n=this.onceEvents[e];return n?"object"!=typeof n?(this.onceEvents[e]=[t,n],"symbol"==typeof e&&this._symbolKeys.add(e)):(n.unshift(t),this.maxListeners!==1/0&&this.maxListeners<=n.length&&console.warn('Maximum event listeners for "'.concat(String(e),'" once event!'))):(this.onceEvents[e]=[t],"symbol"==typeof e&&this._symbolKeys.add(e)),this},c.prototype.off=l,c.prototype.removeAllListeners=function(e){return void 0===e?(this.events=(0,o.nullObj)(),this.onceEvents=(0,o.nullObj)(),this._symbolKeys=new Set):(this.events[e]=void 0,this.onceEvents[e]=void 0,"symbol"==typeof e&&this._symbolKeys.delete(e)),this},c.prototype.setMaxListeners=function(e){return this.maxListeners=e,this},c.prototype.getMaxListeners=function(){return this.maxListeners},c.prototype.listeners=function(e){return this.emit===s?this.events[e]?this.events[e].tasksAsArray().slice():[]:this.events[e]&&this.onceEvents[e]?r(r([],this.events[e].tasksAsArray(),!0),"function"==typeof this.onceEvents[e]?[this.onceEvents[e]]:this.onceEvents[e],!0):this.events[e]?this.events[e].tasksAsArray():this.onceEvents[e]?"function"==typeof this.onceEvents[e]?[this.onceEvents[e]]:this.onceEvents[e]:[]},c.prototype.eventNames=function(){var e=this;if(this.emit===s){var t=Object.keys(this.events);return r(r([],t,!0),Array.from(this._symbolKeys),!0).filter((function(t){return t in e.events&&e.events[t]&&e.events[t].length}))}t=Object.keys(this.events).filter((function(t){return e.events[t]&&e.events[t].length}));var n=Object.keys(this.onceEvents).filter((function(t){return e.onceEvents[t]&&e.onceEvents[t].length}));return r(r(r([],t,!0),n,!0),Array.from(this._symbolKeys).filter((function(t){return t in e.events&&e.events[t]&&e.events[t].length||t in e.onceEvents&&e.onceEvents[t]&&e.onceEvents[t].length})),!0)},c.prototype.listenerCount=function(e){return this.emit===s?this.events[e]&&this.events[e].length||0:(this.events[e]&&this.events[e].length||0)+(this.onceEvents[e]&&this.onceEvents[e].length||0)}},706:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(335),t),i(n(30),t)},665:(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(e){var t="";if(0===e)return t;for(var n=0;n<e-1;++n)t+="arg"+String(n)+", ";return t+="arg"+String(e-1)}function generateBodyPartsCode(e,t){for(var n="",r="",i=0;i<t;++i)n+="var f".concat(i," = collection[").concat(i,"];\n"),r+="f".concat(i,"(").concat(e,")\n");return{funcDefCode:n,funcCallCode:r}}function generateBodyPartsVariadicCode(e){for(var t="",n="",r=0;r<e;++r)t+="var f".concat(r," = collection[").concat(r,"];\n"),n+="f".concat(r,".apply(undefined, arguments)\n");return{funcDefCode:t,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                ").concat(funcCallCode,"\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=collection.length%10==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 10) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                        collection[i+4](").concat(argsDefCode,");\n                        collection[i+5](").concat(argsDefCode,");\n                        collection[i+6](").concat(argsDefCode,");\n                        collection[i+7](").concat(argsDefCode,");\n                        collection[i+8](").concat(argsDefCode,");\n                        collection[i+9](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%4==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 4) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%3==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 3) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                    }\n                });\n            })"):"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; ++i) {\n                        collection[i](").concat(argsDefCode,");\n                    }\n                });\n            })")}var bakeCollection_1=void 0,fixedArgsNum_1=void 0,bakeCollectionVariadic_1=void 0,bakeCollectionAwait_1=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionAwait(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                return Promise.all([ ").concat(funcCallCode," ]);\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode="(function(collection) {\n            return (function(".concat(argsDefCode,") {\n                var promises = Array(collection.length);\n                for (var i = 0; i < collection.length; ++i) {\n                    promises[i] = collection[i](").concat(argsDefCode,");\n                }\n                return Promise.all(promises);\n            });\n        })")}var bakeCollection_2=void 0,fixedArgsNum_2=void 0,bakeCollectionVariadic_2=void 0,bakeCollectionAwait_2=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionVariadic(collection){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function() {\n                ").concat(funcCallCode,"\n            });\n        })")}else funcFactoryCode="(function(collection) {\n            return (function() {\n                for (var i = 0; i < collection.length; ++i) {\n                    collection[i].apply(undefined, arguments);\n                }\n            });\n        })";var bakeCollection_3=void 0,fixedArgsNum=void 0,bakeCollectionVariadic_3=void 0,bakeCollectionAwait_3=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}exports.bakeCollection=bakeCollection,exports.bakeCollectionAwait=bakeCollectionAwait,exports.bakeCollectionVariadic=bakeCollectionVariadic},857:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(369),t)},369:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskCollection=t._fast_remove_single=void 0;var i=n(665);function o(e,t){var n,r=this.length;if(r>1)t?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(e),this.length++);else if(t){var i;if(1===r)(i=Array(1+arguments.length)).push(i),i.push.apply(i,arguments),this._tasks=i;else(i=Array(arguments.length)).push.apply(i,arguments),this._tasks=i;this.length+=arguments.length}else this._tasks=1===r?[this._tasks,e]:e,this.length++}function s(e,t){var n,r=this.length;if(r>1)t?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(e),this.length++);else if(t){var i;if(1===r)(i=Array(1+arguments.length)).push(i),i.push.apply(i,arguments),this._tasks=i;else(i=Array(arguments.length)).push.apply(i,arguments),this._tasks=i;this.length+=arguments.length}else this._tasks=1===r?[this._tasks,e]:e,this.length++;this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function a(e,t){-1!==t&&(0===t?e.shift():t===e.length-1?e.length=e.length-1:e.splice(t,1))}function c(e){0!==this.length&&(1===this.length?this._tasks===e&&(this.length=0):(a(this._tasks,this._tasks.lastIndexOf(e)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function h(e){if(0!==this.length){if(1===this.length)return this._tasks===e&&(this.length=0),this.firstEmitBuildStrategy?void(this.call=i.BAKED_EMPTY_FUNC):void this.rebuild();a(this._tasks,this._tasks.lastIndexOf(e)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length,this.firstEmitBuildStrategy?this.call=p:this.rebuild()}}function l(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((t=this._tasks).splice.apply(t,r([e,0],n,!1)),this.length=this._tasks.length)}function u(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((t=this._tasks).splice.apply(t,r([e,0],n,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function d(){0===this.length?this.call=i.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,i.bakeCollection)(this._tasks,this.argsNum)}function f(){0===this.length?this.call=i.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,i.bakeCollectionAwait)(this._tasks,this.argsNum)}function p(){this.rebuild(),this.call.apply(void 0,arguments)}t._fast_remove_single=a;var g=function(e,t,n,r){void 0===t&&(t=!0),void 0===n&&(n=null),void 0===r&&(r=!1),this.awaitTasks=r,this.call=i.BAKED_EMPTY_FUNC,this.argsNum=e,this.firstEmitBuildStrategy=!0,this.rebuild=r?f.bind(this):d.bind(this),this.setAutoRebuild(t),n?"function"==typeof n?(this._tasks=n,this.length=1):(this._tasks=n,this.length=n.length):(this._tasks=null,this.length=0),t&&this.rebuild()};t.TaskCollection=g,g.prototype.fastClear=function(){this._tasks=null,this.length=0,this.call=i.BAKED_EMPTY_FUNC},g.prototype.clear=function(){this._tasks=null,this.length=0,this.call=i.BAKED_EMPTY_FUNC},g.prototype.growArgsNum=function(e){this.argsNum<e&&(this.argsNum=e,this.firstEmitBuildStrategy?this.call=p:this.rebuild())},g.prototype.setAutoRebuild=function(e){e?(this.push=s.bind(this),this.insert=u.bind(this),this.removeLast=h.bind(this)):(this.push=o.bind(this),this.insert=l.bind(this),this.removeLast=c.bind(this))},g.prototype.tasksAsArray=function(){return 0===this.length?[]:1===this.length?[this._tasks]:this._tasks},g.prototype.setTasks=function(e){0===e.length?(this.length=0,this.call=i.BAKED_EMPTY_FUNC):1===e.length?(this.length=1,this.call=e[0],this._tasks=e[0]):(this.length=e.length,this._tasks=e,this.firstEmitBuildStrategy?this.call=p:this.rebuild())}},335:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},547:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.nullObj=void 0,t.nullObj=function(){var e={__proto__:null,prototype:null};return e}},145:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0;const r=n(397);class i{constructor(e){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:t=25,entryExpirationTimeInMS:n=null,onEntryEvicted:r,onEntryMarkedAsMostRecentlyUsed:i,cloneFn:o,clone:s}=null!=e?e:{};if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");if("number"==typeof n&&(n<=0||Number.isNaN(n)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=t,this.entryExpirationTimeInMS=n,this.onEntryEvicted=r,this.onEntryMarkedAsMostRecentlyUsed=i,this.clone=s,this.cloneFn=o}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(e){if(Number.isNaN(e)||e<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=e,this.enforceSizeLimit()}set(e,t,n){const i=this.lookupTable.get(e);i&&this.removeNodeFromListAndLookupTable(i);const o=new r.LRUCacheNode(e,t,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...n});return this.setNodeAsHead(o),this.lookupTable.set(e,o),this.enforceSizeLimit(),this}get(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),null):(this.setNodeAsHead(t),t.value):null}peek(e){const t=this.lookupTable.get(e);return t?t.isExpired?(this.removeNodeFromListAndLookupTable(t),null):t.value:null}delete(e){const t=this.lookupTable.get(e);return!!t&&this.removeNodeFromListAndLookupTable(t)}has(e){const t=this.lookupTable.get(e);return!!t&&(!t.isExpired||(this.removeNodeFromListAndLookupTable(t),!1))}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(e){let t=this.head;for(;t;){if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e;continue}const n=this.mapNodeToEntry(t);if(e(n))return this.setNodeAsHead(t),n;t=t.next}return null}forEach(e){let t=this.head,n=0;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else e(t.value,t.key,n),t=t.next,n++}*values(){let e=this.head;for(;e;)if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t}else yield e.value,e=e.next}*keys(){let e=this.head;for(;e;)if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t}else yield e.key,e=e.next}*entries(){let e=this.head;for(;e;)if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t}else yield this.mapNodeToEntry(e),e=e.next}*[Symbol.iterator](){let e=this.head;for(;e;)if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t}else yield this.mapNodeToEntry(e),e=e.next}enforceSizeLimit(){let e=this.tail;for(;null!==e&&this.size>this.maxSizeInternal;){const t=e.prev;this.removeNodeFromListAndLookupTable(e),e=t}}mapNodeToEntry({key:e,value:t}){return{key:e,value:t}}setNodeAsHead(e){this.removeNodeFromList(e),this.head?(e.next=this.head,this.head.prev=e,this.head=e):(this.head=e,this.tail=e),e.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(e){null!==e.prev&&(e.prev.next=e.next),null!==e.next&&(e.next.prev=e.prev),this.head===e&&(this.head=e.next),this.tail===e&&(this.tail=e.prev),e.next=null,e.prev=null}removeNodeFromListAndLookupTable(e){return e.invokeOnEvicted(),this.removeNodeFromList(e),this.lookupTable.delete(e.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const e=[];for(const t of this.lookupTable.values())t.isExpired&&e.push(t);e.forEach((e=>this.removeNodeFromListAndLookupTable(e)))}}t.LRUCache=i},397:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCacheNode=void 0;t.LRUCacheNode=class{constructor(e,t,n){const{entryExpirationTimeInMS:r=null,next:i=null,prev:o=null,onEntryEvicted:s,onEntryMarkedAsMostRecentlyUsed:a,clone:c,cloneFn:h}=null!=n?n:{};if("number"==typeof r&&(r<=0||Number.isNaN(r)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=null!=c&&c,this.cloneFn=null!=h?h:this.defaultClone,this.key=e,this.internalValue=this.clone?this.cloneFn(t):t,this.created=Date.now(),this.entryExpirationTimeInMS=r,this.next=i,this.prev=o,this.onEntryEvicted=s,this.onEntryMarkedAsMostRecentlyUsed=a}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return"number"==typeof this.entryExpirationTimeInMS&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:e,value:t,isExpired:n}=this;this.onEntryEvicted({key:e,value:t,isExpired:n})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:e,value:t}=this;this.onEntryMarkedAsMostRecentlyUsed({key:e,value:t})}}defaultClone(e){return"boolean"==typeof e||"string"==typeof e||"number"==typeof e?e:JSON.parse(JSON.stringify(e))}}},654:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(145),t)}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(e,t)=>{for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),__webpack_require__.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";var e={};__webpack_require__.r(e),__webpack_require__.d(e,{OG:()=>z,My:()=>L,Ph:()=>O,lX:()=>F,Id:()=>q,fg:()=>K,qj:()=>H,aT:()=>T,lq:()=>P,z:()=>$,Q5:()=>V});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{OG:()=>yi,My:()=>ai,Ph:()=>li,lX:()=>ui,Id:()=>gi,fg:()=>mi,qj:()=>pi,aT:()=>hi,lq:()=>di,z:()=>fi,Q5:()=>vi});var n={};__webpack_require__.r(n),__webpack_require__.d(n,{DO:()=>Qa,OG:()=>uc,My:()=>ec,Ph:()=>oc,lX:()=>sc,Id:()=>lc,fg:()=>pc,qj:()=>hc,aT:()=>ic,aY:()=>Ja,lq:()=>ac,z:()=>cc,Q5:()=>yc});var r={};function i(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function o(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}__webpack_require__.r(r),__webpack_require__.d(r,{OG:()=>vu,My:()=>du,Ph:()=>gu,lX:()=>yu,Id:()=>Eu,fg:()=>Au,qj:()=>mu,aT:()=>pu,lq:()=>wu,z:()=>bu,Q5:()=>Bu});const s={number:i,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:o,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");i(e.outputLen),i(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){o(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},a=s,c="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,h=e=>e instanceof Uint8Array,l=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),u=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const d=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function f(e){if(!h(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=d[e[n]];return t}function p(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[t]=o}return n}function g(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!h(e))throw new Error("expected Uint8Array, got "+typeof e);return e}function y(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!h(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}class w{clone(){return this._cloneInto()}}function b(e){const t=t=>e().update(g(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function m(e=32){if(c&&"function"==typeof c.getRandomValues)return c.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class E extends w{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=l(this.buffer)}update(e){a.exists(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=g(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=l(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){a.exists(this),a.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,h=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=l(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const h=c/4,u=this.get();if(h>u.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<h;e++)s.setUint32(4*e,u[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const v=(e,t,n)=>e&t^e&n^t&n,x=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),k=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),A=new Uint32Array(64);class S extends E{constructor(){super(64,32,8,!1),this.A=0|k[0],this.B=0|k[1],this.C=0|k[2],this.D=0|k[3],this.E=0|k[4],this.F=0|k[5],this.G=0|k[6],this.H=0|k[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)A[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=A[e-15],n=A[e-2],r=u(t,7)^u(t,18)^t>>>3,i=u(n,17)^u(n,19)^n>>>10;A[e]=i+A[e-7]+r+A[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(u(s,6)^u(s,11)^u(s,25))+((l=s)&a^~l&c)+x[e]+A[e]|0,d=(u(n,2)^u(n,13)^u(n,22))+v(n,r,i)|0;h=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+d|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,o,s,a,c,h)}roundClean(){A.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class B extends S{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const _=b((()=>new S)),I=(b((()=>new B)),BigInt(0),BigInt(1)),R=BigInt(2),C=e=>e instanceof Uint8Array,U=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function L(e){if(!C(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=U[e[n]];return t}function N(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function T(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[t]=o}return n}function O(e){return N(L(e))}function F(e){if(!C(e))throw new Error("Uint8Array expected");return N(L(Uint8Array.from(e).reverse()))}function P(e,t){return T(e.toString(16).padStart(2*t,"0"))}function $(e,t){return P(e,t).reverse()}function H(e,t,n){let r;if("string"==typeof t)try{r=T(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!C(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}function q(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!C(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const z=e=>(R<<BigInt(e-1))-I,D=e=>new Uint8Array(e),j=e=>Uint8Array.from(e);function K(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=D(e),i=D(e),o=0;const s=()=>{r.fill(1),i.fill(0),o=0},a=(...e)=>n(i,r,...e),c=(e=D())=>{i=a(j([0]),e),r=a(),0!==e.length&&(i=a(j([1]),e),r=a())},h=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return q(...n)};return(e,t)=>{let n;for(s(),c(e);!(n=t(h()));)c();return s(),n}}const M={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function V(e,t,n={}){const r=(t,n,r)=>{const i=M[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const o=e[t];if(!(r&&void 0===o||i(o,e)))throw new Error(`Invalid param ${String(t)}=${o} (${typeof o}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}const W=BigInt(0),Z=BigInt(1),G=BigInt(2),Y=BigInt(3),J=BigInt(4),Q=BigInt(5),X=BigInt(8);BigInt(9),BigInt(16);function ee(e,t){const n=e%t;return n>=W?n:t+n}function te(e,t,n){if(n<=W||t<W)throw new Error("Expected power/modulo > 0");if(n===Z)return W;let r=Z;for(;t>W;)t&Z&&(r=r*e%n),e=e*e%n,t>>=Z;return r}function ne(e,t,n){let r=e;for(;t-- >W;)r*=r,r%=n;return r}function re(e,t){if(e===W||t<=W)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=ee(e,t),r=t,i=W,o=Z,s=Z,a=W;for(;n!==W;){const e=r/n,t=r%n,c=i-s*e,h=o-a*e;r=n,n=t,i=s,o=a,s=c,a=h}if(r!==Z)throw new Error("invert: does not exist");return ee(i,t)}function ie(e){if(e%J===Y){const t=(e+Z)/J;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%X===Q){const t=(e-Q)/X;return function(e,n){const r=e.mul(n,G),i=e.pow(r,t),o=e.mul(n,i),s=e.mul(e.mul(o,G),i),a=e.mul(o,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Z)/G;let n,r,i;for(n=e-Z,r=0;n%G===W;n/=G,r++);for(i=G;i<e&&te(i,t,e)!==e-Z;i++);if(1===r){const t=(e+Z)/J;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+Z)/G;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),h=e.pow(s,o),l=e.pow(s,n);for(;!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(l);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,Z<<BigInt(a-t-1));c=e.sqr(n),h=e.mul(h,n),l=e.mul(l,c),a=t}return h}}(e)}const oe=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function se(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}const ae=BigInt(0),ce=BigInt(1);function he(e){return V(e.Fp,oe.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),V(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...se(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const{Ph:le,aT:ue}=e,de={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=de;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:le(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=de,n="string"==typeof e?ue(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=de._parseInt(n.subarray(2)),{d:s,l:a}=de._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),i=t(n(e.r)),o=r.length/2,s=i.length/2,a=n(o),c=n(s);return`30${n(s+o+4)}02${c}${i}02${a}${r}`}},fe=BigInt(0),pe=BigInt(1),ge=(BigInt(2),BigInt(3));BigInt(4);function ye(e){const t=function(e){const t=he(e);V(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return q(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,o=n.sqr(e),s=n.mul(o,e);return n.add(n.add(s,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&fe<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:o}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=L(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:O(H("private key",e,r))}catch(t){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return i&&(s=ee(s,o)),a(s),s}const h=new Map;function l(e){if(!(e instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof u)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?u.ZERO:new u(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}static fromHex(e){const t=u.fromAffine(i(H("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return u.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,h.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint)return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),s=o(e);if(!n.eql(i,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){l(e);const{px:t,py:r,pz:i}=this,{px:o,py:s,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(o,i)),h=n.eql(n.mul(r,a),n.mul(s,i));return c&&h}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,ge),{px:o,py:s,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(o,o),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(o,s);return g=n.add(g,g),l=n.mul(o,a),l=n.add(l,l),c=n.mul(e,l),h=n.mul(i,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(i,l),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(e){l(e);const{px:r,py:i,pz:o}=this,{px:s,py:a,pz:c}=e;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,ge);let y=n.mul(r,s),w=n.mul(i,a),b=n.mul(o,c),m=n.add(r,i),E=n.add(s,a);m=n.mul(m,E),E=n.add(y,w),m=n.sub(m,E),E=n.add(r,o);let v=n.add(s,c);return E=n.mul(E,v),v=n.add(y,b),E=n.sub(E,v),v=n.add(i,o),h=n.add(a,c),v=n.mul(v,h),h=n.add(w,b),v=n.sub(v,h),f=n.mul(p,E),h=n.mul(g,b),f=n.add(h,f),h=n.sub(w,f),f=n.add(w,f),d=n.mul(h,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),E=n.mul(g,E),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),E=n.add(E,b),y=n.mul(w,E),d=n.add(d,y),y=n.mul(v,E),h=n.mul(m,h),h=n.sub(h,y),y=n.mul(m,w),f=n.mul(v,f),f=n.add(f,y),new u(h,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(u.ZERO)}wNAF(e){return f.wNAFCached(this,h,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}))}multiplyUnsafe(e){const r=u.ZERO;if(e===fe)return r;if(a(e),e===pe)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:c,k2:h}=i.splitScalar(e),l=r,d=r,p=this;for(;s>fe||h>fe;)s&pe&&(l=l.add(p)),h&pe&&(d=d.add(p)),p=p.double(),s>>=pe,h>>=pe;return o&&(l=l.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,i.beta),d.py,d.pz),l.add(d)}multiply(e){a(e);let r,i,o=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:c}=s.splitScalar(o);let{p:h,f:l}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(e,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,s.beta),d.py,d.pz),r=h.add(d),i=l.add(p)}else{const{p:e,f:t}=this.wNAF(o);r=e,i=t}return u.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=u.BASE,i=(e,t)=>t!==fe&&t!==pe&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){const{px:t,py:r,pz:i}=this,o=this.is0();null==e&&(e=o?n.ONE:n.inv(i));const s=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===pe)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===pe?this:n?n(u,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(u,this,e)}toHex(e=!0){return L(this.toRawBytes(e))}}u.BASE=new u(t.Gx,t.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>ae;)n&ce&&(r=r.add(i)),i=i.double(),n>>=ce;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),o=[];let s=e,a=s;for(let e=0;e<n;e++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){const{windows:s,windowSize:a}=r(t);let c=e.ZERO,h=e.BASE;const l=BigInt(2**t-1),u=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(o&l);o>>=d,r>a&&(r-=u,o+=ce);const s=t,f=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?h=h.add(n(p,i[s])):c=c.add(n(g,i[f]))}return{p:c,f:h}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,r(o))),this.wNAF(i,o,n)}}}(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function we(e){const t=function(e){const t=he(e);return V(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,o=2*n.BYTES+1;function s(e){return ee(e,r)}function a(e){return re(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=ye({...t,toBytes(e,t,r){const i=t.toAffine(),o=n.toBytes(i.x),s=q;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===o&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}{const e=O(s);if(!(fe<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=l(e);let i=n.sqrt(t);return!(1&~r)!==((i&pe)===pe)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>L(P(e,t.nByteLength));function f(e){return e>r>>pe}const p=(e,t,n)=>O(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=H("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=de.toSig(H("DER",e));return new g(t,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r,s:i,recovery:o}=this,h=m(H("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const l=2===o||3===o?r+t.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&o?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=s(-h*p),y=s(i*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return T(this.toDERHex())}toDERHex(){return de.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return T(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return h(e),!0}catch(e){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const e=function(e,t,n=!1){const r=(e=H("privateHash",e)).length,i=se(t).nByteLength+8;if(i<24||r<i||r>1024)throw new Error(`hashToPrivateScalar: expected ${i}-1024 bytes of input, got ${r}`);return ee(n?F(e):O(e),t-Z)+Z}(t.randomBytes(n.BYTES+8),r);return P(e,t.nByteLength)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===o:n?r===2*i||r===2*o:e instanceof c}const b=t.bits2int||function(e){const n=O(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},m=t.bits2int_modN||function(e){return s(b(e))},E=z(t.nBitLength);function v(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(fe<=e&&e<E))throw new Error(`bigint expected < 2^${t.nBitLength}`);return P(e,t.nByteLength)}function x(e,r,i=k){if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:l}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=H("msgHash",e),p&&(e=H("prehashed msgHash",o(e)));const w=m(e),E=h(r),x=[v(E),v(w)];if(null!=y){const e=!0===y?l(n.BYTES):y;x.push(H("extraEntropy",e,n.BYTES))}const A=q(...x),S=w;return{seed:A,k2sig:function(e){const t=b(e);if(!u(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=s(r.x);if(i===fe)return;const o=s(n*s(S+i*E));if(o===fe)return;let h=(r.x===i?0:2)|Number(r.y&pe),l=o;return d&&f(o)&&(l=function(e){return f(e)?s(-e):e}(o),h^=1),new g(i,l,h)}}}const k={lowS:t.lowS,prehash:!1},A={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(h(e)).toRawBytes(n)},sign:function(e,n,r=k){const{seed:i,k2sig:o}=x(e,n,r),s=t;return K(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(e,n,r,i=A){const o=e;if(n=H("msgHash",n),r=H("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:l}=i;let u,d;try{if("string"==typeof o||o instanceof Uint8Array)try{u=g.fromDER(o)}catch(e){if(!(e instanceof de.Err))throw e;u=g.fromCompact(o)}else{if("object"!=typeof o||"bigint"!=typeof o.r||"bigint"!=typeof o.s)throw new Error("PARSE");{const{r:e,s:t}=o;u=new g(e,t)}}d=c.fromHex(r)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=t.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=s(y*w),E=s(f*w),v=c.BASE.multiplyAndAddUnsafe(d,b,E)?.toAffine();return!!v&&s(v.x)===f},ProjectivePoint:c,Signature:g,utils:y}}class be extends w{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,a.hash(e);const n=g(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return a.exists(this),this.iHash.update(e),this}digestInto(e){a.exists(this),a.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const me=(e,t,n)=>new be(e,t).update(n).digest();function Ee(e){return{hash:e,hmac:(t,...n)=>me(e,t,y(...n)),randomBytes:m}}me.create=(e,t)=>new be(e,t);const ve=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),xe=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),ke=BigInt(1),Ae=BigInt(2),Se=(e,t)=>(e+t/Ae)/t;function Be(e){const t=ve,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),h=e*e*e%t,l=h*h*e%t,u=ne(l,n,t)*l%t,d=ne(u,n,t)*l%t,f=ne(d,Ae,t)*h%t,p=ne(f,i,t)*f%t,g=ne(p,o,t)*p%t,y=ne(g,a,t)*g%t,w=ne(y,c,t)*y%t,b=ne(w,a,t)*g%t,m=ne(b,n,t)*l%t,E=ne(m,s,t)*p%t,v=ne(E,r,t)*h%t,x=ne(v,Ae,t);if(!_e.eql(_e.sqr(x),e))throw new Error("Cannot find square root");return x}const _e=function(e,t,n=!1,r={}){if(e<=W)throw new Error(`Expected Fp ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=se(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=ie(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:z(i),ZERO:W,ONE:Z,create:t=>ee(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return W<=t&&t<e},is0:e=>e===W,isOdd:e=>(e&Z)===Z,neg:t=>ee(-t,e),eql:(e,t)=>e===t,sqr:t=>ee(t*t,e),add:(t,n)=>ee(t+n,e),sub:(t,n)=>ee(t-n,e),mul:(t,n)=>ee(t*n,e),pow:(e,t)=>function(e,t,n){if(n<W)throw new Error("Expected power > 0");if(n===W)return e.ONE;if(n===Z)return t;let r=e.ONE,i=t;for(;n>W;)n&Z&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Z;return r}(a,e,t),div:(t,n)=>ee(t*re(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>re(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?$(e,o):P(e,o),fromBytes:e=>{if(e.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${e.length}`);return n?F(e):O(e)}});return Object.freeze(a)}(ve,void 0,void 0,{sqrt:Be}),Ie=function(e,t){const n=t=>we({...e,...Ee(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:_e,n:xe,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=xe,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-ke*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=Se(o*e,t),c=Se(-r*e,t);let h=ee(e-a*n-c*i,t),l=ee(-a*r-c*o,t);const u=h>s,d=l>s;if(u&&(h=t-h),d&&(l=t-l),h>s||l>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},_),Re=BigInt(0),Ce=e=>"bigint"==typeof e&&Re<e&&e<ve,Ue=e=>"bigint"==typeof e&&Re<e&&e<xe,Le={};function Ne(e,...t){let n=Le[e];if(void 0===n){const t=_(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=q(t,t),Le[e]=n}return _(q(n,...t))}const Te=e=>e.toRawBytes(!0).slice(1),Oe=e=>P(e,32),Fe=e=>ee(e,ve),Pe=e=>ee(e,xe),$e=Ie.ProjectivePoint,He=(e,t,n)=>$e.BASE.multiplyAndAddUnsafe(e,t,n);function qe(e){let t=Ie.utils.normPrivateKeyToScalar(e),n=$e.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:Pe(-t),bytes:Te(n)}}function ze(e){if(!Ce(e))throw new Error("bad x: need 0 < x < p");const t=Fe(e*e);let n=Be(Fe(t*e+BigInt(7)));n%Ae!==Re&&(n=Fe(-n));const r=new $e(e,n,ke);return r.assertValidity(),r}function De(...e){return Pe(O(Ne("BIP0340/challenge",...e)))}function je(e){return qe(e).bytes}function Ke(e,t,n=m(32)){const r=H("message",e),{bytes:i,scalar:o}=qe(t),s=H("auxRand",n,32),a=Oe(o^O(Ne("BIP0340/aux",s))),c=Ne("BIP0340/nonce",a,i,r),h=Pe(O(c));if(h===Re)throw new Error("sign failed: k is zero");const{bytes:l,scalar:u}=qe(h),d=De(l,i,r),f=new Uint8Array(64);if(f.set(l,0),f.set(Oe(Pe(u+d*o)),32),!Me(f,r,i))throw new Error("sign: Invalid signature produced");return f}function Me(e,t,n){const r=H("signature",e,64),i=H("message",t),o=H("publicKey",n,32);try{const e=ze(O(o)),t=O(r.subarray(0,32));if(!Ce(t))return!1;const n=O(r.subarray(32,64));if(!Ue(n))return!1;const s=De(Oe(t),Te(e),i),a=He(e,n,Pe(-s));return!(!a||!a.hasEvenY()||a.toAffine().x!==t)}catch(e){return!1}}const Ve=(()=>({getPublicKey:je,sign:Ke,verify:Me,utils:{randomPrivateKey:Ie.utils.randomPrivateKey,lift_x:ze,pointToBytes:Te,numberToBytesBE:P,bytesToNumberBE:O,taggedHash:Ne,mod:ee}}))();function We(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function Ze(...e){const t=(e,t)=>n=>e(t(n)),n=Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),r=e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0);return{encode:n,decode:r}}function Ge(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(We(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function Ye(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function Je(e,t="="){if(We(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Qe(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function Xe(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],o=Array.from(e);for(o.forEach((e=>{if(We(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,s=!0;for(let i=r;i<o.length;i++){const a=o[i],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");if(e=c%n,o[i]=Math.floor(c/n),!Number.isSafeInteger(o[i])||o[i]*n+e!==c)throw new Error("convertRadix: carry overflow");s&&(o[i]?s=!1:r=i)}if(i.push(e),s)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}const et=(e,t)=>t?et(t,e%t):e,tt=(e,t)=>e+(t-et(e,t));function nt(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(tt(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${tt(t,n)}`);let i=0,o=0;const s=2**n-1,a=[];for(const r of e){if(We(r),r>=2**t)throw new Error(`convertRadix2: invalid data word=${r} from=${t}`);if(i=i<<t|r,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=n;o-=n)a.push((i>>o-n&s)>>>0);i&=2**o-1}if(i=i<<n-o&s,!r&&o>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&o>0&&a.push(i>>>0),a}function rt(e){return We(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return Xe(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(Xe(t,e,256))}}}function it(e,t=!1){if(We(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(tt(8,e)>32||tt(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return nt(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(nt(n,e,8,t))}}}function ot(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}const st=Ze(it(4),Ge("0123456789ABCDEF"),Ye("")),at=Ze(it(5),Ge("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Je(5),Ye("")),ct=(Ze(it(5),Ge("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Je(5),Ye("")),Ze(it(5),Ge("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),Ye(""),Qe((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),Ze(it(6),Ge("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Je(6),Ye(""))),ht=Ze(it(6),Ge("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Je(6),Ye("")),lt=e=>Ze(rt(58),Ge(e),Ye("")),ut=lt("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),dt=(lt("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),lt("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),[0,2,3,5,6,7,9,10,11]),ft={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=ut.encode(r).padStart(dt[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=dt.indexOf(r.length),o=ut.decode(r);for(let e=0;e<o.length-i;e++)if(0!==o[e])throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(o.slice(o.length-i)))}return Uint8Array.from(t)}},pt=Ze(Ge("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),Ye("")),gt=[996825010,642813549,513874426,1027748829,705979059];function yt(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<gt.length;e++)1==(t>>e&1)&&(n^=gt[e]);return n}function wt(e,t,n=1){const r=e.length;let i=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);i=yt(i)^n>>5}i=yt(i);for(let t=0;t<r;t++)i=yt(i)^31&e.charCodeAt(t);for(let e of t)i=yt(i)^e;for(let e=0;e<6;e++)i=yt(i);return i^=n,pt.encode(nt([i%2**30],30,5,!1))}function bt(e){const t="bech32"===e?1:734539939,n=it(5),r=n.decode,i=n.encode,o=ot(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(e=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const o=e.slice(0,i),s=e.slice(i+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=pt.decode(s).slice(0,-6),c=wt(o,a,t);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:o,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=e.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${pt.encode(n)}${wt(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:ot(s),fromWords:r,fromWordsUnsafe:o,toWords:i}}const mt=bt("bech32"),Et=(bt("bech32m"),{encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)}),vt=(Ze(it(4),Ge("0123456789abcdef"),Ye(""),Qe((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}))),"abandon\nability\nable\nabout\nabove\nabsent\nabsorb\nabstract\nabsurd\nabuse\naccess\naccident\naccount\naccuse\nachieve\nacid\nacoustic\nacquire\nacross\nact\naction\nactor\nactress\nactual\nadapt\nadd\naddict\naddress\nadjust\nadmit\nadult\nadvance\nadvice\naerobic\naffair\nafford\nafraid\nagain\nage\nagent\nagree\nahead\naim\nair\nairport\naisle\nalarm\nalbum\nalcohol\nalert\nalien\nall\nalley\nallow\nalmost\nalone\nalpha\nalready\nalso\nalter\nalways\namateur\namazing\namong\namount\namused\nanalyst\nanchor\nancient\nanger\nangle\nangry\nanimal\nankle\nannounce\nannual\nanother\nanswer\nantenna\nantique\nanxiety\nany\napart\napology\nappear\napple\napprove\napril\narch\narctic\narea\narena\nargue\narm\narmed\narmor\narmy\naround\narrange\narrest\narrive\narrow\nart\nartefact\nartist\nartwork\nask\naspect\nassault\nasset\nassist\nassume\nasthma\nathlete\natom\nattack\nattend\nattitude\nattract\nauction\naudit\naugust\naunt\nauthor\nauto\nautumn\naverage\navocado\navoid\nawake\naware\naway\nawesome\nawful\nawkward\naxis\nbaby\nbachelor\nbacon\nbadge\nbag\nbalance\nbalcony\nball\nbamboo\nbanana\nbanner\nbar\nbarely\nbargain\nbarrel\nbase\nbasic\nbasket\nbattle\nbeach\nbean\nbeauty\nbecause\nbecome\nbeef\nbefore\nbegin\nbehave\nbehind\nbelieve\nbelow\nbelt\nbench\nbenefit\nbest\nbetray\nbetter\nbetween\nbeyond\nbicycle\nbid\nbike\nbind\nbiology\nbird\nbirth\nbitter\nblack\nblade\nblame\nblanket\nblast\nbleak\nbless\nblind\nblood\nblossom\nblouse\nblue\nblur\nblush\nboard\nboat\nbody\nboil\nbomb\nbone\nbonus\nbook\nboost\nborder\nboring\nborrow\nboss\nbottom\nbounce\nbox\nboy\nbracket\nbrain\nbrand\nbrass\nbrave\nbread\nbreeze\nbrick\nbridge\nbrief\nbright\nbring\nbrisk\nbroccoli\nbroken\nbronze\nbroom\nbrother\nbrown\nbrush\nbubble\nbuddy\nbudget\nbuffalo\nbuild\nbulb\nbulk\nbullet\nbundle\nbunker\nburden\nburger\nburst\nbus\nbusiness\nbusy\nbutter\nbuyer\nbuzz\ncabbage\ncabin\ncable\ncactus\ncage\ncake\ncall\ncalm\ncamera\ncamp\ncan\ncanal\ncancel\ncandy\ncannon\ncanoe\ncanvas\ncanyon\ncapable\ncapital\ncaptain\ncar\ncarbon\ncard\ncargo\ncarpet\ncarry\ncart\ncase\ncash\ncasino\ncastle\ncasual\ncat\ncatalog\ncatch\ncategory\ncattle\ncaught\ncause\ncaution\ncave\nceiling\ncelery\ncement\ncensus\ncentury\ncereal\ncertain\nchair\nchalk\nchampion\nchange\nchaos\nchapter\ncharge\nchase\nchat\ncheap\ncheck\ncheese\nchef\ncherry\nchest\nchicken\nchief\nchild\nchimney\nchoice\nchoose\nchronic\nchuckle\nchunk\nchurn\ncigar\ncinnamon\ncircle\ncitizen\ncity\ncivil\nclaim\nclap\nclarify\nclaw\nclay\nclean\nclerk\nclever\nclick\nclient\ncliff\nclimb\nclinic\nclip\nclock\nclog\nclose\ncloth\ncloud\nclown\nclub\nclump\ncluster\nclutch\ncoach\ncoast\ncoconut\ncode\ncoffee\ncoil\ncoin\ncollect\ncolor\ncolumn\ncombine\ncome\ncomfort\ncomic\ncommon\ncompany\nconcert\nconduct\nconfirm\ncongress\nconnect\nconsider\ncontrol\nconvince\ncook\ncool\ncopper\ncopy\ncoral\ncore\ncorn\ncorrect\ncost\ncotton\ncouch\ncountry\ncouple\ncourse\ncousin\ncover\ncoyote\ncrack\ncradle\ncraft\ncram\ncrane\ncrash\ncrater\ncrawl\ncrazy\ncream\ncredit\ncreek\ncrew\ncricket\ncrime\ncrisp\ncritic\ncrop\ncross\ncrouch\ncrowd\ncrucial\ncruel\ncruise\ncrumble\ncrunch\ncrush\ncry\ncrystal\ncube\nculture\ncup\ncupboard\ncurious\ncurrent\ncurtain\ncurve\ncushion\ncustom\ncute\ncycle\ndad\ndamage\ndamp\ndance\ndanger\ndaring\ndash\ndaughter\ndawn\nday\ndeal\ndebate\ndebris\ndecade\ndecember\ndecide\ndecline\ndecorate\ndecrease\ndeer\ndefense\ndefine\ndefy\ndegree\ndelay\ndeliver\ndemand\ndemise\ndenial\ndentist\ndeny\ndepart\ndepend\ndeposit\ndepth\ndeputy\nderive\ndescribe\ndesert\ndesign\ndesk\ndespair\ndestroy\ndetail\ndetect\ndevelop\ndevice\ndevote\ndiagram\ndial\ndiamond\ndiary\ndice\ndiesel\ndiet\ndiffer\ndigital\ndignity\ndilemma\ndinner\ndinosaur\ndirect\ndirt\ndisagree\ndiscover\ndisease\ndish\ndismiss\ndisorder\ndisplay\ndistance\ndivert\ndivide\ndivorce\ndizzy\ndoctor\ndocument\ndog\ndoll\ndolphin\ndomain\ndonate\ndonkey\ndonor\ndoor\ndose\ndouble\ndove\ndraft\ndragon\ndrama\ndrastic\ndraw\ndream\ndress\ndrift\ndrill\ndrink\ndrip\ndrive\ndrop\ndrum\ndry\nduck\ndumb\ndune\nduring\ndust\ndutch\nduty\ndwarf\ndynamic\neager\neagle\nearly\nearn\nearth\neasily\neast\neasy\necho\necology\neconomy\nedge\nedit\neducate\neffort\negg\neight\neither\nelbow\nelder\nelectric\nelegant\nelement\nelephant\nelevator\nelite\nelse\nembark\nembody\nembrace\nemerge\nemotion\nemploy\nempower\nempty\nenable\nenact\nend\nendless\nendorse\nenemy\nenergy\nenforce\nengage\nengine\nenhance\nenjoy\nenlist\nenough\nenrich\nenroll\nensure\nenter\nentire\nentry\nenvelope\nepisode\nequal\nequip\nera\nerase\nerode\nerosion\nerror\nerupt\nescape\nessay\nessence\nestate\neternal\nethics\nevidence\nevil\nevoke\nevolve\nexact\nexample\nexcess\nexchange\nexcite\nexclude\nexcuse\nexecute\nexercise\nexhaust\nexhibit\nexile\nexist\nexit\nexotic\nexpand\nexpect\nexpire\nexplain\nexpose\nexpress\nextend\nextra\neye\neyebrow\nfabric\nface\nfaculty\nfade\nfaint\nfaith\nfall\nfalse\nfame\nfamily\nfamous\nfan\nfancy\nfantasy\nfarm\nfashion\nfat\nfatal\nfather\nfatigue\nfault\nfavorite\nfeature\nfebruary\nfederal\nfee\nfeed\nfeel\nfemale\nfence\nfestival\nfetch\nfever\nfew\nfiber\nfiction\nfield\nfigure\nfile\nfilm\nfilter\nfinal\nfind\nfine\nfinger\nfinish\nfire\nfirm\nfirst\nfiscal\nfish\nfit\nfitness\nfix\nflag\nflame\nflash\nflat\nflavor\nflee\nflight\nflip\nfloat\nflock\nfloor\nflower\nfluid\nflush\nfly\nfoam\nfocus\nfog\nfoil\nfold\nfollow\nfood\nfoot\nforce\nforest\nforget\nfork\nfortune\nforum\nforward\nfossil\nfoster\nfound\nfox\nfragile\nframe\nfrequent\nfresh\nfriend\nfringe\nfrog\nfront\nfrost\nfrown\nfrozen\nfruit\nfuel\nfun\nfunny\nfurnace\nfury\nfuture\ngadget\ngain\ngalaxy\ngallery\ngame\ngap\ngarage\ngarbage\ngarden\ngarlic\ngarment\ngas\ngasp\ngate\ngather\ngauge\ngaze\ngeneral\ngenius\ngenre\ngentle\ngenuine\ngesture\nghost\ngiant\ngift\ngiggle\nginger\ngiraffe\ngirl\ngive\nglad\nglance\nglare\nglass\nglide\nglimpse\nglobe\ngloom\nglory\nglove\nglow\nglue\ngoat\ngoddess\ngold\ngood\ngoose\ngorilla\ngospel\ngossip\ngovern\ngown\ngrab\ngrace\ngrain\ngrant\ngrape\ngrass\ngravity\ngreat\ngreen\ngrid\ngrief\ngrit\ngrocery\ngroup\ngrow\ngrunt\nguard\nguess\nguide\nguilt\nguitar\ngun\ngym\nhabit\nhair\nhalf\nhammer\nhamster\nhand\nhappy\nharbor\nhard\nharsh\nharvest\nhat\nhave\nhawk\nhazard\nhead\nhealth\nheart\nheavy\nhedgehog\nheight\nhello\nhelmet\nhelp\nhen\nhero\nhidden\nhigh\nhill\nhint\nhip\nhire\nhistory\nhobby\nhockey\nhold\nhole\nholiday\nhollow\nhome\nhoney\nhood\nhope\nhorn\nhorror\nhorse\nhospital\nhost\nhotel\nhour\nhover\nhub\nhuge\nhuman\nhumble\nhumor\nhundred\nhungry\nhunt\nhurdle\nhurry\nhurt\nhusband\nhybrid\nice\nicon\nidea\nidentify\nidle\nignore\nill\nillegal\nillness\nimage\nimitate\nimmense\nimmune\nimpact\nimpose\nimprove\nimpulse\ninch\ninclude\nincome\nincrease\nindex\nindicate\nindoor\nindustry\ninfant\ninflict\ninform\ninhale\ninherit\ninitial\ninject\ninjury\ninmate\ninner\ninnocent\ninput\ninquiry\ninsane\ninsect\ninside\ninspire\ninstall\nintact\ninterest\ninto\ninvest\ninvite\ninvolve\niron\nisland\nisolate\nissue\nitem\nivory\njacket\njaguar\njar\njazz\njealous\njeans\njelly\njewel\njob\njoin\njoke\njourney\njoy\njudge\njuice\njump\njungle\njunior\njunk\njust\nkangaroo\nkeen\nkeep\nketchup\nkey\nkick\nkid\nkidney\nkind\nkingdom\nkiss\nkit\nkitchen\nkite\nkitten\nkiwi\nknee\nknife\nknock\nknow\nlab\nlabel\nlabor\nladder\nlady\nlake\nlamp\nlanguage\nlaptop\nlarge\nlater\nlatin\nlaugh\nlaundry\nlava\nlaw\nlawn\nlawsuit\nlayer\nlazy\nleader\nleaf\nlearn\nleave\nlecture\nleft\nleg\nlegal\nlegend\nleisure\nlemon\nlend\nlength\nlens\nleopard\nlesson\nletter\nlevel\nliar\nliberty\nlibrary\nlicense\nlife\nlift\nlight\nlike\nlimb\nlimit\nlink\nlion\nliquid\nlist\nlittle\nlive\nlizard\nload\nloan\nlobster\nlocal\nlock\nlogic\nlonely\nlong\nloop\nlottery\nloud\nlounge\nlove\nloyal\nlucky\nluggage\nlumber\nlunar\nlunch\nluxury\nlyrics\nmachine\nmad\nmagic\nmagnet\nmaid\nmail\nmain\nmajor\nmake\nmammal\nman\nmanage\nmandate\nmango\nmansion\nmanual\nmaple\nmarble\nmarch\nmargin\nmarine\nmarket\nmarriage\nmask\nmass\nmaster\nmatch\nmaterial\nmath\nmatrix\nmatter\nmaximum\nmaze\nmeadow\nmean\nmeasure\nmeat\nmechanic\nmedal\nmedia\nmelody\nmelt\nmember\nmemory\nmention\nmenu\nmercy\nmerge\nmerit\nmerry\nmesh\nmessage\nmetal\nmethod\nmiddle\nmidnight\nmilk\nmillion\nmimic\nmind\nminimum\nminor\nminute\nmiracle\nmirror\nmisery\nmiss\nmistake\nmix\nmixed\nmixture\nmobile\nmodel\nmodify\nmom\nmoment\nmonitor\nmonkey\nmonster\nmonth\nmoon\nmoral\nmore\nmorning\nmosquito\nmother\nmotion\nmotor\nmountain\nmouse\nmove\nmovie\nmuch\nmuffin\nmule\nmultiply\nmuscle\nmuseum\nmushroom\nmusic\nmust\nmutual\nmyself\nmystery\nmyth\nnaive\nname\nnapkin\nnarrow\nnasty\nnation\nnature\nnear\nneck\nneed\nnegative\nneglect\nneither\nnephew\nnerve\nnest\nnet\nnetwork\nneutral\nnever\nnews\nnext\nnice\nnight\nnoble\nnoise\nnominee\nnoodle\nnormal\nnorth\nnose\nnotable\nnote\nnothing\nnotice\nnovel\nnow\nnuclear\nnumber\nnurse\nnut\noak\nobey\nobject\noblige\nobscure\nobserve\nobtain\nobvious\noccur\nocean\noctober\nodor\noff\noffer\noffice\noften\noil\nokay\nold\nolive\nolympic\nomit\nonce\none\nonion\nonline\nonly\nopen\nopera\nopinion\noppose\noption\norange\norbit\norchard\norder\nordinary\norgan\norient\noriginal\norphan\nostrich\nother\noutdoor\nouter\noutput\noutside\noval\noven\nover\nown\nowner\noxygen\noyster\nozone\npact\npaddle\npage\npair\npalace\npalm\npanda\npanel\npanic\npanther\npaper\nparade\nparent\npark\nparrot\nparty\npass\npatch\npath\npatient\npatrol\npattern\npause\npave\npayment\npeace\npeanut\npear\npeasant\npelican\npen\npenalty\npencil\npeople\npepper\nperfect\npermit\nperson\npet\nphone\nphoto\nphrase\nphysical\npiano\npicnic\npicture\npiece\npig\npigeon\npill\npilot\npink\npioneer\npipe\npistol\npitch\npizza\nplace\nplanet\nplastic\nplate\nplay\nplease\npledge\npluck\nplug\nplunge\npoem\npoet\npoint\npolar\npole\npolice\npond\npony\npool\npopular\nportion\nposition\npossible\npost\npotato\npottery\npoverty\npowder\npower\npractice\npraise\npredict\nprefer\nprepare\npresent\npretty\nprevent\nprice\npride\nprimary\nprint\npriority\nprison\nprivate\nprize\nproblem\nprocess\nproduce\nprofit\nprogram\nproject\npromote\nproof\nproperty\nprosper\nprotect\nproud\nprovide\npublic\npudding\npull\npulp\npulse\npumpkin\npunch\npupil\npuppy\npurchase\npurity\npurpose\npurse\npush\nput\npuzzle\npyramid\nquality\nquantum\nquarter\nquestion\nquick\nquit\nquiz\nquote\nrabbit\nraccoon\nrace\nrack\nradar\nradio\nrail\nrain\nraise\nrally\nramp\nranch\nrandom\nrange\nrapid\nrare\nrate\nrather\nraven\nraw\nrazor\nready\nreal\nreason\nrebel\nrebuild\nrecall\nreceive\nrecipe\nrecord\nrecycle\nreduce\nreflect\nreform\nrefuse\nregion\nregret\nregular\nreject\nrelax\nrelease\nrelief\nrely\nremain\nremember\nremind\nremove\nrender\nrenew\nrent\nreopen\nrepair\nrepeat\nreplace\nreport\nrequire\nrescue\nresemble\nresist\nresource\nresponse\nresult\nretire\nretreat\nreturn\nreunion\nreveal\nreview\nreward\nrhythm\nrib\nribbon\nrice\nrich\nride\nridge\nrifle\nright\nrigid\nring\nriot\nripple\nrisk\nritual\nrival\nriver\nroad\nroast\nrobot\nrobust\nrocket\nromance\nroof\nrookie\nroom\nrose\nrotate\nrough\nround\nroute\nroyal\nrubber\nrude\nrug\nrule\nrun\nrunway\nrural\nsad\nsaddle\nsadness\nsafe\nsail\nsalad\nsalmon\nsalon\nsalt\nsalute\nsame\nsample\nsand\nsatisfy\nsatoshi\nsauce\nsausage\nsave\nsay\nscale\nscan\nscare\nscatter\nscene\nscheme\nschool\nscience\nscissors\nscorpion\nscout\nscrap\nscreen\nscript\nscrub\nsea\nsearch\nseason\nseat\nsecond\nsecret\nsection\nsecurity\nseed\nseek\nsegment\nselect\nsell\nseminar\nsenior\nsense\nsentence\nseries\nservice\nsession\nsettle\nsetup\nseven\nshadow\nshaft\nshallow\nshare\nshed\nshell\nsheriff\nshield\nshift\nshine\nship\nshiver\nshock\nshoe\nshoot\nshop\nshort\nshoulder\nshove\nshrimp\nshrug\nshuffle\nshy\nsibling\nsick\nside\nsiege\nsight\nsign\nsilent\nsilk\nsilly\nsilver\nsimilar\nsimple\nsince\nsing\nsiren\nsister\nsituate\nsix\nsize\nskate\nsketch\nski\nskill\nskin\nskirt\nskull\nslab\nslam\nsleep\nslender\nslice\nslide\nslight\nslim\nslogan\nslot\nslow\nslush\nsmall\nsmart\nsmile\nsmoke\nsmooth\nsnack\nsnake\nsnap\nsniff\nsnow\nsoap\nsoccer\nsocial\nsock\nsoda\nsoft\nsolar\nsoldier\nsolid\nsolution\nsolve\nsomeone\nsong\nsoon\nsorry\nsort\nsoul\nsound\nsoup\nsource\nsouth\nspace\nspare\nspatial\nspawn\nspeak\nspecial\nspeed\nspell\nspend\nsphere\nspice\nspider\nspike\nspin\nspirit\nsplit\nspoil\nsponsor\nspoon\nsport\nspot\nspray\nspread\nspring\nspy\nsquare\nsqueeze\nsquirrel\nstable\nstadium\nstaff\nstage\nstairs\nstamp\nstand\nstart\nstate\nstay\nsteak\nsteel\nstem\nstep\nstereo\nstick\nstill\nsting\nstock\nstomach\nstone\nstool\nstory\nstove\nstrategy\nstreet\nstrike\nstrong\nstruggle\nstudent\nstuff\nstumble\nstyle\nsubject\nsubmit\nsubway\nsuccess\nsuch\nsudden\nsuffer\nsugar\nsuggest\nsuit\nsummer\nsun\nsunny\nsunset\nsuper\nsupply\nsupreme\nsure\nsurface\nsurge\nsurprise\nsurround\nsurvey\nsuspect\nsustain\nswallow\nswamp\nswap\nswarm\nswear\nsweet\nswift\nswim\nswing\nswitch\nsword\nsymbol\nsymptom\nsyrup\nsystem\ntable\ntackle\ntag\ntail\ntalent\ntalk\ntank\ntape\ntarget\ntask\ntaste\ntattoo\ntaxi\nteach\nteam\ntell\nten\ntenant\ntennis\ntent\nterm\ntest\ntext\nthank\nthat\ntheme\nthen\ntheory\nthere\nthey\nthing\nthis\nthought\nthree\nthrive\nthrow\nthumb\nthunder\nticket\ntide\ntiger\ntilt\ntimber\ntime\ntiny\ntip\ntired\ntissue\ntitle\ntoast\ntobacco\ntoday\ntoddler\ntoe\ntogether\ntoilet\ntoken\ntomato\ntomorrow\ntone\ntongue\ntonight\ntool\ntooth\ntop\ntopic\ntopple\ntorch\ntornado\ntortoise\ntoss\ntotal\ntourist\ntoward\ntower\ntown\ntoy\ntrack\ntrade\ntraffic\ntragic\ntrain\ntransfer\ntrap\ntrash\ntravel\ntray\ntreat\ntree\ntrend\ntrial\ntribe\ntrick\ntrigger\ntrim\ntrip\ntrophy\ntrouble\ntruck\ntrue\ntruly\ntrumpet\ntrust\ntruth\ntry\ntube\ntuition\ntumble\ntuna\ntunnel\nturkey\nturn\nturtle\ntwelve\ntwenty\ntwice\ntwin\ntwist\ntwo\ntype\ntypical\nugly\numbrella\nunable\nunaware\nuncle\nuncover\nunder\nundo\nunfair\nunfold\nunhappy\nuniform\nunique\nunit\nuniverse\nunknown\nunlock\nuntil\nunusual\nunveil\nupdate\nupgrade\nuphold\nupon\nupper\nupset\nurban\nurge\nusage\nuse\nused\nuseful\nuseless\nusual\nutility\nvacant\nvacuum\nvague\nvalid\nvalley\nvalve\nvan\nvanish\nvapor\nvarious\nvast\nvault\nvehicle\nvelvet\nvendor\nventure\nvenue\nverb\nverify\nversion\nvery\nvessel\nveteran\nviable\nvibrant\nvicious\nvictory\nvideo\nview\nvillage\nvintage\nviolin\nvirtual\nvirus\nvisa\nvisit\nvisual\nvital\nvivid\nvocal\nvoice\nvoid\nvolcano\nvolume\nvote\nvoyage\nwage\nwagon\nwait\nwalk\nwall\nwalnut\nwant\nwarfare\nwarm\nwarrior\nwash\nwasp\nwaste\nwater\nwave\nway\nwealth\nweapon\nwear\nweasel\nweather\nweb\nwedding\nweekend\nweird\nwelcome\nwest\nwet\nwhale\nwhat\nwheat\nwheel\nwhen\nwhere\nwhip\nwhisper\nwide\nwidth\nwife\nwild\nwill\nwin\nwindow\nwine\nwing\nwink\nwinner\nwinter\nwire\nwisdom\nwise\nwish\nwitness\nwolf\nwoman\nwonder\nwood\nwool\nword\nwork\nworld\nworry\nworth\nwrap\nwreck\nwrestle\nwrist\nwrite\nwrong\nyard\nyear\nyellow\nyou\nyoung\nyouth\nzebra\nzero\nzone\nzoo".split("\n"));function xt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function kt(e,...t){if(!((n=e)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Expected Uint8Array");var n;if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function At(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");xt(e.outputLen),xt(e.blockLen)}function St(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Bt(e,t){kt(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const _t={number:xt,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:kt,hash:At,exists:St,output:Bt},It="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function Rt(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}const Ct=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ut=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Lt(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Rt(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class Nt{clone(){return this._cloneInto()}}const Tt={}.toString;function Ot(e){const t=t=>e().update(Lt(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}class Ft extends Nt{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,At(e);const n=Lt(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return St(this),this.iHash.update(e),this}digestInto(e){St(this),kt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Pt=(e,t,n)=>new Ft(e,t).update(n).digest();function $t(e,t,n,r){At(e);const i=function(e,t){if(void 0!==t&&"[object Object]"!==Tt.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)}({dkLen:32,asyncTick:10},r),{c:o,dkLen:s,asyncTick:a}=i;if(xt(o),xt(s),xt(a),o<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const c=Lt(t),h=Lt(n),l=new Uint8Array(s),u=Pt.create(e,c),d=u._cloneInto().update(h);return{c:o,dkLen:s,asyncTick:a,DK:l,PRF:u,PRFSalt:d}}function Ht(e,t,n,r,i){return e.destroy(),t.destroy(),r&&r.destroy(),i.fill(0),n}Pt.create=(e,t)=>new Ft(e,t);class qt extends Nt{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ct(this.buffer)}update(e){St(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Lt(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Ct(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){St(this),Bt(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,h=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=Ct(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const zt=(e,t,n)=>e&t^e&n^t&n,Dt=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),jt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Kt=new Uint32Array(64);class Mt extends qt{constructor(){super(64,32,8,!1),this.A=0|jt[0],this.B=0|jt[1],this.C=0|jt[2],this.D=0|jt[3],this.E=0|jt[4],this.F=0|jt[5],this.G=0|jt[6],this.H=0|jt[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)Kt[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Kt[e-15],n=Kt[e-2],r=Ut(t,7)^Ut(t,18)^t>>>3,i=Ut(n,17)^Ut(n,19)^n>>>10;Kt[e]=i+Kt[e-7]+r+Kt[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(Ut(s,6)^Ut(s,11)^Ut(s,25))+((l=s)&a^~l&c)+Dt[e]+Kt[e]|0,u=(Ut(n,2)^Ut(n,13)^Ut(n,22))+zt(n,r,i)|0;h=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,o,s,a,c,h)}roundClean(){Kt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Vt=Ot((()=>new Mt)),Wt=BigInt(2**32-1),Zt=BigInt(32);function Gt(e,t=!1){return t?{h:Number(e&Wt),l:Number(e>>Zt&Wt)}:{h:0|Number(e>>Zt&Wt),l:0|Number(e&Wt)}}const Yt={fromBig:Gt,split:function(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:o,l:s}=Gt(e[i],t);[n[i],r[i]]=[o,s]}return[n,r]},toBig:(e,t)=>BigInt(e>>>0)<<Zt|BigInt(t>>>0),shrSH:(e,t,n)=>e>>>n,shrSL:(e,t,n)=>e<<32-n|t>>>n,rotrSH:(e,t,n)=>e>>>n|t<<32-n,rotrSL:(e,t,n)=>e<<32-n|t>>>n,rotrBH:(e,t,n)=>e<<64-n|t>>>n-32,rotrBL:(e,t,n)=>e>>>n-32|t<<64-n,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:(e,t,n)=>e<<n|t>>>32-n,rotlSL:(e,t,n)=>t<<n|e>>>32-n,rotlBH:(e,t,n)=>t<<n-32|e>>>64-n,rotlBL:(e,t,n)=>e<<n-32|t>>>64-n,add:function(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:0|i}},add3L:(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),add3H:(e,t,n,r)=>t+n+r+(e/2**32|0)|0,add4L:(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),add4H:(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,add5H:(e,t,n,r,i,o)=>t+n+r+i+o+(e/2**32|0)|0,add5L:(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0)},Jt=Yt,[Qt,Xt]=(()=>Jt.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),en=new Uint32Array(80),tn=new Uint32Array(80);class nn extends qt{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:o,Dh:s,Dl:a,Eh:c,El:h,Fh:l,Fl:u,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,n,r,i,o,s,a,c,h,l,u,d,f,p,g]}set(e,t,n,r,i,o,s,a,c,h,l,u,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|n,this.Bl=0|r,this.Ch=0|i,this.Cl=0|o,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|l,this.Fl=0|u,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let n=0;n<16;n++,t+=4)en[n]=e.getUint32(t),tn[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|en[e-15],n=0|tn[e-15],r=Jt.rotrSH(t,n,1)^Jt.rotrSH(t,n,8)^Jt.shrSH(t,n,7),i=Jt.rotrSL(t,n,1)^Jt.rotrSL(t,n,8)^Jt.shrSL(t,n,7),o=0|en[e-2],s=0|tn[e-2],a=Jt.rotrSH(o,s,19)^Jt.rotrBH(o,s,61)^Jt.shrSH(o,s,6),c=Jt.rotrSL(o,s,19)^Jt.rotrBL(o,s,61)^Jt.shrSL(o,s,6),h=Jt.add4L(i,c,tn[e-7],tn[e-16]),l=Jt.add4H(h,r,a,en[e-7],en[e-16]);en[e]=0|l,tn[e]=0|h}let{Ah:n,Al:r,Bh:i,Bl:o,Ch:s,Cl:a,Dh:c,Dl:h,Eh:l,El:u,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:w}=this;for(let e=0;e<80;e++){const t=Jt.rotrSH(l,u,14)^Jt.rotrSH(l,u,18)^Jt.rotrBH(l,u,41),b=Jt.rotrSL(l,u,14)^Jt.rotrSL(l,u,18)^Jt.rotrBL(l,u,41),m=l&d^~l&p,E=u&f^~u&g,v=Jt.add5L(w,b,E,Xt[e],tn[e]),x=Jt.add5H(v,y,t,m,Qt[e],en[e]),k=0|v,A=Jt.rotrSH(n,r,28)^Jt.rotrBH(n,r,34)^Jt.rotrBH(n,r,39),S=Jt.rotrSL(n,r,28)^Jt.rotrBL(n,r,34)^Jt.rotrBL(n,r,39),B=n&i^n&s^i&s,_=r&o^r&a^o&a;y=0|p,w=0|g,p=0|d,g=0|f,d=0|l,f=0|u,({h:l,l:u}=Jt.add(0|c,0|h,0|x,0|k)),c=0|s,h=0|a,s=0|i,a=0|o,i=0|n,o=0|r;const I=Jt.add3L(k,S,_);n=Jt.add3H(I,x,A,B),r=0|I}({h:n,l:r}=Jt.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:i,l:o}=Jt.add(0|this.Bh,0|this.Bl,0|i,0|o)),({h:s,l:a}=Jt.add(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:h}=Jt.add(0|this.Dh,0|this.Dl,0|c,0|h)),({h:l,l:u}=Jt.add(0|this.Eh,0|this.El,0|l,0|u)),({h:d,l:f}=Jt.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=Jt.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:w}=Jt.add(0|this.Hh,0|this.Hl,0|y,0|w)),this.set(n,r,i,o,s,a,c,h,l,u,d,f,p,g,y,w)}roundClean(){en.fill(0),tn.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const rn=Ot((()=>new nn));function on(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function sn(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function an(...e){const t=e=>e,n=(e,t)=>n=>e(t(n));return{encode:e.map((e=>e.encode)).reduceRight(n,t),decode:e.map((e=>e.decode)).reduce(n,t)}}function cn(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(on(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function hn(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function ln(e,t="="){if(on(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function un(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function dn(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],o=Array.from(e);for(o.forEach((e=>{if(on(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,s=!0;for(let i=r;i<o.length;i++){const a=o[i],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");e=c%n;const h=Math.floor(c/n);if(o[i]=h,!Number.isSafeInteger(h)||h*n+e!==c)throw new Error("convertRadix: carry overflow");s&&(h?s=!1:r=i)}if(i.push(e),s)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}const fn=(e,t)=>t?fn(t,e%t):e,pn=(e,t)=>e+(t-fn(e,t));function gn(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(pn(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${pn(t,n)}`);let i=0,o=0;const s=2**n-1,a=[];for(const r of e){if(on(r),r>=2**t)throw new Error(`convertRadix2: invalid data word=${r} from=${t}`);if(i=i<<t|r,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=n;o-=n)a.push((i>>o-n&s)>>>0);i&=2**o-1}if(i=i<<n-o&s,!r&&o>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&o>0&&a.push(i>>>0),a}function yn(e){return on(e),{encode:t=>{if(!sn(t))throw new Error("radix.encode input should be Uint8Array");return dn(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of numbers");return Uint8Array.from(dn(t,e,256))}}}function wn(e,t=!1){if(on(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(pn(8,e)>32||pn(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!sn(n))throw new Error("radix2.encode input should be Uint8Array");return gn(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(gn(n,e,8,t))}}}function bn(e,t){if(on(e),"function"!=typeof t)throw new Error("checksum fn should be function");return{encode(n){if(!sn(n))throw new Error("checksum.encode: input should be Uint8Array");const r=t(n).slice(0,e),i=new Uint8Array(n.length+e);return i.set(n),i.set(r,n.length),i},decode(n){if(!sn(n))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-e),i=t(r).slice(0,e),o=n.slice(-e);for(let t=0;t<e;t++)if(i[t]!==o[t])throw new Error("Invalid checksum");return r}}}const mn={alphabet:cn,chain:an,checksum:bn,convertRadix:dn,convertRadix2:gn,radix:yn,radix2:wn,join:hn,padding:ln},En=an(wn(4),cn("0123456789ABCDEF"),hn("")),vn=an(wn(5),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),ln(5),hn("")),xn=(wn(5),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),hn(""),wn(5),cn("0123456789ABCDEFGHIJKLMNOPQRSTUV"),ln(5),hn(""),wn(5),cn("0123456789ABCDEFGHIJKLMNOPQRSTUV"),hn(""),wn(5),cn("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),hn(""),un((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),an(wn(6),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),ln(6),hn(""))),kn=(wn(6),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),hn(""),an(wn(6),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),ln(6),hn(""))),An=(wn(6),cn("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),hn(""),e=>an(yn(58),cn(e),hn(""))),Sn=An("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Bn=[0,2,3,5,6,7,9,10,11],_n={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Sn.encode(r).padStart(Bn[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=Bn.indexOf(r.length),o=Sn.decode(r);for(let e=0;e<o.length-i;e++)if(0!==o[e])throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(o.slice(o.length-i)))}return Uint8Array.from(t)}},In=e=>an(bn(4,(t=>e(e(t)))),Sn);cn("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),hn("");const Rn={encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)},Cn=(wn(4),cn("0123456789abcdef"),hn(""),un((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),e=>""===e[0]);function Un(e){if("string"!=typeof e)throw new TypeError("Invalid mnemonic type: "+typeof e);return e.normalize("NFKD")}function Ln(e){const t=Un(e),n=t.split(" ");if(![12,15,18,21,24].includes(n.length))throw new Error("Invalid mnemonic");return{nfkd:t,words:n}}function Nn(e){_t.bytes(e,16,20,24,28,32)}function Tn(e,t=128){if(_t.number(t),t%32!=0||t>256)throw new TypeError("Invalid entropy");return function(e,t){Nn(e);const n=Fn(t).encode(e);return n.join(Cn(t)?"":" ")}(function(e=32){if(It&&"function"==typeof It.getRandomValues)return It.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}(t/8),e)}const On=e=>{const t=8-e.length/4;return new Uint8Array([Vt(e)[0]>>t<<t])};function Fn(e){if(!Array.isArray(e)||2048!==e.length||"string"!=typeof e[0])throw new Error("Worlist: expected array of 2048 strings");return e.forEach((e=>{if("string"!=typeof e)throw new Error(`Wordlist: non-string element: ${e}`)})),mn.chain(mn.checksum(1,On),mn.radix2(11,!0),mn.alphabet(e))}function Pn(e,t){try{!function(e,t){const{words:n}=Ln(e),r=Fn(t).decode(n);Nn(r)}(e,t)}catch(e){return!1}return!0}const $n=e=>Un(`mnemonic${e}`);function Hn(e,t=""){return function(e,t,n,r){const{c:i,dkLen:o,DK:s,PRF:a,PRFSalt:c}=$t(e,t,n,r);let h;const l=new Uint8Array(4),u=Ct(l),d=new Uint8Array(a.outputLen);for(let e=1,t=0;t<o;e++,t+=a.outputLen){const n=s.subarray(t,t+a.outputLen);u.setInt32(0,e,!1),(h=c._cloneInto(h)).update(l).digestInto(d),n.set(d.subarray(0,n.length));for(let e=1;e<i;e++){a._cloneInto(h).update(d).digestInto(d);for(let e=0;e<n.length;e++)n[e]^=d[e]}}return Ht(a,c,s,h,d)}(rn,Ln(e).nfkd,$n(t),{c:2048,dkLen:64})}function qn(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function zn(e,...t){if(!((n=e)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Expected Uint8Array");var n;if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Dn(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");qn(e.outputLen),qn(e.blockLen)}function jn(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Kn(e,t){zn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}function Mn(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}const Vn=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Wn=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const Zn=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));const Gn={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Yn(e){return e>=Gn._0&&e<=Gn._9?e-Gn._0:e>=Gn._A&&e<=Gn._F?e-(Gn._A-10):e>=Gn._a&&e<=Gn._f?e-(Gn._a-10):void 0}function Jn(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function Qn(e){if("string"==typeof e&&(e=Jn(e)),!Mn(e))throw new Error("expected Uint8Array, got "+typeof e);return e}function Xn(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];if(!Mn(r))throw new Error("Uint8Array expected");t+=r.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}class er{clone(){return this._cloneInto()}}function tr(e){const t=t=>e().update(Qn(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}class nr extends er{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Dn(e);const n=Qn(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return jn(this),this.iHash.update(e),this}digestInto(e){jn(this),zn(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const rr=(e,t,n)=>new nr(e,t).update(n).digest();rr.create=(e,t)=>new nr(e,t);class ir extends er{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Vn(this.buffer)}update(e){jn(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Qn(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Vn(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){jn(this),Kn(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,h=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=Vn(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const or=new Uint8Array([7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8]),sr=Uint8Array.from({length:16},((e,t)=>t)),ar=sr.map((e=>(9*e+5)%16));let cr=[sr],hr=[ar];for(let e=0;e<4;e++)for(let t of[cr,hr])t.push(t[e].map((e=>or[e])));const lr=[[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8],[12,13,11,15,6,9,9,7,12,15,11,13,7,8,7,7],[13,15,14,11,7,7,6,8,13,14,13,12,5,5,6,9],[14,11,12,14,8,6,5,5,15,12,15,14,9,9,8,6],[15,12,13,13,9,5,8,6,14,11,12,11,8,6,5,5]].map((e=>new Uint8Array(e))),ur=cr.map(((e,t)=>e.map((e=>lr[t][e])))),dr=hr.map(((e,t)=>e.map((e=>lr[t][e])))),fr=new Uint32Array([0,1518500249,1859775393,2400959708,2840853838]),pr=new Uint32Array([1352829926,1548603684,1836072691,2053994217,0]),gr=(e,t)=>e<<t|e>>>32-t;function yr(e,t,n,r){return 0===e?t^n^r:1===e?t&n|~t&r:2===e?(t|~n)^r:3===e?t&r|n&~r:t^(n|~r)}const wr=new Uint32Array(16);class br extends ir{constructor(){super(64,20,8,!0),this.h0=1732584193,this.h1=-271733879,this.h2=-1732584194,this.h3=271733878,this.h4=-1009589776}get(){const{h0:e,h1:t,h2:n,h3:r,h4:i}=this;return[e,t,n,r,i]}set(e,t,n,r,i){this.h0=0|e,this.h1=0|t,this.h2=0|n,this.h3=0|r,this.h4=0|i}process(e,t){for(let n=0;n<16;n++,t+=4)wr[n]=e.getUint32(t,!0);let n=0|this.h0,r=n,i=0|this.h1,o=i,s=0|this.h2,a=s,c=0|this.h3,h=c,l=0|this.h4,u=l;for(let e=0;e<5;e++){const t=4-e,d=fr[e],f=pr[e],p=cr[e],g=hr[e],y=ur[e],w=dr[e];for(let t=0;t<16;t++){const r=gr(n+yr(e,i,s,c)+wr[p[t]]+d,y[t])+l|0;n=l,l=c,c=0|gr(s,10),s=i,i=r}for(let e=0;e<16;e++){const n=gr(r+yr(t,o,a,h)+wr[g[e]]+f,w[e])+u|0;r=u,u=h,h=0|gr(a,10),a=o,o=n}}this.set(this.h1+s+h|0,this.h2+c+u|0,this.h3+l+r|0,this.h4+n+o|0,this.h0+i+a|0)}roundClean(){wr.fill(0)}destroy(){this.destroyed=!0,this.buffer.fill(0),this.set(0,0,0,0,0)}}const mr=tr((()=>new br)),Er=(e,t,n)=>e&t^e&n^t&n,vr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),xr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),kr=new Uint32Array(64);class Ar extends ir{constructor(){super(64,32,8,!1),this.A=0|xr[0],this.B=0|xr[1],this.C=0|xr[2],this.D=0|xr[3],this.E=0|xr[4],this.F=0|xr[5],this.G=0|xr[6],this.H=0|xr[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)kr[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=kr[e-15],n=kr[e-2],r=Wn(t,7)^Wn(t,18)^t>>>3,i=Wn(n,17)^Wn(n,19)^n>>>10;kr[e]=i+kr[e-7]+r+kr[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(Wn(s,6)^Wn(s,11)^Wn(s,25))+((l=s)&a^~l&c)+vr[e]+kr[e]|0,u=(Wn(n,2)^Wn(n,13)^Wn(n,22))+Er(n,r,i)|0;h=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,o,s,a,c,h)}roundClean(){kr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Sr=tr((()=>new Ar)),Br=BigInt(2**32-1),_r=BigInt(32);function Ir(e,t=!1){return t?{h:Number(e&Br),l:Number(e>>_r&Br)}:{h:0|Number(e>>_r&Br),l:0|Number(e&Br)}}const Rr={fromBig:Ir,split:function(e,t=!1){let n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:o,l:s}=Ir(e[i],t);[n[i],r[i]]=[o,s]}return[n,r]},toBig:(e,t)=>BigInt(e>>>0)<<_r|BigInt(t>>>0),shrSH:(e,t,n)=>e>>>n,shrSL:(e,t,n)=>e<<32-n|t>>>n,rotrSH:(e,t,n)=>e>>>n|t<<32-n,rotrSL:(e,t,n)=>e<<32-n|t>>>n,rotrBH:(e,t,n)=>e<<64-n|t>>>n-32,rotrBL:(e,t,n)=>e>>>n-32|t<<64-n,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:(e,t,n)=>e<<n|t>>>32-n,rotlSL:(e,t,n)=>t<<n|e>>>32-n,rotlBH:(e,t,n)=>t<<n-32|e>>>64-n,rotlBL:(e,t,n)=>e<<n-32|t>>>64-n,add:function(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:0|i}},add3L:(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),add3H:(e,t,n,r)=>t+n+r+(e/2**32|0)|0,add4L:(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),add4H:(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,add5H:(e,t,n,r,i,o)=>t+n+r+i+o+(e/2**32|0)|0,add5L:(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0)},Cr=Rr,[Ur,Lr]=(()=>Cr.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),Nr=new Uint32Array(80),Tr=new Uint32Array(80);class Or extends ir{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:o,Dh:s,Dl:a,Eh:c,El:h,Fh:l,Fl:u,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,n,r,i,o,s,a,c,h,l,u,d,f,p,g]}set(e,t,n,r,i,o,s,a,c,h,l,u,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|n,this.Bl=0|r,this.Ch=0|i,this.Cl=0|o,this.Dh=0|s,this.Dl=0|a,this.Eh=0|c,this.El=0|h,this.Fh=0|l,this.Fl=0|u,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let n=0;n<16;n++,t+=4)Nr[n]=e.getUint32(t),Tr[n]=e.getUint32(t+=4);for(let e=16;e<80;e++){const t=0|Nr[e-15],n=0|Tr[e-15],r=Cr.rotrSH(t,n,1)^Cr.rotrSH(t,n,8)^Cr.shrSH(t,n,7),i=Cr.rotrSL(t,n,1)^Cr.rotrSL(t,n,8)^Cr.shrSL(t,n,7),o=0|Nr[e-2],s=0|Tr[e-2],a=Cr.rotrSH(o,s,19)^Cr.rotrBH(o,s,61)^Cr.shrSH(o,s,6),c=Cr.rotrSL(o,s,19)^Cr.rotrBL(o,s,61)^Cr.shrSL(o,s,6),h=Cr.add4L(i,c,Tr[e-7],Tr[e-16]),l=Cr.add4H(h,r,a,Nr[e-7],Nr[e-16]);Nr[e]=0|l,Tr[e]=0|h}let{Ah:n,Al:r,Bh:i,Bl:o,Ch:s,Cl:a,Dh:c,Dl:h,Eh:l,El:u,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:w}=this;for(let e=0;e<80;e++){const t=Cr.rotrSH(l,u,14)^Cr.rotrSH(l,u,18)^Cr.rotrBH(l,u,41),b=Cr.rotrSL(l,u,14)^Cr.rotrSL(l,u,18)^Cr.rotrBL(l,u,41),m=l&d^~l&p,E=u&f^~u&g,v=Cr.add5L(w,b,E,Lr[e],Tr[e]),x=Cr.add5H(v,y,t,m,Ur[e],Nr[e]),k=0|v,A=Cr.rotrSH(n,r,28)^Cr.rotrBH(n,r,34)^Cr.rotrBH(n,r,39),S=Cr.rotrSL(n,r,28)^Cr.rotrBL(n,r,34)^Cr.rotrBL(n,r,39),B=n&i^n&s^i&s,_=r&o^r&a^o&a;y=0|p,w=0|g,p=0|d,g=0|f,d=0|l,f=0|u,({h:l,l:u}=Cr.add(0|c,0|h,0|x,0|k)),c=0|s,h=0|a,s=0|i,a=0|o,i=0|n,o=0|r;const I=Cr.add3L(k,S,_);n=Cr.add3H(I,x,A,B),r=0|I}({h:n,l:r}=Cr.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:i,l:o}=Cr.add(0|this.Bh,0|this.Bl,0|i,0|o)),({h:s,l:a}=Cr.add(0|this.Ch,0|this.Cl,0|s,0|a)),({h:c,l:h}=Cr.add(0|this.Dh,0|this.Dl,0|c,0|h)),({h:l,l:u}=Cr.add(0|this.Eh,0|this.El,0|l,0|u)),({h:d,l:f}=Cr.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=Cr.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:w}=Cr.add(0|this.Hh,0|this.Hl,0|y,0|w)),this.set(n,r,i,o,s,a,c,h,l,u,d,f,p,g,y,w)}roundClean(){Nr.fill(0),Tr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Fr=tr((()=>new Or));function Pr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function $r(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const Hr={number:Pr,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:$r,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Pr(e.outputLen),Pr(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){$r(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},qr=Hr,zr="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Dr=e=>e instanceof Uint8Array,jr=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Kr=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Mr(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Dr(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class Vr{clone(){return this._cloneInto()}}function Wr(e){const t=t=>e().update(Mr(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Zr(e=32){if(zr&&"function"==typeof zr.getRandomValues)return zr.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class Gr extends Vr{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=jr(this.buffer)}update(e){qr.exists(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Mr(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=jr(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){qr.exists(this),qr.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,h=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=jr(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const Yr=(e,t,n)=>e&t^e&n^t&n,Jr=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Qr=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xr=new Uint32Array(64);class ei extends Gr{constructor(){super(64,32,8,!1),this.A=0|Qr[0],this.B=0|Qr[1],this.C=0|Qr[2],this.D=0|Qr[3],this.E=0|Qr[4],this.F=0|Qr[5],this.G=0|Qr[6],this.H=0|Qr[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)Xr[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Xr[e-15],n=Xr[e-2],r=Kr(t,7)^Kr(t,18)^t>>>3,i=Kr(n,17)^Kr(n,19)^n>>>10;Xr[e]=i+Xr[e-7]+r+Xr[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(Kr(s,6)^Kr(s,11)^Kr(s,25))+((l=s)&a^~l&c)+Jr[e]+Xr[e]|0,u=(Kr(n,2)^Kr(n,13)^Kr(n,22))+Yr(n,r,i)|0;h=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,o,s,a,c,h)}roundClean(){Xr.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class ti extends ei{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const ni=Wr((()=>new ei)),ri=(Wr((()=>new ti)),BigInt(0),BigInt(1)),ii=BigInt(2),oi=e=>e instanceof Uint8Array,si=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function ai(e){if(!oi(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=si[e[n]];return t}function ci(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function hi(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[t]=o}return n}function li(e){return ci(ai(e))}function ui(e){if(!oi(e))throw new Error("Uint8Array expected");return ci(ai(Uint8Array.from(e).reverse()))}function di(e,t){return hi(e.toString(16).padStart(2*t,"0"))}function fi(e,t){return di(e,t).reverse()}function pi(e,t,n){let r;if("string"==typeof t)try{r=hi(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!oi(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}function gi(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!oi(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const yi=e=>(ii<<BigInt(e-1))-ri,wi=e=>new Uint8Array(e),bi=e=>Uint8Array.from(e);function mi(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=wi(e),i=wi(e),o=0;const s=()=>{r.fill(1),i.fill(0),o=0},a=(...e)=>n(i,r,...e),c=(e=wi())=>{i=a(bi([0]),e),r=a(),0!==e.length&&(i=a(bi([1]),e),r=a())},h=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return gi(...n)};return(e,t)=>{let n;for(s(),c(e);!(n=t(h()));)c();return s(),n}}const Ei={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function vi(e,t,n={}){const r=(t,n,r)=>{const i=Ei[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const o=e[t];if(!(r&&void 0===o||i(o,e)))throw new Error(`Invalid param ${String(t)}=${o} (${typeof o}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}const xi=BigInt(0),ki=BigInt(1),Ai=BigInt(2),Si=BigInt(3),Bi=BigInt(4),_i=BigInt(5),Ii=BigInt(8);BigInt(9),BigInt(16);function Ri(e,t){const n=e%t;return n>=xi?n:t+n}function Ci(e,t,n){if(n<=xi||t<xi)throw new Error("Expected power/modulo > 0");if(n===ki)return xi;let r=ki;for(;t>xi;)t&ki&&(r=r*e%n),e=e*e%n,t>>=ki;return r}function Ui(e,t,n){let r=e;for(;t-- >xi;)r*=r,r%=n;return r}function Li(e,t){if(e===xi||t<=xi)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Ri(e,t),r=t,i=xi,o=ki,s=ki,a=xi;for(;n!==xi;){const e=r/n,t=r%n,c=i-s*e,h=o-a*e;r=n,n=t,i=s,o=a,s=c,a=h}if(r!==ki)throw new Error("invert: does not exist");return Ri(i,t)}function Ni(e){if(e%Bi===Si){const t=(e+ki)/Bi;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%Ii===_i){const t=(e-_i)/Ii;return function(e,n){const r=e.mul(n,Ai),i=e.pow(r,t),o=e.mul(n,i),s=e.mul(e.mul(o,Ai),i),a=e.mul(o,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-ki)/Ai;let n,r,i;for(n=e-ki,r=0;n%Ai===xi;n/=Ai,r++);for(i=Ai;i<e&&Ci(i,t,e)!==e-ki;i++);if(1===r){const t=(e+ki)/Bi;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+ki)/Ai;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),h=e.pow(s,o),l=e.pow(s,n);for(;!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(l);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,ki<<BigInt(a-t-1));c=e.sqr(n),h=e.mul(h,n),l=e.mul(l,c),a=t}return h}}(e)}const Ti=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Oi(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}const Fi=BigInt(0),Pi=BigInt(1);function $i(e){return vi(e.Fp,Ti.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),vi(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Oi(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const{Ph:Hi,aT:qi}=t,zi={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=zi;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Hi(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=zi,n="string"==typeof e?qi(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=zi._parseInt(n.subarray(2)),{d:s,l:a}=zi._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),i=t(n(e.r)),o=r.length/2,s=i.length/2,a=n(o),c=n(s);return`30${n(s+o+4)}02${c}${i}02${a}${r}`}},Di=BigInt(0),ji=BigInt(1),Ki=(BigInt(2),BigInt(3));BigInt(4);function Mi(e){const t=function(e){const t=$i(e);vi(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return gi(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,o=n.sqr(e),s=n.mul(o,e);return n.add(n.add(s,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&Di<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:o}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=ai(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:li(pi("private key",e,r))}catch(t){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return i&&(s=Ri(s,o)),a(s),s}const h=new Map;function l(e){if(!(e instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof u)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?u.ZERO:new u(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}static fromHex(e){const t=u.fromAffine(i(pi("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return u.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,h.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint)return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),s=o(e);if(!n.eql(i,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){l(e);const{px:t,py:r,pz:i}=this,{px:o,py:s,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(o,i)),h=n.eql(n.mul(r,a),n.mul(s,i));return c&&h}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,Ki),{px:o,py:s,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(o,o),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(o,s);return g=n.add(g,g),l=n.mul(o,a),l=n.add(l,l),c=n.mul(e,l),h=n.mul(i,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(i,l),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(e){l(e);const{px:r,py:i,pz:o}=this,{px:s,py:a,pz:c}=e;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,Ki);let y=n.mul(r,s),w=n.mul(i,a),b=n.mul(o,c),m=n.add(r,i),E=n.add(s,a);m=n.mul(m,E),E=n.add(y,w),m=n.sub(m,E),E=n.add(r,o);let v=n.add(s,c);return E=n.mul(E,v),v=n.add(y,b),E=n.sub(E,v),v=n.add(i,o),h=n.add(a,c),v=n.mul(v,h),h=n.add(w,b),v=n.sub(v,h),f=n.mul(p,E),h=n.mul(g,b),f=n.add(h,f),h=n.sub(w,f),f=n.add(w,f),d=n.mul(h,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),E=n.mul(g,E),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),E=n.add(E,b),y=n.mul(w,E),d=n.add(d,y),y=n.mul(v,E),h=n.mul(m,h),h=n.sub(h,y),y=n.mul(m,w),f=n.mul(v,f),f=n.add(f,y),new u(h,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(u.ZERO)}wNAF(e){return f.wNAFCached(this,h,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}))}multiplyUnsafe(e){const r=u.ZERO;if(e===Di)return r;if(a(e),e===ji)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:c,k2:h}=i.splitScalar(e),l=r,d=r,p=this;for(;s>Di||h>Di;)s&ji&&(l=l.add(p)),h&ji&&(d=d.add(p)),p=p.double(),s>>=ji,h>>=ji;return o&&(l=l.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,i.beta),d.py,d.pz),l.add(d)}multiply(e){a(e);let r,i,o=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:c}=s.splitScalar(o);let{p:h,f:l}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(e,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,s.beta),d.py,d.pz),r=h.add(d),i=l.add(p)}else{const{p:e,f:t}=this.wNAF(o);r=e,i=t}return u.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=u.BASE,i=(e,t)=>t!==Di&&t!==ji&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){const{px:t,py:r,pz:i}=this,o=this.is0();null==e&&(e=o?n.ONE:n.inv(i));const s=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===ji)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===ji?this:n?n(u,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(u,this,e)}toHex(e=!0){return ai(this.toRawBytes(e))}}u.BASE=new u(t.Gx,t.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>Fi;)n&Pi&&(r=r.add(i)),i=i.double(),n>>=Pi;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),o=[];let s=e,a=s;for(let e=0;e<n;e++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){const{windows:s,windowSize:a}=r(t);let c=e.ZERO,h=e.BASE;const l=BigInt(2**t-1),u=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(o&l);o>>=d,r>a&&(r-=u,o+=Pi);const s=t,f=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?h=h.add(n(p,i[s])):c=c.add(n(g,i[f]))}return{p:c,f:h}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,r(o))),this.wNAF(i,o,n)}}}(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function Vi(e){const t=function(e){const t=$i(e);return vi(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,o=2*n.BYTES+1;function s(e){return Ri(e,r)}function a(e){return Li(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=Mi({...t,toBytes(e,t,r){const i=t.toAffine(),o=n.toBytes(i.x),s=gi;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===o&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}{const e=li(s);if(!(Di<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=l(e);let i=n.sqrt(t);return!(1&~r)!==((i&ji)===ji)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>ai(di(e,t.nByteLength));function f(e){return e>r>>ji}const p=(e,t,n)=>li(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=pi("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=zi.toSig(pi("DER",e));return new g(t,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r,s:i,recovery:o}=this,h=m(pi("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const l=2===o||3===o?r+t.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&o?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=s(-h*p),y=s(i*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return hi(this.toDERHex())}toDERHex(){return zi.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return hi(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return h(e),!0}catch(e){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const e=function(e,t,n=!1){const r=(e=pi("privateHash",e)).length,i=Oi(t).nByteLength+8;if(i<24||r<i||r>1024)throw new Error(`hashToPrivateScalar: expected ${i}-1024 bytes of input, got ${r}`);return Ri(n?ui(e):li(e),t-ki)+ki}(t.randomBytes(n.BYTES+8),r);return di(e,t.nByteLength)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===o:n?r===2*i||r===2*o:e instanceof c}const b=t.bits2int||function(e){const n=li(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},m=t.bits2int_modN||function(e){return s(b(e))},E=yi(t.nBitLength);function v(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(Di<=e&&e<E))throw new Error(`bigint expected < 2^${t.nBitLength}`);return di(e,t.nByteLength)}function x(e,r,i=k){if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:l}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=pi("msgHash",e),p&&(e=pi("prehashed msgHash",o(e)));const w=m(e),E=h(r),x=[v(E),v(w)];if(null!=y){const e=!0===y?l(n.BYTES):y;x.push(pi("extraEntropy",e,n.BYTES))}const A=gi(...x),S=w;return{seed:A,k2sig:function(e){const t=b(e);if(!u(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=s(r.x);if(i===Di)return;const o=s(n*s(S+i*E));if(o===Di)return;let h=(r.x===i?0:2)|Number(r.y&ji),l=o;return d&&f(o)&&(l=function(e){return f(e)?s(-e):e}(o),h^=1),new g(i,l,h)}}}const k={lowS:t.lowS,prehash:!1},A={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(h(e)).toRawBytes(n)},sign:function(e,n,r=k){const{seed:i,k2sig:o}=x(e,n,r),s=t;return mi(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(e,n,r,i=A){const o=e;if(n=pi("msgHash",n),r=pi("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:l}=i;let u,d;try{if("string"==typeof o||o instanceof Uint8Array)try{u=g.fromDER(o)}catch(e){if(!(e instanceof zi.Err))throw e;u=g.fromCompact(o)}else{if("object"!=typeof o||"bigint"!=typeof o.r||"bigint"!=typeof o.s)throw new Error("PARSE");{const{r:e,s:t}=o;u=new g(e,t)}}d=c.fromHex(r)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=t.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=s(y*w),E=s(f*w),v=c.BASE.multiplyAndAddUnsafe(d,b,E)?.toAffine();return!!v&&s(v.x)===f},ProjectivePoint:c,Signature:g,utils:y}}class Wi extends Vr{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,qr.hash(e);const n=Mr(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return qr.exists(this),this.iHash.update(e),this}digestInto(e){qr.exists(this),qr.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Zi=(e,t,n)=>new Wi(e,t).update(n).digest();function Gi(e){return{hash:e,hmac:(t,...n)=>Zi(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!Dr(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:Zr}}Zi.create=(e,t)=>new Wi(e,t);const Yi=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ji=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qi=BigInt(1),Xi=BigInt(2),eo=(e,t)=>(e+t/Xi)/t;function to(e){const t=Yi,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),h=e*e*e%t,l=h*h*e%t,u=Ui(l,n,t)*l%t,d=Ui(u,n,t)*l%t,f=Ui(d,Xi,t)*h%t,p=Ui(f,i,t)*f%t,g=Ui(p,o,t)*p%t,y=Ui(g,a,t)*g%t,w=Ui(y,c,t)*y%t,b=Ui(w,a,t)*g%t,m=Ui(b,n,t)*l%t,E=Ui(m,s,t)*p%t,v=Ui(E,r,t)*h%t,x=Ui(v,Xi,t);if(!no.eql(no.sqr(x),e))throw new Error("Cannot find square root");return x}const no=function(e,t,n=!1,r={}){if(e<=xi)throw new Error(`Expected Fp ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=Oi(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=Ni(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:yi(i),ZERO:xi,ONE:ki,create:t=>Ri(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return xi<=t&&t<e},is0:e=>e===xi,isOdd:e=>(e&ki)===ki,neg:t=>Ri(-t,e),eql:(e,t)=>e===t,sqr:t=>Ri(t*t,e),add:(t,n)=>Ri(t+n,e),sub:(t,n)=>Ri(t-n,e),mul:(t,n)=>Ri(t*n,e),pow:(e,t)=>function(e,t,n){if(n<xi)throw new Error("Expected power > 0");if(n===xi)return e.ONE;if(n===ki)return t;let r=e.ONE,i=t;for(;n>xi;)n&ki&&(r=e.mul(r,i)),i=e.sqr(i),n>>=ki;return r}(a,e,t),div:(t,n)=>Ri(t*Li(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Li(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?fi(e,o):di(e,o),fromBytes:e=>{if(e.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${e.length}`);return n?ui(e):li(e)}});return Object.freeze(a)}(Yi,void 0,void 0,{sqrt:to}),ro=function(e,t){const n=t=>Vi({...e,...Gi(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:no,n:Ji,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Ji,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Qi*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=eo(o*e,t),c=eo(-r*e,t);let h=Ri(e-a*n-c*i,t),l=Ri(-a*r-c*o,t);const u=h>s,d=l>s;if(u&&(h=t-h),d&&(l=t-l),h>s||l>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},ni);BigInt(0);ro.ProjectivePoint;const io=ro.ProjectivePoint,oo=In(Sr);function so(e){return BigInt(`0x${function(e){if(!Mn(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Zn[e[n]];return t}(e)}`)}function ao(e){return function(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=Yn(e.charCodeAt(i)),o=Yn(e.charCodeAt(i+1));if(void 0===n||void 0===o){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+o}return r}(e.toString(16).padStart(64,"0"))}const co=Jn("Bitcoin seed"),ho={private:76066276,public:76067358},lo=2147483648,uo=e=>{if(!Number.isSafeInteger(e)||e<0||e>2**32-1)throw new Error(`Invalid number=${e}. Should be from 0 to 2 ** 32 - 1`);const t=new Uint8Array(4);return Vn(t).setUint32(0,e,!1),t};class fo{get fingerprint(){if(!this.pubHash)throw new Error("No publicKey set!");return e=this.pubHash,Vn(e).getUint32(0,!1);var e}get identifier(){return this.pubHash}get pubKeyHash(){return this.pubHash}get privateKey(){return this.privKeyBytes||null}get publicKey(){return this.pubKey||null}get privateExtendedKey(){const e=this.privateKey;if(!e)throw new Error("No private key");return oo.encode(this.serialize(this.versions.private,Xn(new Uint8Array([0]),e)))}get publicExtendedKey(){if(!this.pubKey)throw new Error("No public key");return oo.encode(this.serialize(this.versions.public,this.pubKey))}static fromMasterSeed(e,t=ho){if(zn(e),8*e.length<128||8*e.length>512)throw new Error(`HDKey: wrong seed length=${e.length}. Should be between 128 and 512 bits; 256 bits is advised)`);const n=rr(Fr,co,e);return new fo({versions:t,chainCode:n.slice(32),privateKey:n.slice(0,32)})}static fromExtendedKey(e,t=ho){const n=oo.decode(e),r=Vn(n),i=r.getUint32(0,!1),o={versions:t,depth:n[4],parentFingerprint:r.getUint32(5,!1),index:r.getUint32(9,!1),chainCode:n.slice(13,45)},s=n.slice(45),a=0===s[0];if(i!==t[a?"private":"public"])throw new Error("Version mismatch");return new fo(a?{...o,privateKey:s.slice(1)}:{...o,publicKey:s})}static fromJSON(e){return fo.fromExtendedKey(e.xpriv)}constructor(e){if(this.depth=0,this.index=0,this.chainCode=null,this.parentFingerprint=0,!e||"object"!=typeof e)throw new Error("HDKey.constructor must not be called directly");if(this.versions=e.versions||ho,this.depth=e.depth||0,this.chainCode=e.chainCode,this.index=e.index||0,this.parentFingerprint=e.parentFingerprint||0,!this.depth&&(this.parentFingerprint||this.index))throw new Error("HDKey: zero depth with non-zero index/parent fingerprint");if(e.publicKey&&e.privateKey)throw new Error("HDKey: publicKey and privateKey at same time.");if(e.privateKey){if(!ro.utils.isValidPrivateKey(e.privateKey))throw new Error("Invalid private key");this.privKey="bigint"==typeof e.privateKey?e.privateKey:so(e.privateKey),this.privKeyBytes=ao(this.privKey),this.pubKey=ro.getPublicKey(e.privateKey,!0)}else{if(!e.publicKey)throw new Error("HDKey: no public or private key provided");this.pubKey=io.fromHex(e.publicKey).toRawBytes(!0)}var t;this.pubHash=(t=this.pubKey,mr(Sr(t)))}derive(e){if(!/^[mM]'?/.test(e))throw new Error('Path must start with "m" or "M"');if(/^[mM]'?$/.test(e))return this;const t=e.replace(/^[mM]'?\//,"").split("/");let n=this;for(const e of t){const t=/^(\d+)('?)$/.exec(e);if(!t||3!==t.length)throw new Error(`Invalid child index: ${e}`);let r=+t[1];if(!Number.isSafeInteger(r)||r>=lo)throw new Error("Invalid index");"'"===t[2]&&(r+=lo),n=n.deriveChild(r)}return n}deriveChild(e){if(!this.pubKey||!this.chainCode)throw new Error("No publicKey or chainCode set");let t=uo(e);if(e>=lo){const e=this.privateKey;if(!e)throw new Error("Could not derive hardened child key");t=Xn(new Uint8Array([0]),e,t)}else t=Xn(this.pubKey,t);const n=rr(Fr,this.chainCode,t),r=so(n.slice(0,32)),i=n.slice(32);if(!ro.utils.isValidPrivateKey(r))throw new Error("Tweak bigger than curve order");const o={versions:this.versions,chainCode:i,depth:this.depth+1,parentFingerprint:this.fingerprint,index:e};try{if(this.privateKey){const e=Ri(this.privKey+r,ro.CURVE.n);if(!ro.utils.isValidPrivateKey(e))throw new Error("The tweak was out of range or the resulted private key is invalid");o.privateKey=e}else{const e=io.fromHex(this.pubKey).add(io.fromPrivateKey(r));if(e.equals(io.ZERO))throw new Error("The tweak was equal to negative P, which made the result key invalid");o.publicKey=e.toRawBytes(!0)}return new fo(o)}catch(t){return this.deriveChild(e+1)}}sign(e){if(!this.privateKey)throw new Error("No privateKey set!");return zn(e,32),ro.sign(e,this.privKey).toCompactRawBytes()}verify(e,t){if(zn(e,32),zn(t,64),!this.publicKey)throw new Error("No publicKey set!");let n;try{n=ro.Signature.fromCompact(t)}catch(e){return!1}return ro.verify(n,e,this.publicKey)}wipePrivateData(){return this.privKey=void 0,this.privKeyBytes&&(this.privKeyBytes.fill(0),this.privKeyBytes=void 0),this}toJSON(){return{xpriv:this.privateExtendedKey,xpub:this.publicExtendedKey}}serialize(e,t){if(!this.chainCode)throw new Error("No chainCode set");return zn(t,33),Xn(uo(e),new Uint8Array([this.depth]),uo(this.parentFingerprint),uo(this.index),this.chainCode,t)}}const po=e=>e instanceof Uint8Array,go=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function yo(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}function wo(e){if("string"==typeof e&&(e=yo(e)),!po(e))throw new Error("expected Uint8Array, got "+typeof e);return e}function bo(e,t){if(void 0!==t&&("object"!=typeof t||(n=t,"[object Object]"!==Object.prototype.toString.call(n)||n.constructor!==Object)))throw new Error("options must be object or undefined");var n;return Object.assign(e,t)}function mo(e,t){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");if("number"==typeof t&&e.length!==t)throw new Error(`Uint8Array length ${t} expected`)}function Eo(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function vo(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const xo={number:Eo,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:vo,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("hash must be wrapped by utils.wrapConstructor");Eo(e.outputLen),Eo(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){vo(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},ko=xo,Ao=(e,t)=>255&e[t++]|(255&e[t++])<<8;class So{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,mo(e=wo(e),32);const t=Ao(e,0),n=Ao(e,2),r=Ao(e,4),i=Ao(e,6),o=Ao(e,8),s=Ao(e,10),a=Ao(e,12),c=Ao(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|i<<9),this.r[4]=255&(i>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|s<<2),this.r[7]=8065&(s>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let t=0;t<8;t++)this.pad[t]=Ao(e,16+2*t)}process(e,t,n=!1){const r=n?0:2048,{h:i,r:o}=this,s=o[0],a=o[1],c=o[2],h=o[3],l=o[4],u=o[5],d=o[6],f=o[7],p=o[8],g=o[9],y=Ao(e,t+0),w=Ao(e,t+2),b=Ao(e,t+4),m=Ao(e,t+6),E=Ao(e,t+8),v=Ao(e,t+10),x=Ao(e,t+12),k=Ao(e,t+14);let A=i[0]+(8191&y),S=i[1]+(8191&(y>>>13|w<<3)),B=i[2]+(8191&(w>>>10|b<<6)),_=i[3]+(8191&(b>>>7|m<<9)),I=i[4]+(8191&(m>>>4|E<<12)),R=i[5]+(E>>>1&8191),C=i[6]+(8191&(E>>>14|v<<2)),U=i[7]+(8191&(v>>>11|x<<5)),L=i[8]+(8191&(x>>>8|k<<8)),N=i[9]+(k>>>5|r),T=0,O=T+A*s+S*(5*g)+B*(5*p)+_*(5*f)+I*(5*d);T=O>>>13,O&=8191,O+=R*(5*u)+C*(5*l)+U*(5*h)+L*(5*c)+N*(5*a),T+=O>>>13,O&=8191;let F=T+A*a+S*s+B*(5*g)+_*(5*p)+I*(5*f);T=F>>>13,F&=8191,F+=R*(5*d)+C*(5*u)+U*(5*l)+L*(5*h)+N*(5*c),T+=F>>>13,F&=8191;let P=T+A*c+S*a+B*s+_*(5*g)+I*(5*p);T=P>>>13,P&=8191,P+=R*(5*f)+C*(5*d)+U*(5*u)+L*(5*l)+N*(5*h),T+=P>>>13,P&=8191;let $=T+A*h+S*c+B*a+_*s+I*(5*g);T=$>>>13,$&=8191,$+=R*(5*p)+C*(5*f)+U*(5*d)+L*(5*u)+N*(5*l),T+=$>>>13,$&=8191;let H=T+A*l+S*h+B*c+_*a+I*s;T=H>>>13,H&=8191,H+=R*(5*g)+C*(5*p)+U*(5*f)+L*(5*d)+N*(5*u),T+=H>>>13,H&=8191;let q=T+A*u+S*l+B*h+_*c+I*a;T=q>>>13,q&=8191,q+=R*s+C*(5*g)+U*(5*p)+L*(5*f)+N*(5*d),T+=q>>>13,q&=8191;let z=T+A*d+S*u+B*l+_*h+I*c;T=z>>>13,z&=8191,z+=R*a+C*s+U*(5*g)+L*(5*p)+N*(5*f),T+=z>>>13,z&=8191;let D=T+A*f+S*d+B*u+_*l+I*h;T=D>>>13,D&=8191,D+=R*c+C*a+U*s+L*(5*g)+N*(5*p),T+=D>>>13,D&=8191;let j=T+A*p+S*f+B*d+_*u+I*l;T=j>>>13,j&=8191,j+=R*h+C*c+U*a+L*s+N*(5*g),T+=j>>>13,j&=8191;let K=T+A*g+S*p+B*f+_*d+I*u;T=K>>>13,K&=8191,K+=R*l+C*h+U*c+L*a+N*s,T+=K>>>13,K&=8191,T=(T<<2)+T|0,T=T+O|0,O=8191&T,T>>>=13,F+=T,i[0]=O,i[1]=F,i[2]=P,i[3]=$,i[4]=H,i[5]=q,i[6]=z,i[7]=D,i[8]=j,i[9]=K}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let t=2;t<10;t++)e[t]+=r,r=e[t]>>>13,e[t]&=8191;e[0]+=5*r,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let t=1;t<10;t++)n[t]=e[t]+r,r=n[t]>>>13,n[t]&=8191;n[9]-=8192;let i=(1^r)-1;for(let e=0;e<10;e++)n[e]&=i;i=~i;for(let t=0;t<10;t++)e[t]=e[t]&i|n[t];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+t[0];e[0]=65535&o;for(let n=1;n<8;n++)o=(e[n]+t[n]|0)+(o>>>16)|0,e[n]=65535&o}update(e){ko.exists(this);const{buffer:t,blockLen:n}=this,r=(e=wo(e)).length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);if(o!==n)t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0);else for(;n<=r-i;i+=n)this.process(e,i)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){ko.exists(this),ko.output(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let t=0;t<8;t++)e[i++]=n[t]>>>0,e[i++]=n[t]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}!function(e){const t=(t,n)=>e(n).update(wo(t)).digest(),n=e(new Uint8Array(32));t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t)}((e=>new So(e)));const Bo=yo("expand 16-byte k"),_o=yo("expand 32-byte k"),Io=go(Bo),Ro=go(_o),Co=e=>!(e.byteOffset%4),Uo=e=>{const{core:t,rounds:n,counterRight:r,counterLen:i,allow128bitKeys:o,extendNonceFn:s,blockLen:a}=bo({rounds:20,counterRight:!1,counterLen:8,allow128bitKeys:!0,blockLen:64},e);ko.number(i),ko.number(n),ko.number(a),ko.bool(r),ko.bool(o);const c=a/4;if(a%4!=0)throw new Error("Salsa/ChaCha: blockLen must be aligned to 4 bytes");return(e,h,l,u,d=0)=>{if(ko.bytes(e),ko.bytes(h),ko.bytes(l),u||(u=new Uint8Array(l.length)),ko.bytes(u),ko.number(d),d<0||d>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");if(u.length<l.length)throw new Error(`Salsa/ChaCha: output (${u.length}) is shorter than data (${l.length})`);const f=[];let p,g;if(32===e.length)p=e,g=Ro;else{if(16!==e.length||!o)throw new Error(`Salsa/ChaCha: invalid 32-byte key, got length=${e.length}`);p=new Uint8Array(32),p.set(e),p.set(e,16),g=Io,f.push(p)}if(s){if(h.length<=16)throw new Error("Salsa/ChaCha: extended nonce must be bigger than 16 bytes");p=s(g,p,h.subarray(0,16),new Uint8Array(32)),f.push(p),h=h.subarray(16)}const y=16-i;if(h.length!==y)throw new Error(`Salsa/ChaCha: nonce must be ${y} or 16 bytes`);if(12!==y){const e=new Uint8Array(12);e.set(h,r?0:12-h.length),f.push(h=e)}const w=new Uint8Array(a),b=go(w),m=go(p),E=go(h),v=Co(l)&&go(l),x=Co(u)&&go(u);f.push(b);const k=l.length;for(let e=0,r=d;e<k;r++){if(t(g,m,E,b,r,n),r>=2**32-1)throw new Error("Salsa/ChaCha: counter overflow");const i=Math.min(a,k-e);if(i===a&&x&&v){const t=e/4;if(e%4!=0)throw new Error("Salsa/ChaCha: invalid block position");for(let e=0;e<c;e++)x[t+e]=v[t+e]^b[e];e+=a}else{for(let t=0;t<i;t++)u[e+t]=l[e+t]^w[t];e+=i}}for(let e=0;e<f.length;e++)f[e].fill(0);return u}},Lo=(e,t)=>e<<t|e>>>32-t;function No(e,t,n,r,i,o=20){let s=e[0],a=e[1],c=e[2],h=e[3],l=t[0],u=t[1],d=t[2],f=t[3],p=t[4],g=t[5],y=t[6],w=t[7],b=i,m=n[0],E=n[1],v=n[2],x=s,k=a,A=c,S=h,B=l,_=u,I=d,R=f,C=p,U=g,L=y,N=w,T=b,O=m,F=E,P=v;for(let e=0;e<o;e+=2)x=x+B|0,T=Lo(T^x,16),C=C+T|0,B=Lo(B^C,12),x=x+B|0,T=Lo(T^x,8),C=C+T|0,B=Lo(B^C,7),k=k+_|0,O=Lo(O^k,16),U=U+O|0,_=Lo(_^U,12),k=k+_|0,O=Lo(O^k,8),U=U+O|0,_=Lo(_^U,7),A=A+I|0,F=Lo(F^A,16),L=L+F|0,I=Lo(I^L,12),A=A+I|0,F=Lo(F^A,8),L=L+F|0,I=Lo(I^L,7),S=S+R|0,P=Lo(P^S,16),N=N+P|0,R=Lo(R^N,12),S=S+R|0,P=Lo(P^S,8),N=N+P|0,R=Lo(R^N,7),x=x+_|0,P=Lo(P^x,16),L=L+P|0,_=Lo(_^L,12),x=x+_|0,P=Lo(P^x,8),L=L+P|0,_=Lo(_^L,7),k=k+I|0,T=Lo(T^k,16),N=N+T|0,I=Lo(I^N,12),k=k+I|0,T=Lo(T^k,8),N=N+T|0,I=Lo(I^N,7),A=A+R|0,O=Lo(O^A,16),C=C+O|0,R=Lo(R^C,12),A=A+R|0,O=Lo(O^A,8),C=C+O|0,R=Lo(R^C,7),S=S+B|0,F=Lo(F^S,16),U=U+F|0,B=Lo(B^U,12),S=S+B|0,F=Lo(F^S,8),U=U+F|0,B=Lo(B^U,7);let $=0;r[$++]=s+x|0,r[$++]=a+k|0,r[$++]=c+A|0,r[$++]=h+S|0,r[$++]=l+B|0,r[$++]=u+_|0,r[$++]=d+I|0,r[$++]=f+R|0,r[$++]=p+C|0,r[$++]=g+U|0,r[$++]=y+L|0,r[$++]=w+N|0,r[$++]=b+T|0,r[$++]=m+O|0,r[$++]=E+F|0,r[$++]=v+P|0}const To=Uo({core:No,counterRight:!1,counterLen:4,allow128bitKeys:!1});const Oo=new Uint8Array([0]),Fo=new Uint8Array;const Po=(e,t,n,r,i)=>function(e,t,n,r=32){if(a.hash(e),a.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=Fo);const o=new Uint8Array(i*e.outputLen),s=me.create(e,t),c=s._cloneInto(),h=new Uint8Array(s.outputLen);for(let t=0;t<i;t++)Oo[0]=t+1,c.update(0===t?Fo:h).update(n).update(Oo).digestInto(h),o.set(h,e.outputLen*t),s._cloneInto(c);return s.destroy(),c.destroy(),h.fill(0),Oo.fill(0),o.slice(0,r)}(e,function(e,t,n){return a.hash(e),void 0===n&&(n=new Uint8Array(e.outputLen)),me(e,g(n),g(t))}(e,t,n),r,i);var $o=Object.defineProperty,Ho=(e,t)=>{for(var n in t)$o(e,n,{get:t[n],enumerable:!0})};function qo(e){return f(Ve.getPublicKey(e))}Ho({},{MessageNode:()=>Vo,MessageQueue:()=>Wo,insertEventIntoAscendingList:()=>Mo,insertEventIntoDescendingList:()=>Ko,normalizeURL:()=>jo,utf8Decoder:()=>zo,utf8Encoder:()=>Do});var zo=new TextDecoder("utf-8"),Do=new TextEncoder;function jo(e){let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),("80"===t.port&&"ws:"===t.protocol||"443"===t.port&&"wss:"===t.protocol)&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}function Ko(e,t){let n,r=0,i=e.length-1,o=r;if(i<0)o=0;else if(t.created_at<e[i].created_at)o=i+1;else if(t.created_at>=e[r].created_at)o=r;else for(;;){if(i<=r+1){o=i;break}if(n=Math.floor(r+(i-r)/2),e[n].created_at>t.created_at)r=n;else{if(!(e[n].created_at<t.created_at)){o=n;break}i=n}}return e[o]?.id!==t.id?[...e.slice(0,o),t,...e.slice(o)]:e}function Mo(e,t){let n,r=0,i=e.length-1,o=r;if(i<0)o=0;else if(t.created_at>e[i].created_at)o=i+1;else if(t.created_at<=e[r].created_at)o=r;else for(;;){if(i<=r+1){o=i;break}if(n=Math.floor(r+(i-r)/2),e[n].created_at<t.created_at)r=n;else{if(!(e[n].created_at>t.created_at)){o=n;break}i=n}}return e[o]?.id!==t.id?[...e.slice(0,o),t,...e.slice(o)]:e}var Vo=class{_value;_next;get value(){return this._value}set value(e){this._value=e}get next(){return this._next}set next(e){this._next=e}constructor(e){this._value=e,this._next=null}},Wo=class{_first;_last;get first(){return this._first}set first(e){this._first=e}get last(){return this._last}set last(e){this._last=e}_size;get size(){return this._size}set size(e){this._size=e}constructor(){this._first=null,this._last=null,this._size=0}enqueue(e){const t=new Vo(e);return 0!==this._size&&this._last?(this._last.next=t,this._last=t):(this._first=t,this._last=t),this._size++,!0}dequeue(){if(0===this._size||!this._first)return null;let e=this._first;return this._first=e.next,e.next=null,this._size--,e.value}},Zo=Symbol("verified");function Go(e,t){const n=e;return n.pubkey=qo(t),n.id=Yo(n),n.sig=es(n,t),n[Zo]=!0,n}function Yo(e){return f(_(Do.encode(function(e){if(!Qo(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}(e))))}var Jo=e=>e instanceof Object;function Qo(e){if(!Jo(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}function Xo(e){if("boolean"==typeof e[Zo])return e[Zo];const t=Yo(e);if(t!==e.id)return e[Zo]=!1;try{return e[Zo]=Ve.verify(e.sig,t,e.pubkey)}catch(t){return e[Zo]=!1}}function es(e,t){return f(Ve.sign(Yo(e),t))}function ts(e,t){if(e.ids&&-1===e.ids.indexOf(t.id)&&!e.ids.some((e=>t.id.startsWith(e))))return!1;if(e.kinds&&-1===e.kinds.indexOf(t.kind))return!1;if(e.authors&&-1===e.authors.indexOf(t.pubkey)&&!e.authors.some((e=>t.pubkey.startsWith(e))))return!1;for(let n in e)if("#"===n[0]){let r=e[`#${n.slice(1)}`];if(r&&!t.tags.find((([e,t])=>e===n.slice(1)&&-1!==r.indexOf(t))))return!1}return!(e.since&&t.created_at<e.since)&&!(e.until&&t.created_at>e.until)}function ns(e,t){for(let n=0;n<e.length;n++)if(ts(e[n],t))return!0;return!1}function rs(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,i=e.slice(r).indexOf('"')+r+1;return e.slice(i,i+64)}function is(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,i=e.slice(r),o=Math.min(i.indexOf(","),i.indexOf("}"));return parseInt(i.slice(0,o),10)}function os(e){let t=e.slice(0,22).indexOf('"EVENT"');if(-1===t)return null;let n=e.slice(t+7+1).indexOf('"');if(-1===n)return null;let r=t+7+1+n,i=e.slice(r+1,80).indexOf('"');if(-1===i)return null;let o=r+1+i;return e.slice(r+1,o)}function ss(e,t){return t===rs(e,"id")}function as(e,t){return t===rs(e,"pubkey")}function cs(e,t){return t===is(e,"kind")}Ho({},{getHex64:()=>rs,getInt:()=>is,getSubscriptionId:()=>os,matchEventId:()=>ss,matchEventKind:()=>cs,matchEventPubkey:()=>as});function hs(e,t={}){let{listTimeout:n=3e3,getTimeout:r=3e3,countTimeout:i=3e3}=t;var o,s,a={},c={connect:[],disconnect:[],error:[],notice:[],auth:[]},h={},l={};function u(){return 1===o?.readyState}async function d(e){let t=JSON.stringify(e);if(u()||(await new Promise((e=>setTimeout(e,1e3))),u()))try{o.send(t)}catch(e){console.log(e)}}const f=(e,{verb:t="REQ",skipVerification:n=!1,alreadyHaveEvent:r=null,id:i=Math.random().toString().slice(2)}={})=>{let o=i;a[o]={id:o,filters:e,skipVerification:n,alreadyHaveEvent:r},d([t,o,...e]);let s={sub:(t,i={})=>f(t||e,{skipVerification:i.skipVerification||n,alreadyHaveEvent:i.alreadyHaveEvent||r,id:o}),unsub:()=>{delete a[o],delete h[o],d(["CLOSE",o])},on:(e,t)=>{h[o]=h[o]||{event:[],count:[],eose:[]},h[o][e].push(t)},off:(e,t)=>{let n=h[o],r=n[e].indexOf(t);r>=0&&n[e].splice(r,1)},get events(){return ls(s)}};return s};function p(e,t){return new Promise(((n,r)=>{if(!e.id)return void r(new Error(`event ${e} has no id`));let i=e.id;d([t,e]),l[i]={resolve:n,reject:r}}))}return{url:e,sub:f,on:(e,t)=>{c[e].push(t),"connect"===e&&1===o?.readyState&&t()},off:(e,t)=>{let n=c[e].indexOf(t);-1!==n&&c[e].splice(n,1)},list:(e,t)=>new Promise((r=>{let i=f(e,t),o=[],s=setTimeout((()=>{i.unsub(),r(o)}),n);i.on("eose",(()=>{i.unsub(),clearTimeout(s),r(o)})),i.on("event",(e=>{o.push(e)}))})),get:(e,t)=>new Promise((n=>{let i=f([e],t),o=setTimeout((()=>{i.unsub(),n(null)}),r);i.on("event",(e=>{i.unsub(),clearTimeout(o),n(e)}))})),count:e=>new Promise((t=>{let n=f(e,{...f,verb:"COUNT"}),r=setTimeout((()=>{n.unsub(),t(null)}),i);n.on("count",(e=>{n.unsub(),clearTimeout(r),t(e)}))})),async publish(e){await p(e,"EVENT")},async auth(e){await p(e,"AUTH")},connect:async function(){u()||await async function(){return s||(s=new Promise(((t,n)=>{try{o=new WebSocket(e)}catch(e){n(e)}o.onopen=()=>{c.connect.forEach((e=>e())),t()},o.onerror=()=>{s=void 0,c.error.forEach((e=>e())),n()},o.onclose=async()=>{s=void 0,c.disconnect.forEach((e=>e()))};let r,i=new Wo;function u(){if(0===i.size)return clearInterval(r),void(r=null);var t=i.dequeue();if(!t)return;let n=os(t);if(n){let r=a[n];if(r&&r.alreadyHaveEvent&&r.alreadyHaveEvent(rs(t,"id"),e))return}try{let e=JSON.parse(t);switch(e[0]){case"EVENT":{let t=e[1],n=e[2];return void(Qo(n)&&a[t]&&(a[t].skipVerification||Xo(n))&&ns(a[t].filters,n)&&(a[t],(h[t]?.event||[]).forEach((e=>e(n)))))}case"COUNT":let t=e[1],n=e[2];return void(a[t]&&(h[t]?.count||[]).forEach((e=>e(n))));case"EOSE":{let t=e[1];return void(t in h&&(h[t].eose.forEach((e=>e())),h[t].eose=[]))}case"OK":{let t=e[1],n=e[2],r=e[3]||"";if(t in l){let{resolve:e,reject:i}=l[t];n?e(null):i(new Error(r))}return}case"NOTICE":let r=e[1];return void c.notice.forEach((e=>e(r)));case"AUTH":{let t=e[1];return void c.auth?.forEach((e=>e(t)))}}}catch(e){return}}o.onmessage=e=>{i.enqueue(e.data),r||(r=setInterval(u,0))}})),s)}()},close(){c={connect:[],disconnect:[],error:[],notice:[],auth:[]},h={},l={},o?.readyState===WebSocket.OPEN&&o.close()},get status(){return o?.readyState??3}}}async function*ls(e){let t;const n=[],r=e=>{t?(t(e),t=void 0):n.push(e)};e.on("event",r);try{for(;;)if(n.length>0)yield n.shift();else{const e=await new Promise((e=>{t=e}));yield e}}finally{e.off("event",r)}}var us={};Ho(us,{BECH32_REGEX:()=>fs,decode:()=>ps,naddrEncode:()=>ks,neventEncode:()=>xs,noteEncode:()=>bs,nprofileEncode:()=>vs,npubEncode:()=>ws,nrelayEncode:()=>As,nsecEncode:()=>ys});var ds=5e3,fs=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ps(e){let{prefix:t,words:n}=mt.decode(e,ds),r=new Uint8Array(mt.fromWords(n));switch(t){case"nprofile":{let e=gs(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:f(e[0][0]),relays:e[1]?e[1].map((e=>zo.decode(e))):[]}}}case"nevent":{let e=gs(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:f(e[0][0]),relays:e[1]?e[1].map((e=>zo.decode(e))):[],author:e[2]?.[0]?f(e[2][0]):void 0,kind:e[3]?.[0]?parseInt(f(e[3][0]),16):void 0}}}case"naddr":{let e=gs(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!e[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!e[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:zo.decode(e[0][0]),pubkey:f(e[2][0]),kind:parseInt(f(e[3][0]),16),relays:e[1]?e[1].map((e=>zo.decode(e))):[]}}}case"nrelay":{let e=gs(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:zo.decode(e[0][0])}}case"nsec":case"npub":case"note":return{type:t,data:f(r)};default:throw new Error(`unknown prefix ${t}`)}}function gs(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1];if(!r)throw new Error(`malformed TLV ${e}`);let i=n.slice(2,2+r);if(n=n.slice(2+r),i.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(i)}return t}function ys(e){return Es("nsec",e)}function ws(e){return Es("npub",e)}function bs(e){return Es("note",e)}function ms(e,t){let n=mt.toWords(t);return mt.encode(e,n,ds)}function Es(e,t){return ms(e,p(t))}function vs(e){return ms("nprofile",Ss({0:[p(e.pubkey)],1:(e.relays||[]).map((e=>Do.encode(e)))}))}function xs(e){let t;return null!=e.kind&&(t=function(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=255&e,t}(e.kind)),ms("nevent",Ss({0:[p(e.id)],1:(e.relays||[]).map((e=>Do.encode(e))),2:e.author?[p(e.author)]:[],3:t?[new Uint8Array(t)]:[]}))}function ks(e){let t=new ArrayBuffer(4);return new DataView(t).setUint32(0,e.kind,!1),ms("naddr",Ss({0:[Do.encode(e.identifier)],1:(e.relays||[]).map((e=>Do.encode(e))),2:[p(e.pubkey)],3:[new Uint8Array(t)]}))}function As(e){return ms("nrelay",Ss({0:[Do.encode(e)]}))}function Ss(e){let t=[];return Object.entries(e).forEach((([e,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(e)],0),r.set([n.length],1),r.set(n,2),t.push(r)}))})),y(...t)}var Bs={};async function _s(e,t,n){const r=Rs(Ie.getSharedSecret(e,"02"+t));let i=Uint8Array.from(m(16)),o=Do.encode(n),s=await crypto.subtle.importKey("raw",r,{name:"AES-CBC"},!1,["encrypt"]),a=await crypto.subtle.encrypt({name:"AES-CBC",iv:i},s,o);return`${ct.encode(new Uint8Array(a))}?iv=${ct.encode(new Uint8Array(i.buffer))}`}async function Is(e,t,n){let[r,i]=n.split("?iv="),o=Rs(Ie.getSharedSecret(e,"02"+t)),s=await crypto.subtle.importKey("raw",o,{name:"AES-CBC"},!1,["decrypt"]),a=ct.decode(r),c=ct.decode(i),h=await crypto.subtle.decrypt({name:"AES-CBC",iv:c},s,a);return zo.decode(h)}function Rs(e){return e.slice(1,33)}Ho(Bs,{decrypt:()=>Is,encrypt:()=>_s}),"undefined"!=typeof crypto&&!crypto.subtle&&crypto.webcrypto&&(crypto.subtle=crypto.webcrypto.subtle);Ho({},{NIP05_REGEX:()=>Us,queryProfile:()=>Ts,searchDomain:()=>Ns,useFetchImplementation:()=>Ls});var Cs,Us=/^(?:([\w.+-]+)@)?([\w.-]+)$/;try{Cs=fetch}catch{}function Ls(e){Cs=e}async function Ns(e,t=""){try{return(await(await Cs(`https://${e}/.well-known/nostr.json?name=${t}`)).json()).names}catch(e){return{}}}async function Ts(e){const t=e.match(Us);if(!t)return null;const[n,r="_",i]=t;try{const e=await Cs(`https://${i}/.well-known/nostr.json?name=${r}`),{names:t,relays:n}=function(e){const t={names:{}};for(const[n,r]of Object.entries(e.names))"string"==typeof n&&"string"==typeof r&&(t.names[n]=r);if(e.relays){t.relays={};for(const[n,r]of Object.entries(e.relays))"string"==typeof n&&Array.isArray(r)&&(t.relays[n]=r.filter((e=>"string"==typeof e)))}return t}(await e.json()),o=t[r];return o?{pubkey:o,relays:n?.[o]}:null}catch(e){return null}}function Os(e,t){let n=fo.fromMasterSeed(Hn(e,t)).derive("m/44'/1237'/0'/0/0").privateKey;if(!n)throw new Error("could not derive private key");return f(n)}function Fs(){return Tn(vt)}function Ps(e){return Pn(e,vt)}Ho({},{generateSeedWords:()=>Fs,privateKeyFromSeedWords:()=>Os,validateWords:()=>Ps});function $s(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of e.tags)"e"===r[0]&&r[1]&&n.push(r),"p"===r[0]&&r[1]&&t.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let e=0;e<n.length;e++){const r=n[e],[i,o,s,a]=r,c={id:o,relays:s?[s]:[]},h=0===e,l=e===n.length-1;"root"!==a?"reply"!==a?"mention"!==a?h?t.root=c:l?t.reply=c:t.mentions.push(c):t.mentions.push(c):t.reply=c:t.root=c}return t}Ho({},{parse:()=>$s});function Hs(e){let t=0;for(let n=0;n<e.length;n++){const r=parseInt(e[n],16);if(0!==r){t+=Math.clz32(r)-28;break}t+=4}return t}function qs(e,t){let n=0;const r=e,i=["nonce",n.toString(),t.toString()];for(r.tags.push(i);;){const e=Math.floor((new Date).getTime()/1e3);if(e!==r.created_at&&(n=0,r.created_at=e),i[1]=(++n).toString(),r.id=Yo(r),Hs(r.id)>=t)break}return r}Ho({},{getPow:()=>Hs,minePow:()=>qs});function zs(e,t,n,r){return Go({kind:6,tags:[...e.tags??[],["e",t.id,n],["p",t.pubkey]],content:""===e.content?"":JSON.stringify(t),created_at:e.created_at},r)}function Ds(e){if(6!==e.kind)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const i=e.tags[r];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==t?{id:t[1],relays:[t[2],n?.[2]].filter((e=>"string"==typeof e)),author:n?.[1]}:void 0}function js(e,{skipVerification:t}={}){const n=Ds(e);if(void 0===n||""===e.content)return;let r;try{r=JSON.parse(e.content)}catch(e){return}return r.id===n.id&&(t||Xo(r))?r:void 0}Ho({},{finishRepostEvent:()=>zs,getRepostedEvent:()=>js,getRepostedEventPointer:()=>Ds});Ho({},{NOSTR_URI_REGEX:()=>Ks,parse:()=>Vs,test:()=>Ms});var Ks=new RegExp(`nostr:(${fs.source})`);function Ms(e){return"string"==typeof e&&new RegExp(`^${Ks.source}$`).test(e)}function Vs(e){const t=e.match(new RegExp(`^${Ks.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:ps(t[1])}}function Ws(e,t,n){const r=t.tags.filter((e=>e.length>=2&&("e"===e[0]||"p"===e[0])));return Go({...e,kind:7,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function Zs(e){if(7!==e.kind)return;let t,n;for(let r=e.tags.length-1;r>=0&&(void 0===t||void 0===n);r--){const i=e.tags[r];i.length>=2&&("e"===i[0]&&void 0===t?t=i:"p"===i[0]&&void 0===n&&(n=i))}return void 0!==t&&void 0!==n?{id:t[1],relays:[t[2],n[2]].filter((e=>void 0!==e)),author:n[1]}:void 0}Ho({},{finishReactionEvent:()=>Ws,getReactedEventPointer:()=>Zs});function Gs(e,t){let n=[];(t.kind||-1)>=0&&n.push(`kind=${t.kind}`),t.until&&n.push(`created_at<${t.until}`),t.since&&n.push(`created_at>${t.since}`);let r=n.join("&");if(""===r)throw new Error("refusing to create a delegation without any conditions");let i=_(Do.encode(`nostr:delegation:${t.pubkey}:${r}`)),o=f(Ve.sign(i,e));return{from:qo(e),to:t.pubkey,cond:r,sig:o}}function Ys(e){let t=e.tags.find((e=>"delegation"===e[0]&&e.length>=4));if(!t)return null;let n=t[1],r=t[2],i=t[3],o=r.split("&");for(let t=0;t<o.length;t++){let[n,r,i]=o[t].split(/\b/);if(("kind"!==n||"="!==r||e.kind!==parseInt(i))&&!("created_at"===n&&"<"===r&&e.created_at<parseInt(i)||"created_at"===n&&">"===r&&e.created_at>parseInt(i)))return null}let s=_(Do.encode(`nostr:delegation:${e.pubkey}:${r}`));return Ve.verify(i,s,n)?n:null}Ho({},{createDelegation:()=>Gs,getDelegator:()=>Ys});Ho({},{matchAll:()=>Qs,regex:()=>Js,replaceAll:()=>Xs});var Js=()=>new RegExp(`\\b${Ks.source}\\b`,"g");function*Qs(e){const t=e.matchAll(Js());for(const e of t)try{const[t,n]=e;yield{uri:t,value:n,decoded:ps(n),start:e.index,end:e.index+t.length}}catch(e){}}function Xs(e,t){return e.replaceAll(Js(),((e,n)=>t({uri:e,value:n,decoded:ps(n)})))}Ho({},{channelCreateEvent:()=>ta,channelHideMessageEvent:()=>ia,channelMessageEvent:()=>ra,channelMetadataEvent:()=>na,channelMuteUserEvent:()=>oa});var ea,ta=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Go({kind:40,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},na=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Go({kind:41,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},ra=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),Go({kind:42,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},ia=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Go({kind:43,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},oa=(e,t)=>{let n;if("object"==typeof e.content)n=JSON.stringify(e.content);else{if("string"!=typeof e.content)return;n=e.content}return Go({kind:44,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)};Ho({},{useFetchImplementation:()=>sa,validateGithub:()=>aa});try{ea=fetch}catch{}function sa(e){ea=e}async function aa(e,t,n){try{return await(await ea(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch(e){return!1}}Ho({},{authenticate:()=>ca});var ca=async({challenge:e,relay:t,sign:n})=>{const r={kind:22242,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t.url],["challenge",e]],content:""};return t.auth(await n(r))};Ho({},{decrypt:()=>ua,encrypt:()=>la,utils:()=>ha});var ha={v2:{maxPlaintextSize:65408,minCiphertextSize:100,maxCiphertextSize:102400,getConversationKey:(e,t)=>Ie.getSharedSecret(e,"02"+t).subarray(1,33),getMessageKeys(e,t){const n=Po(_,e,t,"nip44-v2",76);return{encryption:n.subarray(0,32),nonce:n.subarray(32,44),auth:n.subarray(44,76)}},calcPadding(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)},pad(e){const t=Do.encode(e),n=t.length;if(n<1||n>=ha.v2.maxPlaintextSize)throw new Error("invalid plaintext length: must be between 1b and 64KB");const r=ha.v2.calcPadding(n),i=new Uint8Array(r-n),o=new Uint8Array(2);return new DataView(o.buffer).setUint16(0,n),y(o,t,i)},unpad(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(0===t||n.length!==t||e.length!==2+ha.v2.calcPadding(t))throw new Error("invalid padding");return zo.decode(n)}}};function la(e,t,n={}){const r=n.version??2;if(2!==r)throw new Error("unknown encryption version "+r);const i=n.salt??m(32);mo(i,32);const o=ha.v2.getMessageKeys(e,i),s=ha.v2.pad(t),a=To(o.encryption,o.nonce,s),c=me(_,o.auth,a);return ct.encode(y(new Uint8Array([r]),i,a,c))}function ua(e,t){const n=ha.v2;mo(e,32);const r=t.length;if(r<n.minCiphertextSize||r>=n.maxCiphertextSize)throw new Error("invalid ciphertext length: "+r);if("#"===t[0])throw new Error("unknown encryption version");let i;try{i=ct.decode(t)}catch(e){throw new Error("invalid base64: "+e.message)}const o=i.subarray(0,1)[0];if(2!==o)throw new Error("unknown encryption version "+o);const s=i.subarray(1,33),a=i.subarray(33,-32),c=i.subarray(-32),h=n.getMessageKeys(e,s);if(!function(e,t){if(e.length!==t.length)throw new Error("equalBytes: Different size of Uint8Arrays");let n=!0;for(let r=0;r<e.length;r++)n&&(n=e[r]===t[r]);return n}(me(_,h.auth,a),c))throw new Error("invalid MAC");const l=To(h.encryption,h.nonce,a);return n.unpad(l)}function da(e){const{pathname:t,searchParams:n}=new URL(e),r=t,i=n.get("relay"),o=n.get("secret");if(!r||!i||!o)throw new Error("invalid connection string");return{pubkey:r,relay:i,secret:o}}async function fa({pubkey:e,secret:t,invoice:n}){const r={method:"pay_invoice",params:{invoice:n}},i=await _s(t,e,JSON.stringify(r));return Go({kind:23194,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e]]},t)}Ho({},{makeNwcRequestEvent:()=>fa,parseConnectionString:()=>da});var pa,ga={};Ho(ga,{getZapEndpoint:()=>wa,makeZapReceipt:()=>Ea,makeZapRequest:()=>ba,useFetchImplementation:()=>ya,validateZapRequest:()=>ma});try{pa=fetch}catch{}function ya(e){pa=e}async function wa(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:e}=mt.decode(n,1e3),r=mt.fromWords(e);t=zo.decode(r)}else{if(!r)return null;{let[e,n]=r.split("@");t=`https://${n}/.well-known/lnurlp/${e}`}}let i=await pa(t),o=await i.json();if(o.allowsNostr&&o.nostrPubkey)return o.callback}catch(e){}return null}function ba({profile:e,event:t,amount:n,relays:r,comment:i=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let o={kind:9734,created_at:Math.round(Date.now()/1e3),content:i,tags:[["p",e],["amount",n.toString()],["relays",...r]]};return t&&o.tags.push(["e",t]),o}function ma(e){let t;try{t=JSON.parse(e)}catch(e){return"Invalid zap request JSON."}if(!Qo(t))return"Zap request is not a valid Nostr event.";if(!Xo(t))return"Invalid signature on zap request.";let n=t.tags.find((([e,t])=>"p"===e&&t));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find((([e,t])=>"e"===e&&t));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find((([e,t])=>"relays"===e&&t))?null:"Zap request doesn't have a 'relays' tag."}function Ea({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let i=JSON.parse(e).tags.filter((([e])=>"e"===e||"p"===e||"a"===e)),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["bolt11",n],["description",e]]};return t&&o.tags.push(["preimage",t]),o}Ho({},{getToken:()=>xa,unpackEventFromToken:()=>Aa,validateEvent:()=>Sa,validateToken:()=>ka});var va="Nostr ";async function xa(e,t,n,r=!1){if(!e||!t)throw new Error("Missing loginUrl or httpMethod");const i=function(e=255){return{kind:e,content:"",tags:[],created_at:0}}(27235);i.tags=[["u",e],["method",t]],i.created_at=Math.round((new Date).getTime()/1e3);const o=await n(i);return(r?va:"")+ct.encode(Do.encode(JSON.stringify(o)))}async function ka(e,t,n){const r=await Aa(e).catch((e=>{throw e}));return await Sa(r,t,n).catch((e=>{throw e}))}async function Aa(e){if(!e)throw new Error("Missing token");e=e.replace(va,"");const t=zo.decode(ct.decode(e));if(!t||0===t.length||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}async function Sa(e,t,n){if(!e)throw new Error("Invalid nostr event");if(!Xo(e))throw new Error("Invalid nostr event, signature invalid");if(27235!==e.kind)throw new Error("Invalid nostr event, kind invalid");if(!e.created_at)throw new Error("Invalid nostr event, created_at invalid");if(Math.round((new Date).getTime()/1e3)-e.created_at>60)throw new Error("Invalid nostr event, expired");const r=e.tags.find((e=>"u"===e[0]));if(1!==r?.length&&r?.[1]!==t)throw new Error("Invalid nostr event, url tag invalid");const i=e.tags.find((e=>"method"===e[0]));if(1!==i?.length&&i?.[1].toLowerCase()!==n.toLowerCase())throw new Error("Invalid nostr event, method tag invalid");return!0}var Ba=__webpack_require__(706),_a=__webpack_require__(833);function Ia(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Ra(e,...t){if(!((n=e)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}function Ca(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Ia(e.outputLen),Ia(e.blockLen)}function Ua(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function La(e,t){Ra(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Na="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;const Ta=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Oa=(e,t)=>e<<32-t|e>>>t;new Uint8Array(new Uint32Array([287454020]).buffer)[0];function Fa(e){return"string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),Ra(e),e}class Pa{clone(){return this._cloneInto()}}function $a(e){const t=t=>e().update(Fa(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Ha(e=32){if(Na&&"function"==typeof Na.getRandomValues)return Na.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}const qa=(e,t,n)=>e&t^e&n^t&n;class za extends Pa{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ta(this.buffer)}update(e){Ua(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Fa(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Ta(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ua(this),La(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,h=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=Ta(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const Da=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ja=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ka=new Uint32Array(64);class Ma extends za{constructor(){super(64,32,8,!1),this.A=0|ja[0],this.B=0|ja[1],this.C=0|ja[2],this.D=0|ja[3],this.E=0|ja[4],this.F=0|ja[5],this.G=0|ja[6],this.H=0|ja[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)Ka[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Ka[e-15],n=Ka[e-2],r=Oa(t,7)^Oa(t,18)^t>>>3,i=Oa(n,17)^Oa(n,19)^n>>>10;Ka[e]=i+Ka[e-7]+r+Ka[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(Oa(s,6)^Oa(s,11)^Oa(s,25))+((l=s)&a^~l&c)+Da[e]+Ka[e]|0,u=(Oa(n,2)^Oa(n,13)^Oa(n,22))+qa(n,r,i)|0;h=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,o,s,a,c,h)}roundClean(){Ka.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Va=$a((()=>new Ma));class Wa extends Pa{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Ca(e);const n=Fa(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return Ua(this),this.iHash.update(e),this}digestInto(e){Ua(this),Ra(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Za=(e,t,n)=>new Wa(e,t).update(n).digest();Za.create=(e,t)=>new Wa(e,t);const Ga=BigInt(1),Ya=BigInt(2);function Ja(e){return e instanceof Uint8Array||null!=e&&"object"==typeof e&&"Uint8Array"===e.constructor.name}function Qa(e){if(!Ja(e))throw new Error("Uint8Array expected")}const Xa=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function ec(e){Qa(e);let t="";for(let n=0;n<e.length;n++)t+=Xa[e[n]];return t}function tc(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}const nc={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function rc(e){return e>=nc._0&&e<=nc._9?e-nc._0:e>=nc._A&&e<=nc._F?e-(nc._A-10):e>=nc._a&&e<=nc._f?e-(nc._a-10):void 0}function ic(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let t=0,i=0;t<n;t++,i+=2){const n=rc(e.charCodeAt(i)),o=rc(e.charCodeAt(i+1));if(void 0===n||void 0===o){const t=e[i]+e[i+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+i)}r[t]=16*n+o}return r}function oc(e){return tc(ec(e))}function sc(e){return Qa(e),tc(ec(Uint8Array.from(e).reverse()))}function ac(e,t){return ic(e.toString(16).padStart(2*t,"0"))}function cc(e,t){return ac(e,t).reverse()}function hc(e,t,n){let r;if("string"==typeof t)try{r=ic(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!Ja(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}function lc(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];Qa(r),t+=r.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}const uc=e=>(Ya<<BigInt(e-1))-Ga,dc=e=>new Uint8Array(e),fc=e=>Uint8Array.from(e);function pc(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=dc(e),i=dc(e),o=0;const s=()=>{r.fill(1),i.fill(0),o=0},a=(...e)=>n(i,r,...e),c=(e=dc())=>{i=a(fc([0]),e),r=a(),0!==e.length&&(i=a(fc([1]),e),r=a())},h=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return lc(...n)};return(e,t)=>{let n;for(s(),c(e);!(n=t(h()));)c();return s(),n}}const gc={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||Ja(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function yc(e,t,n={}){const r=(t,n,r)=>{const i=gc[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const o=e[t];if(!(r&&void 0===o||i(o,e)))throw new Error(`Invalid param ${String(t)}=${o} (${typeof o}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}const wc=BigInt(0),bc=BigInt(1),mc=BigInt(2),Ec=BigInt(3),vc=BigInt(4),xc=BigInt(5),kc=BigInt(8);BigInt(9),BigInt(16);function Ac(e,t){const n=e%t;return n>=wc?n:t+n}function Sc(e,t,n){if(n<=wc||t<wc)throw new Error("Expected power/modulo > 0");if(n===bc)return wc;let r=bc;for(;t>wc;)t&bc&&(r=r*e%n),e=e*e%n,t>>=bc;return r}function Bc(e,t,n){let r=e;for(;t-- >wc;)r*=r,r%=n;return r}function _c(e,t){if(e===wc||t<=wc)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Ac(e,t),r=t,i=wc,o=bc,s=bc,a=wc;for(;n!==wc;){const e=r/n,t=r%n,c=i-s*e,h=o-a*e;r=n,n=t,i=s,o=a,s=c,a=h}if(r!==bc)throw new Error("invert: does not exist");return Ac(i,t)}function Ic(e){if(e%vc===Ec){const t=(e+bc)/vc;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%kc===xc){const t=(e-xc)/kc;return function(e,n){const r=e.mul(n,mc),i=e.pow(r,t),o=e.mul(n,i),s=e.mul(e.mul(o,mc),i),a=e.mul(o,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-bc)/mc;let n,r,i;for(n=e-bc,r=0;n%mc===wc;n/=mc,r++);for(i=mc;i<e&&Sc(i,t,e)!==e-bc;i++);if(1===r){const t=(e+bc)/vc;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+bc)/mc;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),h=e.pow(s,o),l=e.pow(s,n);for(;!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(l);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,bc<<BigInt(a-t-1));c=e.sqr(n),h=e.mul(h,n),l=e.mul(l,c),a=t}return h}}(e)}const Rc=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Cc(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function Uc(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Lc(e){const t=Uc(e);return t+Math.ceil(t/2)}const Nc=BigInt(0),Tc=BigInt(1);function Oc(e){return yc(e.Fp,Rc.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),yc(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Cc(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const{Ph:Fc,aT:Pc}=n,$c={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=$c;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Fc(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=$c,n="string"==typeof e?Pc(e):e;Qa(n);let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=$c._parseInt(n.subarray(2)),{d:s,l:a}=$c._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),i=t(n(e.r)),o=r.length/2,s=i.length/2,a=n(o),c=n(s);return`30${n(s+o+4)}02${c}${i}02${a}${r}`}},Hc=BigInt(0),qc=BigInt(1),zc=(BigInt(2),BigInt(3));BigInt(4);function Dc(e){const t=function(e){const t=Oc(e);yc(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return lc(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,o=n.sqr(e),s=n.mul(o,e);return n.add(n.add(s,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&Hc<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:o}=t;if(n&&"bigint"!=typeof e){if(Ja(e)&&(e=ec(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:oc(hc("private key",e,r))}catch(t){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return i&&(s=Ac(s,o)),a(s),s}const h=new Map;function l(e){if(!(e instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof u)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?u.ZERO:new u(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}static fromHex(e){const t=u.fromAffine(i(hc("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return u.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,h.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),s=o(e);if(!n.eql(i,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){l(e);const{px:t,py:r,pz:i}=this,{px:o,py:s,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(o,i)),h=n.eql(n.mul(r,a),n.mul(s,i));return c&&h}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,zc),{px:o,py:s,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(o,o),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(o,s);return g=n.add(g,g),l=n.mul(o,a),l=n.add(l,l),c=n.mul(e,l),h=n.mul(i,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(i,l),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(e){l(e);const{px:r,py:i,pz:o}=this,{px:s,py:a,pz:c}=e;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,zc);let y=n.mul(r,s),w=n.mul(i,a),b=n.mul(o,c),m=n.add(r,i),E=n.add(s,a);m=n.mul(m,E),E=n.add(y,w),m=n.sub(m,E),E=n.add(r,o);let v=n.add(s,c);return E=n.mul(E,v),v=n.add(y,b),E=n.sub(E,v),v=n.add(i,o),h=n.add(a,c),v=n.mul(v,h),h=n.add(w,b),v=n.sub(v,h),f=n.mul(p,E),h=n.mul(g,b),f=n.add(h,f),h=n.sub(w,f),f=n.add(w,f),d=n.mul(h,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),E=n.mul(g,E),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),E=n.add(E,b),y=n.mul(w,E),d=n.add(d,y),y=n.mul(v,E),h=n.mul(m,h),h=n.sub(h,y),y=n.mul(m,w),f=n.mul(v,f),f=n.add(f,y),new u(h,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(u.ZERO)}wNAF(e){return f.wNAFCached(this,h,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}))}multiplyUnsafe(e){const r=u.ZERO;if(e===Hc)return r;if(a(e),e===qc)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:c,k2:h}=i.splitScalar(e),l=r,d=r,p=this;for(;s>Hc||h>Hc;)s&qc&&(l=l.add(p)),h&qc&&(d=d.add(p)),p=p.double(),s>>=qc,h>>=qc;return o&&(l=l.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,i.beta),d.py,d.pz),l.add(d)}multiply(e){a(e);let r,i,o=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:c}=s.splitScalar(o);let{p:h,f:l}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(e,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,s.beta),d.py,d.pz),r=h.add(d),i=l.add(p)}else{const{p:e,f:t}=this.wNAF(o);r=e,i=t}return u.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=u.BASE,i=(e,t)=>t!==Hc&&t!==qc&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){const{px:t,py:r,pz:i}=this,o=this.is0();null==e&&(e=o?n.ONE:n.inv(i));const s=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===qc)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===qc?this:n?n(u,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(u,this,e)}toHex(e=!0){return ec(this.toRawBytes(e))}}u.BASE=new u(t.Gx,t.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>Nc;)n&Tc&&(r=r.add(i)),i=i.double(),n>>=Tc;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),o=[];let s=e,a=s;for(let e=0;e<n;e++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){const{windows:s,windowSize:a}=r(t);let c=e.ZERO,h=e.BASE;const l=BigInt(2**t-1),u=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(o&l);o>>=d,r>a&&(r-=u,o+=Tc);const s=t,f=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?h=h.add(n(p,i[s])):c=c.add(n(g,i[f]))}return{p:c,f:h}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,r(o))),this.wNAF(i,o,n)}}}(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function jc(e){const t=function(e){const t=Oc(e);return yc(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,o=2*n.BYTES+1;function s(e){return Ac(e,r)}function a(e){return _c(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=Dc({...t,toBytes(e,t,r){const i=t.toAffine(),o=n.toBytes(i.x),s=lc;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===o&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}{const e=oc(s);if(!(Hc<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=l(e);let i;try{i=n.sqrt(t)}catch(e){const t=e instanceof Error?": "+e.message:"";throw new Error("Point is not on curve"+t)}return!(1&~r)!==((i&qc)===qc)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>ec(ac(e,t.nByteLength));function f(e){return e>r>>qc}const p=(e,t,n)=>oc(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=hc("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=$c.toSig(hc("DER",e));return new g(t,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r,s:i,recovery:o}=this,h=m(hc("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const l=2===o||3===o?r+t.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&o?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=s(-h*p),y=s(i*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return ic(this.toDERHex())}toDERHex(){return $c.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return ic(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return h(e),!0}catch(e){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const e=Lc(t.n);return function(e,t,n=!1){const r=e.length,i=Uc(t),o=Lc(t);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const s=Ac(n?oc(e):sc(e),t-bc)+bc;return n?cc(s,i):ac(s,i)}(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=Ja(e),n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===o:n?r===2*i||r===2*o:e instanceof c}const b=t.bits2int||function(e){const n=oc(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},m=t.bits2int_modN||function(e){return s(b(e))},E=uc(t.nBitLength);function v(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(Hc<=e&&e<E))throw new Error(`bigint expected < 2^${t.nBitLength}`);return ac(e,t.nByteLength)}function x(e,r,i=k){if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:l}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=hc("msgHash",e),p&&(e=hc("prehashed msgHash",o(e)));const w=m(e),E=h(r),x=[v(E),v(w)];if(null!=y&&!1!==y){const e=!0===y?l(n.BYTES):y;x.push(hc("extraEntropy",e))}const A=lc(...x),S=w;return{seed:A,k2sig:function(e){const t=b(e);if(!u(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=s(r.x);if(i===Hc)return;const o=s(n*s(S+i*E));if(o===Hc)return;let h=(r.x===i?0:2)|Number(r.y&qc),l=o;return d&&f(o)&&(l=function(e){return f(e)?s(-e):e}(o),h^=1),new g(i,l,h)}}}const k={lowS:t.lowS,prehash:!1},A={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(h(e)).toRawBytes(n)},sign:function(e,n,r=k){const{seed:i,k2sig:o}=x(e,n,r),s=t;return pc(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(e,n,r,i=A){const o=e;if(n=hc("msgHash",n),r=hc("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:l}=i;let u,d;try{if("string"==typeof o||Ja(o))try{u=g.fromDER(o)}catch(e){if(!(e instanceof $c.Err))throw e;u=g.fromCompact(o)}else{if("object"!=typeof o||"bigint"!=typeof o.r||"bigint"!=typeof o.s)throw new Error("PARSE");{const{r:e,s:t}=o;u=new g(e,t)}}d=c.fromHex(r)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=t.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=s(y*w),E=s(f*w),v=c.BASE.multiplyAndAddUnsafe(d,b,E)?.toAffine();return!!v&&s(v.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function Kc(e){return{hash:e,hmac:(t,...n)=>Za(e,t,function(...e){let t=0;for(let n=0;n<e.length;n++){const r=e[n];Ra(r),t+=r.length}const n=new Uint8Array(t);for(let t=0,r=0;t<e.length;t++){const i=e[t];n.set(i,r),r+=i.length}return n}(...n)),randomBytes:Ha}}const Mc=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Vc=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Wc=BigInt(1),Zc=BigInt(2),Gc=(e,t)=>(e+t/Zc)/t;function Yc(e){const t=Mc,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),h=e*e*e%t,l=h*h*e%t,u=Bc(l,n,t)*l%t,d=Bc(u,n,t)*l%t,f=Bc(d,Zc,t)*h%t,p=Bc(f,i,t)*f%t,g=Bc(p,o,t)*p%t,y=Bc(g,a,t)*g%t,w=Bc(y,c,t)*y%t,b=Bc(w,a,t)*g%t,m=Bc(b,n,t)*l%t,E=Bc(m,s,t)*p%t,v=Bc(E,r,t)*h%t,x=Bc(v,Zc,t);if(!Jc.eql(Jc.sqr(x),e))throw new Error("Cannot find square root");return x}const Jc=function(e,t,n=!1,r={}){if(e<=wc)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=Cc(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=Ic(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:uc(i),ZERO:wc,ONE:bc,create:t=>Ac(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return wc<=t&&t<e},is0:e=>e===wc,isOdd:e=>(e&bc)===bc,neg:t=>Ac(-t,e),eql:(e,t)=>e===t,sqr:t=>Ac(t*t,e),add:(t,n)=>Ac(t+n,e),sub:(t,n)=>Ac(t-n,e),mul:(t,n)=>Ac(t*n,e),pow:(e,t)=>function(e,t,n){if(n<wc)throw new Error("Expected power > 0");if(n===wc)return e.ONE;if(n===bc)return t;let r=e.ONE,i=t;for(;n>wc;)n&bc&&(r=e.mul(r,i)),i=e.sqr(i),n>>=bc;return r}(a,e,t),div:(t,n)=>Ac(t*_c(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>_c(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?cc(e,o):ac(e,o),fromBytes:e=>{if(e.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${e.length}`);return n?sc(e):oc(e)}});return Object.freeze(a)}(Mc,void 0,void 0,{sqrt:Yc}),Qc=function(e,t){const n=t=>jc({...e,...Kc(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Jc,n:Vc,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Vc,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Wc*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=Gc(o*e,t),c=Gc(-r*e,t);let h=Ac(e-a*n-c*i,t),l=Ac(-a*r-c*o,t);const u=h>s,d=l>s;if(u&&(h=t-h),d&&(l=t-l),h>s||l>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},Va),Xc=BigInt(0),eh=e=>"bigint"==typeof e&&Xc<e&&e<Mc,th=e=>"bigint"==typeof e&&Xc<e&&e<Vc,nh={};function rh(e,...t){let n=nh[e];if(void 0===n){const t=Va(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=lc(t,t),nh[e]=n}return Va(lc(n,...t))}const ih=e=>e.toRawBytes(!0).slice(1),oh=e=>ac(e,32),sh=e=>Ac(e,Mc),ah=e=>Ac(e,Vc),ch=Qc.ProjectivePoint,hh=(e,t,n)=>ch.BASE.multiplyAndAddUnsafe(e,t,n);function lh(e){let t=Qc.utils.normPrivateKeyToScalar(e),n=ch.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:ah(-t),bytes:ih(n)}}function uh(e){if(!eh(e))throw new Error("bad x: need 0 < x < p");const t=sh(e*e);let n=Yc(sh(t*e+BigInt(7)));n%Zc!==Xc&&(n=sh(-n));const r=new ch(e,n,Wc);return r.assertValidity(),r}function dh(...e){return ah(oc(rh("BIP0340/challenge",...e)))}function fh(e){return lh(e).bytes}function ph(e,t,n=Ha(32)){const r=hc("message",e),{bytes:i,scalar:o}=lh(t),s=hc("auxRand",n,32),a=oh(o^oc(rh("BIP0340/aux",s))),c=rh("BIP0340/nonce",a,i,r),h=ah(oc(c));if(h===Xc)throw new Error("sign failed: k is zero");const{bytes:l,scalar:u}=lh(h),d=dh(l,i,r),f=new Uint8Array(64);if(f.set(l,0),f.set(oh(ah(u+d*o)),32),!gh(f,r,i))throw new Error("sign: Invalid signature produced");return f}function gh(e,t,n){const r=hc("signature",e,64),i=hc("message",t),o=hc("publicKey",n,32);try{const e=uh(oc(o)),t=oc(r.subarray(0,32));if(!eh(t))return!1;const n=oc(r.subarray(32,64));if(!th(n))return!1;const s=dh(oh(t),ih(e),i),a=hh(e,n,ah(-s));return!(!a||!a.hasEvenY()||a.toAffine().x!==t)}catch(e){return!1}}const yh=(()=>({getPublicKey:fh,sign:ph,verify:gh,utils:{randomPrivateKey:Qc.utils.randomPrivateKey,lift_x:uh,pointToBytes:ih,numberToBytesBE:ac,bytesToNumberBE:oc,taggedHash:rh,mod:Ac}}))();var wh=__webpack_require__(654);__webpack_require__(705);function bh(e,t){if(e.outboxTracker)return e.outboxTracker.data.get(t)?.writeRelays}function mh(e,t,n,r=2){const i=new Map,{pubkeysToRelays:o,authorsMissingRelays:s}=function(e,t){const n=new Map,r=new Set;return t.forEach((t=>{const i=bh(e,t);i&&i.size>0?(i.forEach((e=>{const r=n.get(e)||new Set;r.add(t),n.set(e,r)})),n.set(t,i)):r.add(t)})),{pubkeysToRelays:n,authorsMissingRelays:r}}(e,t),a=function(e,t){const n=new Map;return t.forEach((t=>{const r=bh(e,t);r&&r.forEach((e=>{const t=n.get(e)||0;n.set(e,t+1)}))})),Array.from(n.entries()).sort(((e,t)=>t[1]-e[1])).map((e=>e[0]))}(e,t),c=(e,t)=>{const n=i.get(t)||[];n.push(e),i.set(t,n)};for(const[e,t]of o.entries()){let o=r;const s=n.connectedRelays();for(const n of s)t.has(n.url)&&(c(e,n.url),o--);for(const n of t)i.has(n)&&(c(e,n),o--);if(!(o<=0))for(const n of a){if(o<=0)break;t.has(n)&&(c(e,n),o--)}}for(const e of s)n.permanentAndConnectedRelays().forEach((t=>{const n=i.get(t.url)||[];n.push(e),i.set(t.url,n)}));return i}var Eh=class{ndkRelay;_status;relay;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;reconnectTimeout;constructor(e){this.ndkRelay=e,this._status=3,this.relay=hs(this.ndkRelay.url),this.debug=this.ndkRelay.debug.extend("connectivity"),this.relay.on("notice",(e=>this.handleNotice(e)))}async connect(e,t=!0){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),e??=this.timeoutMs,!this.timeoutMs&&e&&(this.timeoutMs=e);const n=()=>{this.updateConnectionStats.connected(),this._status=1,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")},r=()=>{this.updateConnectionStats.disconnected(),1===this._status&&(this._status=3,this.handleReconnection()),this.ndkRelay.emit("disconnect")},i=async e=>{this.debug("Relay requested authentication",{havePolicy:!!this.ndkRelay.authPolicy}),this.ndkRelay.authPolicy?7!==this._status&&(this._status=7,await this.ndkRelay.authPolicy(this.ndkRelay,e),7===this._status&&(this.debug("Authentication policy finished"),this._status=1,this.ndkRelay.emit("authed"))):await this.ndkRelay.emit("auth",e)};try{this.updateConnectionStats.attempt(),3===this._status?this._status=0:this._status=4,this.relay.off("connect",n),this.relay.off("disconnect",r),this.relay.on("connect",n),this.relay.on("disconnect",r),this.relay.on("auth",i),await async function(e,t,n){return t?new Promise(((r,i)=>{const o=setTimeout((()=>{i(new Error(n||`Timed out after ${t}ms`))}),t);e().then(r,i).finally((()=>clearTimeout(o)))})):e()}(this.relay.connect,e,"Timed out while connecting")}catch(e){throw this._status=3,t?this.handleReconnection():this.ndkRelay.emit("delayed-connect",1728e5),e}}disconnect(){this._status=2,this.relay.close()}get status(){return this._status}isAvailable(){return 1===this._status}isFlapping(){const e=this._connectionStats.durations;if(e.length%3!=0)return!1;const t=e.reduce(((e,t)=>e+t),0)/e.length,n=e.map((e=>Math.pow(e-t,2))).reduce(((e,t)=>e+t),0)/e.length;return Math.sqrt(n)<1e3}async handleNotice(e){(e.includes("oo many")||e.includes("aximum"))&&(this.disconnect(),setTimeout((()=>this.connect()),2e3),this.debug(this.relay.url,"Relay complaining?",e)),this.ndkRelay.emit("notice",e)}handleReconnection(e=0){if(this.reconnectTimeout)return;if(this.debug("Attempting to reconnect",{attempt:e}),this.isFlapping())return this.ndkRelay.emit("flapping",this._connectionStats),void(this._status=5);const t=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout((()=>{this.reconnectTimeout=void 0,this._status=4,this.connect().then((()=>{this.debug("Reconnected")})).catch((t=>{e<5?setTimeout((()=>{this.handleReconnection(e+1)}),1e3*(e+1)^4):this.debug("Reconnect failed")}))}),t),this.ndkRelay.emit("delayed-connect",t),this.debug("Reconnecting in",t),this._connectionStats.nextReconnectAt=Date.now()+t}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++}};get connectionStats(){return this._connectionStats}},vh=class{ndkRelay;constructor(e){this.ndkRelay=e}async publish(e,t=2500){const n=()=>new Promise(((n,r)=>{try{this.publishEvent(e,t).then((e=>n(e))).catch((e=>r(e)))}catch(e){r(e)}})),r=new Promise(((e,n)=>{setTimeout((()=>n(new Error("Timeout"))),t)})),i=()=>{n().then((e=>o(e))).catch((e=>s(e)))};let o,s;return 1===this.ndkRelay.status?Promise.race([n(),r]):Promise.race([new Promise(((e,t)=>{o=e,s=t,this.ndkRelay.once("connect",i)})),r]).finally((()=>{this.ndkRelay.removeListener("connect",i)}))}async publishEvent(e,t){const n=await e.toNostrEvent(),r=this.ndkRelay.connectivity.relay.publish(n);let i;const o=new Promise(((t,n)=>{r.then((()=>{clearTimeout(i),this.ndkRelay.emit("published",e),t(!0)})).catch((t=>{clearTimeout(i),this.ndkRelay.debug("Publish failed",t,e.id),this.ndkRelay.emit("publish:failed",e,t),n(t)}))}));if(!t||e.isEphemeral())return o;const s=new Promise(((n,r)=>{i=setTimeout((()=>{this.ndkRelay.debug("Publish timed out",e.rawEvent()),this.ndkRelay.emit("publish:failed",e,"Timeout"),r(new Error("Publish operation timed out"))}),t)}));return Promise.race([o,s])}async auth(e){return this.ndkRelay.connectivity.relay.auth(e.rawEvent())}};function xh(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,n])=>{Array.isArray(n)?void 0===t[e]?t[e]=[...n]:t[e]=Array.from(new Set([...t[e],...n])):t[e]=n}))})),t}function kh(e){return!(!e.filter.ids||!function(e){const t=e.filter.ids;return!!t&&t.length===e.eventFirstSeen.size}(e))}function Ah(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const[n,r]of Object.entries(e)){const e=t[n];if(!e)return!1;if(Array.isArray(r)&&Array.isArray(e)){const t=r;for(const n of e){const e=n;if(!t.includes(e))return!1}}else if(e!==r)return!1}return!0}var Sh=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,Bh=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;var _h=class extends Ba.EventEmitter{subscriptions;req;debug;constructor(e,t){super(),this.subscriptions=e,this.debug=t||this.subscriptions[0].subscription.debug.extend("grouped");for(const t of e)this.handleSubscriptionClosure(t)}addSubscription(e){this.subscriptions.push(e),this.handleSubscriptionClosure(e)}eventReceived(e){for(const t of this.subscriptions)t.eventReceived(e)}eoseReceived(e){Array.from(this.subscriptions).forEach((async t=>{t.subscription.eoseReceived(e)}))}handleSubscriptionClosure(e){e.subscription.on("close",(()=>{const t=this.subscriptions.findIndex((t=>t.subscription===e.subscription));this.subscriptions.splice(t,1),this.subscriptions.length<=0&&this.emit("close")}))}map(e){return this.subscriptions.map(e)}[Symbol.iterator](){let e=0;const t=this.subscriptions;return{next:()=>e<t.length?{value:t[e++],done:!1}:{value:null,done:!0}}}},Ih=class{subscription;filters=[];ndkRelay;constructor(e,t,n){this.subscription=e,this.filters=t,this.ndkRelay=n}eventReceived(e){if(!this.eventMatchesLocalFilter(e))return;const t=new ul(void 0,e);t.relay=this.ndkRelay,this.subscription.eventReceived(t,this.ndkRelay,!1)}eventMatchesLocalFilter(e){return this.filters.some((t=>ts(t,e)))}};var Rh=class{ndkRelay;delayedItems=new Map;delayedTimers=new Map;activeSubscriptions=new Map;activeSubscriptionsByGroupId=new Map;executionTimeoutsByGroupId=new Map;debug;groupingDebug;conn;constructor(e){this.ndkRelay=e,this.conn=e.connectivity,this.debug=e.debug.extend("subscriptions"),this.groupingDebug=e.debug.extend("grouping")}subscribe(e,t){const n=function(e,t){const n=[];for(const t of e){if(t.since||t.until)return null;const e=Object.keys(t||{}).sort().join("-");n.push(e)}let r=t?"+":"";return r+=n.join("|"),r}(t,e.closeOnEose),r=new Ih(e,t,this.ndkRelay);if(!n||!e.isGroupable())return void this.executeSubscriptions(n,new _h([r]),t);const i=this.activeSubscriptionsByGroupId.get(n);if(i){const n=function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length&&Ah(e[n],t[n]);n++)return e[n]}(i.filters,t);if(n){const n=this.activeSubscriptions.get(i.sub);return void n?.addSubscription(new Ih(e,t,this.ndkRelay))}}let o=this.delayedItems.get(n);o?o.addSubscription(r):(o=new _h([r]),this.delayedItems.set(n,o),o.once("close",(()=>{this.delayedItems.get(n)&&this.delayedItems.delete(n)})));let s=this.executionTimeoutsByGroupId.get(n);s&&"at-most"!==e.opts.groupableDelayType||(s=setTimeout((()=>{this.executeGroup(n,e)}),e.opts.groupableDelay),this.executionTimeoutsByGroupId.set(n,s)),this.delayedTimers.has(n)?this.delayedTimers.get(n).push(s):this.delayedTimers.set(n,[s])}executeGroup(e,t){const n=this.delayedItems.get(e);this.delayedItems.delete(e);const r=this.delayedTimers.get(e);if(this.delayedTimers.delete(e),r)for(const e of r)clearTimeout(e);if(n){const t=n.subscriptions[0].filters.length,r=[];for(let e=0;e<t;e++){const t=n.map((t=>t.filters[e]));r.push(xh(t))}this.executeSubscriptions(e,n,r)}}executeSubscriptionsWhenConnected(e,t,n){const r=()=>{this.executeSubscriptionsConnected(e,t,n)};this.ndkRelay.once("ready",r),t.once("close",(()=>{this.ndkRelay.removeListener("ready",r)}))}executeSubscriptions(e,t,n){this.conn.isAvailable()?this.executeSubscriptionsConnected(e,t,n):this.executeSubscriptionsWhenConnected(e,t,n)}executeSubscriptionsConnected(e,t,n){const r=[];for(const{subscription:e}of t)r.push(e);const i=function(e,t){const n=e.map((e=>e.subId)).filter(Boolean),r=[],i=new Set,o=new Set;if(n.length>0)r.push(Array.from(new Set(n)).join(","));else{for(const e of t)for(const t of Object.keys(e))"kinds"===t?e.kinds?.forEach((e=>o.add(e))):i.add(t);o.size>0&&r.push("kinds:"+Array.from(o).join(",")),i.size>0&&r.push(Array.from(i).join(","))}let s=r.join("-");return s.length>20&&(s=s.substring(0,20)),s+="-"+Math.floor(999*Math.random()).toString(),s}(r,n);t.req=n;const o={id:i,skipVerification:!0},s=this.conn.relay.sub(n,o);return this.activeSubscriptions.set(s,t),e&&this.activeSubscriptionsByGroupId.set(e,{filters:n,sub:s}),s.on("event",(e=>{const t=this.activeSubscriptions.get(s);t?.eventReceived(e)})),s.on("eose",(()=>{const e=this.activeSubscriptions.get(s);e?.eoseReceived(this.ndkRelay)})),t.once("close",(()=>{s.unsub(),this.activeSubscriptions.delete(s),e&&this.activeSubscriptionsByGroupId.delete(e)})),this.executeSubscriptionsWhenConnected(e,t,n),s}executedFilters(){const e=new Map;for(const[,t]of this.activeSubscriptions)e.set(t.req,t.map((e=>e.subscription)));return e}},Ch=(e,t)=>t.some((t=>t instanceof RegExp?t.test(e):t===e)),Uh=new Set(["https:","http:","file:"]),Lh=e=>{try{const{protocol:t}=new URL(e);return t.endsWith(":")&&!t.includes(".")&&!Uh.has(t)}catch{return!1}},Nh=(e,{stripHash:t})=>{const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(e);if(!n)throw new Error(`Invalid URL: ${e}`);let{type:r,data:i,hash:o}=n.groups;const s=r.split(";");o=t?"":o;let a=!1;"base64"===s[s.length-1]&&(s.pop(),a=!0);const c=s.shift()?.toLowerCase()??"",h=[...s.map((e=>{let[t,n=""]=e.split("=").map((e=>e.trim()));return"charset"===t&&(n=n.toLowerCase(),"us-ascii"===n)?"":`${t}${n?`=${n}`:""}`})).filter(Boolean)];return a&&h.push("base64"),(h.length>0||c&&"text/plain"!==c)&&h.unshift(c),`data:${h.join(";")},${a?i.trim():i}${o?`#${o}`:""}`};function Th(e){let t=function(e,t){if("string"!=typeof(t={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...t}).defaultProtocol||t.defaultProtocol.endsWith(":")||(t.defaultProtocol=`${t.defaultProtocol}:`),e=e.trim(),/^data:/i.test(e))return Nh(e,t);if(Lh(e))return e;const n=e.startsWith("//");!n&&/^\.*\//.test(e)||(e=e.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,t.defaultProtocol));const r=new URL(e);if(t.forceHttp&&t.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");if(t.forceHttp&&"https:"===r.protocol&&(r.protocol="http:"),t.forceHttps&&"http:"===r.protocol&&(r.protocol="https:"),t.stripAuthentication&&(r.username="",r.password=""),t.stripHash?r.hash="":t.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,"")),r.pathname){const e=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let t=0,n="";for(;;){const i=e.exec(r.pathname);if(!i)break;const o=i[0],s=i.index;n+=r.pathname.slice(t,s).replace(/\/{2,}/g,"/"),n+=o,t=s+o.length}n+=r.pathname.slice(t,r.pathname.length).replace(/\/{2,}/g,"/"),r.pathname=n}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}if(!0===t.removeDirectoryIndex&&(t.removeDirectoryIndex=[/^index\.[a-z]+$/]),Array.isArray(t.removeDirectoryIndex)&&t.removeDirectoryIndex.length>0){let e=r.pathname.split("/");const n=e[e.length-1];Ch(n,t.removeDirectoryIndex)&&(e=e.slice(0,-1),r.pathname=e.slice(1).join("/")+"/")}if(r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),t.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,""))),Array.isArray(t.removeQueryParameters))for(const e of[...r.searchParams.keys()])Ch(e,t.removeQueryParameters)&&r.searchParams.delete(e);if(Array.isArray(t.keepQueryParameters)||!0!==t.removeQueryParameters||(r.search=""),Array.isArray(t.keepQueryParameters)&&t.keepQueryParameters.length>0)for(const e of[...r.searchParams.keys()])Ch(e,t.keepQueryParameters)||r.searchParams.delete(e);if(t.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}t.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,"")),t.removeExplicitPort&&r.port&&(r.port="");const i=e;return e=r.toString(),t.removeSingleSlash||"/"!==r.pathname||i.endsWith("/")||""!==r.hash||(e=e.replace(/\/$/,"")),(t.removeTrailingSlash||"/"===r.pathname)&&""===r.hash&&t.removeSingleSlash&&(e=e.replace(/\/$/,"")),n&&!t.normalizeProtocol&&(e=e.replace(/^http:\/\//,"//")),t.stripProtocol&&(e=e.replace(/^(?:https?:)?\/\//,"")),e}(e.toLowerCase(),{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return t.endsWith("/")||(t+="/"),t}function Oh(e){const t=new Set;for(const n of e)try{t.add(Th(n))}catch{}return Array.from(t)}var Fh=class extends Ba.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;validationRatio;validatedEventCount=0;skippedEventCount=0;trusted=!1;complaining=!1;debug;constructor(e,t){super(),this.url=Th(e),this.scores=new Map,this.debug=_a(`ndk:relay:${e}`),this.connectivity=new Eh(this),this.subs=new Rh(this),this.publisher=new vh(this),this.authPolicy=t,this.validationRatio=void 0}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(e,t=!0){return this.connectivity.connect(e,t)}disconnect(){3!==this.status&&this.connectivity.disconnect()}subscribe(e,t){this.subs.subscribe(e,t)}async publish(e,t=2500){return this.publisher.publish(e,t)}async auth(e){return this.publisher.auth(e)}scoreSlowerEvent(e){}tagReference(e){const t=["r",this.url];return e&&t.push(e),t}referenceTags(){return[["r",this.url]]}activeSubscriptions(){return this.subs.executedFilters()}addValidatedEvent(){this.validatedEventCount++}addSkippedEvent(){this.skippedEventCount++}getValidationRatio(){return 0===this.skippedEventCount?1:this.validatedEventCount/(this.validatedEventCount+this.skippedEventCount)}shouldValidateEvent(){return!this.trusted&&(void 0===this.validationRatio||this.getValidationRatio()<this.validationRatio)}},Ph=class extends Error{errors;constructor(e,t){super(e),this.errors=t}get relayErrors(){const e=[];for(const[t,n]of this.errors)e.push(`${t.url}: ${n}`);return e.join("\n")}},$h=class e{relays;debug;ndk;constructor(e,t){this.relays=e,this.ndk=t,this.debug=t.debug.extend("relayset")}addRelay(e){this.relays.add(e)}static fromRelayUrls(t,n){const r=new Set;for(const e of t){const t=n.pool.relays.get(e);if(t)r.add(t);else{const t=new Fh(e);n.pool.useTemporaryRelay(t),r.add(t)}}return new e(new Set(r),n)}async publish(e,t){const n=new Set,r=new Map,i=e.isEphemeral(),o=Array.from(this.relays).map((o=>new Promise((s=>{o.publish(e,t).then((e=>{n.add(o),s()})).catch((e=>{i||(r.set(o,e),this.debug("error publishing to relay",{relay:o.url,err:e})),s()}))}))));if(await Promise.all(o),0===n.size&&!i)throw new Ph("No relay was able to receive the event",r);return n}get size(){return this.relays.size}};function Hh(e,t,n){return function(e,t,n){const r=new Map,i=new Set;if(t.forEach((e=>{e.authors&&e.authors.forEach((e=>i.add(e)))})),i.size>0){const o=mh(e,Array.from(i),n);for(const e of o.keys())r.set(e,[]);for(const e of t)if(e.authors)for(const[t,n]of o.entries()){const i=e.authors.filter((e=>n.includes(e)));r.set(t,[...r.get(t),{...e,authors:i}])}else for(const t of o.keys())r.set(t,[...r.get(t),e])}else n.permanentAndConnectedRelays().forEach((e=>{r.set(e.url,t)}));return r}(e,t,n)}async function qh(e){return""}function zh(){if(void 0===this.kind)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function Dh(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function jh(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}async function Kh(e,t){if(!this.ndk)throw new Error("No NDK instance found!");if(t||(await this.ndk.assertSigner(),t=this.ndk.signer),!e){const t=this.getMatchingTags("p");if(1!==t.length)throw new Error("No recipient could be determined and no explicit recipient was provided");e=this.ndk.getUser({pubkey:t[0][1]})}this.content=await(t?.encrypt(e,this.content))}async function Mh(e,t){if(!this.ndk)throw new Error("No NDK instance found!");t||(await this.ndk.assertSigner(),t=this.ndk.signer),e||(e=this.author),this.content=await(t?.decrypt(e,this.content))}function Vh(){let e=[];return this.onRelays.length>0?e=this.onRelays.map((e=>e.url)):this.relay&&(e=[this.relay.url]),this.isParamReplaceable()?us.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:e}):e.length>0?us.neventEncode({id:this.tagId(),relays:e,author:this.pubkey}):us.noteEncode(this.tagId())}async function Wh(e=!0,t){if(!t&&e){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t=this.ndk.signer}const n=new ul(this.ndk,{kind:Zh(this),content:""});return n.tag(this),16===n.kind?n.tags.push(["k",`${this.kind}`]):n.content=JSON.stringify(this.rawEvent()),t&&await n.sign(t),e&&await n.publish(),n}function Zh(e){return 1===e.kind?6:16}var Gh;function Yh(e){return e.getMatchingTags("e").some((e=>e[3]))}function Jh(e,t){t??=e.tagType();let n=e.tags.find((e=>"root"===e[3]));if(!n){if(Yh(e))return;const n=e.getMatchingTags(t);if(n.length<3)return n[0]}return n}async function Qh(e,t){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(e,t);if(0===n.length)return;const[r,i,o]=n[0];return await this.ndk.fetchEvent(i,{},undefined)}async function Xh(){if(!this.ndk)throw new Error("NDK instance not found");const e=Jh(this);if(e)return this.ndk.fetchEventFromTag(e)}async function el(){if(!this.ndk)throw new Error("NDK instance not found");const e=function(e,t){t??=e.tagType();let n=e.tags.find((e=>"reply"===e[3]));if(n)return n;if(n||(n=e.tags.find((e=>"root"===e[3]))),!n){if(Yh(e))return;const n=e.getMatchingTags(t);if(1===n.length)return n[0];if(2===n.length)return n[1]}}(this);if(e)return this.ndk.fetchEventFromTag(e)}function tl(e=!1,t=!1){const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return e&&n.push(this.sig),t&&n.push(this.id),JSON.stringify(n)}var nl={};var rl=/^[a-f0-9]{64}$/;function il(){if("number"!=typeof this.kind)return!1;if("string"!=typeof this.content)return!1;if("number"!=typeof this.created_at)return!1;if("string"!=typeof this.pubkey)return!1;if(!this.pubkey.match(rl))return!1;if(!Array.isArray(this.tags))return!1;for(let e=0;e<this.tags.length;e++){const t=this.tags[e];if(!Array.isArray(t))return!1;for(let e=0;e<t.length;e++)if("object"==typeof t[e])return!1}return!0}var ol=new wh.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function sl(e){if("boolean"==typeof this.signatureVerified)return this.signatureVerified;const t=ol.get(this.id);if(null!==t)return this.signatureVerified=t;try{if(!this.ndk?.asyncSigVerification){const e=_((new TextEncoder).encode(this.serialize())),t=yh.verify(this.sig,e,this.pubkey);return ol.set(this.id,t),this.signatureVerified=t}(async function(e,t){return new Promise((t=>{const n=e.serialize();let r=!1;nl[e.id]||(nl[e.id]={event:e,resolves:[]},r=!0),nl[e.id].resolves.push(t),r&&Gh.postMessage({serialized:n,id:e.id,sig:e.sig,pubkey:e.pubkey})}))})(this).then((t=>{e&&(this.signatureVerified=t,ol.set(this.id,t)),t||this.ndk.emit("event:invalid-sig",this)}))}catch(e){return console.error("Error verifying signature",this.rawEvent(),e),this.signatureVerified=!1}}function al(){return e=this.serialize(),f(_((new TextEncoder).encode(e)));var e}var cl=_a("ndk:zap"),hl=["wss://nos.lol","wss://relay.nostr.band","wss://relay.f7z.io","wss://relay.damus.io","wss://nostr.mom","wss://no.str.cr"],ll=class e extends Ba.EventEmitter{ndk;zappedEvent;zappedUser;fetch=fetch;constructor(e){super(),this.ndk=e.ndk,this.zappedEvent=e.zappedEvent,this.fetch=e._fetch||fetch,this.zappedUser=e.zappedUser||this.ndk.getUser({pubkey:this.zappedEvent?.pubkey})}static async getZapperPubkey(t,n){const r=t.getUser({pubkey:n}),i=new e({ndk:t,zappedUser:r}),o=await i.getZapSpec();return o?.nostrPubkey}async getZapSpec(){if(!this.zappedUser)throw new Error("No user to zap was provided");return this.zappedUser.getZapConfiguration(this.ndk)}async getZapSpecWithoutCache(){let e,t,n,r;if(this.zappedUser&&(this.zappedUser.profile||await this.zappedUser.fetchProfile({groupable:!1}),r=this.zappedUser.profile,e=(this.zappedUser.profile||{}).lud06,t=(this.zappedUser.profile||{}).lud16),t&&!t.startsWith("LNURL")){const[e,r]=t.split("@");n=`https://${r}/.well-known/lnurlp/${e}`}else if(e){const{words:t}=mt.decode(e,1e3),r=mt.fromWords(t);n=new TextDecoder("utf-8").decode(r)}if(!n)throw cl("No zap endpoint found",r,{lud06:e,lud16:t}),new Error("No zap endpoint found");try{const e=this.fetch||this.ndk.httpFetch,t=await e(n);if(200!==t.status){const e=await t.text();throw new Error(`Unable to fetch zap endpoint ${n}: ${e}`)}return await t.json()}catch(e){throw new Error(`Unable to fetch zap endpoint ${n}: ${e}`)}}async getZapEndpoint(){const e=await this.getZapSpec();if(!e)return;let t;return e?.allowsNostr&&(e?.nostrPubkey||e?.nostrPubkey)&&(t=e.callback),t}async createZapRequest(e,t,n,r,i){const o=await this.generateZapRequest(e,t,n,r);if(!o)return null;const{event:s,zapEndpoint:a}=o;if(!s)throw new Error("No zap request event found");let c;await s.sign(i);try{cl(`Getting invoice for zap request: ${a}`),c=await this.getInvoice(s,e,a)}catch(e){throw new Error("Failed to get invoice: "+e)}return c}async getInvoice(e,t,n){cl(`Fetching invoice from ${n}?`+new URLSearchParams({amount:t.toString(),nostr:encodeURIComponent(JSON.stringify(e.rawEvent()))}));const r=new URL(n);r.searchParams.append("amount",t.toString()),r.searchParams.append("nostr",JSON.stringify(e.rawEvent())),cl(`Fetching invoice from ${r.toString()}`);const i=await fetch(r.toString());if(cl(`Got response from zap endpoint: ${n}`,{status:i.status}),200!==i.status){cl(`Received non-200 status from zap endpoint: ${n}`,{status:i.status,amount:t,nostr:JSON.stringify(e.rawEvent())});const r=await i.text();throw new Error(`Unable to fetch zap endpoint ${n}: ${r}`)}return(await i.json()).pr}async generateZapRequest(e,t,n,r,i){const o=await this.getZapEndpoint();if(!o)throw new Error("No zap endpoint found");if(!this.zappedEvent&&!this.zappedUser)throw new Error("No zapped event or user found");const s=ga.makeZapRequest({profile:this.zappedUser.pubkey,event:null,amount:e,comment:t||"",relays:r??this.relays()});if(this.zappedEvent){const e=this.zappedEvent.referenceTags().filter((e=>"p"!==e[0]));s.tags.push(...e)}s.tags.push(["lnurl",o]);const a=new ul(this.ndk,s);return n&&(a.tags=a.tags.concat(n)),{event:a,zapEndpoint:o}}relays(){let e=[];return this.ndk?.pool?.relays&&(e=this.ndk.pool.urls()),e.length||(e=hl),e}},ul=class e extends Ba.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;onRelays=[];constructor(e,t){super(),this.ndk=e,this.created_at=t?.created_at,this.content=t?.content||"",this.tags=t?.tags||[],this.id=t?.id||"",this.sig=t?.sig,this.pubkey=t?.pubkey||"",this.kind=t?.kind}static deserialize(t,n){return new e(t,function(e){const t=JSON.parse(e),n={pubkey:t[1],created_at:t[2],kind:t[3],tags:t[4],content:t[5]};return 7===t.length&&(n.sig=t[6]),8===t.length&&(n.id=t[7]),n}(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(e){this.pubkey=e.pubkey,this._author=void 0}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const e=this.ndk.getUser({pubkey:this.pubkey});return this._author=e,e}tag(t,n,r,i){let o=[];if(void 0!==t.fetchProfile){i??="p";const e=[i,t.pubkey];n&&e.push("",n),o.push(e)}else if(t instanceof e){const e=t;r??=e?.pubkey===this.pubkey,o=e.referenceTags(n,r,i);for(const t of e.getMatchingTags("p"))t[1]!==this.pubkey&&(this.tags.find((e=>"p"===e[0]&&e[1]===t[1]))||this.tags.push(["p",t[1]]))}else{if(!Array.isArray(t))throw new Error("Invalid argument",t);o=[t]}this.tags=function(e,t){const n=new Map,r=(e,t)=>e.every(((e,n)=>e===t[n]));return e.concat(t).forEach((e=>{for(let[t,i]of n)if(r(i,e)||r(e,i))return void(e.length>=i.length&&n.set(t,e));n.set((e=>e.join(","))(e),e)})),Array.from(n.values())}(this.tags,o)}async toNostrEvent(e){if(!e&&""===this.pubkey){const e=await(this.ndk?.signer?.user());this.pubkey=e?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:t,tags:n}=await this.generateTags();this.content=t||"",this.tags=n;try{this.id=this.getEventHash()}catch(e){}return this.rawEvent()}serialize=tl.bind(this);getEventHash=al.bind(this);validate=il.bind(this);verifySignature=sl.bind(this);isReplaceable=zh.bind(this);isEphemeral=Dh.bind(this);isParamReplaceable=jh.bind(this);encode=Vh.bind(this);encrypt=Kh.bind(this);decrypt=Mh.bind(this);getMatchingTags(e,t){return this.tags.filter((t=>t[0]===e)).filter((e=>!t||e[3]===t))}tagValue(e){const t=this.getMatchingTags(e);if(0!==t.length)return t[0][1]}get alt(){return this.tagValue("alt")}set alt(e){this.removeTag("alt"),e&&this.tags.push(["alt",e])}get dTag(){return this.tagValue("d")}set dTag(e){this.removeTag("d"),e&&this.tags.push(["d",e])}removeTag(e){this.tags=this.tags.filter((t=>t[0]!==e))}async sign(e){e?this.author=await e.user():(this.ndk?.assertSigner(),e=this.ndk.signer);const t=await this.toNostrEvent();return console.log("signing",t),this.sig=await e.sign(t),this.sig}async publish(e,t){if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");e||(e=this.ndk.devWriteRelaySet||function(e,t){const n=new Set;return e.pool?.permanentAndConnectedRelays().forEach((e=>n.add(e))),new $h(n,e)}(this.ndk)),this.ndk.debug(`publish to ${e.size} relays`,this.rawEvent()),5===this.kind&&this.ndk.cacheAdapter?.deleteEvent&&this.ndk.cacheAdapter.deleteEvent(this);const n=await e.publish(this,t);return this.onRelays=Array.from(n),n}async generateTags(){let e=[];const t=await async function(e,t=[]){let n=[];const r=e=>{t.find((t=>["q",e[0]].includes(t[0])&&t[1]===e[1]))||t.push(e)};return e=e.replace(/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,(e=>{try{const t=e.split(/(@|nostr:)/)[2],{type:i,data:o}=us.decode(t);let s;switch(i){case"npub":s=["p",o];break;case"nprofile":s=["p",o.pubkey];break;case"note":n.push(new Promise((async e=>{r(["e",o,await qh(),"mention"]),e()})));break;case"nevent":n.push(new Promise((async e=>{let{id:t,relays:n,author:i}=o;n&&0!==n.length||(n=[await qh()]),r(["e",t,n[0],"mention"]),i&&r(["p",i]),e()})));break;case"naddr":n.push(new Promise((async e=>{const t=[o.kind,o.pubkey,o.identifier].join(":");let n=o.relays??[];0===n.length&&(n=[await qh()]),r(["a",t,n[0],"mention"]),r(["p",o.pubkey]),e()})));break;default:return e}return s&&r(s),`nostr:${t}`}catch(t){return e}})),await Promise.all(n),{content:e=e.replace(/(?<=\s|^)(#[^\s!@#$%^&*()=+.\/,\[{\]};:'"?><]+)/g,((e,n)=>{const r=["t",n];return t.find((e=>e[0]===r[0]&&e[1]===r[1]))||t.push(r),e})),tags:t}}(this.content,this.tags),n=t.content;if(e=t.tags,this.kind&&this.isParamReplaceable()){if(!this.getMatchingTags("d")[0]){const t=this.tagValue("title");let n=[...Array(t?6:16)].map((()=>Math.random().toString(36)[2])).join("");t&&t.length>0&&(n=t.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")+"-"+n),e.push(["d",n])}}if((this.ndk?.clientName||this.ndk?.clientNip89)&&!this.tagValue("client")){const t=["client",this.ndk.clientName??""];this.ndk.clientNip89&&t.push(this.ndk.clientNip89),e.push(t)}return{content:n||"",tags:e}}muted(){const e=this.ndk?.mutedIds.get(this.pubkey);if(e&&"p"===e)return"author";const t=this.tagReference(),n=this.ndk?.mutedIds.get(t[1]);return n&&n===t[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const e=this.getMatchingTags("d")[0];return e?e[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return 0===this.kind||3===this.kind||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(!this.isParamReplaceable())throw new Error("This must only be called on replaceable events");const e=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${e}`}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(e){let t;return t=this.isParamReplaceable()?["a",this.tagAddress()]:["e",this.tagId()],this.relay?t.push(this.relay.url):t.push(""),e&&t.push(e),t}referenceTags(e,t,n){let r=[];return r=this.isParamReplaceable()?[[n??"a",this.tagAddress()],[n??"e",this.id]]:[[n??"e",this.id]],this.relay?.url?r=r.map((e=>(e.push(this.relay?.url),e))):e&&(r=r.map((e=>(e.push(""),e)))),e&&r.forEach((t=>t.push(e))),t||r.push(...this.author.referenceTags()),r}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}async zap(e,t,n,r,i){if(!this.ndk)throw new Error("No NDK instance found");i||this.ndk.assertSigner();const o=new ll({ndk:this.ndk,zappedEvent:this,zappedUser:r}),s=Array.from(this.ndk.pool.relays.keys());return await o.createZapRequest(e,t,n,s,i)}async delete(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new e(this.ndk,{kind:5,content:t||""});return r.tag(this),n&&await r.publish(),r}fetchTaggedEvent=Qh.bind(this);fetchRootEvent=Xh.bind(this);fetchReplyEvent=el.bind(this);repost=Wh.bind(this);async react(t,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new e(this.ndk,{kind:7,content:t});return r.tag(this),n?await r.publish():await r.sign(),r}get isValid(){return this.validate()}},dl={closeOnEose:!1,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100,groupableDelayType:"at-most"},fl=class extends Ba.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;relayFilters;relaySet;ndk;debug;eoseDebug;eventFirstSeen=new Map;eosesSeen=new Set;eventsPerRelay=new Map;lastEventReceivedAt;internalId;closeOnEose;constructor(e,t,n,r,i){if(super(),this.ndk=e,this.pool=n?.pool||e.pool,this.opts={...dl,...n||{}},this.filters=t instanceof Array?t:[t],this.subId=i||n?.subId,this.internalId=Math.random().toString(36).substring(7),this.relaySet=r,this.debug=e.debug.extend(`subscription[${n?.subId??this.internalId}]`),this.eoseDebug=this.debug.extend("eose"),this.skipVerification=n?.skipVerification||!1,this.skipValidation=n?.skipValidation||!1,this.closeOnEose=n?.closeOnEose||!1,"ONLY_CACHE"===this.opts.cacheUsage&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}get filter(){return this.filters[0]}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return"ONLY_RELAY"!==this.opts?.cacheUsage}shouldQueryRelays(){return"ONLY_CACHE"!==this.opts?.cacheUsage}shouldWaitForCache(){return this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&"PARALLEL"!==this.opts.cacheUsage}async start(){let e;this.shouldQueryCache()&&(e=this.startWithCache(),this.shouldWaitForCache()&&(await e,kh(this)))?this.emit("eose",this):this.shouldQueryRelays()?this.startWithRelays():this.emit("eose",this)}stop(){this.emit("close",this),this.removeAllListeners()}hasAuthorsFilter(){return this.filters.some((e=>e.authors?.length))}async startWithCache(){if(this.ndk.cacheAdapter?.query){const e=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await e}}startWithRelays(){if(this.relaySet){this.relayFilters=new Map;for(const e of this.relaySet.relays)this.relayFilters.set(e.url,this.filters)}else this.relayFilters=Hh(this.ndk,this.filters,this.pool);if(this.relayFilters&&0!==this.relayFilters.size)for(const[e,t]of this.relayFilters){this.pool.getRelay(e,!0,!0,t).subscribe(this,t)}else this.debug("No relays to subscribe to",this.pool.relays.size)}eventReceived(e,t,n=!1){t&&(e.relay??=t,e.onRelays.push(t)),t||(t=e.relay),e.ndk??=this.ndk,!n&&t&&this.ndk.emit("event",e,t);if(this.eventFirstSeen.has(e.id)){const n=Date.now()-(this.eventFirstSeen.get(e.id)||0);return t&&(t.scoreSlowerEvent(n),this.trackPerRelay(e,t)),void this.emit("event:dup",e,t,n,this)}if(!n){if(!this.skipValidation&&!e.isValid)return void this.debug("Event failed validation",e.rawEvent());if(!1!==e.relay?.shouldValidateEvent()&&!this.skipVerification&&!e.verifySignature(!0)&&!this.ndk.asyncSigVerification)return void this.debug("Event failed signature validation",e)}!n&&t?(this.trackPerRelay(e,t),this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(e,this.filters,t),this.eventFirstSeen.set(e.id,Date.now())):this.eventFirstSeen.set(e.id,0),this.emit("event",e,t,this),this.lastEventReceivedAt=Date.now()}trackPerRelay(e,t){let n=this.eventsPerRelay.get(t);n||(n=new Set,this.eventsPerRelay.set(t,n)),n.add(e.id)}eoseTimeout;eoseReceived(e){this.eosesSeen.add(e);let t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const n=this.eosesSeen.size===this.relayFilters?.size;if(kh(this))this.emit("eose"),this.opts?.closeOnEose&&this.stop();else if(n)this.emit("eose"),this.eoseDebug("All EOSEs seen"),this.opts?.closeOnEose&&this.stop();else{let e=1e3;const n=this.eosesSeen.size/this.relayFilters.size;if(this.eosesSeen.size>=2&&n>=.5){e*=1-n,this.eoseTimeout&&clearTimeout(this.eoseTimeout);const r=()=>{t=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,void 0!==t&&t<20?this.eoseTimeout=setTimeout(r,e):(this.emit("eose"),this.opts?.closeOnEose&&this.stop())};this.eoseTimeout=setTimeout(r,e)}}}};async function pl(e,t,n=3){if(!this.ndk)throw new Error("NDK not set");const r=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},e||{groupable:!1});if(r){const e=new Set;return r.tags.forEach((t=>{"p"===t[0]&&e.add(t[1])})),t&&this.ndk?.outboxTracker?.trackUsers(Array.from(e)),[...e].reduce(((e,t)=>{const n=new bl({pubkey:t});return n.ndk=this.ndk,e.add(n),e}),new Set)}return new Set}function gl(e){const t={};for(const[n,r]of Object.entries(e))switch(n){case"username":case"name":t.name=r;break;case"displayName":t.display_name=r;break;case"image":case"picture":t.picture=r;break;case"bio":case"about":t.about=r;break;default:t[n]=r}return JSON.stringify(t)}var yl=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function wl(e,t,n=fetch,r={}){return await e.queuesNip05.add({id:t,func:async()=>{if(e.cacheAdapter&&e.cacheAdapter.loadNip05){const n=await e.cacheAdapter.loadNip05(t);if("missing"!==n){if(n){const t=new bl({pubkey:n.pubkey,relayUrls:n.relays,nip46Urls:n.nip46});return t.ndk=e,t}if("no-cache"!==r.cache)return null}}const i=t.match(yl);if(!i)return null;const[o,s="_",a]=i;try{const i=await n(`https://${a}/.well-known/nostr.json?name=${s}`,r),{names:o,relays:c,nip46:h}=function(e){const t={names:{}};for(const[n,r]of Object.entries(e.names))"string"==typeof n&&"string"==typeof r&&(t.names[n.toLowerCase()]=r);if(e.relays){t.relays={};for(const[n,r]of Object.entries(e.relays))"string"==typeof n&&Array.isArray(r)&&(t.relays[n]=r.filter((e=>"string"==typeof e)))}if(e.nip46){t.nip46={};for(const[n,r]of Object.entries(e.nip46))"string"==typeof n&&Array.isArray(r)&&(t.nip46[n]=r.filter((e=>"string"==typeof e)))}return t}(await i.json()),l=o[s.toLowerCase()];let u=null;return l&&(u={pubkey:l,relays:c?.[l],nip46:h?.[l]}),e?.cacheAdapter&&e.cacheAdapter.saveNip05&&e.cacheAdapter.saveNip05(t,u),u}catch(n){return e?.cacheAdapter&&e.cacheAdapter.saveNip05&&e?.cacheAdapter.saveNip05(t,null),console.error("Failed to fetch NIP05 for",t,n),null}}})}var bl=class e{ndk;profile;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(e){e.npub&&(this._npub=e.npub),e.hexpubkey&&(this._pubkey=e.hexpubkey),e.pubkey&&(this._pubkey=e.pubkey),e.relayUrls&&(this.relayUrls=e.relayUrls),e.nip46Urls&&(this.nip46Urls=e.nip46Urls)}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=us.npubEncode(this.pubkey)}return this._npub}set npub(e){this._npub=e}get hexpubkey(){return this.pubkey}set hexpubkey(e){this._pubkey=e}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=us.decode(this.npub).data}return this._pubkey}set pubkey(e){this._pubkey=e}async getZapConfiguration(e){if(e??=this.ndk,!e)throw new Error("No NDK instance found");return await e.queuesZapConfig.add({id:this.pubkey,func:async()=>{if(this.ndk?.cacheAdapter?.loadUsersLNURLDoc){const e=await this.ndk.cacheAdapter.loadUsersLNURLDoc(this.pubkey);if("missing"!==e){if(null===e)return;if(e)return e}}const t=new ll({ndk:e,zappedUser:this});let n;try{n=await t.getZapSpecWithoutCache()}catch{}if(this.ndk?.cacheAdapter?.saveUsersLNURLDoc&&this.ndk.cacheAdapter.saveUsersLNURLDoc(this.pubkey,n||null),n)return n}})}async getZapperPubkey(){const e=await this.getZapConfiguration();return e?.nostrPubkey}static async fromNip05(t,n,r=!1){if(!n)throw new Error("No NDK instance found");let i={};r&&(i.cache="no-cache");const o=await wl(n,t,n?.httpFetch,i);if(o){const t=new e({pubkey:o.pubkey,relayUrls:o.relays,nip46Urls:o.nip46});return t.ndk=n,t}}async fetchProfile(e){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});let t=null;if(this.ndk.cacheAdapter&&this.ndk.cacheAdapter.fetchProfile&&"ONLY_RELAY"!==e?.cacheUsage){const e=await this.ndk.cacheAdapter.fetchProfile(this.pubkey);if(e)return this.profile=e,e}!e&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.locking&&(t=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",closeOnEose:!0,groupable:!1}),e={cacheUsage:"ONLY_RELAY",closeOnEose:!0,groupable:!0,groupableDelay:250}),t&&0!==t.size||(t=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},e));const n=Array.from(t).sort(((e,t)=>e.created_at-t.created_at));return 0===n.length?null:(this.profile=function(e){const t={};let n;try{n=JSON.parse(e.content)}catch(e){throw new Error(`Failed to parse profile event: ${e}`)}return Object.keys(n).forEach((e=>{switch(e){case"name":t.name=n.name;break;case"display_name":t.displayName=n.display_name;break;case"image":case"picture":t.image=n.picture||n.image;break;case"banner":t.banner=n.banner;break;case"bio":t.bio=n.bio;break;case"nip05":t.nip05=n.nip05;break;case"lud06":t.lud06=n.lud06;break;case"lud16":t.lud16=n.lud16;break;case"about":t.about=n.about;break;case"zapService":t.zapService=n.zapService;break;case"website":t.website=n.website;break;default:t[e]=n[e]}})),t}(n[0]),this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile)}follows=pl.bind(this);tagReference(){return["p",this.pubkey]}referenceTags(e){const t=[["p",this.pubkey]];return e?(t[0].push("",e),t):t}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner();const e=new ul(this.ndk,{kind:0,content:gl(this.profile)});await e.publish()}async follow(e,t,n=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),t||(t=await this.follows(void 0,void 0,n)),t.has(e))return!1;t.add(e);const r=new ul(this.ndk,{kind:n});for(const e of t)r.tag(e);return await r.publish(),!0}async unfollow(e,t,n=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),t||(t=await this.follows(void 0,void 0,n));const r=new Set;let i=!1;for(const n of t)n.pubkey!==e.pubkey&&(r.add(n),i=!0);if(!i)return!1;const o=new ul(this.ndk,{kind:n});for(const e of t)o.tag(e);return await o.publish()}async validateNip05(e){if(!this.ndk)throw new Error("No NDK instance found");const t=await wl(this.ndk,e);return null===t?null:t.pubkey===this.pubkey}async zap(e,t,n,r){if(!this.ndk)throw new Error("No NDK instance found");r||this.ndk.assertSigner();const i=new ll({ndk:this.ndk,zappedUser:this}),o=Array.from(this.ndk.pool.relays.keys());return await i.createZapRequest(e,t,n,o,r)}},ml=class e extends ul{_encryptedTags;encryptedTagsLength;constructor(e,t){super(e,t),this.kind??=30001}static from(t){return new e(t.ndk,t.rawEvent())}get title(){const e=this.tagValue("title")||this.tagValue("name");return 3!==this.kind||e?1e4!==this.kind||e?10001!==this.kind||e?10002!==this.kind||e?10003!==this.kind||e?10004!==this.kind||e?10005!==this.kind||e?10006!==this.kind||e?10007!==this.kind||e?10015!==this.kind||e?10030!==this.kind||e?e??this.tagValue("d"):"Emojis":"Interests":"Search Relays":"Blocked Relays":"Public Chats":"Communities":"Bookmarks":"Relay Metadata":"Pinned Notes":"Mute":"Contacts"}set title(e){if(this.removeTag("title"),this.removeTag("name"),!e)throw new Error("Title cannot be empty");this.tags.push(["title",e])}get name(){const e=this.tagValue("name");return 3!==this.kind||e?1e4!==this.kind||e?10001!==this.kind||e?10002!==this.kind||e?10003!==this.kind||e?10004!==this.kind||e?10005!==this.kind||e?10006!==this.kind||e?10007!==this.kind||e?10015!==this.kind||e?10030!==this.kind||e?e??this.tagValue("d"):"Emojis":"Interests":"Search Relays":"Blocked Relays":"Public Chats":"Communities":"Bookmarks":"Relay Metadata":"Pinned Notes":"Mute":"Contacts"}set name(e){if(this.removeTag("name"),!e)throw new Error("Name cannot be empty");this.tags.push(["title",e])}get description(){return this.tagValue("description")}set description(e){e?this.tags.push(["description",e]):this.removeTag("description")}isEncryptedTagsCacheValid(){return!(!this._encryptedTags||this.encryptedTagsLength!==this.content.length)}async encryptedTags(e=!0){if(e&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const t=await this.ndk.signer.user();try{if(this.content.length>0)try{const e=await this.ndk.signer.decrypt(t,this.content),n=JSON.parse(e);return n&&n[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=n):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch(e){console.log(`error decrypting ${this.content}`)}}catch(e){}return[]}validateTag(e){return!0}getItems(e){return this.tags.filter((t=>t[0]===e))}get items(){return this.tags.filter((e=>!["d","L","l","title","name","description","summary","image","thumb","alt","expiration","subject","client"].includes(e[0])))}async addItem(e,t=void 0,n=!1,r="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let i;if(e instanceof ul)i=[e.tagReference(t)];else if(e instanceof bl)i=e.referenceTags();else if(e instanceof Fh)i=e.referenceTags();else{if(!Array.isArray(e))throw new Error("Invalid object type");i=[e]}if(t&&i[0].push(t),n){const e=await this.ndk.signer.user(),t=await this.encryptedTags();"top"===r?t.unshift(...i):t.push(...i),this._encryptedTags=t,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(t),await this.encrypt(e)}else"top"===r?this.tags.unshift(...i):this.tags.push(...i);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(e,t){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(t){const t=await this.ndk.signer.user(),n=await this.encryptedTags();n.splice(e,1),this._encryptedTags=n,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(n),await this.encrypt(t)}else this.tags.splice(e,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}filterForItems(){const e=new Set,t=new Map,n=[];for(const n of this.items)if("e"===n[0]&&n[1])e.add(n[1]);else if("a"===n[0]&&n[1]){const[e,r,i]=n[1].split(":");if(!e||!r)continue;const o=`${e}:${r}`,s=t.get(o)||[];s.push(i||""),t.set(o,s)}if(e.size>0&&n.push({ids:Array.from(e)}),t.size>0)for(const[e,r]of t.entries()){const[t,i]=e.split(":");n.push({kinds:[parseInt(t)],authors:[i],"#d":r})}return n}};var El="read",vl="write",xl=class e extends ul{constructor(e,t){super(e,t),this.kind??=10002}static from(t){return new e(t.ndk,t.rawEvent())}static async forUser(e,t){return(await this.forUsers([e],t)).get(e)}static async forUsers(t,n){const r=n.outboxPool||n.pool,i=new Set;for(const e of r.relays.values())i.add(e);const o=new Map,s=new Map,a=new $h(i,n);if(n.cacheAdapter?.locking){const r=await n.fetchEvents({kinds:[3,10002],authors:t},{cacheUsage:"ONLY_CACHE"});for(const t of r)10002===t.kind&&o.set(t.pubkey,e.from(t));for(const e of r)if(3===e.kind){const t=kl(n,e);t&&s.set(e.pubkey,t)}t=t.filter((e=>!o.has(e)&&!s.has(e)))}if(0===t.length)return o;await Promise.all([new Promise((async i=>{const s=await n.fetchEvents({kinds:[10002],authors:t},{closeOnEose:!0,pool:r,groupable:!1},a);for(const t of s)o.set(t.pubkey,e.from(t));i()})),new Promise((async e=>{const i=await n.fetchEvents({kinds:[3],authors:t},{closeOnEose:!0,pool:r,groupable:!1},a);for(const e of i){const t=kl(n,e);t&&s.set(e.pubkey,t)}e()}))]);const c=new Map;for(const e of t){const t=o.get(e)??s.get(e);t&&c.set(e,t)}return c}get readRelayUrls(){return this.tags.filter((e=>"r"===e[0]||"relay"===e[0])).filter((e=>!e[2]||e[2]&&e[2]===El)).map((e=>e[1]))}set readRelayUrls(e){for(const t of e)this.tags.push(["r",t,El])}get writeRelayUrls(){return this.tags.filter((e=>"r"===e[0]||"relay"===e[0])).filter((e=>!e[2]||e[2]&&e[2]===vl)).map((e=>e[1]))}set writeRelayUrls(e){for(const t of e)this.tags.push(["r",t,vl])}get bothRelayUrls(){return this.tags.filter((e=>"r"===e[0]||"relay"===e[0])).filter((e=>!e[2])).map((e=>e[1]))}set bothRelayUrls(e){for(const t of e)this.tags.push(["r",t])}get relays(){return this.tags.filter((e=>"r"===e[0]||"relay"===e[0])).map((e=>e[1]))}};function kl(e,t){try{const n=JSON.parse(t.content),r=new xl(e),i=new Set,o=new Set;for(let[e,t]of Object.entries(n)){try{e=Th(e)}catch{continue}if(t){const n=t;n.write&&o.add(e),n.read&&i.add(e)}else i.add(e),o.add(e)}return r.readRelayUrls=Array.from(i),r.writeRelayUrls=Array.from(o),r}catch{}}async function Al(e){return await this.sendReq("pay_invoice",{invoice:e})}var Sl=class e{_user;privateKey;constructor(e){e&&(this.privateKey=e,this._user=new bl({pubkey:qo(this.privateKey)}))}static generate(){const t=f(Ve.utils.randomPrivateKey());return new e(t)}async blockUntilReady(){if(!this._user)throw new Error("NDKUser not initialized");return this._user}async user(){return await this.blockUntilReady(),this._user}async sign(e){if(!this.privateKey)throw Error("Attempted to sign without a private key");return es(e,this.privateKey)}async encrypt(e,t){if(!this.privateKey)throw Error("Attempted to encrypt without a private key");const n=e.pubkey;return await Bs.encrypt(this.privateKey,n,t)}async decrypt(e,t){if(!this.privateKey)throw Error("Attempted to decrypt without a private key");const n=e.pubkey;return await Bs.decrypt(this.privateKey,n,t)}};async function Bl(e,t){const n=new ul(this.ndk,{kind:23194,tags:[["p",this.walletService.pubkey]],content:JSON.stringify({method:e,params:t})});return this.debug("Sending request",n.content),await n.encrypt(this.walletService,this.signer),await n.sign(this.signer),this.debug("Request encrypted and signed"),new Promise((async(t,r)=>{try{const i=n.tagId();if(!i)throw new Error("Failed to get e-tag");const o=e=>{this.off(i,o),this.off("event",o),this.debug("Received response",e);try{const n=JSON.parse(e);n.error&&r(n),t(n)}catch(e){this.debug("Failed to parse response",e),r({result_type:"error",error:{code:"failed_to_parse_response",message:e.message}})}},s=this.ndk.subscribe({kinds:[23195],"#e":[i],limit:1},{groupable:!1,subId:`nwc-${e}`},this.relaySet);s.on("event",(async e=>{await e.decrypt(e.author,this.signer),o(e.content),s.stop()})),this.once(i,o),this.once("event",o),this.debug("Sending request to relay",n.rawEvent()),await n.publish(this.relaySet)}catch(e){this.debug("Failed to send request",e,e.relayErrors),r({result_type:"error",error:{code:"failed_to_send_request",message:e.message}})}}))}async function _l(){return await this.sendReq("get_balance",{})}async function Il(){return await this.sendReq("get_info",{})}var Rl=class e extends Ba.EventEmitter{ndk;debug;walletService;relaySet;signer;active=!1;constructor({ndk:e,pubkey:t,relayUrls:n,secret:r}){super(),this.ndk=e,this.walletService=e.getUser({pubkey:t}),this.relaySet=new $h(new Set(n.map((t=>e.pool.getRelay(t)))),e),this.signer=new Sl(r),this.debug=e.debug.extend("nwc"),this.debug(`Starting with wallet service ${this.walletService.npub}`)}static async fromURI(t,n){const r=new URL(n);if("nostr+walletconnect:"!==r.protocol)throw new Error("Invalid protocol");return new e({ndk:t,pubkey:r.host??r.pathname,relayUrls:r.searchParams.getAll("relay")??[""],secret:r.searchParams.get("secret")??""})}async blockUntilReady(e){const t=await this.signer.user(),n=new Promise(((t,n)=>{setTimeout((()=>{n(new Error("Timeout"))}),e)})),r=[new Promise((e=>{const n=this.ndk.subscribe({kinds:[23195],"#p":[t.pubkey],limit:1},{groupable:!1,subId:"nwc"},this.relaySet);n.on("event",(async e=>{this.debug("received response",e.rawEvent());const t=e.tagValue("e");if(t){this.debug("received an event",t);try{await e.decrypt(e.author,this.signer),this.emit(t,e.content)}catch(e){return void this.debug("Failed to decrypt event",e)}}else this.debug("Received an event without an e-tag")})),n.on("eose",(()=>{this.debug("Subscription ready"),this.active=!0,e()})),n.on("close",(()=>{this.debug("Subscription closed"),this.active=!1}))}))];return e&&r.push(n),await Promise.race(r)}async sendReq(e,t){return await Bl.call(this,e,t)}async payInvoice(e){return await Al.call(this,e)}async getInfo(){return await Il.call(this)}getBalance=_l.bind(this)};var Cl=class{_userPromise;nip04Queue=[];nip04Processing=!1;debug;waitTimeout;constructor(e=1e3){this.debug=_a("ndk:nip07"),this.waitTimeout=e}async blockUntilReady(){await this.waitForExtension();const e=await window.nostr.getPublicKey();if(!e)throw new Error("User rejected access");return new bl({pubkey:e})}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}async sign(e){await this.waitForExtension();return(await window.nostr.signEvent(e)).sig}async relays(){await this.waitForExtension();const e=await(window.nostr.getRelays?.())||{},t=[];for(const n of Object.keys(e))e[n].read&&e[n].write&&t.push(n);return t.map((e=>new Fh(e)))}async encrypt(e,t){await this.waitForExtension();const n=e.pubkey;return this.queueNip04("encrypt",n,t)}async decrypt(e,t){await this.waitForExtension();const n=e.pubkey;return this.queueNip04("decrypt",n,t)}async queueNip04(e,t,n){return new Promise(((r,i)=>{this.nip04Queue.push({type:e,counterpartyHexpubkey:t,value:n,resolve:r,reject:i}),this.nip04Processing||this.processNip04Queue()}))}async processNip04Queue(e,t=0){if(!e&&0===this.nip04Queue.length)return void(this.nip04Processing=!1);this.nip04Processing=!0;const{type:n,counterpartyHexpubkey:r,value:i,resolve:o,reject:s}=e||this.nip04Queue.shift();this.debug("Processing encryption queue item",{type:n,counterpartyHexpubkey:r,value:i});try{let e;e="encrypt"===n?await window.nostr.nip04.encrypt(r,i):await window.nostr.nip04.decrypt(r,i),o(e)}catch(o){if(o.message&&o.message.includes("call already executing")&&t<5)return this.debug("Retrying encryption queue item",{type:n,counterpartyHexpubkey:r,value:i,retries:t}),void setTimeout((()=>{this.processNip04Queue(e,t+1)}),50*t);s(o)}this.processNip04Queue()}waitForExtension(){return new Promise(((e,t)=>{if(window.nostr)return void e();let n;const r=setInterval((()=>{window.nostr&&(clearTimeout(n),clearInterval(r),e())}),100);n=setTimeout((()=>{clearInterval(r),t(new Error("NIP-07 extension not available"))}),this.waitTimeout)}))}},Ul=class extends Ba.EventEmitter{ndk;signer;relaySet;debug;constructor(e,t,n,r){super(),this.ndk=e,this.signer=t,this.relaySet=r?$h.fromRelayUrls(r,e):void 0,this.debug=n.extend("rpc")}subscribe(e){const t=this.ndk.subscribe(e,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY"},this.relaySet);return t.on("event",(async e=>{try{const t=await this.parseEvent(e);t.method?this.emit("request",t):this.emit(`response-${t.id}`,t)}catch(t){this.debug("error parsing event",t,e.rawEvent())}})),new Promise((e=>{t.on("eose",(()=>e(t)))}))}async parseEvent(e){const t=this.ndk.getUser({pubkey:e.pubkey});t.ndk=this.ndk;const n=await this.signer.decrypt(t,e.content),r=JSON.parse(n),{id:i,method:o,params:s,result:a,error:c}=r;return o?{id:i,pubkey:e.pubkey,method:o,params:s,event:e}:{id:i,result:a,error:c,event:e}}async sendResponse(e,t,n,r=24133,i){const o={id:e,result:n};i&&(o.error=i);const s=await this.signer.user(),a=this.ndk.getUser({pubkey:t}),c=new ul(this.ndk,{kind:r,content:JSON.stringify(o),tags:[["p",t]],pubkey:s.pubkey});c.content=await this.signer.encrypt(a,c.content),await c.sign(this.signer),await c.publish(this.relaySet)}async sendRequest(e,t,n=[],r=24133,i){const o=Math.random().toString(36).substring(7),s=await this.signer.user(),a=this.ndk.getUser({pubkey:e}),c={id:o,method:t,params:n},h=new Promise((()=>{const e=t=>{"auth_url"===t.result?(this.once(`response-${o}`,e),this.emit("authUrl",t.error)):i&&i(t)};this.once(`response-${o}`,e)})),l=new ul(this.ndk,{kind:r,content:JSON.stringify(c),tags:[["p",e]],pubkey:s.pubkey});return l.content=await this.signer.encrypt(a,l.content),await l.sign(this.signer),await l.publish(this.relaySet),h}};Ba.EventEmitter;var Ll=class{type;relayUrlScores;readRelays;writeRelays;constructor(e){this.type=e,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},Nl=class extends Ba.EventEmitter{data;ndk;debug;constructor(e){super(),this.ndk=e,this.debug=e.debug.extend("outbox-tracker"),this.data=new wh.LRUCache({maxSize:1e5,entryExpirationTimeInMS:12e4})}trackUsers(e){for(let t=0;t<e.length;t+=400){let n=e.slice(t,t+400).map((e=>Tl(e))).filter((e=>!this.data.has(e)));if(0!==n.length){for(const e of n)this.data.set(e,new Ll("user"));xl.forUsers(n,this.ndk).then((e=>{for(const[t,n]of e){const e=this.data.get(t);if(n){e.readRelays=new Set(Oh(n.readRelayUrls)),e.writeRelays=new Set(Oh(n.writeRelayUrls));for(const t of e.readRelays)this.ndk.pool.blacklistRelayUrls.has(t)&&e.readRelays.delete(t);for(const t of e.writeRelays)this.ndk.pool.blacklistRelayUrls.has(t)&&e.writeRelays.delete(t);this.data.set(t,e)}}}))}}}track(e,t){const n=Tl(e);t??=function(e){return e instanceof bl?"user":"kind"}(e);let r=this.data.get(n);return r||(r=new Ll(t),e instanceof bl&&this.trackUsers([e])),r}};function Tl(e){return e instanceof bl?e.pubkey:e}var Ol=class extends Ba.EventEmitter{relays=new Map;blacklistRelayUrls;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;constructor(e=[],t=[],n,r){super(),this.debug=r??n.debug.extend("pool"),this.ndk=n;for(const t of e){const e=new Fh(t);this.addRelay(e,!1)}this.blacklistRelayUrls=new Set(t)}set name(e){this.debug=this.debug.extend(e)}useTemporaryRelay(e,t=3e4){const n=this.relays.has(e.url);n||this.addRelay(e);const r=this.temporaryRelayTimers.get(e.url);if(r&&clearTimeout(r),!n||r){const n=setTimeout((()=>{this.removeRelay(e.url)}),t);this.temporaryRelayTimers.set(e.url,n)}}addRelay(e,t=!0){const n=this.relays.has(e.url),r=this.blacklistRelayUrls?.has(e.url),i=e.url.includes("/npub1");let o=!0;const s=e.url;if(n)return void this.debug(`Refusing to add relay ${s}: already in the pool`);if(r)return void this.debug(`Refusing to add relay ${s}: blacklisted`);if(i)return void this.debug(`Refusing to add relay ${s}: is a filter relay`);if(this.ndk.cacheAdapter?.getRelayStatus){const n=this.ndk.cacheAdapter.getRelayStatus(s);if(n&&n.dontConnectBefore){if(n.dontConnectBefore>Date.now()){const r=n.dontConnectBefore-Date.now();return this.debug(`Refusing to add relay ${s}: delayed connect for ${r}ms`),void setTimeout((()=>{this.addRelay(e,t)}),r)}o=!1}}this.debug(`Adding relay ${s} to the pool`);const a=t=>this.emit("notice",e,t),c=()=>this.handleRelayConnect(s),h=()=>this.handleRelayReady(e),l=()=>this.emit("relay:disconnect",e),u=()=>this.handleFlapping(e),d=t=>this.emit("relay:auth",e,t),f=()=>this.emit("relay:authed",e);e.off("notice",a),e.off("connect",c),e.off("ready",h),e.off("disconnect",l),e.off("flapping",u),e.off("auth",d),e.off("authed",f),e.on("notice",a),e.on("connect",c),e.on("ready",h),e.on("disconnect",l),e.on("flapping",u),e.on("auth",d),e.on("authed",f),e.on("delayed-connect",(t=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(e.url,{dontConnectBefore:Date.now()+t})})),this.relays.set(s,e),t&&(this.emit("relay:connecting",e),e.connect(void 0,o).catch((e=>{this.debug(`Failed to connect to relay ${s}`,e)})))}removeRelay(e){const t=this.relays.get(e);if(t)return t.disconnect(),this.relays.delete(e),this.emit("relay:disconnect",t),!0;const n=this.temporaryRelayTimers.get(e);return n&&(clearTimeout(n),this.temporaryRelayTimers.delete(e)),!1}getRelay(e,t=!0,n=!1,r){let i=this.relays.get(e);return i||(i=new Fh(e),n?this.useTemporaryRelay(i):this.addRelay(i,t)),i}handleRelayConnect(e){this.emit("relay:connect",this.relays.get(e)),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(e){this.debug(`Relay ${e.url} ready`),this.emit("relay:ready",e)}async connect(e){const t=[];this.debug(`Connecting to ${this.relays.size} relays${e?`, timeout ${e}...`:""}`);for(const n of this.relays.values()){const r=new Promise(((t,r)=>(this.emit("relay:connecting",n),n.connect(e).then(t).catch(r))));if(e){const i=new Promise(((t,n)=>{setTimeout((()=>n(`Timed out after ${e}ms`)),e)}));t.push(Promise.race([r,i]).catch((e=>{this.debug(`Failed to connect to relay ${n.url}: ${e??"No reason specified"}`)})))}else t.push(r)}e&&setTimeout((()=>{const e=this.stats().connected===this.relays.size,t=this.stats().connected>0;!e&&t&&this.emit("connect")}),e),await Promise.all(t)}checkOnFlappingRelays(){if(this.flappingRelays.size/this.relays.size>=.8)for(const e of this.flappingRelays)this.backoffTimes.set(e,0)}handleFlapping(e){this.debug(`Relay ${e.url} is flapping`);let t=this.backoffTimes.get(e.url)||5e3;t*=2,this.backoffTimes.set(e.url,t),this.debug(`Backoff time for ${e.url} is ${t}ms`),setTimeout((()=>{this.debug(`Attempting to reconnect to ${e.url}`),this.emit("relay:connecting",e),e.connect(),this.checkOnFlappingRelays()}),t),e.disconnect(),this.emit("flapping",e)}size(){return this.relays.size}stats(){const e={total:0,connected:0,disconnected:0,connecting:0};for(const t of this.relays.values())e.total++,1===t.status?e.connected++:3===t.status?e.disconnected++:0===t.status&&e.connecting++;return e}connectedRelays(){return Array.from(this.relays.values()).filter((e=>1===e.status))}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter((e=>1===e.status||!this.temporaryRelayTimers.has(e.url)))}urls(){return Array.from(this.relays.keys())}};async function Fl(e,t,n={type:"timeout"}){const r=this.debug.extend("fetch-event-from-tag"),[i,o,s]=e;let a,c=s&&""!==s?this.pool.getRelay(s,!0,!0,[{ids:[o]}]):void 0;const h=new Promise((e=>{this.fetchEvent(o,t,c).then(e)}));if(""===s||!s||"none"===n.type)return h;let l=new Promise((async e=>{let i=n.relaySet,s=n.timeout??1500,c=new Promise((e=>setTimeout(e,s)));if("timeout"===n.type&&await c,a)e(a);else{r("fallback fetch triggered"),e(await this.fetchEvent(o,t,i))}}));switch(n.type){case"timeout":return Promise.race([h,l]);case"eose":return a=await h,a||l}}var Pl=class{ndk;spec;url;nip98Required=!1;constructor(e,t){this.url=`https://${e}/.well-known/nostr/nip96.json`,this.ndk=t}async prepareUpload(e,t="POST"){if(this.validateHttpFetch(),this.spec||await this.fetchSpec(),!this.spec)throw new Error("Failed to fetch NIP96 spec");let n={};if(this.nip98Required){n={Authorization:await this.generateNip98Header(this.spec.api_url,t,e)}}return{url:this.spec.api_url,headers:n}}async xhrUpload(e,t){const n="POST",{url:r,headers:i}=await this.prepareUpload(t,n);e.open(n,r,!0),i.Authorization&&e.setRequestHeader("Authorization",i.Authorization);const o=new FormData;return o.append("file",t),new Promise(((t,n)=>{e.onload=function(){e.status>=200&&e.status<300?t(JSON.parse(e.responseText)):n(new Error(e.statusText))},e.onerror=function(){n(new Error("Network Error"))},e.send(o)}))}async upload(e){const t="POST",{url:n,headers:r}=await this.prepareUpload(e,t),i=new FormData;i.append("file",e);const o=await this.ndk.httpFetch(this.spec.api_url,{method:t,headers:r,body:i});if(200!==o.status)throw new Error(`Failed to upload file to ${n}`);const s=await o.json();if("success"!==s.status)throw new Error(s.message);return s}validateHttpFetch(){if(!this.ndk)throw new Error("NDK is required to fetch NIP96 spec");if(!this.ndk.httpFetch)throw new Error("NDK must have an httpFetch method to fetch NIP96 spec")}async fetchSpec(){this.validateHttpFetch();const e=await this.ndk.httpFetch(this.url);if(200!==e.status)throw new Error(`Failed to fetch NIP96 spec from ${this.url}`);const t=await e.json();if(!t)throw new Error(`Failed to parse NIP96 spec from ${this.url}`);this.spec=t,this.nip98Required=this.spec.plans.free.is_nip98_required}async generateNip98Header(e,t,n){const r=new ul(this.ndk,{kind:27235,tags:[["u",e],["method",t]]});if(["POST","PUT","PATCH"].includes(t)){const e=await this.calculateSha256(n);r.tags.push(["payload",e])}await r.sign();return`Nostr ${btoa(JSON.stringify(r.rawEvent()))}`}async calculateSha256(e){const t=await e.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}},$l=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(e,t){this.maxConcurrency=t}add(e){if(this.promises.has(e.id))return this.promises.get(e.id);const t=new Promise(((t,n)=>{this.queue.push({...e,func:()=>e.func().then((e=>(t(e),e)),(e=>{throw n(e),e}))}),this.process()}));return this.promises.set(e.id,t),t.finally((()=>{this.promises.delete(e.id),this.processing.delete(e.id)})),t}process(){if(this.processing.size>=this.maxConcurrency||0===this.queue.length)return;const e=this.queue.shift();e&&!this.processing.has(e.id)&&(this.processing.add(e.id),e.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},Hl=["wss://purplepag.es/","wss://profiles.nos.social/"],ql=["wss://brb.io/","wss://nostr.mutinywallet.com/"],zl=class extends Ba.EventEmitter{explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;mutedIds;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;validationRatio=1;relayAuthDefaultPolicy;httpFetch;autoConnectUserRelays=!0;autoFetchUserMutelist=!0;constructor(e={}){super(),this.debug=e.debug||_a("ndk"),this.explicitRelayUrls=e.explicitRelayUrls||[],this.pool=new Ol(e.explicitRelayUrls||[],e.blacklistRelayUrls||ql,this),this.pool.name="main",this.debug(`Starting with explicit relays: ${JSON.stringify(this.explicitRelayUrls)}`),this.pool.on("relay:auth",(async(e,t)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(e,t)})),this.autoConnectUserRelays=e.autoConnectUserRelays??!0,this.autoFetchUserMutelist=e.autoFetchUserMutelist??!0,this.clientName=e.clientName,this.clientNip89=e.clientNip89,this.relayAuthDefaultPolicy=e.relayAuthDefaultPolicy,e.enableOutboxModel&&(this.outboxPool=new Ol(e.outboxRelayUrls||Hl,e.blacklistRelayUrls||ql,this,this.debug.extend("outbox-pool")),this.outboxPool.name="outbox",this.outboxTracker=new Nl(this)),this.signer=e.signer,this.cacheAdapter=e.cacheAdapter,this.mutedIds=e.mutedIds||new Map,e.devWriteRelayUrls&&(this.devWriteRelaySet=$h.fromRelayUrls(e.devWriteRelayUrls,this)),this.queuesZapConfig=new $l("zaps",3),this.queuesNip05=new $l("nip05",10),this.signatureVerificationWorker=e.signatureVerificationWorker,this.validationRatio=e.validationRatio||1;try{this.httpFetch=fetch}catch{}}set signatureVerificationWorker(e){this.asyncSigVerification=!!e,e&&((Gh=e).onmessage=e=>{const[t,n]=e.data,r=nl[t];if(r){delete nl[t];for(const e of r.resolves)e(n)}else console.error("No record found for event",t)})}addExplicitRelay(e,t,n=!0){let r;return r="string"==typeof e?new Fh(e,t):e,this.pool.addRelay(r,n),this.explicitRelayUrls.push(r.url),r}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(e){const t=this._activeUser?.pubkey!==e?.pubkey;if(this._activeUser=e,e&&t){const t=async e=>{const t=await xl.forUser(e.pubkey,this);if(t){this.debug("Connecting to user relays",{npub:e.npub,relays:t.relays});for(const e of t.relays){let t=this.pool.relays.get(e);t||(t=new Fh(e),this.pool.addRelay(t))}}else this.debug("No relay list found for user",{npub:e.npub})},n=async e=>{const t=await this.fetchEvent({kinds:[1e4],authors:[e.pubkey]});if(t){const e=ml.from(t);for(const t of e.items)this.mutedIds.set(t[1],t[0])}},r=[async e=>{const t=await this.fetchEvent({kinds:[10006],authors:[e.pubkey]});if(t){const e=ml.from(t);for(const t of e.items)this.pool.blacklistRelayUrls.add(t[0])}this.debug("Blocked relays",{blockedRelays:t})}];this.autoConnectUserRelays&&r.push(t),this.autoFetchUserMutelist&&r.push(n);const i=async e=>{for(const t of r)await t(e)},o=this.outboxPool||this.pool;o.connectedRelays.length>0?i(e):(this.debug("Waiting for connection to main relays"),o.once("connect",(()=>{i(e)})))}else e||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(e){this._signer=e,e&&this.emit("signer:ready",e),e?.user().then((e=>{e.ndk=this,this.activeUser=e}))}async connect(e){if(this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer"),this._signer.relays)){(await this._signer.relays()).forEach((e=>this.pool.addRelay(e)))}const t=[this.pool.connect(e)];return this.outboxPool&&t.push(this.outboxPool.connect(e)),this.debug("Connecting to relays",{timeoutMs:e}),Promise.allSettled(t).then((()=>{}))}getUser(e){const t=new bl(e);return t.ndk=this,t}async getUserFromNip05(e,t=!1){return bl.fromNip05(e,this,t)}subscribe(e,t,n,r=!0){const i=new fl(this,e,t,n);if(n)for(const e of n.relays)this.pool.useTemporaryRelay(e);if(this.outboxPool&&i.hasAuthorsFilter()){const e=i.filters.filter((e=>e.authors&&e.authors?.length>0)).map((e=>e.authors)).flat();this.outboxTracker?.trackUsers(e)}return r&&setTimeout((()=>i.start()),0),i}async publish(e,t,n){return this.debug("Deprecated: Use `event.publish()` instead"),e.publish(t,n)}fetchEventFromTag=Fl.bind(this);async fetchEvent(e,t,n){let r,i;if(n instanceof Fh?i=new $h(new Set([n]),this):n instanceof $h&&(i=n),!n&&"string"==typeof e&&null===e.match(Sh)){const t=function(e){try{const t=us.decode(e);if(["naddr","nevent"].includes(t?.type)){const e=t.data;if(e?.relays)return e.relays.map((e=>new Fh(e)))}}catch(e){}return[]}(e);t.length>0&&(i=new $h(new Set(t),this),i=function(e,t){const n=t.connectedRelays();if(!Array.from(e.relays).some((e=>n.map((e=>e.url)).includes(e.url))))for(const t of n)e.addRelay(t);if(0===n.length)for(const n of t.relays.values())e.addRelay(n);return e}(i,this.pool))}if(r="string"==typeof e?function(e){let t;if(e.match(Sh)){const[t,n,r]=e.split(":"),i={authors:[n],kinds:[parseInt(t)]};return r&&(i["#d"]=[r]),i}if(e.match(Bh))try{switch(t=us.decode(e),t.type){case"nevent":return{ids:[t.data.id]};case"note":return{ids:[t.data]};case"naddr":const e={authors:[t.data.pubkey],kinds:[t.data.kind]};return t.data.identifier&&(e["#d"]=[t.data.identifier]),e}}catch(t){console.error("Error decoding",e,t)}return{ids:[e]}}(e):e,!r)throw new Error(`Invalid filter: ${JSON.stringify(e)}`);return new Promise((e=>{let n=null;const o=this.subscribe(r,{...t||{},closeOnEose:!0},i,!1);o.on("event",(t=>{t.ndk=this,t.isReplaceable()?(!n||n.created_at<t.created_at)&&(n=t):e(t)})),o.on("eose",(()=>{e(n)})),o.start()}))}async fetchEvents(e,t,n){return new Promise((r=>{const i=new Map,o=this.subscribe(e,{...t||{},closeOnEose:!0},n,!1),s=e=>{const t=e.deduplicationKey(),n=i.get(t);var r,o;n&&(o=e,e=(r=n).created_at>o.created_at?r:o),e.ndk=this,i.set(t,e)};o.on("event",s),o.on("event:dup",s),o.on("eose",(()=>{r(new Set(i.values()))})),o.start()}))}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getNip96(e){return new Pl(e,this)}async nwc(e,t=2e3){const n=await Rl.fromURI(this,e);return!1!==t&&await n.blockUntilReady(t),n}};function Dl(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function jl(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Kl(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Dl(e.outputLen),Dl(e.blockLen)}function Ml(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Vl(e,t){jl(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Wl="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,Zl=e=>e instanceof Uint8Array,Gl=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Yl=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Jl(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Zl(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class Ql{clone(){return this._cloneInto()}}function Xl(e){const t=t=>e().update(Jl(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function eu(e=32){if(Wl&&"function"==typeof Wl.getRandomValues)return Wl.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}class tu extends Ql{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Gl(this.buffer)}update(e){Ml(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Jl(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Gl(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ml(this),Vl(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,h=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=Gl(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const nu=(e,t,n)=>e&t^e&n^t&n,ru=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),iu=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ou=new Uint32Array(64);class su extends tu{constructor(){super(64,32,8,!1),this.A=0|iu[0],this.B=0|iu[1],this.C=0|iu[2],this.D=0|iu[3],this.E=0|iu[4],this.F=0|iu[5],this.G=0|iu[6],this.H=0|iu[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)ou[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=ou[e-15],n=ou[e-2],r=Yl(t,7)^Yl(t,18)^t>>>3,i=Yl(n,17)^Yl(n,19)^n>>>10;ou[e]=i+ou[e-7]+r+ou[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(Yl(s,6)^Yl(s,11)^Yl(s,25))+((l=s)&a^~l&c)+ru[e]+ou[e]|0,u=(Yl(n,2)^Yl(n,13)^Yl(n,22))+nu(n,r,i)|0;h=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,o,s,a,c,h)}roundClean(){ou.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const au=Xl((()=>new su)),cu=(BigInt(0),BigInt(1)),hu=BigInt(2),lu=e=>e instanceof Uint8Array,uu=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function du(e){if(!lu(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=uu[e[n]];return t}function fu(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":`0x${e}`)}function pu(e){if("string"!=typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let t=0;t<n.length;t++){const r=2*t,i=e.slice(r,r+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");n[t]=o}return n}function gu(e){return fu(du(e))}function yu(e){if(!lu(e))throw new Error("Uint8Array expected");return fu(du(Uint8Array.from(e).reverse()))}function wu(e,t){return pu(e.toString(16).padStart(2*t,"0"))}function bu(e,t){return wu(e,t).reverse()}function mu(e,t,n){let r;if("string"==typeof t)try{r=pu(t)}catch(n){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${n}`)}else{if(!lu(t))throw new Error(`${e} must be hex string or Uint8Array`);r=Uint8Array.from(t)}const i=r.length;if("number"==typeof n&&i!==n)throw new Error(`${e} expected ${n} bytes, got ${i}`);return r}function Eu(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!lu(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}const vu=e=>(hu<<BigInt(e-1))-cu,xu=e=>new Uint8Array(e),ku=e=>Uint8Array.from(e);function Au(e,t,n){if("number"!=typeof e||e<2)throw new Error("hashLen must be a number");if("number"!=typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=xu(e),i=xu(e),o=0;const s=()=>{r.fill(1),i.fill(0),o=0},a=(...e)=>n(i,r,...e),c=(e=xu())=>{i=a(ku([0]),e),r=a(),0!==e.length&&(i=a(ku([1]),e),r=a())},h=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return Eu(...n)};return(e,t)=>{let n;for(s(),c(e);!(n=t(h()));)c();return s(),n}}const Su={bigint:e=>"bigint"==typeof e,function:e=>"function"==typeof e,boolean:e=>"boolean"==typeof e,string:e=>"string"==typeof e,stringOrUint8Array:e=>"string"==typeof e||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"==typeof e&&Number.isSafeInteger(e.outputLen)};function Bu(e,t,n={}){const r=(t,n,r)=>{const i=Su[n];if("function"!=typeof i)throw new Error(`Invalid validator "${n}", expected function`);const o=e[t];if(!(r&&void 0===o||i(o,e)))throw new Error(`Invalid param ${String(t)}=${o} (${typeof o}), expected ${n}`)};for(const[e,n]of Object.entries(t))r(e,n,!1);for(const[e,t]of Object.entries(n))r(e,t,!0);return e}const _u=BigInt(0),Iu=BigInt(1),Ru=BigInt(2),Cu=BigInt(3),Uu=BigInt(4),Lu=BigInt(5),Nu=BigInt(8);BigInt(9),BigInt(16);function Tu(e,t){const n=e%t;return n>=_u?n:t+n}function Ou(e,t,n){if(n<=_u||t<_u)throw new Error("Expected power/modulo > 0");if(n===Iu)return _u;let r=Iu;for(;t>_u;)t&Iu&&(r=r*e%n),e=e*e%n,t>>=Iu;return r}function Fu(e,t,n){let r=e;for(;t-- >_u;)r*=r,r%=n;return r}function Pu(e,t){if(e===_u||t<=_u)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=Tu(e,t),r=t,i=_u,o=Iu,s=Iu,a=_u;for(;n!==_u;){const e=r/n,t=r%n,c=i-s*e,h=o-a*e;r=n,n=t,i=s,o=a,s=c,a=h}if(r!==Iu)throw new Error("invert: does not exist");return Tu(i,t)}function $u(e){if(e%Uu===Cu){const t=(e+Iu)/Uu;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%Nu===Lu){const t=(e-Lu)/Nu;return function(e,n){const r=e.mul(n,Ru),i=e.pow(r,t),o=e.mul(n,i),s=e.mul(e.mul(o,Ru),i),a=e.mul(o,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Iu)/Ru;let n,r,i;for(n=e-Iu,r=0;n%Ru===_u;n/=Ru,r++);for(i=Ru;i<e&&Ou(i,t,e)!==e-Iu;i++);if(1===r){const t=(e+Iu)/Uu;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+Iu)/Ru;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,c=e.pow(e.mul(e.ONE,i),n),h=e.pow(s,o),l=e.pow(s,n);for(;!e.eql(l,e.ONE);){if(e.eql(l,e.ZERO))return e.ZERO;let t=1;for(let n=e.sqr(l);t<a&&!e.eql(n,e.ONE);t++)n=e.sqr(n);const n=e.pow(c,Iu<<BigInt(a-t-1));c=e.sqr(n),h=e.mul(h,n),l=e.mul(l,c),a=t}return h}}(e)}const Hu=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function qu(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function zu(e){if("bigint"!=typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Du(e){const t=zu(e);return t+Math.ceil(t/2)}class ju extends Ql{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Kl(e);const n=Jl(t);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let e=0;e<i.length;e++)i[e]^=54;this.iHash.update(i),this.oHash=e.create();for(let e=0;e<i.length;e++)i[e]^=106;this.oHash.update(i),i.fill(0)}update(e){return Ml(this),this.iHash.update(e),this}digestInto(e){Ml(this),jl(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ku=(e,t,n)=>new ju(e,t).update(n).digest();Ku.create=(e,t)=>new ju(e,t);const Mu=BigInt(0),Vu=BigInt(1);function Wu(e){return Bu(e.Fp,Hu.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Bu(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...qu(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const{Ph:Zu,aT:Gu}=r,Yu={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(e){const{Err:t}=Yu;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Zu(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Yu,n="string"==typeof e?Gu(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=Yu._parseInt(n.subarray(2)),{d:s,l:a}=Yu._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?`0${t}`:t},r=t(n(e.s)),i=t(n(e.r)),o=r.length/2,s=i.length/2,a=n(o),c=n(s);return`30${n(s+o+4)}02${c}${i}02${a}${r}`}},Ju=BigInt(0),Qu=BigInt(1),Xu=(BigInt(2),BigInt(3));BigInt(4);function ed(e){const t=function(e){const t=Wu(e);Bu(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return Eu(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,o=n.sqr(e),s=n.mul(o,e);return n.add(n.add(s,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"==typeof e&&Ju<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:o}=t;if(n&&"bigint"!=typeof e){if(e instanceof Uint8Array&&(e=du(e)),"string"!=typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"==typeof e?e:gu(mu("private key",e,r))}catch(t){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof e}`)}return i&&(s=Tu(s,o)),a(s),s}const h=new Map;function l(e){if(!(e instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof u)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?u.ZERO:new u(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}static fromHex(e){const t=u.fromAffine(i(mu("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return u.BASE.multiply(c(e))}_setWindowSize(e){this._WINDOW_SIZE=e,h.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),s=o(e);if(!n.eql(i,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){l(e);const{px:t,py:r,pz:i}=this,{px:o,py:s,pz:a}=e,c=n.eql(n.mul(t,a),n.mul(o,i)),h=n.eql(n.mul(r,a),n.mul(s,i));return c&&h}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,Xu),{px:o,py:s,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(o,o),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(o,s);return g=n.add(g,g),l=n.mul(o,a),l=n.add(l,l),c=n.mul(e,l),h=n.mul(i,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(i,l),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(e){l(e);const{px:r,py:i,pz:o}=this,{px:s,py:a,pz:c}=e;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,Xu);let y=n.mul(r,s),w=n.mul(i,a),b=n.mul(o,c),m=n.add(r,i),E=n.add(s,a);m=n.mul(m,E),E=n.add(y,w),m=n.sub(m,E),E=n.add(r,o);let v=n.add(s,c);return E=n.mul(E,v),v=n.add(y,b),E=n.sub(E,v),v=n.add(i,o),h=n.add(a,c),v=n.mul(v,h),h=n.add(w,b),v=n.sub(v,h),f=n.mul(p,E),h=n.mul(g,b),f=n.add(h,f),h=n.sub(w,f),f=n.add(w,f),d=n.mul(h,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),E=n.mul(g,E),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),E=n.add(E,b),y=n.mul(w,E),d=n.add(d,y),y=n.mul(v,E),h=n.mul(m,h),h=n.sub(h,y),y=n.mul(m,w),f=n.mul(v,f),f=n.add(f,y),new u(h,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(u.ZERO)}wNAF(e){return f.wNAFCached(this,h,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(u.fromAffine)}))}multiplyUnsafe(e){const r=u.ZERO;if(e===Ju)return r;if(a(e),e===Qu)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:c,k2:h}=i.splitScalar(e),l=r,d=r,p=this;for(;s>Ju||h>Ju;)s&Qu&&(l=l.add(p)),h&Qu&&(d=d.add(p)),p=p.double(),s>>=Qu,h>>=Qu;return o&&(l=l.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,i.beta),d.py,d.pz),l.add(d)}multiply(e){a(e);let r,i,o=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:c}=s.splitScalar(o);let{p:h,f:l}=this.wNAF(t),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(e,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,s.beta),d.py,d.pz),r=h.add(d),i=l.add(p)}else{const{p:e,f:t}=this.wNAF(o);r=e,i=t}return u.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=u.BASE,i=(e,t)=>t!==Ju&&t!==Qu&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){const{px:t,py:r,pz:i}=this,o=this.is0();null==e&&(e=o?n.ONE:n.inv(i));const s=n.mul(t,e),a=n.mul(r,e),c=n.mul(i,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===Qu)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===Qu?this:n?n(u,this):this.multiplyUnsafe(t.h)}toRawBytes(e=!0){return this.assertValidity(),r(u,this,e)}toHex(e=!0){return du(this.toRawBytes(e))}}u.BASE=new u(t.Gx,t.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=function(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>Mu;)n&Vu&&(r=r.add(i)),i=i.double(),n>>=Vu;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),o=[];let s=e,a=s;for(let e=0;e<n;e++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){const{windows:s,windowSize:a}=r(t);let c=e.ZERO,h=e.BASE;const l=BigInt(2**t-1),u=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(o&l);o>>=d,r>a&&(r-=u,o+=Vu);const s=t,f=t+Math.abs(r)-1,p=e%2!=0,g=r<0;0===r?h=h.add(n(p,i[s])):c=c.add(n(g,i[f]))}return{p:c,f:h}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,r(o))),this.wNAF(i,o,n)}}}(u,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:s}}function td(e){const t=function(e){const t=Wu(e);return Bu(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,o=2*n.BYTES+1;function s(e){return Tu(e,r)}function a(e){return Pu(e,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=ed({...t,toBytes(e,t,r){const i=t.toAffine(),o=n.toBytes(i.x),s=Eu;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===o&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${t} was invalid. Expected ${i} compressed bytes or ${o} uncompressed bytes`)}{const e=gu(s);if(!(Ju<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=l(e);let i=n.sqrt(t);return!(1&~r)!==((i&Qu)===Qu)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>du(wu(e,t.nByteLength));function f(e){return e>r>>Qu}const p=(e,t,n)=>gu(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=mu("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=Yu.toSig(mu("DER",e));return new g(t,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r,s:i,recovery:o}=this,h=m(mu("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const l=2===o||3===o?r+t.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&o?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=s(-h*p),y=s(i*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return pu(this.toDERHex())}toDERHex(){return Yu.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return pu(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return h(e),!0}catch(e){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const e=Du(t.n);return function(e,t,n=!1){const r=e.length,i=zu(t),o=Du(t);if(r<16||r<o||r>1024)throw new Error(`expected ${o}-1024 bytes of input, got ${r}`);const s=Tu(n?gu(e):yu(e),t-Iu)+Iu;return n?bu(s,i):wu(s,i)}(t.randomBytes(e),t.n)},precompute:(e=8,t=c.BASE)=>(t._setWindowSize(e),t.multiply(BigInt(3)),t)};function w(e){const t=e instanceof Uint8Array,n="string"==typeof e,r=(t||n)&&e.length;return t?r===i||r===o:n?r===2*i||r===2*o:e instanceof c}const b=t.bits2int||function(e){const n=gu(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},m=t.bits2int_modN||function(e){return s(b(e))},E=vu(t.nBitLength);function v(e){if("bigint"!=typeof e)throw new Error("bigint expected");if(!(Ju<=e&&e<E))throw new Error(`bigint expected < 2^${t.nBitLength}`);return wu(e,t.nByteLength)}function x(e,r,i=k){if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:l}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=mu("msgHash",e),p&&(e=mu("prehashed msgHash",o(e)));const w=m(e),E=h(r),x=[v(E),v(w)];if(null!=y){const e=!0===y?l(n.BYTES):y;x.push(mu("extraEntropy",e))}const A=Eu(...x),S=w;return{seed:A,k2sig:function(e){const t=b(e);if(!u(t))return;const n=a(t),r=c.BASE.multiply(t).toAffine(),i=s(r.x);if(i===Ju)return;const o=s(n*s(S+i*E));if(o===Ju)return;let h=(r.x===i?0:2)|Number(r.y&Qu),l=o;return d&&f(o)&&(l=function(e){return f(e)?s(-e):e}(o),h^=1),new g(i,l,h)}}}const k={lowS:t.lowS,prehash:!1},A={lowS:t.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e,t=!0){return c.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t,n=!0){if(w(e))throw new Error("first arg must be private key");if(!w(t))throw new Error("second arg must be public key");return c.fromHex(t).multiply(h(e)).toRawBytes(n)},sign:function(e,n,r=k){const{seed:i,k2sig:o}=x(e,n,r),s=t;return Au(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(e,n,r,i=A){const o=e;if(n=mu("msgHash",n),r=mu("publicKey",r),"strict"in i)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:l}=i;let u,d;try{if("string"==typeof o||o instanceof Uint8Array)try{u=g.fromDER(o)}catch(e){if(!(e instanceof Yu.Err))throw e;u=g.fromCompact(o)}else{if("object"!=typeof o||"bigint"!=typeof o.r||"bigint"!=typeof o.s)throw new Error("PARSE");{const{r:e,s:t}=o;u=new g(e,t)}}d=c.fromHex(r)}catch(e){if("PARSE"===e.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=t.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=s(y*w),E=s(f*w),v=c.BASE.multiplyAndAddUnsafe(d,b,E)?.toAffine();return!!v&&s(v.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function nd(e){return{hash:e,hmac:(t,...n)=>Ku(e,t,function(...e){const t=new Uint8Array(e.reduce(((e,t)=>e+t.length),0));let n=0;return e.forEach((e=>{if(!Zl(e))throw new Error("Uint8Array expected");t.set(e,n),n+=e.length})),t}(...n)),randomBytes:eu}}const rd=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),id=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),od=BigInt(1),sd=BigInt(2),ad=(e,t)=>(e+t/sd)/t;function cd(e){const t=rd,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),c=BigInt(88),h=e*e*e%t,l=h*h*e%t,u=Fu(l,n,t)*l%t,d=Fu(u,n,t)*l%t,f=Fu(d,sd,t)*h%t,p=Fu(f,i,t)*f%t,g=Fu(p,o,t)*p%t,y=Fu(g,a,t)*g%t,w=Fu(y,c,t)*y%t,b=Fu(w,a,t)*g%t,m=Fu(b,n,t)*l%t,E=Fu(m,s,t)*p%t,v=Fu(E,r,t)*h%t,x=Fu(v,sd,t);if(!hd.eql(hd.sqr(x),e))throw new Error("Cannot find square root");return x}const hd=function(e,t,n=!1,r={}){if(e<=_u)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:i,nByteLength:o}=qu(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=$u(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:vu(i),ZERO:_u,ONE:Iu,create:t=>Tu(t,e),isValid:t=>{if("bigint"!=typeof t)throw new Error("Invalid field element: expected bigint, got "+typeof t);return _u<=t&&t<e},is0:e=>e===_u,isOdd:e=>(e&Iu)===Iu,neg:t=>Tu(-t,e),eql:(e,t)=>e===t,sqr:t=>Tu(t*t,e),add:(t,n)=>Tu(t+n,e),sub:(t,n)=>Tu(t-n,e),mul:(t,n)=>Tu(t*n,e),pow:(e,t)=>function(e,t,n){if(n<_u)throw new Error("Expected power > 0");if(n===_u)return e.ONE;if(n===Iu)return t;let r=e.ONE,i=t;for(;n>_u;)n&Iu&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Iu;return r}(a,e,t),div:(t,n)=>Tu(t*Pu(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>Pu(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?bu(e,o):wu(e,o),fromBytes:e=>{if(e.length!==o)throw new Error(`Fp.fromBytes: expected ${o}, got ${e.length}`);return n?yu(e):gu(e)}});return Object.freeze(a)}(rd,void 0,void 0,{sqrt:cd}),ld=function(e,t){const n=t=>td({...e,...nd(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:hd,n:id,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=id,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-od*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=ad(o*e,t),c=ad(-r*e,t);let h=Tu(e-a*n-c*i,t),l=Tu(-a*r-c*o,t);const u=h>s,d=l>s;if(u&&(h=t-h),d&&(l=t-l),h>s||l>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},au),ud=BigInt(0),dd=e=>"bigint"==typeof e&&ud<e&&e<rd,fd=e=>"bigint"==typeof e&&ud<e&&e<id,pd={};function gd(e,...t){let n=pd[e];if(void 0===n){const t=au(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=Eu(t,t),pd[e]=n}return au(Eu(n,...t))}const yd=e=>e.toRawBytes(!0).slice(1),wd=e=>wu(e,32),bd=e=>Tu(e,rd),md=e=>Tu(e,id),Ed=ld.ProjectivePoint,vd=(e,t,n)=>Ed.BASE.multiplyAndAddUnsafe(e,t,n);function xd(e){let t=ld.utils.normPrivateKeyToScalar(e),n=Ed.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:md(-t),bytes:yd(n)}}function kd(e){if(!dd(e))throw new Error("bad x: need 0 < x < p");const t=bd(e*e);let n=cd(bd(t*e+BigInt(7)));n%sd!==ud&&(n=bd(-n));const r=new Ed(e,n,od);return r.assertValidity(),r}function Ad(...e){return md(gu(gd("BIP0340/challenge",...e)))}function Sd(e){return xd(e).bytes}function Bd(e,t,n=eu(32)){const r=mu("message",e),{bytes:i,scalar:o}=xd(t),s=mu("auxRand",n,32),a=wd(o^gu(gd("BIP0340/aux",s))),c=gd("BIP0340/nonce",a,i,r),h=md(gu(c));if(h===ud)throw new Error("sign failed: k is zero");const{bytes:l,scalar:u}=xd(h),d=Ad(l,i,r),f=new Uint8Array(64);if(f.set(l,0),f.set(wd(md(u+d*o)),32),!_d(f,r,i))throw new Error("sign: Invalid signature produced");return f}function _d(e,t,n){const r=mu("signature",e,64),i=mu("message",t),o=mu("publicKey",n,32);try{const e=kd(gu(o)),t=gu(r.subarray(0,32));if(!dd(t))return!1;const n=gu(r.subarray(32,64));if(!fd(n))return!1;const s=Ad(wd(t),yd(e),i),a=vd(e,n,md(-s));return!(!a||!a.hasEvenY()||a.toAffine().x!==t)}catch(e){return!1}}const Id=(()=>({getPublicKey:Sd,sign:Bd,verify:_d,utils:{randomPrivateKey:ld.utils.randomPrivateKey,lift_x:kd,pointToBytes:yd,numberToBytesBE:wu,bytesToNumberBE:gu,taggedHash:gd,mod:Tu}}))(),Rd=("object"==typeof globalThis&&"crypto"in globalThis&&globalThis.crypto,e=>e instanceof Uint8Array),Cd=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Ud=(e,t)=>e<<32-t|e>>>t;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const Ld=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Nd(e){if(!Rd(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ld[e[n]];return t}function Td(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!Rd(e))throw new Error("expected Uint8Array, got "+typeof e);return e}class Od{clone(){return this._cloneInto()}}function Fd(e){const t=t=>e().update(Td(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Pd(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function $d(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}const Hd={number:Pd,bool:function(e){if("boolean"!=typeof e)throw new Error(`Expected boolean, not ${e}`)},bytes:$d,hash:function(e){if("function"!=typeof e||"function"!=typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Pd(e.outputLen),Pd(e.blockLen)},exists:function(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")},output:function(e,t){$d(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},qd=Hd;class zd extends Od{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Cd(this.buffer)}update(e){qd.exists(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=Td(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=Cd(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){qd.exists(this),qd.output(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let e=o;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),c=r?4:0,h=r?0:4;e.setUint32(t+c,s,r),e.setUint32(t+h,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=Cd(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<c;e++)s.setUint32(4*e,h[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const Dd=(e,t,n)=>e&t^e&n^t&n,jd=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Kd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Md=new Uint32Array(64);class Vd extends zd{constructor(){super(64,32,8,!1),this.A=0|Kd[0],this.B=0|Kd[1],this.C=0|Kd[2],this.D=0|Kd[3],this.E=0|Kd[4],this.F=0|Kd[5],this.G=0|Kd[6],this.H=0|Kd[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let n=0;n<16;n++,t+=4)Md[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=Md[e-15],n=Md[e-2],r=Ud(t,7)^Ud(t,18)^t>>>3,i=Ud(n,17)^Ud(n,19)^n>>>10;Md[e]=i+Md[e-7]+r+Md[e-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:c,H:h}=this;for(let e=0;e<64;e++){const t=h+(Ud(s,6)^Ud(s,11)^Ud(s,25))+((l=s)&a^~l&c)+jd[e]+Md[e]|0,u=(Ud(n,2)^Ud(n,13)^Ud(n,22))+Dd(n,r,i)|0;h=c,c=a,a=s,s=o+t|0,o=i,i=r,r=n,n=t+u|0}var l;n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,i,o,s,a,c,h)}roundClean(){Md.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Wd extends Vd{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Zd=Fd((()=>new Vd));Fd((()=>new Wd));var Gd=Symbol("verified"),Yd=e=>e instanceof Object;new TextDecoder("utf-8");var Jd=new TextEncoder;function Qd(e){if(!function(e){if(!Yd(e))return!1;if("number"!=typeof e.kind)return!1;if("string"!=typeof e.content)return!1;if("number"!=typeof e.created_at)return!1;if("string"!=typeof e.pubkey)return!1;if(!e.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let e=0;e<n.length;e++)if("object"==typeof n[e])return!1}return!0}(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Xd(e){return Nd(Zd(Jd.encode(Qd(e))))}var ef=new class{generateSecretKey(){return Id.utils.randomPrivateKey()}getPublicKey(e){return Nd(Id.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Nd(Id.getPublicKey(t)),n.id=Xd(n),n.sig=Nd(Id.sign(Xd(n),t)),n[Gd]=!0,n}verifyEvent(e){if("boolean"==typeof e[Gd])return e[Gd];const t=Xd(e);if(t!==e.id)return e[Gd]=!1,!1;try{const n=Id.verify(e.sig,t,e.pubkey);return e[Gd]=n,n}catch(t){return e[Gd]=!1,!1}}},tf=(ef.generateSecretKey,ef.getPublicKey);ef.finalizeEvent,ef.verifyEvent;function nf(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function rf(...e){const t=(e,t)=>n=>e(t(n)),n=Array.from(e).reverse().reduce(((e,n)=>e?t(e,n.encode):n.encode),void 0),r=e.reduce(((e,n)=>e?t(e,n.decode):n.decode),void 0);return{encode:n,decode:r}}function of(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("alphabet.encode input should be an array of numbers");return t.map((t=>{if(nf(t),t<0||t>=e.length)throw new Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]}))},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("alphabet.decode input should be array of strings");return t.map((t=>{if("string"!=typeof t)throw new Error(`alphabet.decode: not string element=${t}`);const n=e.indexOf(t);if(-1===n)throw new Error(`Unknown letter: "${t}". Allowed: ${e}`);return n}))}}}function sf(e=""){if("string"!=typeof e)throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw new Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw new Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw new Error("join.decode input should be string");return t.split(e)}}}function af(e,t="="){if(nf(e),"string"!=typeof t)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.encode: non-string input=${e}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let e of n)if("string"!=typeof e)throw new Error(`padding.decode: non-string input=${e}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function cf(e){if("function"!=typeof e)throw new Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function hf(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const i=[],o=Array.from(e);for(o.forEach((e=>{if(nf(e),e<0||e>=t)throw new Error(`Wrong integer: ${e}`)}));;){let e=0,s=!0;for(let i=r;i<o.length;i++){const a=o[i],c=t*e+a;if(!Number.isSafeInteger(c)||t*e/t!==e||c-a!=t*e)throw new Error("convertRadix: carry overflow");if(e=c%n,o[i]=Math.floor(c/n),!Number.isSafeInteger(o[i])||o[i]*n+e!==c)throw new Error("convertRadix: carry overflow");s&&(o[i]?s=!1:r=i)}if(i.push(e),s)break}for(let t=0;t<e.length-1&&0===e[t];t++)i.push(0);return i.reverse()}const lf=(e,t)=>t?lf(t,e%t):e,uf=(e,t)=>e+(t-lf(e,t));function df(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(uf(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${uf(t,n)}`);let i=0,o=0;const s=2**n-1,a=[];for(const r of e){if(nf(r),r>=2**t)throw new Error(`convertRadix2: invalid data word=${r} from=${t}`);if(i=i<<t|r,o+t>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=n;o-=n)a.push((i>>o-n&s)>>>0);i&=2**o-1}if(i=i<<n-o&s,!r&&o>=t)throw new Error("Excess padding");if(!r&&i)throw new Error(`Non-zero padding: ${i}`);return r&&o>0&&a.push(i>>>0),a}function ff(e){return nf(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return hf(Array.from(t),256,e)},decode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(hf(t,e,256))}}}function pf(e,t=!1){if(nf(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(uf(8,e)>32||uf(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return df(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(df(n,e,8,t))}}}function gf(e){if("function"!=typeof e)throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}const yf=rf(pf(4),of("0123456789ABCDEF"),sf("")),wf=rf(pf(5),of("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),af(5),sf("")),bf=(rf(pf(5),of("0123456789ABCDEFGHIJKLMNOPQRSTUV"),af(5),sf("")),rf(pf(5),of("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),sf(""),cf((e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),rf(pf(6),of("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),af(6),sf(""))),mf=rf(pf(6),of("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),af(6),sf("")),Ef=e=>rf(ff(58),of(e),sf("")),vf=Ef("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),xf=(Ef("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Ef("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),[0,2,3,5,6,7,9,10,11]),kf={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=vf.encode(r).padStart(xf[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),i=xf.indexOf(r.length),o=vf.decode(r);for(let e=0;e<o.length-i;e++)if(0!==o[e])throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(o.slice(o.length-i)))}return Uint8Array.from(t)}},Af=rf(of("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),sf("")),Sf=[996825010,642813549,513874426,1027748829,705979059];function Bf(e){const t=e>>25;let n=(33554431&e)<<5;for(let e=0;e<Sf.length;e++)1==(t>>e&1)&&(n^=Sf[e]);return n}function _f(e,t,n=1){const r=e.length;let i=1;for(let t=0;t<r;t++){const n=e.charCodeAt(t);if(n<33||n>126)throw new Error(`Invalid prefix (${e})`);i=Bf(i)^n>>5}i=Bf(i);for(let t=0;t<r;t++)i=Bf(i)^31&e.charCodeAt(t);for(let e of t)i=Bf(i)^e;for(let e=0;e<6;e++)i=Bf(i);return i^=n,Af.encode(df([i%2**30],30,5,!1))}function If(e){const t="bech32"===e?1:734539939,n=pf(5),r=n.decode,i=n.encode,o=gf(r);function s(e,n=90){if("string"!=typeof e)throw new Error("bech32.decode input should be string, not "+typeof e);if(e.length<8||!1!==n&&e.length>n)throw new TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${n})`);const r=e.toLowerCase();if(e!==r&&e!==e.toUpperCase())throw new Error("String must be lowercase or uppercase");const i=(e=r).lastIndexOf("1");if(0===i||-1===i)throw new Error('Letter "1" must be present between prefix and data only');const o=e.slice(0,i),s=e.slice(i+1);if(s.length<6)throw new Error("Data must be at least 6 characters long");const a=Af.decode(s).slice(0,-6),c=_f(o,a,t);if(!s.endsWith(c))throw new Error(`Invalid checksum in ${e}: expected "${c}"`);return{prefix:o,words:a}}return{encode:function(e,n,r=90){if("string"!=typeof e)throw new Error("bech32.encode prefix should be string, not "+typeof e);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const i=e.length+7+n.length;if(!1!==r&&i>r)throw new TypeError(`Length ${i} exceeds limit ${r}`);return`${e=e.toLowerCase()}1${Af.encode(n)}${_f(e,n,t)}`},decode:s,decodeToBytes:function(e){const{prefix:t,words:n}=s(e,!1);return{prefix:t,words:n,bytes:r(n)}},decodeUnsafe:gf(s),fromWords:r,fromWordsUnsafe:o,toWords:i}}const Rf=If("bech32"),Cf=(If("bech32m"),{encode:e=>(new TextDecoder).decode(e),decode:e=>(new TextEncoder).encode(e)});rf(pf(4),of("0123456789abcdef"),sf(""),cf((e=>{if("string"!=typeof e||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})));var Uf,Lf=new TextDecoder("utf-8"),Nf=(new TextEncoder,5e3);function Tf(e){let t={},n=e;for(;n.length>0;){let e=n[0],r=n[1],i=n.slice(2,2+r);if(n=n.slice(2+r),i.length<r)throw new Error(`not enough data to read on TLV ${e}`);t[e]=t[e]||[],t[e].push(i)}return t}(Uf=jQuery)(document).ready((function(){const e=15e3;let t=new zl({explicitRelayUrls:["wss://purplepag.es","wss://relay.nostr.band","wss://relay.primal.net","wss://relay.damus.io","wss://nostr.wine","wss://relay.snort.social","wss://eden.nostr.land","wss://nostr.bitcoiner.social","wss://nostrpub.yeghro.site"]});var n=Uf("#loginform"),r=Uf("#nostr_login_toggle"),i=Uf(".nostr-login-field"),o=Uf(".nostr-login-buttons"),s=Uf("#nostr-wp-submit"),a=Uf("#use_nostr_extension"),c=(Uf("#wp-submit"),n.children().not(".nostr-login-container, .nostr-login-field, .nostr-login-buttons").detach());function h(){var e,t=r.prop("checked");n.children().not(".nostr-login-container, .nostr-login-field, .nostr-login-buttons").remove(),t?(i.show(),o.show(),n.off("submit").on("submit",l)):(i.hide(),o.hide(),n.append(c.clone()),s.val("Log In"),n.off("submit")),e=r.prop("checked"),r.next(".nostr-toggle-slider").css("background-color",e?"#2196F3":"#ccc"),r.next(".nostr-toggle-slider").find("span").css("transform",e?"translateX(26px)":"none")}async function l(e){e.preventDefault();let t=Uf("#nostr_private_key").val();try{if(t.startsWith("nsec"))try{const{type:e,data:r}=function(e){let{prefix:t,words:n}=Rf.decode(e,Nf),r=new Uint8Array(Rf.fromWords(n));switch(t){case"nprofile":{let e=Tf(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Nd(e[0][0]),relays:e[1]?e[1].map((e=>Lf.decode(e))):[]}}}case"nevent":{let e=Tf(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==e[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(e[2]&&32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(e[3]&&4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Nd(e[0][0]),relays:e[1]?e[1].map((e=>Lf.decode(e))):[],author:e[2]?.[0]?Nd(e[2][0]):void 0,kind:e[3]?.[0]?parseInt(Nd(e[3][0]),16):void 0}}}case"naddr":{let e=Tf(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!e[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==e[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!e[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==e[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Lf.decode(e[0][0]),pubkey:Nd(e[2][0]),kind:parseInt(Nd(e[3][0]),16),relays:e[1]?e[1].map((e=>Lf.decode(e))):[]}}}case"nrelay":{let e=Tf(r);if(!e[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:Lf.decode(e[0][0])}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:Nd(r)};default:throw new Error(`unknown prefix ${t}`)}}(t);if("nsec"!==e)throw new Error("Invalid nsec key");n=r,t=Array.from(n).map((e=>e.toString(16).padStart(2,"0"))).join("")}catch(e){return void alert("Invalid nsec key format. Please check your private key and try again.")}if(!/^[0-9a-fA-F]{64}$/.test(t))throw new Error("Invalid private key format");await u(t)}catch(e){alert("Failed to log in with Nostr. Please check your private key and try again.")}var n}async function u(n=null,r=null,i=null){try{r||(r=tf(n));const o=t.connect(),s=new Promise(((t,n)=>setTimeout((()=>n(new Error("Connection to relays timed out"))),e)));try{await Promise.race([o,s])}catch(e){return void alert("Failed to connect to Nostr relays. Please try again later.")}let a=t.getUser({pubkey:r});i&&(a.signer=i);const c=a.fetchProfile(),h=new Promise(((t,n)=>setTimeout((()=>n(new Error("Fetching user profile timed out"))),e)));try{await Promise.race([c,h])}catch(e){alert("Failed to fetch user profile from Nostr. Proceeding with login using available information.")}const l=a.profile||{};Uf.ajax({url:nostr_login_ajax.ajax_url,type:"POST",data:{action:"nostr_login",public_key:r,metadata:JSON.stringify(l),nonce:nostr_login_ajax.nonce},success:function(e){e.success?window.location.href=e.data.redirect:alert(e.data.message)},error:function(){alert("An error occurred. Please try again.")}})}catch(e){throw e}}!function(){var e=r.closest(".nostr-login-container");e.css({"margin-bottom":"20px",position:"relative",display:"flex","align-items":"center"}),r.css({opacity:"0",width:"0",height:"0",position:"absolute"});var t=Uf('<span class="nostr-toggle-slider"></span>');t.css({position:"relative",cursor:"pointer",width:"60px",height:"34px","background-color":"#ccc",transition:".4s","border-radius":"34px",display:"inline-block","margin-right":"10px"}),t.append(Uf("<span></span>").css({position:"absolute",content:'""',height:"26px",width:"26px",left:"4px",bottom:"4px","background-color":"white",transition:".4s","border-radius":"50%"})),r.after(t),e.find(".nostr-toggle-label span").css({"vertical-align":"middle"})}(),r.on("change",h),a.on("click",(async function(e){e.preventDefault();try{const e=new Cl,t=(await e.user()).pubkey;await u(null,t,e)}catch(e){alert("Failed to use Nostr extension. Please make sure you have a compatible extension installed and try again.")}})),h()}))})()})();