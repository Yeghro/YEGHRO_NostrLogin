/*! For license information please see nostr-login.min.js.LICENSE.txt */
(()=>{var __webpack_modules__={833:(t,e,n)=>{e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,s=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(s=r))})),e.splice(s,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=n(736)(e);const{formatters:r}=t.exports;r.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},736:(t,e,n)=>{t.exports=function(t){function e(t){let n,s,i,o=null;function a(...t){if(!a.enabled)return;const r=a,s=Number(new Date),i=s-(n||s);r.diff=i,r.prev=n,r.curr=s,n=s,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((n,s)=>{if("%%"===n)return"%";o++;const i=e.formatters[s];if("function"==typeof i){const e=t[o];n=i.call(r,e),t.splice(o,1),o--}return n})),e.formatArgs.call(r,t);(r.log||e.log).apply(r,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=r,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(s!==e.namespaces&&(s=e.namespaces,i=e.enabled(t)),i),set:t=>{o=t}}),"function"==typeof e.init&&e.init(a),a}function r(t,n){const r=e(this.namespace+(void 0===n?":":n)+t);return r.log=this.log,r}function s(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},e.disable=function(){const t=[...e.names.map(s),...e.skips.map(s).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let n;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),s=r.length;for(n=0;n<s;n++)r[n]&&("-"===(t=r[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let n,r;for(n=0,r=e.skips.length;n<r;n++)if(e.skips[n].test(t))return!1;for(n=0,r=e.names.length;n<r;n++)if(e.names[n].test(t))return!0;return!1},e.humanize=n(585),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((n=>{e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let n=0;for(let e=0;e<t.length;e++)n=(n<<5)-n+t.charCodeAt(e),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e}},705:(t,e,n)=>{const{bech32:r,hex:s,utf8:i}=n(746),o={bech32:"bc",pubKeyHash:0,scriptHash:5,validWitnessVersions:[0]},a={bech32:"tb",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},c={bech32:"tbs",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},h={bech32:"bcrt",pubKeyHash:111,scriptHash:196,validWitnessVersions:[0]},l={bech32:"sb",pubKeyHash:63,scriptHash:123,validWitnessVersions:[0]},u=["option_data_loss_protect","initial_routing_sync","option_upfront_shutdown_script","gossip_queries","var_onion_optin","gossip_queries_ex","option_static_remotekey","payment_secret","basic_mpp","option_support_large_channel"],d={m:BigInt(1e3),u:BigInt(1e6),n:BigInt(1e9),p:BigInt(1e12)},f=BigInt("2100000000000000000"),p=BigInt(1e11),g={payment_hash:1,payment_secret:16,description:13,payee:19,description_hash:23,expiry:6,min_final_cltv_expiry:24,fallback_address:9,route_hint:3,feature_bits:5,metadata:27},y={};for(let t=0,e=Object.keys(g);t<e.length;t++){const n=e[t],r=g[e[t]].toString();y[r]=n}const w={1:t=>s.encode(r.fromWordsUnsafe(t)),16:t=>s.encode(r.fromWordsUnsafe(t)),13:t=>i.encode(r.fromWordsUnsafe(t)),19:t=>s.encode(r.fromWordsUnsafe(t)),23:t=>s.encode(r.fromWordsUnsafe(t)),27:t=>s.encode(r.fromWordsUnsafe(t)),6:m,24:m,3:function(t){const e=[];let n,i,o,a,c,h=r.fromWordsUnsafe(t);for(;h.length>0;)n=s.encode(h.slice(0,33)),i=s.encode(h.slice(33,41)),o=parseInt(s.encode(h.slice(41,45)),16),a=parseInt(s.encode(h.slice(45,49)),16),c=parseInt(s.encode(h.slice(49,51)),16),h=h.slice(51),e.push({pubkey:n,short_channel_id:i,fee_base_msat:o,fee_proportional_millionths:a,cltv_expiry_delta:c});return e},5:function(t){const e=t.slice().reverse().map((t=>[!!(1&t),!!(2&t),!!(4&t),!!(8&t),!!(16&t)])).reduce(((t,e)=>t.concat(e)),[]);for(;e.length<2*u.length;)e.push(!1);const n={};u.forEach(((t,r)=>{let s;s=e[2*r]?"required":e[2*r+1]?"supported":"unsupported",n[t]=s}));const r=e.slice(2*u.length);return n.extra_bits={start_bit:2*u.length,bits:r,has_required:r.reduce(((t,e,n)=>n%2!=0?t||!1:t||e),!1)},n}};function b(t){return e=>({tagCode:parseInt(t),words:r.encode("unknown",e,Number.MAX_SAFE_INTEGER)})}function m(t){return t.reverse().reduce(((t,e,n)=>t+e*Math.pow(32,n)),0)}function v(t,e){let n,r;if(t.slice(-1).match(/^[munp]$/))n=t.slice(-1),r=t.slice(0,-1);else{if(t.slice(-1).match(/^[^munp0-9]$/))throw new Error("Not a valid multiplier for the amount");r=t}if(!r.match(/^\d+$/))throw new Error("Not a valid human readable amount");const s=BigInt(r),i=n?s*p/d[n]:s*p;if("p"===n&&s%BigInt(10)!==BigInt(0)||i>f)throw new Error("Amount is outside of valid range");return e?i.toString():i}t.exports={decode:function(t,e){if("string"!=typeof t)throw new Error("Lightning Payment Request must be string");if("ln"!==t.slice(0,2).toLowerCase())throw new Error("Not a proper lightning payment request");const n=[],i=r.decode(t,Number.MAX_SAFE_INTEGER);t=t.toLowerCase();const u=i.prefix;let d=i.words,f=t.slice(u.length+1),p=d.slice(-104);d=d.slice(0,-104);let E=u.match(/^ln(\S+?)(\d*)([a-zA-Z]?)$/);if(E&&!E[2]&&(E=u.match(/^ln(\S+)$/)),!E)throw new Error("Not a proper lightning payment request");n.push({name:"lightning_network",letters:"ln"});const k=E[1];let A;if(e){if(void 0===e.bech32||void 0===e.pubKeyHash||void 0===e.scriptHash||!Array.isArray(e.validWitnessVersions))throw new Error("Invalid network");A=e}else switch(k){case o.bech32:A=o;break;case a.bech32:A=a;break;case c.bech32:A=c;break;case h.bech32:A=h;break;case l.bech32:A=l}if(!A||A.bech32!==k)throw new Error("Unknown coin bech32 prefix");n.push({name:"coin_network",letters:k,value:A});const x=E[2];let _;if(x){_=v(x+E[3],!0),n.push({name:"amount",letters:E[2]+E[3],value:_})}else _=null;n.push({name:"separator",letters:"1"});const S=m(d.slice(0,7));let R,C,U,I;for(d=d.slice(7),n.push({name:"timestamp",letters:f.slice(0,7),value:S}),f=f.slice(7);d.length>0;){const t=d[0].toString();R=y[t]||"unknown_tag",C=w[t]||b(t),d=d.slice(1),U=m(d.slice(0,2)),d=d.slice(2),I=d.slice(0,U),d=d.slice(U),n.push({name:R,tag:f[0],letters:f.slice(0,3+U),value:C(I)}),f=f.slice(3+U)}n.push({name:"signature",letters:f.slice(0,104),value:s.encode(r.fromWordsUnsafe(p))}),f=f.slice(104),n.push({name:"checksum",letters:f});let T={paymentRequest:t,sections:n,get expiry(){let t=n.find((t=>"expiry"===t.name));if(t)return N("timestamp")+t.value},get route_hints(){return n.filter((t=>"route_hint"===t.name)).map((t=>t.value))}};for(let t in g)"route_hint"!==t&&Object.defineProperty(T,t,{get:()=>N(t)});return T;function N(t){let e=n.find((e=>e.name===t));return e?e.value:void 0}},hrpToMillisat:v}},746:(t,e)=>{"use strict";function n(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function r(...t){const e=(t,e)=>n=>t(e(n));return{encode:Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),decode:t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0)}}function s(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(n(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function i(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function o(t,e="="){if(n(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function a(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function c(t,e,r){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(r<2)throw new Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let s=0;const i=[],o=Array.from(t);for(o.forEach((t=>{if(n(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,n=!0;for(let i=s;i<o.length;i++){const a=o[i],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%r,o[i]=Math.floor(c/r),!Number.isSafeInteger(o[i])||o[i]*r+t!==c)throw new Error("convertRadix: carry overflow");n&&(o[i]?n=!1:s=i)}if(i.push(t),n)break}for(let e=0;e<t.length-1&&0===t[e];e++)i.push(0);return i.reverse()}Object.defineProperty(e,"__esModule",{value:!0}),e.bytes=e.stringToBytes=e.str=e.bytesToString=e.hex=e.utf8=e.bech32m=e.bech32=e.base58check=e.base58xmr=e.base58xrp=e.base58flickr=e.base58=e.base64url=e.base64=e.base32crockford=e.base32hex=e.base32=e.base16=e.utils=e.assertNumber=void 0,e.assertNumber=n;const h=(t,e)=>e?h(e,t%e):t,l=(t,e)=>t+(e-h(t,e));function u(t,e,r,s){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(r<=0||r>32)throw new Error(`convertRadix2: wrong to=${r}`);if(l(e,r)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${r} carryBits=${l(e,r)}`);let i=0,o=0;const a=2**r-1,c=[];for(const s of t){if(n(s),s>=2**e)throw new Error(`convertRadix2: invalid data word=${s} from=${e}`);if(i=i<<e|s,o+e>32)throw new Error(`convertRadix2: carry overflow pos=${o} from=${e}`);for(o+=e;o>=r;o-=r)c.push((i>>o-r&a)>>>0);i&=2**o-1}if(i=i<<r-o&a,!s&&o>=e)throw new Error("Excess padding");if(!s&&i)throw new Error(`Non-zero padding: ${i}`);return s&&o>0&&c.push(i>>>0),c}function d(t){return n(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return c(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(c(e,t,256))}}}function f(t,e=!1){if(n(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(l(8,t)>32||l(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return u(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(u(n,t,8,e))}}}function p(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}function g(t,e){if(n(t),"function"!=typeof e)throw new Error("checksum fn should be function");return{encode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.encode: input should be Uint8Array");const r=e(n).slice(0,t),s=new Uint8Array(n.length+t);return s.set(n),s.set(r,n.length),s},decode(n){if(!(n instanceof Uint8Array))throw new Error("checksum.decode: input should be Uint8Array");const r=n.slice(0,-t),s=e(r).slice(0,t),i=n.slice(-t);for(let e=0;e<t;e++)if(s[e]!==i[e])throw new Error("Invalid checksum");return r}}}e.utils={alphabet:s,chain:r,checksum:g,radix:d,radix2:f,join:i,padding:o},e.base16=r(f(4),s("0123456789ABCDEF"),i("")),e.base32=r(f(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),o(5),i("")),e.base32hex=r(f(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),o(5),i("")),e.base32crockford=r(f(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),i(""),a((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),e.base64=r(f(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),o(6),i("")),e.base64url=r(f(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),o(6),i(""));const y=t=>r(d(58),s(t),i(""));e.base58=y("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),e.base58flickr=y("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),e.base58xrp=y("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const w=[0,2,3,5,6,7,9,10,11];e.base58xmr={encode(t){let n="";for(let r=0;r<t.length;r+=8){const s=t.subarray(r,r+8);n+=e.base58.encode(s).padStart(w[s.length],"1")}return n},decode(t){let n=[];for(let r=0;r<t.length;r+=11){const s=t.slice(r,r+11),i=w.indexOf(s.length),o=e.base58.decode(s);for(let t=0;t<o.length-i;t++)if(0!==o[t])throw new Error("base58xmr: wrong padding");n=n.concat(Array.from(o.slice(o.length-i)))}return Uint8Array.from(n)}};e.base58check=t=>r(g(4,(e=>t(t(e)))),e.base58);const b=r(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),i("")),m=[996825010,642813549,513874426,1027748829,705979059];function v(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<m.length;t++)1==(e>>t&1)&&(n^=m[t]);return n}function E(t,e,n=1){const r=t.length;let s=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);s=v(s)^n>>5}s=v(s);for(let e=0;e<r;e++)s=v(s)^31&t.charCodeAt(e);for(let t of e)s=v(s)^t;for(let t=0;t<6;t++)s=v(s);return s^=n,b.encode(u([s%2**30],30,5,!1))}function k(t){const e="bech32"===t?1:734539939,n=f(5),r=n.decode,s=n.encode,i=p(r);function o(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const s=(t=r).lastIndexOf("1");if(0===s||-1===s)throw new Error('Letter "1" must be present between prefix and data only');const i=t.slice(0,s),o=t.slice(s+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=b.decode(o).slice(0,-6),c=E(i,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:i,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const s=t.length+7+n.length;if(!1!==r&&s>r)throw new TypeError(`Length ${s} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${b.encode(n)}${E(t,n,e)}`},decode:o,decodeToBytes:function(t){const{prefix:e,words:n}=o(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:p(o),fromWords:r,fromWordsUnsafe:i,toWords:s}}e.bech32=k("bech32"),e.bech32m=k("bech32m"),e.utf8={encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)},e.hex=r(f(4),s("0123456789abcdef"),i(""),a((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));const A={utf8:e.utf8,hex:e.hex,base16:e.base16,base32:e.base32,base64:e.base64,base64url:e.base64url,base58:e.base58,base58xmr:e.base58xmr},x=`Invalid encoding type. Available types: ${Object.keys(A).join(", ")}`;e.bytesToString=(t,e)=>{if("string"!=typeof t||!A.hasOwnProperty(t))throw new TypeError(x);if(!(e instanceof Uint8Array))throw new TypeError("bytesToString() expects Uint8Array");return A[t].encode(e)},e.str=e.bytesToString;e.stringToBytes=(t,e)=>{if(!A.hasOwnProperty(t))throw new TypeError(x);if("string"!=typeof e)throw new TypeError("stringToBytes() expects string");return A[t].decode(e)},e.bytes=e.stringToBytes},585:t=>{var e=1e3,n=60*e,r=60*n,s=24*r,i=7*s,o=365.25*s;function a(t,e,n,r){var s=e>=1.5*n;return Math.round(t/n)+" "+r+(s?"s":"")}t.exports=function(t,c){c=c||{};var h=typeof t;if("string"===h&&t.length>0)return function(t){if((t=String(t)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!a)return;var c=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*s;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}(t);if("number"===h&&isFinite(t))return c.long?function(t){var i=Math.abs(t);if(i>=s)return a(t,i,s,"day");if(i>=r)return a(t,i,r,"hour");if(i>=n)return a(t,i,n,"minute");if(i>=e)return a(t,i,e,"second");return t+" ms"}(t):function(t){var i=Math.abs(t);if(i>=s)return Math.round(t/s)+"d";if(i>=r)return Math.round(t/r)+"h";if(i>=n)return Math.round(t/n)+"m";if(i>=e)return Math.round(t/e)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},30:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,s=0,i=e.length;s<i;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.EventEmitter=void 0;var s=n(857),i=n(547);function o(t,e,n,r,s,i){var o=this.events[t];return!!o&&(0!==o.length&&(o.argsNum<6?o.call(e,n,r,s,i):o.call.apply(void 0,arguments),!0))}function a(t,e,n,r,s,i){var o=this.events[t];if(o){if(0===o.length)return!1;o.argsNum<6?o.call(e,n,r,s,i):o.call.apply(void 0,arguments)}var a=this.onceEvents[t];if(a){if("function"==typeof a)this.onceEvents[t]=void 0,arguments.length<6?a(e,n,r,s,i):a.apply(void 0,arguments);else{var c=a;if(this.onceEvents[t]=void 0,arguments.length<6)for(var h=0;h<c.length;++h)c[h](e,n,r,s,i);else for(h=0;h<c.length;++h)c[h].apply(void 0,arguments)}return!0}return!!o}var c=function(){function t(){this.events=(0,i.nullObj)(),this.onceEvents=(0,i.nullObj)(),this._symbolKeys=new Set,this.maxListeners=1/0}return Object.defineProperty(t.prototype,"_eventsCount",{get:function(){return this.eventNames().length},enumerable:!1,configurable:!0}),t}();function h(t,e,n){if(void 0===n&&(n=e.length),"function"!=typeof e)throw new TypeError("The listener must be a function");var r=this.events[t];return r?(r.push(e),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" event!'))):(this.events[t]=new s.TaskCollection(n,!0,e,!1),"symbol"==typeof t&&this._symbolKeys.add(t)),this}function l(t,e){var n=this.events[t];n&&n.removeLast(e);var r=this.onceEvents[t];return r&&("function"==typeof r?this.onceEvents[t]=void 0:"object"==typeof r&&(1===r.length&&r[0]===e?this.onceEvents[t]=void 0:(0,s._fast_remove_single)(r,r.lastIndexOf(e)))),this}e.EventEmitter=c,c.prototype.emit=o,c.prototype.on=h,c.prototype.once=function(t,e){switch(this.emit===o&&(this.emit=a),typeof this.onceEvents[t]){case"undefined":this.onceEvents[t]=e,"symbol"==typeof t&&this._symbolKeys.add(t);break;case"function":this.onceEvents[t]=[this.onceEvents[t],e];break;case"object":this.onceEvents[t].push(e)}return this},c.prototype.addListener=h,c.prototype.removeListener=l,c.prototype.addListenerBound=function(t,e,n,r){void 0===n&&(n=this),void 0===r&&(r=e.length),this.boundFuncs||(this.boundFuncs=new Map);var s=e.bind(n);return this.boundFuncs.set(e,s),this.addListener(t,s,r)},c.prototype.removeListenerBound=function(t,e){var n,r,s=null===(n=this.boundFuncs)||void 0===n?void 0:n.get(e);return null===(r=this.boundFuncs)||void 0===r||r.delete(e),this.removeListener(t,s)},c.prototype.hasListeners=function(t){return this.events[t]&&!!this.events[t].length},c.prototype.prependListener=function(t,e,n){if(void 0===n&&(n=e.length),"function"!=typeof e)throw new TypeError("The listener must be a function");var r=this.events[t];return r&&r instanceof s.TaskCollection?(r.insert(0,e),r.growArgsNum(n),this.maxListeners!==1/0&&this.maxListeners<=r.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" event!'))):(r=this.events[t]=new s.TaskCollection(n,!0,e,!1),"symbol"==typeof t&&this._symbolKeys.add(t)),this},c.prototype.prependOnceListener=function(t,e){this.emit===o&&(this.emit=a);var n=this.onceEvents[t];return n?"object"!=typeof n?(this.onceEvents[t]=[e,n],"symbol"==typeof t&&this._symbolKeys.add(t)):(n.unshift(e),this.maxListeners!==1/0&&this.maxListeners<=n.length&&console.warn('Maximum event listeners for "'.concat(String(t),'" once event!'))):(this.onceEvents[t]=[e],"symbol"==typeof t&&this._symbolKeys.add(t)),this},c.prototype.off=l,c.prototype.removeAllListeners=function(t){return void 0===t?(this.events=(0,i.nullObj)(),this.onceEvents=(0,i.nullObj)(),this._symbolKeys=new Set):(this.events[t]=void 0,this.onceEvents[t]=void 0,"symbol"==typeof t&&this._symbolKeys.delete(t)),this},c.prototype.setMaxListeners=function(t){return this.maxListeners=t,this},c.prototype.getMaxListeners=function(){return this.maxListeners},c.prototype.listeners=function(t){return this.emit===o?this.events[t]?this.events[t].tasksAsArray().slice():[]:this.events[t]&&this.onceEvents[t]?r(r([],this.events[t].tasksAsArray(),!0),"function"==typeof this.onceEvents[t]?[this.onceEvents[t]]:this.onceEvents[t],!0):this.events[t]?this.events[t].tasksAsArray():this.onceEvents[t]?"function"==typeof this.onceEvents[t]?[this.onceEvents[t]]:this.onceEvents[t]:[]},c.prototype.eventNames=function(){var t=this;if(this.emit===o){var e=Object.keys(this.events);return r(r([],e,!0),Array.from(this._symbolKeys),!0).filter((function(e){return e in t.events&&t.events[e]&&t.events[e].length}))}e=Object.keys(this.events).filter((function(e){return t.events[e]&&t.events[e].length}));var n=Object.keys(this.onceEvents).filter((function(e){return t.onceEvents[e]&&t.onceEvents[e].length}));return r(r(r([],e,!0),n,!0),Array.from(this._symbolKeys).filter((function(e){return e in t.events&&t.events[e]&&t.events[e].length||e in t.onceEvents&&t.onceEvents[e]&&t.onceEvents[e].length})),!0)},c.prototype.listenerCount=function(t){return this.emit===o?this.events[t]&&this.events[t].length||0:(this.events[t]&&this.events[t].length||0)+(this.onceEvents[t]&&this.onceEvents[t].length||0)}},706:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),s(n(335),e),s(n(30),e)},665:(__unused_webpack_module,exports)=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bakeCollectionVariadic=exports.bakeCollectionAwait=exports.bakeCollection=exports.BAKED_EMPTY_FUNC=void 0,exports.BAKED_EMPTY_FUNC=function(){};var FORLOOP_FALLBACK=1500;function generateArgsDefCode(t){var e="";if(0===t)return e;for(var n=0;n<t-1;++n)e+="arg"+String(n)+", ";return e+="arg"+String(t-1)}function generateBodyPartsCode(t,e){for(var n="",r="",s=0;s<e;++s)n+="var f".concat(s," = collection[").concat(s,"];\n"),r+="f".concat(s,"(").concat(t,")\n");return{funcDefCode:n,funcCallCode:r}}function generateBodyPartsVariadicCode(t){for(var e="",n="",r=0;r<t;++r)e+="var f".concat(r," = collection[").concat(r,"];\n"),n+="f".concat(r,".apply(undefined, arguments)\n");return{funcDefCode:e,funcCallCode:n}}function bakeCollection(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                ").concat(funcCallCode,"\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode=collection.length%10==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 10) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                        collection[i+4](").concat(argsDefCode,");\n                        collection[i+5](").concat(argsDefCode,");\n                        collection[i+6](").concat(argsDefCode,");\n                        collection[i+7](").concat(argsDefCode,");\n                        collection[i+8](").concat(argsDefCode,");\n                        collection[i+9](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%4==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 4) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                        collection[i+3](").concat(argsDefCode,");\n                    }\n                });\n            })"):collection.length%3==0?"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; i += 3) {\n                        collection[i](").concat(argsDefCode,");\n                        collection[i+1](").concat(argsDefCode,");\n                        collection[i+2](").concat(argsDefCode,");\n                    }\n                });\n            })"):"(function(collection) {\n                return (function(".concat(argsDefCode,") {\n                    for (var i = 0; i < collection.length; ++i) {\n                        collection[i](").concat(argsDefCode,");\n                    }\n                });\n            })")}var bakeCollection_1=void 0,fixedArgsNum_1=void 0,bakeCollectionVariadic_1=void 0,bakeCollectionAwait_1=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionAwait(collection,fixedArgsNum){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var argsDefCode=generateArgsDefCode(fixedArgsNum),_a=generateBodyPartsCode(argsDefCode,collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function(").concat(argsDefCode,") {\n                return Promise.all([ ").concat(funcCallCode," ]);\n            });\n        })")}else{var argsDefCode=generateArgsDefCode(fixedArgsNum);funcFactoryCode="(function(collection) {\n            return (function(".concat(argsDefCode,") {\n                var promises = Array(collection.length);\n                for (var i = 0; i < collection.length; ++i) {\n                    promises[i] = collection[i](").concat(argsDefCode,");\n                }\n                return Promise.all(promises);\n            });\n        })")}var bakeCollection_2=void 0,fixedArgsNum_2=void 0,bakeCollectionVariadic_2=void 0,bakeCollectionAwait_2=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}function bakeCollectionVariadic(collection){if(0===collection.length)return exports.BAKED_EMPTY_FUNC;if(1===collection.length)return collection[0];var funcFactoryCode;if(collection.length<FORLOOP_FALLBACK){var _a=generateBodyPartsVariadicCode(collection.length),funcDefCode=_a.funcDefCode,funcCallCode=_a.funcCallCode;funcFactoryCode="(function(collection) {\n            ".concat(funcDefCode,"\n            collection = undefined;\n            return (function() {\n                ").concat(funcCallCode,"\n            });\n        })")}else funcFactoryCode="(function(collection) {\n            return (function() {\n                for (var i = 0; i < collection.length; ++i) {\n                    collection[i].apply(undefined, arguments);\n                }\n            });\n        })";var bakeCollection_3=void 0,fixedArgsNum=void 0,bakeCollectionVariadic_3=void 0,bakeCollectionAwait_3=void 0,funcFactory=eval(funcFactoryCode);return funcFactory(collection)}exports.bakeCollection=bakeCollection,exports.bakeCollectionAwait=bakeCollectionAwait,exports.bakeCollectionVariadic=bakeCollectionVariadic},857:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),s(n(369),e)},369:function(t,e,n){"use strict";var r=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var r,s=0,i=e.length;s<i;s++)!r&&s in e||(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.TaskCollection=e._fast_remove_single=void 0;var s=n(665);function i(t,e){var n,r=this.length;if(r>1)e?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(t),this.length++);else if(e){var s;if(1===r)(s=Array(1+arguments.length)).push(s),s.push.apply(s,arguments),this._tasks=s;else(s=Array(arguments.length)).push.apply(s,arguments),this._tasks=s;this.length+=arguments.length}else this._tasks=1===r?[this._tasks,t]:t,this.length++}function o(t,e){var n,r=this.length;if(r>1)e?((n=this._tasks).push.apply(n,arguments),this.length+=arguments.length):(this._tasks.push(t),this.length++);else if(e){var s;if(1===r)(s=Array(1+arguments.length)).push(s),s.push.apply(s,arguments),this._tasks=s;else(s=Array(arguments.length)).push.apply(s,arguments),this._tasks=s;this.length+=arguments.length}else this._tasks=1===r?[this._tasks,t]:t,this.length++;this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function a(t,e){-1!==e&&(0===e?t.shift():e===t.length-1?t.length=t.length-1:t.splice(e,1))}function c(t){0!==this.length&&(1===this.length?this._tasks===t&&(this.length=0):(a(this._tasks,this._tasks.lastIndexOf(t)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length))}function h(t){if(0!==this.length){if(1===this.length)return this._tasks===t&&(this.length=0),this.firstEmitBuildStrategy?void(this.call=s.BAKED_EMPTY_FUNC):void this.rebuild();a(this._tasks,this._tasks.lastIndexOf(t)),1===this._tasks.length?(this._tasks=this._tasks[0],this.length=1):this.length=this._tasks.length,this.firstEmitBuildStrategy?this.call=p:this.rebuild()}}function l(t){for(var e,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,r([t,0],n,!1)),this.length=this._tasks.length)}function u(t){for(var e,n=[],s=1;s<arguments.length;s++)n[s-1]=arguments[s];0===this.length?(this._tasks=n,this.length=1):1===this.length?(n.unshift(this._tasks),this._tasks=n,this.length=this._tasks.length):((e=this._tasks).splice.apply(e,r([t,0],n,!1)),this.length=this._tasks.length),this.firstEmitBuildStrategy?this.call=p:this.rebuild()}function d(){0===this.length?this.call=s.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,s.bakeCollection)(this._tasks,this.argsNum)}function f(){0===this.length?this.call=s.BAKED_EMPTY_FUNC:1===this.length?this.call=this._tasks:this.call=(0,s.bakeCollectionAwait)(this._tasks,this.argsNum)}function p(){this.rebuild(),this.call.apply(void 0,arguments)}e._fast_remove_single=a;var g=function(t,e,n,r){void 0===e&&(e=!0),void 0===n&&(n=null),void 0===r&&(r=!1),this.awaitTasks=r,this.call=s.BAKED_EMPTY_FUNC,this.argsNum=t,this.firstEmitBuildStrategy=!0,this.rebuild=r?f.bind(this):d.bind(this),this.setAutoRebuild(e),n?"function"==typeof n?(this._tasks=n,this.length=1):(this._tasks=n,this.length=n.length):(this._tasks=null,this.length=0),e&&this.rebuild()};e.TaskCollection=g,g.prototype.fastClear=function(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC},g.prototype.clear=function(){this._tasks=null,this.length=0,this.call=s.BAKED_EMPTY_FUNC},g.prototype.growArgsNum=function(t){this.argsNum<t&&(this.argsNum=t,this.firstEmitBuildStrategy?this.call=p:this.rebuild())},g.prototype.setAutoRebuild=function(t){t?(this.push=o.bind(this),this.insert=u.bind(this),this.removeLast=h.bind(this)):(this.push=i.bind(this),this.insert=l.bind(this),this.removeLast=c.bind(this))},g.prototype.tasksAsArray=function(){return 0===this.length?[]:1===this.length?[this._tasks]:this._tasks},g.prototype.setTasks=function(t){0===t.length?(this.length=0,this.call=s.BAKED_EMPTY_FUNC):1===t.length?(this.length=1,this.call=t[0],this._tasks=t[0]):(this.length=t.length,this._tasks=t,this.firstEmitBuildStrategy?this.call=p:this.rebuild())}},335:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0})},547:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.nullObj=void 0,e.nullObj=function(){var t={__proto__:null,prototype:null};return t}},145:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCache=void 0;const r=n(397);class s{constructor(t){this.lookupTable=new Map,this.head=null,this.tail=null;const{maxSize:e=25,entryExpirationTimeInMS:n=null,onEntryEvicted:r,onEntryMarkedAsMostRecentlyUsed:s,cloneFn:i,clone:o}=null!=t?t:{};if(Number.isNaN(e)||e<=0)throw new Error("maxSize must be greater than 0.");if("number"==typeof n&&(n<=0||Number.isNaN(n)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.maxSizeInternal=e,this.entryExpirationTimeInMS=n,this.onEntryEvicted=r,this.onEntryMarkedAsMostRecentlyUsed=s,this.clone=o,this.cloneFn=i}get size(){return this.cleanCache(),this.lookupTable.size}get remainingSize(){return this.maxSizeInternal-this.size}get newest(){return this.head?this.head.isExpired?(this.removeNodeFromListAndLookupTable(this.head),this.newest):this.mapNodeToEntry(this.head):null}get oldest(){return this.tail?this.tail.isExpired?(this.removeNodeFromListAndLookupTable(this.tail),this.oldest):this.mapNodeToEntry(this.tail):null}get maxSize(){return this.maxSizeInternal}set maxSize(t){if(Number.isNaN(t)||t<=0)throw new Error("maxSize must be greater than 0.");this.maxSizeInternal=t,this.enforceSizeLimit()}set(t,e,n){const s=this.lookupTable.get(t);s&&this.removeNodeFromListAndLookupTable(s);const i=new r.LRUCacheNode(t,e,{entryExpirationTimeInMS:this.entryExpirationTimeInMS,onEntryEvicted:this.onEntryEvicted,onEntryMarkedAsMostRecentlyUsed:this.onEntryMarkedAsMostRecentlyUsed,clone:this.clone,cloneFn:this.cloneFn,...n});return this.setNodeAsHead(i),this.lookupTable.set(t,i),this.enforceSizeLimit(),this}get(t){const e=this.lookupTable.get(t);return e?e.isExpired?(this.removeNodeFromListAndLookupTable(e),null):(this.setNodeAsHead(e),e.value):null}peek(t){const e=this.lookupTable.get(t);return e?e.isExpired?(this.removeNodeFromListAndLookupTable(e),null):e.value:null}delete(t){const e=this.lookupTable.get(t);return!!e&&this.removeNodeFromListAndLookupTable(e)}has(t){const e=this.lookupTable.get(t);return!!e&&(!e.isExpired||(this.removeNodeFromListAndLookupTable(e),!1))}clear(){this.head=null,this.tail=null,this.lookupTable.clear()}find(t){let e=this.head;for(;e;){if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t;continue}const n=this.mapNodeToEntry(e);if(t(n))return this.setNodeAsHead(e),n;e=e.next}return null}forEach(t){let e=this.head,n=0;for(;e;)if(e.isExpired){const t=e.next;this.removeNodeFromListAndLookupTable(e),e=t}else t(e.value,e.key,n),e=e.next,n++}*values(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield t.value,t=t.next}*keys(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield t.key,t=t.next}*entries(){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield this.mapNodeToEntry(t),t=t.next}*[Symbol.iterator](){let t=this.head;for(;t;)if(t.isExpired){const e=t.next;this.removeNodeFromListAndLookupTable(t),t=e}else yield this.mapNodeToEntry(t),t=t.next}enforceSizeLimit(){let t=this.tail;for(;null!==t&&this.size>this.maxSizeInternal;){const e=t.prev;this.removeNodeFromListAndLookupTable(t),t=e}}mapNodeToEntry({key:t,value:e}){return{key:t,value:e}}setNodeAsHead(t){this.removeNodeFromList(t),this.head?(t.next=this.head,this.head.prev=t,this.head=t):(this.head=t,this.tail=t),t.invokeOnEntryMarkedAsMostRecentlyUsed()}removeNodeFromList(t){null!==t.prev&&(t.prev.next=t.next),null!==t.next&&(t.next.prev=t.prev),this.head===t&&(this.head=t.next),this.tail===t&&(this.tail=t.prev),t.next=null,t.prev=null}removeNodeFromListAndLookupTable(t){return t.invokeOnEvicted(),this.removeNodeFromList(t),this.lookupTable.delete(t.key)}cleanCache(){if(!this.entryExpirationTimeInMS)return;const t=[];for(const e of this.lookupTable.values())e.isExpired&&t.push(e);t.forEach((t=>this.removeNodeFromListAndLookupTable(t)))}}e.LRUCache=s},397:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LRUCacheNode=void 0;e.LRUCacheNode=class{constructor(t,e,n){const{entryExpirationTimeInMS:r=null,next:s=null,prev:i=null,onEntryEvicted:o,onEntryMarkedAsMostRecentlyUsed:a,clone:c,cloneFn:h}=null!=n?n:{};if("number"==typeof r&&(r<=0||Number.isNaN(r)))throw new Error("entryExpirationTimeInMS must either be null (no expiry) or greater than 0");this.clone=null!=c&&c,this.cloneFn=null!=h?h:this.defaultClone,this.key=t,this.internalValue=this.clone?this.cloneFn(e):e,this.created=Date.now(),this.entryExpirationTimeInMS=r,this.next=s,this.prev=i,this.onEntryEvicted=o,this.onEntryMarkedAsMostRecentlyUsed=a}get value(){return this.clone?this.cloneFn(this.internalValue):this.internalValue}get isExpired(){return"number"==typeof this.entryExpirationTimeInMS&&Date.now()-this.created>this.entryExpirationTimeInMS}invokeOnEvicted(){if(this.onEntryEvicted){const{key:t,value:e,isExpired:n}=this;this.onEntryEvicted({key:t,value:e,isExpired:n})}}invokeOnEntryMarkedAsMostRecentlyUsed(){if(this.onEntryMarkedAsMostRecentlyUsed){const{key:t,value:e}=this;this.onEntryMarkedAsMostRecentlyUsed({key:t,value:e})}}defaultClone(t){return"boolean"==typeof t||"string"==typeof t||"number"==typeof t?t:JSON.parse(JSON.stringify(t))}}},654:function(t,e,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(e,n);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[n]}}),Object.defineProperty(t,r,s)}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]}),s=this&&this.__exportStar||function(t,e){for(var n in t)"default"===n||Object.prototype.hasOwnProperty.call(e,n)||r(e,t,n)};Object.defineProperty(e,"__esModule",{value:!0}),s(n(145),e)}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t].call(n.exports,n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{"use strict";var t={};__webpack_require__.r(t),__webpack_require__.d(t,{OG:()=>O,My:()=>R,Ph:()=>I,lX:()=>T,Id:()=>P,fg:()=>M,qj:()=>B,aT:()=>U,lq:()=>N,z:()=>L,Q5:()=>q});var e={};__webpack_require__.r(e),__webpack_require__.d(e,{DO:()=>Ea,OG:()=>Ba,My:()=>Aa,Ph:()=>Ca,lX:()=>Ua,Id:()=>La,fg:()=>Fa,qj:()=>Na,aT:()=>Ra,aY:()=>va,lq:()=>Ia,z:()=>Ta,Q5:()=>Ma});var n={};function r(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function s(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function i(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");r(t.outputLen),r(t.blockLen)}function o(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function a(t,e){s(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}__webpack_require__.r(n),__webpack_require__.d(n,{uk:()=>Pl,Ay:()=>ou});const c="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,h=t=>t instanceof Uint8Array,l=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),u=(t,e)=>t<<32-e|t>>>e;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function d(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!h(t))throw new Error("expected Uint8Array, got "+typeof t);return t}class f{clone(){return this._cloneInto()}}function p(t){const e=e=>t().update(d(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function g(t=32){if(c&&"function"==typeof c.getRandomValues)return c.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}class y extends f{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=l(this.buffer)}update(t){o(this);const{view:e,buffer:n,blockLen:r}=this,s=(t=d(t)).length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);if(o!==r)n.set(t.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=l(t);for(;r<=s-i;i+=r)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){o(this),a(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:s}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let t=i;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}(n,r-8,BigInt(8*this.length),s),this.process(n,0);const c=l(t),h=this.outputLen;if(h%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=h/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<u;t++)c.setUint32(4*t,d[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:s,destroyed:i,pos:o}=this;return t.length=r,t.pos=o,t.finished=s,t.destroyed=i,r%e&&t.buffer.set(n),t}}const w=(t,e,n)=>t&e^t&n^e&n,b=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),m=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),v=new Uint32Array(64);class E extends y{constructor(){super(64,32,8,!1),this.A=0|m[0],this.B=0|m[1],this.C=0|m[2],this.D=0|m[3],this.E=0|m[4],this.F=0|m[5],this.G=0|m[6],this.H=0|m[7]}get(){const{A:t,B:e,C:n,D:r,E:s,F:i,G:o,H:a}=this;return[t,e,n,r,s,i,o,a]}set(t,e,n,r,s,i,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|s,this.F=0|i,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)v[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=v[t-15],n=v[t-2],r=u(e,7)^u(e,18)^e>>>3,s=u(n,17)^u(n,19)^n>>>10;v[t]=s+v[t-7]+r+v[t-16]|0}let{A:n,B:r,C:s,D:i,E:o,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(u(o,6)^u(o,11)^u(o,25))+((l=o)&a^~l&c)+b[t]+v[t]|0,d=(u(n,2)^u(n,13)^u(n,22))+w(n,r,s)|0;h=c,c=a,a=o,o=i+e|0,i=s,s=r,r=n,n=e+d|0}var l;n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,s,i,o,a,c,h)}roundClean(){v.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const k=p((()=>new E)),A=(BigInt(0),BigInt(1)),x=BigInt(2),_=t=>t instanceof Uint8Array,S=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function R(t){if(!_(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=S[t[n]];return e}function C(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}function U(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,s=t.slice(r,r+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[e]=i}return n}function I(t){return C(R(t))}function T(t){if(!_(t))throw new Error("Uint8Array expected");return C(R(Uint8Array.from(t).reverse()))}function N(t,e){return U(t.toString(16).padStart(2*e,"0"))}function L(t,e){return N(t,e).reverse()}function B(t,e,n){let r;if("string"==typeof e)try{r=U(e)}catch(n){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${n}`)}else{if(!_(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const s=r.length;if("number"==typeof n&&s!==n)throw new Error(`${t} expected ${n} bytes, got ${s}`);return r}function P(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!_(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}const O=t=>(x<<BigInt(t-1))-A,F=t=>new Uint8Array(t),$=t=>Uint8Array.from(t);function M(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=F(t),s=F(t),i=0;const o=()=>{r.fill(1),s.fill(0),i=0},a=(...t)=>n(s,r,...t),c=(t=F())=>{s=a($([0]),t),r=a(),0!==t.length&&(s=a($([1]),t),r=a())},h=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return P(...n)};return(t,e)=>{let n;for(o(),c(t);!(n=e(h()));)c();return o(),n}}const D={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function q(t,e,n={}){const r=(e,n,r)=>{const s=D[n];if("function"!=typeof s)throw new Error(`Invalid validator "${n}", expected function`);const i=t[e];if(!(r&&void 0===i||s(i,t)))throw new Error(`Invalid param ${String(e)}=${i} (${typeof i}), expected ${n}`)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}const z=BigInt(0),H=BigInt(1),V=BigInt(2),j=BigInt(3),K=BigInt(4),W=BigInt(5),Z=BigInt(8);BigInt(9),BigInt(16);function J(t,e){const n=t%e;return n>=z?n:e+n}function Y(t,e,n){if(n<=z||e<z)throw new Error("Expected power/modulo > 0");if(n===H)return z;let r=H;for(;e>z;)e&H&&(r=r*t%n),t=t*t%n,e>>=H;return r}function G(t,e,n){let r=t;for(;e-- >z;)r*=r,r%=n;return r}function Q(t,e){if(t===z||e<=z)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=J(t,e),r=e,s=z,i=H,o=H,a=z;for(;n!==z;){const t=r/n,e=r%n,c=s-o*t,h=i-a*t;r=n,n=e,s=o,i=a,o=c,a=h}if(r!==H)throw new Error("invert: does not exist");return J(s,e)}function X(t){if(t%K===j){const e=(t+H)/K;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%Z===W){const e=(t-W)/Z;return function(t,n){const r=t.mul(n,V),s=t.pow(r,e),i=t.mul(n,s),o=t.mul(t.mul(i,V),s),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-H)/V;let n,r,s;for(n=t-H,r=0;n%V===z;n/=V,r++);for(s=V;s<t&&Y(s,e,t)!==t-H;s++);if(1===r){const e=(t+H)/K;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+H)/V;return function(t,o){if(t.pow(o,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,s),n),h=t.pow(o,i),l=t.pow(o,n);for(;!t.eql(l,t.ONE);){if(t.eql(l,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(l);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,H<<BigInt(a-e-1));c=t.sqr(n),h=t.mul(h,n),l=t.mul(l,c),a=e}return h}}(t)}const tt=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function et(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function nt(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function rt(t){const e=nt(t);return e+Math.ceil(e/2)}class st extends f{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,i(t);const n=d(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return o(this),this.iHash.update(t),this}digestInto(t){o(this),s(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:s,blockLen:i,outputLen:o}=this;return t.finished=r,t.destroyed=s,t.blockLen=i,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const it=(t,e,n)=>new st(t,e).update(n).digest();it.create=(t,e)=>new st(t,e);const ot=BigInt(0),at=BigInt(1);function ct(t){return q(t.Fp,tt.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),q(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...et(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:ht,aT:lt}=t,ut={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=ut;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:ht(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=ut,n="string"==typeof t?lt(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||48!=n[0])throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:s,l:i}=ut._parseInt(n.subarray(2)),{d:o,l:a}=ut._parseInt(i);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,n=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},r=e(n(t.s)),s=e(n(t.r)),i=r.length/2,o=s.length/2,a=n(i),c=n(o);return`30${n(o+i+4)}02${c}${s}02${a}${r}`}},dt=BigInt(0),ft=BigInt(1),pt=(BigInt(2),BigInt(3));BigInt(4);function gt(t){const e=function(t){const e=ct(t);q(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:s}=e;if(n){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=e.toBytes||((t,e,r)=>{const s=e.toAffine();return P(Uint8Array.from([4]),n.toBytes(s.x),n.toBytes(s.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function i(t){const{a:r,b:s}=e,i=n.sqr(t),o=n.mul(i,t);return n.add(n.add(o,n.mul(t,r)),s)}if(!n.eql(n.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function o(t){return"bigint"==typeof t&&dt<t&&t<e.n}function a(t){if(!o(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:s,n:i}=e;if(n&&"bigint"!=typeof t){if(t instanceof Uint8Array&&(t=R(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let o;try{o="bigint"==typeof t?t:I(B("private key",t,r))}catch(e){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof t}`)}return s&&(o=J(o,i)),a(o),o}const h=new Map;function l(t){if(!(t instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof u)throw new Error("projective point not allowed");const s=t=>n.eql(t,n.ZERO);return s(e)&&s(r)?u.ZERO:new u(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}static fromHex(t){const e=u.fromAffine(s(B("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return u.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,h.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:r}=this.toAffine();if(!n.isValid(t)||!n.isValid(r))throw new Error("bad point: x or y not FE");const s=n.sqr(r),o=i(t);if(!n.eql(s,o))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){l(t);const{px:e,py:r,pz:s}=this,{px:i,py:o,pz:a}=t,c=n.eql(n.mul(e,a),n.mul(i,s)),h=n.eql(n.mul(r,a),n.mul(o,s));return c&&h}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,s=n.mul(r,pt),{px:i,py:o,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(i,i),f=n.mul(o,o),p=n.mul(a,a),g=n.mul(i,o);return g=n.add(g,g),l=n.mul(i,a),l=n.add(l,l),c=n.mul(t,l),h=n.mul(s,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(s,l),p=n.mul(t,p),g=n.sub(d,p),g=n.mul(t,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(o,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(t){l(t);const{px:r,py:s,pz:i}=this,{px:o,py:a,pz:c}=t;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,g=n.mul(e.b,pt);let y=n.mul(r,o),w=n.mul(s,a),b=n.mul(i,c),m=n.add(r,s),v=n.add(o,a);m=n.mul(m,v),v=n.add(y,w),m=n.sub(m,v),v=n.add(r,i);let E=n.add(o,c);return v=n.mul(v,E),E=n.add(y,b),v=n.sub(v,E),E=n.add(s,i),h=n.add(a,c),E=n.mul(E,h),h=n.add(w,b),E=n.sub(E,h),f=n.mul(p,v),h=n.mul(g,b),f=n.add(h,f),h=n.sub(w,f),f=n.add(w,f),d=n.mul(h,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),v=n.mul(g,v),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),v=n.add(v,b),y=n.mul(w,v),d=n.add(d,y),y=n.mul(E,v),h=n.mul(m,h),h=n.sub(h,y),y=n.mul(m,w),f=n.mul(E,f),f=n.add(f,y),new u(h,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(u.ZERO)}wNAF(t){return f.wNAFCached(this,h,t,(t=>{const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}))}multiplyUnsafe(t){const r=u.ZERO;if(t===dt)return r;if(a(t),t===ft)return this;const{endo:s}=e;if(!s)return f.unsafeLadder(this,t);let{k1neg:i,k1:o,k2neg:c,k2:h}=s.splitScalar(t),l=r,d=r,p=this;for(;o>dt||h>dt;)o&ft&&(l=l.add(p)),h&ft&&(d=d.add(p)),p=p.double(),o>>=ft,h>>=ft;return i&&(l=l.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,s.beta),d.py,d.pz),l.add(d)}multiply(t){a(t);let r,s,i=t;const{endo:o}=e;if(o){const{k1neg:t,k1:e,k2neg:a,k2:c}=o.splitScalar(i);let{p:h,f:l}=this.wNAF(e),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(t,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,o.beta),d.py,d.pz),r=h.add(d),s=l.add(p)}else{const{p:t,f:e}=this.wNAF(i);r=t,s=e}return u.normalizeZ([r,s])[0]}multiplyAndAddUnsafe(t,e,n){const r=u.BASE,s=(t,e)=>e!==dt&&e!==ft&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),i=s(this,e).add(s(t,n));return i.is0()?void 0:i}toAffine(t){const{px:e,py:r,pz:s}=this,i=this.is0();null==t&&(t=i?n.ONE:n.inv(s));const o=n.mul(e,t),a=n.mul(r,t),c=n.mul(s,t);if(i)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===ft)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===ft?this:n?n(u,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),r(u,this,t)}toHex(t=!0){return R(this.toRawBytes(t))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,s=e;for(;n>ot;)n&at&&(r=r.add(s)),s=s.double(),n>>=at;return r},precomputeWindow(t,e){const{windows:n,windowSize:s}=r(e),i=[];let o=t,a=o;for(let t=0;t<n;t++){a=o,i.push(a);for(let t=1;t<s;t++)a=a.add(o),i.push(a);o=a.double()}return i},wNAF(e,s,i){const{windows:o,windowSize:a}=r(e);let c=t.ZERO,h=t.BASE;const l=BigInt(2**e-1),u=2**e,d=BigInt(e);for(let t=0;t<o;t++){const e=t*a;let r=Number(i&l);i>>=d,r>a&&(r-=u,i+=at);const o=e,f=e+Math.abs(r)-1,p=t%2!=0,g=r<0;0===r?h=h.add(n(p,s[o])):c=c.add(n(g,s[f]))}return{p:c,f:h}},wNAFCached(t,e,n,r){const s=t._WINDOW_SIZE||1;let i=e.get(t);return i||(i=this.precomputeWindow(t,s),1!==s&&e.set(t,r(i))),this.wNAF(s,i,n)}}}(u,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:o}}function yt(t){const e=function(t){const e=ct(t);return q(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,s=n.BYTES+1,i=2*n.BYTES+1;function o(t){return J(t,r)}function a(t){return Q(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=gt({...e,toBytes(t,e,r){const s=e.toAffine(),i=n.toBytes(s.x),o=P;return r?o(Uint8Array.from([e.hasEvenY()?2:3]),i):o(Uint8Array.from([4]),i,n.toBytes(s.y))},fromBytes(t){const e=t.length,r=t[0],o=t.subarray(1);if(e!==s||2!==r&&3!==r){if(e===i&&4===r){return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${e} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}{const t=I(o);if(!(dt<(a=t)&&a<n.ORDER))throw new Error("Point is not on curve");const e=l(t);let s=n.sqrt(e);return!(1&~r)!==((s&ft)===ft)&&(s=n.neg(s)),{x:t,y:s}}var a}}),d=t=>R(N(t,e.nByteLength));function f(t){return t>r>>ft}const p=(t,e,n)=>I(t.slice(e,n));class g{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=B("compactSignature",t,2*n),new g(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=ut.toSig(B("DER",t));return new g(e,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r,s,recovery:i}=this,h=m(B("msgHash",t));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const l=2===i||3===i?r+e.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&i?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=o(-h*p),y=o(s*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return U(this.toDERHex())}toDERHex(){return ut.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return U(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(t){try{return h(t),!0}catch(t){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const t=rt(e.n);return function(t,e,n=!1){const r=t.length,s=nt(e),i=rt(e);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const o=J(n?I(t):T(t),e-H)+H;return n?L(o,s):N(o,s)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function w(t){const e=t instanceof Uint8Array,n="string"==typeof t,r=(e||n)&&t.length;return e?r===s||r===i:n?r===2*s||r===2*i:t instanceof c}const b=e.bits2int||function(t){const n=I(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},m=e.bits2int_modN||function(t){return o(b(t))},v=O(e.nBitLength);function E(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(dt<=t&&t<v))throw new Error(`bigint expected < 2^${e.nBitLength}`);return N(t,e.nByteLength)}function k(t,r,s=A){if(["recovered","canonical"].some((t=>t in s)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:l}=e;let{lowS:d,prehash:p,extraEntropy:y}=s;null==d&&(d=!0),t=B("msgHash",t),p&&(t=B("prehashed msgHash",i(t)));const w=m(t),v=h(r),k=[E(v),E(w)];if(null!=y){const t=!0===y?l(n.BYTES):y;k.push(B("extraEntropy",t))}const x=P(...k),_=w;return{seed:x,k2sig:function(t){const e=b(t);if(!u(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),s=o(r.x);if(s===dt)return;const i=o(n*o(_+s*v));if(i===dt)return;let h=(r.x===s?0:2)|Number(r.y&ft),l=i;return d&&f(i)&&(l=function(t){return f(t)?o(-t):t}(i),h^=1),new g(s,l,h)}}}const A={lowS:e.lowS,prehash:!1},x={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(w(t))throw new Error("first arg must be private key");if(!w(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(h(t)).toRawBytes(n)},sign:function(t,n,r=A){const{seed:s,k2sig:i}=k(t,n,r),o=e;return M(o.hash.outputLen,o.nByteLength,o.hmac)(s,i)},verify:function(t,n,r,s=x){const i=t;if(n=B("msgHash",n),r=B("publicKey",r),"strict"in s)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:l}=s;let u,d;try{if("string"==typeof i||i instanceof Uint8Array)try{u=g.fromDER(i)}catch(t){if(!(t instanceof ut.Err))throw t;u=g.fromCompact(i)}else{if("object"!=typeof i||"bigint"!=typeof i.r||"bigint"!=typeof i.s)throw new Error("PARSE");{const{r:t,s:e}=i;u=new g(t,e)}}d=c.fromHex(r)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=e.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=o(y*w),v=o(f*w),E=c.BASE.multiplyAndAddUnsafe(d,b,v)?.toAffine();return!!E&&o(E.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function wt(t){return{hash:t,hmac:(e,...n)=>it(t,e,function(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!h(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}(...n)),randomBytes:g}}const bt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),mt=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),vt=BigInt(1),Et=BigInt(2),kt=(t,e)=>(t+e/Et)/e;function At(t){const e=bt,n=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),h=t*t*t%e,l=h*h*t%e,u=G(l,n,e)*l%e,d=G(u,n,e)*l%e,f=G(d,Et,e)*h%e,p=G(f,s,e)*f%e,g=G(p,i,e)*p%e,y=G(g,a,e)*g%e,w=G(y,c,e)*y%e,b=G(w,a,e)*g%e,m=G(b,n,e)*l%e,v=G(m,o,e)*p%e,E=G(v,r,e)*h%e,k=G(E,Et,e);if(!xt.eql(xt.sqr(k),t))throw new Error("Cannot find square root");return k}const xt=function(t,e,n=!1,r={}){if(t<=z)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:s,nByteLength:i}=et(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=X(t),a=Object.freeze({ORDER:t,BITS:s,BYTES:i,MASK:O(s),ZERO:z,ONE:H,create:e=>J(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return z<=e&&e<t},is0:t=>t===z,isOdd:t=>(t&H)===H,neg:e=>J(-e,t),eql:(t,e)=>t===e,sqr:e=>J(e*e,t),add:(e,n)=>J(e+n,t),sub:(e,n)=>J(e-n,t),mul:(e,n)=>J(e*n,t),pow:(t,e)=>function(t,e,n){if(n<z)throw new Error("Expected power > 0");if(n===z)return t.ONE;if(n===H)return e;let r=t.ONE,s=e;for(;n>z;)n&H&&(r=t.mul(r,s)),s=t.sqr(s),n>>=H;return r}(a,t,e),div:(e,n)=>J(e*Q(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>Q(e,t),sqrt:r.sqrt||(t=>o(a,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,s)=>t.is0(r)?e:(n[s]=e,t.mul(e,r))),t.ONE),s=t.inv(r);return e.reduceRight(((e,r,s)=>t.is0(r)?e:(n[s]=t.mul(e,n[s]),t.mul(e,r))),s),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?L(t,i):N(t,i),fromBytes:t=>{if(t.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${t.length}`);return n?T(t):I(t)}});return Object.freeze(a)}(bt,void 0,void 0,{sqrt:At}),_t=function(t,e){const n=e=>yt({...t,...wt(e)});return Object.freeze({...n(e),create:n})}({a:BigInt(0),b:BigInt(7),Fp:xt,n:mt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=mt,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-vt*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,o=BigInt("0x100000000000000000000000000000000"),a=kt(i*t,e),c=kt(-r*t,e);let h=J(t-a*n-c*s,e),l=J(-a*r-c*i,e);const u=h>o,d=l>o;if(u&&(h=e-h),d&&(l=e-l),h>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},k),St=BigInt(0),Rt=t=>"bigint"==typeof t&&St<t&&t<bt,Ct=t=>"bigint"==typeof t&&St<t&&t<mt,Ut={};function It(t,...e){let n=Ut[t];if(void 0===n){const e=k(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=P(e,e),Ut[t]=n}return k(P(n,...e))}const Tt=t=>t.toRawBytes(!0).slice(1),Nt=t=>N(t,32),Lt=t=>J(t,bt),Bt=t=>J(t,mt),Pt=_t.ProjectivePoint,Ot=(t,e,n)=>Pt.BASE.multiplyAndAddUnsafe(t,e,n);function Ft(t){let e=_t.utils.normPrivateKeyToScalar(t),n=Pt.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Bt(-e),bytes:Tt(n)}}function $t(t){if(!Rt(t))throw new Error("bad x: need 0 < x < p");const e=Lt(t*t);let n=At(Lt(e*t+BigInt(7)));n%Et!==St&&(n=Lt(-n));const r=new Pt(t,n,vt);return r.assertValidity(),r}function Mt(...t){return Bt(I(It("BIP0340/challenge",...t)))}function Dt(t){return Ft(t).bytes}function qt(t,e,n=g(32)){const r=B("message",t),{bytes:s,scalar:i}=Ft(e),o=B("auxRand",n,32),a=Nt(i^I(It("BIP0340/aux",o))),c=It("BIP0340/nonce",a,s,r),h=Bt(I(c));if(h===St)throw new Error("sign failed: k is zero");const{bytes:l,scalar:u}=Ft(h),d=Mt(l,s,r),f=new Uint8Array(64);if(f.set(l,0),f.set(Nt(Bt(u+d*i)),32),!zt(f,r,s))throw new Error("sign: Invalid signature produced");return f}function zt(t,e,n){const r=B("signature",t,64),s=B("message",e),i=B("publicKey",n,32);try{const t=$t(I(i)),e=I(r.subarray(0,32));if(!Rt(e))return!1;const n=I(r.subarray(32,64));if(!Ct(n))return!1;const o=Mt(Nt(e),Tt(t),s),a=Ot(t,n,Bt(-o));return!(!a||!a.hasEvenY()||a.toAffine().x!==e)}catch(t){return!1}}const Ht=(()=>({getPublicKey:Dt,sign:qt,verify:zt,utils:{randomPrivateKey:_t.utils.randomPrivateKey,lift_x:$t,pointToBytes:Tt,numberToBytesBE:N,bytesToNumberBE:I,taggedHash:It,mod:J}}))(),Vt="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0,jt=t=>t instanceof Uint8Array,Kt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Wt=(t,e)=>t<<32-e|t>>>e;if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");const Zt=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Jt(t){if(!jt(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Zt[t[n]];return e}function Yt(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let e=0;e<n.length;e++){const r=2*e,s=t.slice(r,r+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[e]=i}return n}function Gt(t){if("string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),!jt(t))throw new Error("expected Uint8Array, got "+typeof t);return t}function Qt(...t){const e=new Uint8Array(t.reduce(((t,e)=>t+e.length),0));let n=0;return t.forEach((t=>{if(!jt(t))throw new Error("Uint8Array expected");e.set(t,n),n+=t.length})),e}class Xt{clone(){return this._cloneInto()}}function te(t){const e=e=>t().update(Gt(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function ee(t=32){if(Vt&&"function"==typeof Vt.getRandomValues)return Vt.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function ne(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function re(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}const se={number:ne,bool:function(t){if("boolean"!=typeof t)throw new Error(`Expected boolean, not ${t}`)},bytes:re,hash:function(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");ne(t.outputLen),ne(t.blockLen)},exists:function(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")},output:function(t,e){re(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}},ie=se;class oe extends Xt{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Kt(this.buffer)}update(t){ie.exists(this);const{view:e,buffer:n,blockLen:r}=this,s=(t=Gt(t)).length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);if(o!==r)n.set(t.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=Kt(t);for(;r<=s-i;i+=r)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){ie.exists(this),ie.output(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:s}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let t=i;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}(n,r-8,BigInt(8*this.length),s),this.process(n,0);const o=Kt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)o.setUint32(4*t,h[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:s,destroyed:i,pos:o}=this;return t.length=r,t.pos=o,t.finished=s,t.destroyed=i,r%e&&t.buffer.set(n),t}}const ae=(t,e,n)=>t&e^t&n^e&n,ce=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),he=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),le=new Uint32Array(64);class ue extends oe{constructor(){super(64,32,8,!1),this.A=0|he[0],this.B=0|he[1],this.C=0|he[2],this.D=0|he[3],this.E=0|he[4],this.F=0|he[5],this.G=0|he[6],this.H=0|he[7]}get(){const{A:t,B:e,C:n,D:r,E:s,F:i,G:o,H:a}=this;return[t,e,n,r,s,i,o,a]}set(t,e,n,r,s,i,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|s,this.F=0|i,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)le[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=le[t-15],n=le[t-2],r=Wt(e,7)^Wt(e,18)^e>>>3,s=Wt(n,17)^Wt(n,19)^n>>>10;le[t]=s+le[t-7]+r+le[t-16]|0}let{A:n,B:r,C:s,D:i,E:o,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(Wt(o,6)^Wt(o,11)^Wt(o,25))+((l=o)&a^~l&c)+ce[t]+le[t]|0,u=(Wt(n,2)^Wt(n,13)^Wt(n,22))+ae(n,r,s)|0;h=c,c=a,a=o,o=i+e|0,i=s,s=r,r=n,n=e+u|0}var l;n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,s,i,o,a,c,h)}roundClean(){le.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class de extends ue{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const fe=te((()=>new ue));te((()=>new de));function pe(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function ge(...t){const e=(t,e)=>n=>t(e(n)),n=Array.from(t).reverse().reduce(((t,n)=>t?e(t,n.encode):n.encode),void 0),r=t.reduce(((t,n)=>t?e(t,n.decode):n.decode),void 0);return{encode:n,decode:r}}function ye(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(pe(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function we(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function be(t,e="="){if(pe(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function me(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function ve(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const s=[],i=Array.from(t);for(i.forEach((t=>{if(pe(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,o=!0;for(let s=r;s<i.length;s++){const a=i[s],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");if(t=c%n,i[s]=Math.floor(c/n),!Number.isSafeInteger(i[s])||i[s]*n+t!==c)throw new Error("convertRadix: carry overflow");o&&(i[s]?o=!1:r=s)}if(s.push(t),o)break}for(let e=0;e<t.length-1&&0===t[e];e++)s.push(0);return s.reverse()}const Ee=(t,e)=>e?Ee(e,t%e):t,ke=(t,e)=>t+(e-Ee(t,e));function Ae(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(ke(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${ke(e,n)}`);let s=0,i=0;const o=2**n-1,a=[];for(const r of t){if(pe(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(s=s<<e|r,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=n;i-=n)a.push((s>>i-n&o)>>>0);s&=2**i-1}if(s=s<<n-i&o,!r&&i>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&i>0&&a.push(s>>>0),a}function xe(t){return pe(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return ve(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of strings");return Uint8Array.from(ve(e,t,256))}}}function _e(t,e=!1){if(pe(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(ke(8,t)>32||ke(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ae(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ae(n,t,8,e))}}}function Se(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}const Re=ge(_e(4),ye("0123456789ABCDEF"),we("")),Ce=ge(_e(5),ye("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),be(5),we("")),Ue=(ge(_e(5),ye("0123456789ABCDEFGHIJKLMNOPQRSTUV"),be(5),we("")),ge(_e(5),ye("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),we(""),me((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")))),ge(_e(6),ye("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),be(6),we(""))),Ie=ge(_e(6),ye("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),be(6),we("")),Te=t=>ge(xe(58),ye(t),we("")),Ne=Te("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),Le=(Te("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),Te("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz"),[0,2,3,5,6,7,9,10,11]),Be={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=Ne.encode(r).padStart(Le[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),s=Le.indexOf(r.length),i=Ne.decode(r);for(let t=0;t<i.length-s;t++)if(0!==i[t])throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(i.slice(i.length-s)))}return Uint8Array.from(e)}},Pe=ge(ye("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),we("")),Oe=[996825010,642813549,513874426,1027748829,705979059];function Fe(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<Oe.length;t++)1==(e>>t&1)&&(n^=Oe[t]);return n}function $e(t,e,n=1){const r=t.length;let s=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);s=Fe(s)^n>>5}s=Fe(s);for(let e=0;e<r;e++)s=Fe(s)^31&t.charCodeAt(e);for(let t of e)s=Fe(s)^t;for(let t=0;t<6;t++)s=Fe(s);return s^=n,Pe.encode(Ae([s%2**30],30,5,!1))}function Me(t){const e="bech32"===t?1:734539939,n=_e(5),r=n.decode,s=n.encode,i=Se(r);function o(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const s=(t=r).lastIndexOf("1");if(0===s||-1===s)throw new Error('Letter "1" must be present between prefix and data only');const i=t.slice(0,s),o=t.slice(s+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=Pe.decode(o).slice(0,-6),c=$e(i,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:i,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);const s=t.length+7+n.length;if(!1!==r&&s>r)throw new TypeError(`Length ${s} exceeds limit ${r}`);return`${t=t.toLowerCase()}1${Pe.encode(n)}${$e(t,n,e)}`},decode:o,decodeToBytes:function(t){const{prefix:e,words:n}=o(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:Se(o),fromWords:r,fromWordsUnsafe:i,toWords:s}}const De=Me("bech32"),qe=(Me("bech32m"),{encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)});ge(_e(4),ye("0123456789abcdef"),we(""),me((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})));function ze(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function He(t){if("boolean"!=typeof t)throw new Error(`boolean expected, not ${t}`)}function Ve(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function je(t,...e){if(!Ve(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Ke(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function We(t,e){je(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Ze=t=>new Uint8Array(t.buffer,t.byteOffset,t.byteLength),Je=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Ye=t=>new DataView(t.buffer,t.byteOffset,t.byteLength);if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Ge(t){if("string"==typeof t)t=function(t){if("string"!=typeof t)throw new Error("string expected, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t);else{if(!Ve(t))throw new Error("Uint8Array expected, got "+typeof t);t=t.slice()}return t}function Qe(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return 0===n}const Xe=(t,e)=>(Object.assign(e,t),e);function tn(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}const en=16,nn=new Uint8Array(16),rn=Je(nn),sn=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255;class on{constructor(t,e){this.blockLen=en,this.outputLen=en,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,je(t=Ge(t),16);const n=Ye(t);let r=n.getUint32(0,!1),s=n.getUint32(4,!1),i=n.getUint32(8,!1),o=n.getUint32(12,!1);const a=[];for(let t=0;t<128;t++)a.push({s0:sn(r),s1:sn(s),s2:sn(i),s3:sn(o)}),({s0:r,s1:s,s2:i,s3:o}={s3:(l=i)<<31|(u=o)>>>1,s2:(h=s)<<31|l>>>1,s1:(c=r)<<31|h>>>1,s0:c>>>1^225<<24&-(1&u)});var c,h,l,u;const d=(t=>t>65536?8:t>1024?4:2)(e||1024);if(![1,2,4,8].includes(d))throw new Error(`ghash: wrong window size=${d}, should be 2, 4 or 8`);this.W=d;const f=128/d,p=this.windowSize=2**d,g=[];for(let t=0;t<f;t++)for(let e=0;e<p;e++){let n=0,r=0,s=0,i=0;for(let o=0;o<d;o++){if(!(e>>>d-o-1&1))continue;const{s0:c,s1:h,s2:l,s3:u}=a[d*t+o];n^=c,r^=h,s^=l,i^=u}g.push({s0:n,s1:r,s2:s,s3:i})}this.t=g}_updateBlock(t,e,n,r){t^=this.s0,e^=this.s1,n^=this.s2,r^=this.s3;const{W:s,t:i,windowSize:o}=this;let a=0,c=0,h=0,l=0;const u=(1<<s)-1;let d=0;for(const f of[t,e,n,r])for(let t=0;t<4;t++){const e=f>>>8*t&255;for(let t=8/s-1;t>=0;t--){const n=e>>>s*t&u,{s0:r,s1:f,s2:p,s3:g}=i[d*o+n];a^=r,c^=f,h^=p,l^=g,d+=1}}this.s0=a,this.s1=c,this.s2=h,this.s3=l}update(t){t=Ge(t),Ke(this);const e=Je(t),n=Math.floor(t.length/en),r=t.length%en;for(let t=0;t<n;t++)this._updateBlock(e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]);return r&&(nn.set(t.subarray(n*en)),this._updateBlock(rn[0],rn[1],rn[2],rn[3]),rn.fill(0)),this}destroy(){const{t}=this;for(const e of t)e.s0=0,e.s1=0,e.s2=0,e.s3=0}digestInto(t){Ke(this),We(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:s}=this,i=Je(t);return i[0]=e,i[1]=n,i[2]=r,i[3]=s,t}digest(){const t=new Uint8Array(en);return this.digestInto(t),this.destroy(),t}}class an extends on{constructor(t,e){const n=function(t){t.reverse();const e=1&t[15];let n=0;for(let e=0;e<t.length;e++){const r=t[e];t[e]=r>>>1|n,n=(1&r)<<7}return t[0]^=225&-e,t}((t=Ge(t)).slice());super(n,e),n.fill(0)}update(t){t=Ge(t),Ke(this);const e=Je(t),n=t.length%en,r=Math.floor(t.length/en);for(let t=0;t<r;t++)this._updateBlock(sn(e[4*t+3]),sn(e[4*t+2]),sn(e[4*t+1]),sn(e[4*t+0]));return n&&(nn.set(t.subarray(r*en)),this._updateBlock(sn(rn[3]),sn(rn[2]),sn(rn[1]),sn(rn[0])),rn.fill(0)),this}digestInto(t){Ke(this),We(t,this),this.finished=!0;const{s0:e,s1:n,s2:r,s3:s}=this,i=Je(t);return i[0]=e,i[1]=n,i[2]=r,i[3]=s,t.reverse()}}function cn(t){const e=(e,n)=>t(n,e.length).update(Ge(e)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(e,n)=>t(e,n),e}const hn=cn(((t,e)=>new on(t,e))),ln=cn(((t,e)=>new an(t,e))),un=16,dn=new Uint8Array(un),fn=283;function pn(t){return t<<1^fn&-(t>>7)}function gn(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(1&e),t=pn(t);return n}const yn=(()=>{let t=new Uint8Array(256);for(let e=0,n=1;e<256;e++,n^=pn(n))t[e]=n;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=255&(r^r>>4^r>>5^r>>6^r>>7^99)}return e})(),wn=yn.map(((t,e)=>yn.indexOf(e))),bn=t=>t<<24|t>>>8,mn=t=>t<<8|t>>>24;function vn(t,e){if(256!==t.length)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map(((n,r)=>e(t[r]))),r=n.map(mn),s=r.map(mn),i=s.map(mn),o=new Uint32Array(65536),a=new Uint32Array(65536),c=new Uint16Array(65536);for(let e=0;e<256;e++)for(let h=0;h<256;h++){const l=256*e+h;o[l]=n[e]^r[h],a[l]=s[e]^i[h],c[l]=t[e]<<8|t[h]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:s,T3:i,T01:o,T23:a}}const En=vn(yn,(t=>gn(t,3)<<24|t<<16|t<<8|gn(t,2))),kn=vn(wn,(t=>gn(t,11)<<24|gn(t,13)<<16|gn(t,9)<<8|gn(t,14))),An=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=pn(n))t[e]=n;return t})();function xn(t){je(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=En,r=Je(t),s=r.length,i=t=>Rn(n,t,t,t,t),o=new Uint32Array(e+28);o.set(r);for(let t=s;t<o.length;t++){let e=o[t-1];t%s==0?e=i(bn(e))^An[t/s-1]:s>6&&t%s==4&&(e=i(e)),o[t]=o[t-s]^e}return o}function _n(t){const e=xn(t),n=e.slice(),r=e.length,{sbox2:s}=En,{T0:i,T1:o,T2:a,T3:c}=kn;for(let t=0;t<r;t+=4)for(let s=0;s<4;s++)n[t+s]=e[r-t-4+s];e.fill(0);for(let t=4;t<r-4;t++){const e=n[t],r=Rn(s,e,e,e,e);n[t]=i[255&r]^o[r>>>8&255]^a[r>>>16&255]^c[r>>>24]}return n}function Sn(t,e,n,r,s,i){return t[n<<8&65280|r>>>8&255]^e[s>>>8&65280|i>>>24&255]}function Rn(t,e,n,r,s){return t[255&e|65280&n]|t[r>>>16&255|s>>>16&65280]<<16}function Cn(t,e,n,r,s){const{sbox2:i,T01:o,T23:a}=En;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],s^=t[c++];const h=t.length/4-2;for(let i=0;i<h;i++){const i=t[c++]^Sn(o,a,e,n,r,s),h=t[c++]^Sn(o,a,n,r,s,e),l=t[c++]^Sn(o,a,r,s,e,n),u=t[c++]^Sn(o,a,s,e,n,r);e=i,n=h,r=l,s=u}return{s0:t[c++]^Rn(i,e,n,r,s),s1:t[c++]^Rn(i,n,r,s,e),s2:t[c++]^Rn(i,r,s,e,n),s3:t[c++]^Rn(i,s,e,n,r)}}function Un(t,e,n,r,s){const{sbox2:i,T01:o,T23:a}=kn;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],s^=t[c++];const h=t.length/4-2;for(let i=0;i<h;i++){const i=t[c++]^Sn(o,a,e,s,r,n),h=t[c++]^Sn(o,a,n,e,s,r),l=t[c++]^Sn(o,a,r,n,e,s),u=t[c++]^Sn(o,a,s,r,n,e);e=i,n=h,r=l,s=u}return{s0:t[c++]^Rn(i,e,s,r,n),s1:t[c++]^Rn(i,n,e,s,r),s2:t[c++]^Rn(i,r,n,e,s),s3:t[c++]^Rn(i,s,r,n,e)}}function In(t,e){if(!e)return new Uint8Array(t);if(je(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function Tn(t,e,n,r){je(e,un),je(n);const s=n.length;r=In(s,r);const i=e,o=Je(i);let{s0:a,s1:c,s2:h,s3:l}=Cn(t,o[0],o[1],o[2],o[3]);const u=Je(n),d=Je(r);for(let e=0;e+4<=u.length;e+=4){d[e+0]=u[e+0]^a,d[e+1]=u[e+1]^c,d[e+2]=u[e+2]^h,d[e+3]=u[e+3]^l;let n=1;for(let t=i.length-1;t>=0;t--)n=n+(255&i[t])|0,i[t]=255&n,n>>>=8;({s0:a,s1:c,s2:h,s3:l}=Cn(t,o[0],o[1],o[2],o[3]))}const f=un*Math.floor(u.length/4);if(f<s){const t=new Uint32Array([a,c,h,l]),e=Ze(t);for(let t=f,i=0;t<s;t++,i++)r[t]=n[t]^e[i]}return r}function Nn(t,e,n,r,s){je(n,un),je(r),s=In(r.length,s);const i=n,o=Je(i),a=Ye(i),c=Je(r),h=Je(s),l=e?0:12,u=r.length;let d=a.getUint32(l,e),{s0:f,s1:p,s2:g,s3:y}=Cn(t,o[0],o[1],o[2],o[3]);for(let n=0;n+4<=c.length;n+=4)h[n+0]=c[n+0]^f,h[n+1]=c[n+1]^p,h[n+2]=c[n+2]^g,h[n+3]=c[n+3]^y,d=d+1>>>0,a.setUint32(l,d,e),({s0:f,s1:p,s2:g,s3:y}=Cn(t,o[0],o[1],o[2],o[3]));const w=un*Math.floor(c.length/4);if(w<u){const t=new Uint32Array([f,p,g,y]),e=Ze(t);for(let t=w,n=0;t<u;t++,n++)s[t]=r[t]^e[n]}return s}Xe({blockSize:16,nonceLength:16},(function(t,e){function n(n,r){const s=xn(t),i=e.slice(),o=Tn(s,i,n,r);return s.fill(0),i.fill(0),o}return je(t),je(e,un),{encrypt:(t,e)=>n(t,e),decrypt:(t,e)=>n(t,e)}}));function Ln(t){if(je(t),t.length%un!=0)throw new Error("aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size 16")}function Bn(t,e,n){let r=t.length;const s=r%un;if(!e&&0!==s)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const i=Je(t);if(e){let t=un-s;t||(t=un),r+=t}const o=In(r,n);return{b:i,o:Je(o),out:o}}function Pn(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const s=t.subarray(0,-r);for(let e=0;e<r;e++)if(t[n-e-1]!==r)throw new Error("aes/pcks5: wrong padding");return s}function On(t){const e=new Uint8Array(16),n=Je(e);e.set(t);const r=un-t.length;for(let t=un-r;t<un;t++)e[t]=r;return n}Xe({blockSize:16},(function(t,e={}){je(t);const n=!e.disablePadding;return{encrypt:(e,r)=>{je(e);const{b:s,o:i,out:o}=Bn(e,n,r),a=xn(t);let c=0;for(;c+4<=s.length;){const{s0:t,s1:e,s2:n,s3:r}=Cn(a,s[c+0],s[c+1],s[c+2],s[c+3]);i[c++]=t,i[c++]=e,i[c++]=n,i[c++]=r}if(n){const t=On(e.subarray(4*c)),{s0:n,s1:r,s2:s,s3:o}=Cn(a,t[0],t[1],t[2],t[3]);i[c++]=n,i[c++]=r,i[c++]=s,i[c++]=o}return a.fill(0),o},decrypt:(e,r)=>{Ln(e);const s=_n(t),i=In(e.length,r),o=Je(e),a=Je(i);for(let t=0;t+4<=o.length;){const{s0:e,s1:n,s2:r,s3:i}=Un(s,o[t+0],o[t+1],o[t+2],o[t+3]);a[t++]=e,a[t++]=n,a[t++]=r,a[t++]=i}return s.fill(0),Pn(i,n)}}}));const Fn=Xe({blockSize:16,nonceLength:16},(function(t,e,n={}){je(t),je(e,16);const r=!n.disablePadding;return{encrypt:(n,s)=>{const i=xn(t),{b:o,o:a,out:c}=Bn(n,r,s),h=Je(e);let l=h[0],u=h[1],d=h[2],f=h[3],p=0;for(;p+4<=o.length;)l^=o[p+0],u^=o[p+1],d^=o[p+2],f^=o[p+3],({s0:l,s1:u,s2:d,s3:f}=Cn(i,l,u,d,f)),a[p++]=l,a[p++]=u,a[p++]=d,a[p++]=f;if(r){const t=On(n.subarray(4*p));l^=t[0],u^=t[1],d^=t[2],f^=t[3],({s0:l,s1:u,s2:d,s3:f}=Cn(i,l,u,d,f)),a[p++]=l,a[p++]=u,a[p++]=d,a[p++]=f}return i.fill(0),c},decrypt:(n,s)=>{Ln(n);const i=_n(t),o=Je(e),a=In(n.length,s),c=Je(n),h=Je(a);let l=o[0],u=o[1],d=o[2],f=o[3];for(let t=0;t+4<=c.length;){const e=l,n=u,r=d,s=f;l=c[t+0],u=c[t+1],d=c[t+2],f=c[t+3];const{s0:o,s1:a,s2:p,s3:g}=Un(i,l,u,d,f);h[t++]=o^e,h[t++]=a^n,h[t++]=p^r,h[t++]=g^s}return i.fill(0),Pn(a,r)}}}));Xe({blockSize:16,nonceLength:16},(function(t,e){function n(n,r,s){const i=xn(t),o=n.length;s=In(o,s);const a=Je(n),c=Je(s),h=r?c:a,l=Je(e);let u=l[0],d=l[1],f=l[2],p=l[3];for(let t=0;t+4<=a.length;){const{s0:e,s1:n,s2:r,s3:s}=Cn(i,u,d,f,p);c[t+0]=a[t+0]^e,c[t+1]=a[t+1]^n,c[t+2]=a[t+2]^r,c[t+3]=a[t+3]^s,u=h[t++],d=h[t++],f=h[t++],p=h[t++]}const g=un*Math.floor(a.length/4);if(g<o){({s0:u,s1:d,s2:f,s3:p}=Cn(i,u,d,f,p));const t=Ze(new Uint32Array([u,d,f,p]));for(let e=g,r=0;e<o;e++,r++)s[e]=n[e]^t[r];t.fill(0)}return i.fill(0),s}return je(t),je(e,16),{encrypt:(t,e)=>n(t,!0,e),decrypt:(t,e)=>n(t,!1,e)}}));function $n(t,e,n,r,s){const i=t.create(n,r.length+(s?.length||0));s&&i.update(s),i.update(r);const o=new Uint8Array(16),a=Ye(o);return s&&tn(a,0,BigInt(8*s.length),e),tn(a,8,BigInt(8*r.length),e),i.update(o),i.digest()}Xe({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){if(je(e),0===e.length)throw new Error("aes/gcm: empty nonce");const r=16;function s(t,e,r){const s=$n(hn,!1,t,r,n);for(let t=0;t<e.length;t++)s[t]^=e[t];return s}function i(){const n=xn(t),r=dn.slice(),s=dn.slice();if(Nn(n,!1,s,s,r),12===e.length)s.set(e);else{const t=dn.slice();tn(Ye(t),8,BigInt(8*e.length),!1),hn.create(r).update(e).update(t).digestInto(s)}return{xk:n,authKey:r,counter:s,tagMask:Nn(n,!1,s,dn)}}return{encrypt:t=>{je(t);const{xk:e,authKey:n,counter:o,tagMask:a}=i(),c=new Uint8Array(t.length+r);Nn(e,!1,o,t,c);const h=s(n,a,c.subarray(0,c.length-r));return c.set(h,t.length),e.fill(0),c},decrypt:t=>{if(je(t),t.length<r)throw new Error("aes/gcm: ciphertext less than tagLen (16)");const{xk:e,authKey:n,counter:o,tagMask:a}=i(),c=t.subarray(0,-16),h=t.subarray(-16);if(!Qe(s(n,a,c),h))throw new Error("aes/gcm: invalid ghash tag");const l=Nn(e,!1,o,c);return n.fill(0),a.fill(0),e.fill(0),l}}}));const Mn=(t,e,n)=>r=>{if(!Number.isSafeInteger(r)||e>r||r>n)throw new Error(`${t}: invalid value=${r}, must be [${e}..${n}]`)};Xe({blockSize:16,nonceLength:12,tagLength:16},(function(t,e,n){const r=Mn("AAD",0,2**36),s=Mn("plaintext",0,2**36),i=Mn("nonce",12,12),o=Mn("ciphertext",16,2**36+16);function a(){const n=t.length;if(16!==n&&24!==n&&32!==n)throw new Error(`key length must be 16, 24 or 32 bytes, got: ${n} bytes`);const r=xn(t),s=new Uint8Array(n),i=new Uint8Array(16),o=Je(e);let a=0,c=o[0],h=o[1],l=o[2],u=0;for(const t of[i,s].map(Je)){const e=Je(t);for(let t=0;t<e.length;t+=2){const{s0:n,s1:s}=Cn(r,a,c,h,l);e[t+0]=n,e[t+1]=s,a=++u}}return r.fill(0),{authKey:i,encKey:xn(s)}}function c(t,r,s){const i=$n(ln,!0,r,s,n);for(let t=0;t<12;t++)i[t]^=e[t];i[15]&=127;const o=Je(i);let a=o[0],c=o[1],h=o[2],l=o[3];return({s0:a,s1:c,s2:h,s3:l}=Cn(t,a,c,h,l)),o[0]=a,o[1]=c,o[2]=h,o[3]=l,i}function h(t,e,n){let r=e.slice();return r[15]|=128,Nn(t,!0,r,n)}return je(e),i(e.length),n&&(je(n),r(n.length)),{encrypt:t=>{je(t),s(t.length);const{encKey:e,authKey:n}=a(),r=c(e,n,t),i=new Uint8Array(t.length+16);return i.set(r,t.length),i.set(h(e,r,t)),e.fill(0),n.fill(0),i},decrypt:t=>{je(t),o(t.length);const e=t.subarray(-16),{encKey:n,authKey:r}=a(),s=h(n,e,t.subarray(0,-16)),i=c(n,r,s);if(n.fill(0),r.fill(0),!Qe(e,i))throw new Error("invalid polyval tag");return s}}}));const Dn=(t,e)=>255&t[e++]|(255&t[e++])<<8;class qn{constructor(t){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,je(t=Ge(t),32);const e=Dn(t,0),n=Dn(t,2),r=Dn(t,4),s=Dn(t,6),i=Dn(t,8),o=Dn(t,10),a=Dn(t,12),c=Dn(t,14);this.r[0]=8191&e,this.r[1]=8191&(e>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|s<<9),this.r[4]=255&(s>>>4|i<<12),this.r[5]=i>>>1&8190,this.r[6]=8191&(i>>>14|o<<2),this.r[7]=8065&(o>>>11|a<<5),this.r[8]=8191&(a>>>8|c<<8),this.r[9]=c>>>5&127;for(let e=0;e<8;e++)this.pad[e]=Dn(t,16+2*e)}process(t,e,n=!1){const r=n?0:2048,{h:s,r:i}=this,o=i[0],a=i[1],c=i[2],h=i[3],l=i[4],u=i[5],d=i[6],f=i[7],p=i[8],g=i[9],y=Dn(t,e+0),w=Dn(t,e+2),b=Dn(t,e+4),m=Dn(t,e+6),v=Dn(t,e+8),E=Dn(t,e+10),k=Dn(t,e+12),A=Dn(t,e+14);let x=s[0]+(8191&y),_=s[1]+(8191&(y>>>13|w<<3)),S=s[2]+(8191&(w>>>10|b<<6)),R=s[3]+(8191&(b>>>7|m<<9)),C=s[4]+(8191&(m>>>4|v<<12)),U=s[5]+(v>>>1&8191),I=s[6]+(8191&(v>>>14|E<<2)),T=s[7]+(8191&(E>>>11|k<<5)),N=s[8]+(8191&(k>>>8|A<<8)),L=s[9]+(A>>>5|r),B=0,P=B+x*o+_*(5*g)+S*(5*p)+R*(5*f)+C*(5*d);B=P>>>13,P&=8191,P+=U*(5*u)+I*(5*l)+T*(5*h)+N*(5*c)+L*(5*a),B+=P>>>13,P&=8191;let O=B+x*a+_*o+S*(5*g)+R*(5*p)+C*(5*f);B=O>>>13,O&=8191,O+=U*(5*d)+I*(5*u)+T*(5*l)+N*(5*h)+L*(5*c),B+=O>>>13,O&=8191;let F=B+x*c+_*a+S*o+R*(5*g)+C*(5*p);B=F>>>13,F&=8191,F+=U*(5*f)+I*(5*d)+T*(5*u)+N*(5*l)+L*(5*h),B+=F>>>13,F&=8191;let $=B+x*h+_*c+S*a+R*o+C*(5*g);B=$>>>13,$&=8191,$+=U*(5*p)+I*(5*f)+T*(5*d)+N*(5*u)+L*(5*l),B+=$>>>13,$&=8191;let M=B+x*l+_*h+S*c+R*a+C*o;B=M>>>13,M&=8191,M+=U*(5*g)+I*(5*p)+T*(5*f)+N*(5*d)+L*(5*u),B+=M>>>13,M&=8191;let D=B+x*u+_*l+S*h+R*c+C*a;B=D>>>13,D&=8191,D+=U*o+I*(5*g)+T*(5*p)+N*(5*f)+L*(5*d),B+=D>>>13,D&=8191;let q=B+x*d+_*u+S*l+R*h+C*c;B=q>>>13,q&=8191,q+=U*a+I*o+T*(5*g)+N*(5*p)+L*(5*f),B+=q>>>13,q&=8191;let z=B+x*f+_*d+S*u+R*l+C*h;B=z>>>13,z&=8191,z+=U*c+I*a+T*o+N*(5*g)+L*(5*p),B+=z>>>13,z&=8191;let H=B+x*p+_*f+S*d+R*u+C*l;B=H>>>13,H&=8191,H+=U*h+I*c+T*a+N*o+L*(5*g),B+=H>>>13,H&=8191;let V=B+x*g+_*p+S*f+R*d+C*u;B=V>>>13,V&=8191,V+=U*l+I*h+T*c+N*a+L*o,B+=V>>>13,V&=8191,B=(B<<2)+B|0,B=B+P|0,P=8191&B,B>>>=13,O+=B,s[0]=P,s[1]=O,s[2]=F,s[3]=$,s[4]=M,s[5]=D,s[6]=q,s[7]=z,s[8]=H,s[9]=V}finalize(){const{h:t,pad:e}=this,n=new Uint16Array(10);let r=t[1]>>>13;t[1]&=8191;for(let e=2;e<10;e++)t[e]+=r,r=t[e]>>>13,t[e]&=8191;t[0]+=5*r,r=t[0]>>>13,t[0]&=8191,t[1]+=r,r=t[1]>>>13,t[1]&=8191,t[2]+=r,n[0]=t[0]+5,r=n[0]>>>13,n[0]&=8191;for(let e=1;e<10;e++)n[e]=t[e]+r,r=n[e]>>>13,n[e]&=8191;n[9]-=8192;let s=(1^r)-1;for(let t=0;t<10;t++)n[t]&=s;s=~s;for(let e=0;e<10;e++)t[e]=t[e]&s|n[e];t[0]=65535&(t[0]|t[1]<<13),t[1]=65535&(t[1]>>>3|t[2]<<10),t[2]=65535&(t[2]>>>6|t[3]<<7),t[3]=65535&(t[3]>>>9|t[4]<<4),t[4]=65535&(t[4]>>>12|t[5]<<1|t[6]<<14),t[5]=65535&(t[6]>>>2|t[7]<<11),t[6]=65535&(t[7]>>>5|t[8]<<8),t[7]=65535&(t[8]>>>8|t[9]<<5);let i=t[0]+e[0];t[0]=65535&i;for(let n=1;n<8;n++)i=(t[n]+e[n]|0)+(i>>>16)|0,t[n]=65535&i}update(t){Ke(this);const{buffer:e,blockLen:n}=this,r=(t=Ge(t)).length;for(let s=0;s<r;){const i=Math.min(n-this.pos,r-s);if(i!==n)e.set(t.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===n&&(this.process(e,0,!1),this.pos=0);else for(;n<=r-s;s+=n)this.process(t,s)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(t){Ke(this),We(t,this),this.finished=!0;const{buffer:e,h:n}=this;let{pos:r}=this;if(r){for(e[r++]=1;r<16;r++)e[r]=0;this.process(e,0,!0)}this.finalize();let s=0;for(let e=0;e<8;e++)t[s++]=n[e]>>>0,t[s++]=n[e]>>>8;return t}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}}const zn=function(t){const e=(e,n)=>t(n).update(Ge(e)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=e=>t(e),e}((t=>new qn(t))),Hn=t=>Uint8Array.from(t.split("").map((t=>t.charCodeAt(0)))),Vn=Hn("expand 16-byte k"),jn=Hn("expand 32-byte k"),Kn=Je(Vn),Wn=Je(jn);Wn.slice();function Zn(t,e){return t<<e|t>>>32-e}function Jn(t){return t.byteOffset%4==0}const Yn=64,Gn=16,Qn=2**32-1,Xn=new Uint32Array;function tr(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:s,counterRight:i,rounds:o}=function(t,e){if(null==e||"object"!=typeof e)throw new Error("options must be defined");return Object.assign(t,e)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if("function"!=typeof t)throw new Error("core must be a function");return ze(s),ze(o),He(i),He(n),(e,a,c,h,l=0)=>{je(e),je(a),je(c);const u=c.length;if(h||(h=new Uint8Array(u)),je(h),ze(l),l<0||l>=Qn)throw new Error("arx: counter overflow");if(h.length<u)throw new Error(`arx: output (${h.length}) is shorter than data (${u})`);const d=[];let f,p,g=e.length;if(32===g)f=e.slice(),d.push(f),p=Wn;else{if(16!==g||!n)throw new Error(`arx: invalid 32-byte key, got length=${g}`);f=new Uint8Array(32),f.set(e),f.set(e,16),p=Kn,d.push(f)}Jn(a)||(a=a.slice(),d.push(a));const y=Je(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,Je(a.subarray(0,16)),y),a=a.subarray(16)}const w=16-s;if(w!==a.length)throw new Error(`arx: nonce must be ${w} or 16 bytes`);if(12!==w){const t=new Uint8Array(12);t.set(a,i?0:12-a.length),a=t,d.push(a)}const b=Je(a);for(!function(t,e,n,r,s,i,o,a){const c=s.length,h=new Uint8Array(Yn),l=Je(h),u=Jn(s)&&Jn(i),d=u?Je(s):Xn,f=u?Je(i):Xn;for(let p=0;p<c;o++){if(t(e,n,r,l,o,a),o>=Qn)throw new Error("arx: counter overflow");const g=Math.min(Yn,c-p);if(u&&g===Yn){const t=p/4;if(p%4!=0)throw new Error("arx: invalid block position");for(let e,n=0;n<Gn;n++)e=t+n,f[e]=d[e]^l[n];p+=Yn}else{for(let t,e=0;e<g;e++)t=p+e,i[t]=s[t]^h[e];p+=g}}}(t,p,y,b,c,h,l,o);d.length>0;)d.pop().fill(0);return h}}function er(t,e,n,r,s,i=20){let o=t[0],a=t[1],c=t[2],h=t[3],l=e[0],u=e[1],d=e[2],f=e[3],p=e[4],g=e[5],y=e[6],w=e[7],b=s,m=n[0],v=n[1],E=n[2],k=o,A=a,x=c,_=h,S=l,R=u,C=d,U=f,I=p,T=g,N=y,L=w,B=b,P=m,O=v,F=E;for(let t=0;t<i;t+=2)k=k+S|0,B=Zn(B^k,16),I=I+B|0,S=Zn(S^I,12),k=k+S|0,B=Zn(B^k,8),I=I+B|0,S=Zn(S^I,7),A=A+R|0,P=Zn(P^A,16),T=T+P|0,R=Zn(R^T,12),A=A+R|0,P=Zn(P^A,8),T=T+P|0,R=Zn(R^T,7),x=x+C|0,O=Zn(O^x,16),N=N+O|0,C=Zn(C^N,12),x=x+C|0,O=Zn(O^x,8),N=N+O|0,C=Zn(C^N,7),_=_+U|0,F=Zn(F^_,16),L=L+F|0,U=Zn(U^L,12),_=_+U|0,F=Zn(F^_,8),L=L+F|0,U=Zn(U^L,7),k=k+R|0,F=Zn(F^k,16),N=N+F|0,R=Zn(R^N,12),k=k+R|0,F=Zn(F^k,8),N=N+F|0,R=Zn(R^N,7),A=A+C|0,B=Zn(B^A,16),L=L+B|0,C=Zn(C^L,12),A=A+C|0,B=Zn(B^A,8),L=L+B|0,C=Zn(C^L,7),x=x+U|0,P=Zn(P^x,16),I=I+P|0,U=Zn(U^I,12),x=x+U|0,P=Zn(P^x,8),I=I+P|0,U=Zn(U^I,7),_=_+S|0,O=Zn(O^_,16),T=T+O|0,S=Zn(S^T,12),_=_+S|0,O=Zn(O^_,8),T=T+O|0,S=Zn(S^T,7);let $=0;r[$++]=o+k|0,r[$++]=a+A|0,r[$++]=c+x|0,r[$++]=h+_|0,r[$++]=l+S|0,r[$++]=u+R|0,r[$++]=d+C|0,r[$++]=f+U|0,r[$++]=p+I|0,r[$++]=g+T|0,r[$++]=y+N|0,r[$++]=w+L|0,r[$++]=b+B|0,r[$++]=m+P|0,r[$++]=v+O|0,r[$++]=E+F|0}const nr=tr(er,{counterRight:!1,counterLength:4,allowShortKeys:!1}),rr=tr(er,{counterRight:!1,counterLength:8,extendNonceFn:function(t,e,n,r){let s=t[0],i=t[1],o=t[2],a=t[3],c=e[0],h=e[1],l=e[2],u=e[3],d=e[4],f=e[5],p=e[6],g=e[7],y=n[0],w=n[1],b=n[2],m=n[3];for(let t=0;t<20;t+=2)s=s+c|0,y=Zn(y^s,16),d=d+y|0,c=Zn(c^d,12),s=s+c|0,y=Zn(y^s,8),d=d+y|0,c=Zn(c^d,7),i=i+h|0,w=Zn(w^i,16),f=f+w|0,h=Zn(h^f,12),i=i+h|0,w=Zn(w^i,8),f=f+w|0,h=Zn(h^f,7),o=o+l|0,b=Zn(b^o,16),p=p+b|0,l=Zn(l^p,12),o=o+l|0,b=Zn(b^o,8),p=p+b|0,l=Zn(l^p,7),a=a+u|0,m=Zn(m^a,16),g=g+m|0,u=Zn(u^g,12),a=a+u|0,m=Zn(m^a,8),g=g+m|0,u=Zn(u^g,7),s=s+h|0,m=Zn(m^s,16),p=p+m|0,h=Zn(h^p,12),s=s+h|0,m=Zn(m^s,8),p=p+m|0,h=Zn(h^p,7),i=i+l|0,y=Zn(y^i,16),g=g+y|0,l=Zn(l^g,12),i=i+l|0,y=Zn(y^i,8),g=g+y|0,l=Zn(l^g,7),o=o+u|0,w=Zn(w^o,16),d=d+w|0,u=Zn(u^d,12),o=o+u|0,w=Zn(w^o,8),d=d+w|0,u=Zn(u^d,7),a=a+c|0,b=Zn(b^a,16),f=f+b|0,c=Zn(c^f,12),a=a+c|0,b=Zn(b^a,8),f=f+b|0,c=Zn(c^f,7);let v=0;r[v++]=s,r[v++]=i,r[v++]=o,r[v++]=a,r[v++]=y,r[v++]=w,r[v++]=b,r[v++]=m},allowShortKeys:!1}),sr=new Uint8Array(16),ir=(t,e)=>{t.update(e);const n=e.length%16;n&&t.update(sr.subarray(n))},or=new Uint8Array(32);function ar(t,e,n,r,s){const i=t(e,n,or),o=zn.create(i);s&&ir(o,s),ir(o,r);const a=new Uint8Array(16),c=Ye(a);tn(c,0,BigInt(s?s.length:0),!0),tn(c,8,BigInt(r.length),!0),o.update(a);const h=o.digest();return i.fill(0),h}const cr=t=>(e,n,r)=>{const s=16;return je(e,32),je(n),{encrypt:(i,o)=>{const a=i.length,c=a+s;o?je(o,c):o=new Uint8Array(c),t(e,n,i,o,1);const h=ar(t,e,n,o.subarray(0,-16),r);return o.set(h,a),o},decrypt:(i,o)=>{const a=i.length,c=a-s;if(a<s)throw new Error("encrypted data must be at least 16 bytes");o?je(o,c):o=new Uint8Array(c);const h=i.subarray(0,-16);if(!Qe(i.subarray(-16),ar(t,e,n,h,r)))throw new Error("invalid tag");return t(e,n,h,o,1),o}}};cr(nr),cr(rr);class hr extends Xt{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,ie.hash(t);const n=Gt(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return ie.exists(this),this.iHash.update(t),this}digestInto(t){ie.exists(this),ie.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:s,blockLen:i,outputLen:o}=this;return t.finished=r,t.destroyed=s,t.blockLen=i,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const lr=(t,e,n)=>new hr(t,e).update(n).digest();function ur(t,e,n){return ie.hash(t),void 0===n&&(n=new Uint8Array(t.outputLen)),lr(t,Gt(n),Gt(e))}lr.create=(t,e)=>new hr(t,e);const dr=new Uint8Array([0]),fr=new Uint8Array;function pr(t,e,n,r=32){if(ie.hash(t),ie.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(r/t.outputLen);void 0===n&&(n=fr);const i=new Uint8Array(s*t.outputLen),o=lr.create(t,e),a=o._cloneInto(),c=new Uint8Array(o.outputLen);for(let e=0;e<s;e++)dr[0]=e+1,a.update(0===e?fr:c).update(n).update(dr).digestInto(c),i.set(c,t.outputLen*e),o._cloneInto(a);return o.destroy(),a.destroy(),c.fill(0),dr.fill(0),i.slice(0,r)}var gr=Object.defineProperty,yr=(t,e)=>{for(var n in e)gr(t,n,{get:e[n],enumerable:!0})},wr=Symbol("verified"),br=t=>t instanceof Object;function mr(t){if(!br(t))return!1;if("number"!=typeof t.kind)return!1;if("string"!=typeof t.content)return!1;if("number"!=typeof t.created_at)return!1;if("string"!=typeof t.pubkey)return!1;if(!t.pubkey.match(/^[a-f0-9]{64}$/))return!1;if(!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let t=0;t<n.length;t++)if("object"==typeof n[t])return!1}return!0}yr({},{Queue:()=>Rr,QueueNode:()=>Sr,binarySearch:()=>_r,insertEventIntoAscendingList:()=>xr,insertEventIntoDescendingList:()=>Ar,normalizeURL:()=>kr,utf8Decoder:()=>vr,utf8Encoder:()=>Er});var vr=new TextDecoder("utf-8"),Er=new TextEncoder;function kr(t){-1===t.indexOf("://")&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),("80"===e.port&&"ws:"===e.protocol||"443"===e.port&&"wss:"===e.protocol)&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function Ar(t,e){const[n,r]=_r(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:t.created_at-e.created_at));return r||t.splice(n,0,e),t}function xr(t,e){const[n,r]=_r(t,(t=>e.id===t.id?0:e.created_at===t.created_at?-1:e.created_at-t.created_at));return r||t.splice(n,0,e),t}function _r(t,e){let n=0,r=t.length-1;for(;n<=r;){const s=Math.floor((n+r)/2),i=e(t[s]);if(0===i)return[s,!0];i<0?r=s-1:n=s+1}return[n,!1]}var Sr=class{value;next=null;prev=null;constructor(t){this.value=t}},Rr=class{first;last;constructor(){this.first=null,this.last=null}enqueue(t){const e=new Sr(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const t=this.first;return this.first=t.next,t.value}};function Cr(t){return Jt(fe(Er.encode(function(t){if(!mr(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}(t))))}var Ur=new class{generateSecretKey(){return Ht.utils.randomPrivateKey()}getPublicKey(t){return Jt(Ht.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=Jt(Ht.getPublicKey(e)),n.id=Cr(n),n.sig=Jt(Ht.sign(Cr(n),e)),n[wr]=!0,n}verifyEvent(t){if("boolean"==typeof t[wr])return t[wr];const e=Cr(t);if(e!==t.id)return t[wr]=!1,!1;try{const n=Ht.verify(t.sig,e,t.pubkey);return t[wr]=n,n}catch(e){return t[wr]=!1,!1}}},Ir=Ur.generateSecretKey,Tr=Ur.getPublicKey,Nr=Ur.finalizeEvent,Lr=Ur.verifyEvent;function Br(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function Pr(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function Or(t){return 2e4<=t&&t<3e4}function Fr(t){return 3e4<=t&&t<4e4}function $r(t){return Br(t)?"regular":Pr(t)?"replaceable":Or(t)?"ephemeral":Fr(t)?"parameterized":"unknown"}yr({},{Application:()=>Ws,BadgeAward:()=>Zr,BadgeDefinition:()=>Ds,BlockedRelaysList:()=>ks,BookmarkList:()=>ms,Bookmarksets:()=>Fs,Calendar:()=>ti,CalendarEventRSVP:()=>ei,ChannelCreation:()=>Yr,ChannelHideMessage:()=>Xr,ChannelMessage:()=>Qr,ChannelMetadata:()=>Gr,ChannelMuteUser:()=>ts,ClassifiedListing:()=>Ys,ClientAuth:()=>Us,CommunitiesList:()=>vs,CommunityDefinition:()=>si,CommunityPostApproval:()=>cs,Contacts:()=>zr,CreateOrUpdateProduct:()=>Hs,CreateOrUpdateStall:()=>zs,Curationsets:()=>$s,Date:()=>Qs,DraftClassifiedListing:()=>Gs,DraftLong:()=>js,Emojisets:()=>Ks,EncryptedDirectMessage:()=>Hr,EncryptedDirectMessages:()=>Vr,EventDeletion:()=>jr,FileMetadata:()=>ns,FileServerPreference:()=>Ss,Followsets:()=>Bs,GenericRepost:()=>Jr,Genericlists:()=>Ps,HTTPAuth:()=>Ls,Handlerinformation:()=>ri,Handlerrecommendation:()=>ni,Highlights:()=>gs,InterestsList:()=>xs,Interestsets:()=>qs,JobFeedback:()=>us,JobRequest:()=>hs,JobResult:()=>ls,Label:()=>as,LightningPubRPC:()=>Cs,LiveChatMessage:()=>rs,LiveEvent:()=>Zs,LongFormArticle:()=>Vs,Metadata:()=>Mr,Mutelist:()=>ys,NWCWalletInfo:()=>Rs,NWCWalletRequest:()=>Is,NWCWalletResponse:()=>Ts,NostrConnect:()=>Ns,OpenTimestamps:()=>es,Pinlist:()=>ws,ProblemTracker:()=>ss,ProfileBadges:()=>Ms,PublicChatsList:()=>Es,Reaction:()=>Wr,RecommendRelay:()=>qr,RelayList:()=>bs,Relaysets:()=>Os,Report:()=>is,Reporting:()=>os,Repost:()=>Kr,SearchRelaysList:()=>As,ShortTextNote:()=>Dr,Time:()=>Xs,UserEmojiList:()=>_s,UserStatuses:()=>Js,Zap:()=>ps,ZapGoal:()=>ds,ZapRequest:()=>fs,classifyKind:()=>$r,isEphemeralKind:()=>Or,isParameterizedReplaceableKind:()=>Fr,isRegularKind:()=>Br,isReplaceableKind:()=>Pr});var Mr=0,Dr=1,qr=2,zr=3,Hr=4,Vr=4,jr=5,Kr=6,Wr=7,Zr=8,Jr=16,Yr=40,Gr=41,Qr=42,Xr=43,ts=44,es=1040,ns=1063,rs=1311,ss=1971,is=1984,os=1984,as=1985,cs=4550,hs=5999,ls=6999,us=7e3,ds=9041,fs=9734,ps=9735,gs=9802,ys=1e4,ws=10001,bs=10002,ms=10003,vs=10004,Es=10005,ks=10006,As=10007,xs=10015,_s=10030,Ss=10096,Rs=13194,Cs=21e3,Us=22242,Is=23194,Ts=23195,Ns=24133,Ls=27235,Bs=3e4,Ps=30001,Os=30002,Fs=30003,$s=30004,Ms=30008,Ds=30009,qs=30015,zs=30017,Hs=30018,Vs=30023,js=30024,Ks=30030,Ws=30078,Zs=30311,Js=30315,Ys=30402,Gs=30403,Qs=31922,Xs=31923,ti=31924,ei=31925,ni=31989,ri=31990,si=34550;function ii(t,e){if(t.ids&&-1===t.ids.indexOf(e.id))return!1;if(t.kinds&&-1===t.kinds.indexOf(e.kind))return!1;if(t.authors&&-1===t.authors.indexOf(e.pubkey))return!1;for(let n in t)if("#"===n[0]){let r=t[`#${n.slice(1)}`];if(r&&!e.tags.find((([t,e])=>t===n.slice(1)&&-1!==r.indexOf(e))))return!1}return!(t.since&&e.created_at<t.since)&&!(t.until&&e.created_at>t.until)}function oi(t,e){for(let n=0;n<t.length;n++)if(ii(t[n],e))return!0;return!1}function ai(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,s=t.slice(r).indexOf('"')+r+1;return t.slice(s,s+64)}function ci(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,s=t.slice(r),i=Math.min(s.indexOf(","),s.indexOf("}"));return parseInt(s.slice(0,i),10)}function hi(t){let e=t.slice(0,22).indexOf('"EVENT"');if(-1===e)return null;let n=t.slice(e+7+1).indexOf('"');if(-1===n)return null;let r=e+7+1+n,s=t.slice(r+1,80).indexOf('"');if(-1===s)return null;let i=r+1+s;return t.slice(r+1,i)}function li(t,e){return e===ai(t,"id")}function ui(t,e){return e===ai(t,"pubkey")}function di(t,e){return e===ci(t,"kind")}yr({},{getHex64:()=>ai,getInt:()=>ci,getSubscriptionId:()=>hi,matchEventId:()=>li,matchEventKind:()=>di,matchEventPubkey:()=>ui});function fi(t,e){return{kind:Us,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}yr({},{makeAuthEvent:()=>fi});try{WebSocket}catch{}try{WebSocket}catch{}var pi={};yr(pi,{BECH32_REGEX:()=>yi,Bech32MaxSize:()=>gi,decode:()=>wi,encodeBytes:()=>Ai,naddrEncode:()=>Si,neventEncode:()=>_i,noteEncode:()=>Ei,nprofileEncode:()=>xi,npubEncode:()=>vi,nrelayEncode:()=>Ri,nsecEncode:()=>mi});var gi=5e3,yi=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function wi(t){let{prefix:e,words:n}=De.decode(t,gi),r=new Uint8Array(De.fromWords(n));switch(e){case"nprofile":{let t=bi(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nprofile");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Jt(t[0][0]),relays:t[1]?t[1].map((t=>vr.decode(t))):[]}}}case"nevent":{let t=bi(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nevent");if(32!==t[0][0].length)throw new Error("TLV 0 should be 32 bytes");if(t[2]&&32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(t[3]&&4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Jt(t[0][0]),relays:t[1]?t[1].map((t=>vr.decode(t))):[],author:t[2]?.[0]?Jt(t[2][0]):void 0,kind:t[3]?.[0]?parseInt(Jt(t[3][0]),16):void 0}}}case"naddr":{let t=bi(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for naddr");if(!t[2]?.[0])throw new Error("missing TLV 2 for naddr");if(32!==t[2][0].length)throw new Error("TLV 2 should be 32 bytes");if(!t[3]?.[0])throw new Error("missing TLV 3 for naddr");if(4!==t[3][0].length)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:vr.decode(t[0][0]),pubkey:Jt(t[2][0]),kind:parseInt(Jt(t[3][0]),16),relays:t[1]?t[1].map((t=>vr.decode(t))):[]}}}case"nrelay":{let t=bi(r);if(!t[0]?.[0])throw new Error("missing TLV 0 for nrelay");return{type:"nrelay",data:vr.decode(t[0][0])}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:Jt(r)};default:throw new Error(`unknown prefix ${e}`)}}function bi(t){let e={},n=t;for(;n.length>0;){let t=n[0],r=n[1],s=n.slice(2,2+r);if(n=n.slice(2+r),s.length<r)throw new Error(`not enough data to read on TLV ${t}`);e[t]=e[t]||[],e[t].push(s)}return e}function mi(t){return Ai("nsec",t)}function vi(t){return Ai("npub",Yt(t))}function Ei(t){return Ai("note",Yt(t))}function ki(t,e){let n=De.toWords(e);return De.encode(t,n,gi)}function Ai(t,e){return ki(t,e)}function xi(t){return ki("nprofile",Ci({0:[Yt(t.pubkey)],1:(t.relays||[]).map((t=>Er.encode(t)))}))}function _i(t){let e;return void 0!==t.kind&&(e=function(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=255&t,e}(t.kind)),ki("nevent",Ci({0:[Yt(t.id)],1:(t.relays||[]).map((t=>Er.encode(t))),2:t.author?[Yt(t.author)]:[],3:e?[new Uint8Array(e)]:[]}))}function Si(t){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t.kind,!1),ki("naddr",Ci({0:[Er.encode(t.identifier)],1:(t.relays||[]).map((t=>Er.encode(t))),2:[Yt(t.pubkey)],3:[new Uint8Array(e)]}))}function Ri(t){return ki("nrelay",Ci({0:[Er.encode(t)]}))}function Ci(t){let e=[];return Object.entries(t).reverse().forEach((([t,n])=>{n.forEach((n=>{let r=new Uint8Array(n.length+2);r.set([parseInt(t)],0),r.set([n.length],1),r.set(n,2),e.push(r)}))})),Qt(...e)}var Ui={};async function Ii(t,e,n){const r=t instanceof Uint8Array?Jt(t):t,s=Ni(_t.getSharedSecret(r,"02"+e));let i=Uint8Array.from(ee(16)),o=Er.encode(n),a=Fn(s,i).encrypt(o);return`${Ue.encode(new Uint8Array(a))}?iv=${Ue.encode(new Uint8Array(i.buffer))}`}async function Ti(t,e,n){const r=t instanceof Uint8Array?Jt(t):t;let[s,i]=n.split("?iv="),o=Ni(_t.getSharedSecret(r,"02"+e)),a=Ue.decode(i),c=Ue.decode(s),h=Fn(o,a).decrypt(c);return vr.decode(h)}function Ni(t){return t.slice(1,33)}yr(Ui,{decrypt:()=>Ti,encrypt:()=>Ii});yr({},{NIP05_REGEX:()=>Bi,isValid:()=>$i,queryProfile:()=>Fi,searchDomain:()=>Oi,useFetchImplementation:()=>Pi});var Li,Bi=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/;try{Li=fetch}catch{}function Pi(t){Li=t}async function Oi(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Li(n,{redirect:"error"});return(await r.json()).names}catch(t){return{}}}async function Fi(t){const e=t.match(Bi);if(!e)return null;const[n,r="_",s]=e;try{const t=`https://${s}/.well-known/nostr.json?name=${r}`,e=await(await Li(t,{redirect:"error"})).json();let n=e.names[r];return n?{pubkey:n,relays:e.relays?.[n]}:null}catch(t){return null}}async function $i(t,e){let n=await Fi(e);return!!n&&n.pubkey===t}function Mi(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[]},n=[];for(const r of t.tags)"e"===r[0]&&r[1]&&n.push(r),"p"===r[0]&&r[1]&&e.profiles.push({pubkey:r[1],relays:r[2]?[r[2]]:[]});for(let t=0;t<n.length;t++){const r=n[t],[s,i,o,a]=r,c={id:i,relays:o?[o]:[]},h=0===t,l=t===n.length-1;"root"!==a?"reply"!==a?"mention"!==a?h?e.root=c:l?e.reply=c:e.mentions.push(c):e.mentions.push(c):e.reply=c:e.root=c}return e}yr({},{parse:()=>Mi});yr({},{fetchRelayInformation:()=>qi,useFetchImplementation:()=>Di});try{fetch}catch{}function Di(t){t}async function qi(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}function zi(t){let e=0;for(let n=0;n<t.length;n++){const r=parseInt(t[n],16);if(0!==r){e+=Math.clz32(r)-28;break}e+=4}return e}function Hi(t,e){let n=0;const r=t,s=["nonce",n.toString(),e.toString()];for(r.tags.push(s);;){const t=Math.floor((new Date).getTime()/1e3);if(t!==r.created_at&&(n=0,r.created_at=t),s[1]=(++n).toString(),r.id=Cr(r),zi(r.id)>=e)break}return r}yr({},{getPow:()=>zi,minePow:()=>Hi});function Vi(t,e,n,r){return Nr({kind:Kr,tags:[...t.tags??[],["e",e.id,n],["p",e.pubkey]],content:""===t.content?"":JSON.stringify(e),created_at:t.created_at},r)}function ji(t){if(t.kind!==Kr)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const s=t.tags[r];s.length>=2&&("e"===s[0]&&void 0===e?e=s:"p"===s[0]&&void 0===n&&(n=s))}return void 0!==e?{id:e[1],relays:[e[2],n?.[2]].filter((t=>"string"==typeof t)),author:n?.[1]}:void 0}function Ki(t,{skipVerification:e}={}){const n=ji(t);if(void 0===n||""===t.content)return;let r;try{r=JSON.parse(t.content)}catch(t){return}return r.id===n.id&&(e||Lr(r))?r:void 0}yr({},{finishRepostEvent:()=>Vi,getRepostedEvent:()=>Ki,getRepostedEventPointer:()=>ji});yr({},{NOSTR_URI_REGEX:()=>Wi,parse:()=>Ji,test:()=>Zi});var Wi=new RegExp(`nostr:(${yi.source})`);function Zi(t){return"string"==typeof t&&new RegExp(`^${Wi.source}$`).test(t)}function Ji(t){const e=t.match(new RegExp(`^${Wi.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:wi(e[1])}}function Yi(t,e,n){const r=e.tags.filter((t=>t.length>=2&&("e"===t[0]||"p"===t[0])));return Nr({...t,kind:Wr,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function Gi(t){if(t.kind!==Wr)return;let e,n;for(let r=t.tags.length-1;r>=0&&(void 0===e||void 0===n);r--){const s=t.tags[r];s.length>=2&&("e"===s[0]&&void 0===e?e=s:"p"===s[0]&&void 0===n&&(n=s))}return void 0!==e&&void 0!==n?{id:e[1],relays:[e[2],n[2]].filter((t=>void 0!==t)),author:n[1]}:void 0}yr({},{finishReactionEvent:()=>Yi,getReactedEventPointer:()=>Gi});yr({},{matchAll:()=>Xi,regex:()=>Qi,replaceAll:()=>to});var Qi=()=>new RegExp(`\\b${Wi.source}\\b`,"g");function*Xi(t){const e=t.matchAll(Qi());for(const t of e)try{const[e,n]=t;yield{uri:e,value:n,decoded:wi(n),start:t.index,end:t.index+e.length}}catch(t){}}function to(t,e){return t.replaceAll(Qi(),((t,n)=>e({uri:t,value:n,decoded:wi(n)})))}yr({},{channelCreateEvent:()=>eo,channelHideMessageEvent:()=>so,channelMessageEvent:()=>ro,channelMetadataEvent:()=>no,channelMuteUserEvent:()=>io});var eo=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return Nr({kind:Yr,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},no=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return Nr({kind:Gr,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},ro=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),Nr({kind:Qr,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},so=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return Nr({kind:Xr,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},io=(t,e)=>{let n;if("object"==typeof t.content)n=JSON.stringify(t.content);else{if("string"!=typeof t.content)return;n=t.content}return Nr({kind:ts,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)};yr({},{EMOJI_SHORTCODE_REGEX:()=>oo,matchAll:()=>co,regex:()=>ao,replaceAll:()=>ho});var oo=/:(\w+):/,ao=()=>new RegExp(`\\B${oo.source}\\B`,"g");function*co(t){const e=t.matchAll(ao());for(const t of e)try{const[e,n]=t;yield{shortcode:e,name:n,start:t.index,end:t.index+e.length}}catch(t){}}function ho(t,e){return t.replaceAll(ao(),((t,n)=>e({shortcode:t,name:n})))}var lo;yr({},{useFetchImplementation:()=>uo,validateGithub:()=>fo});try{lo=fetch}catch{}function uo(t){lo=t}async function fo(t,e,n){try{return await(await lo(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch(t){return!1}}yr({},{decrypt:()=>ko,encrypt:()=>Eo,getConversationKey:()=>yo,v2:()=>Ao});var po=1,go=65535;function yo(t,e){const n=_t.getSharedSecret(t,"02"+e).subarray(1,33);return ur(fe,n,"nip44-v2")}function wo(t,e){const n=pr(fe,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function bo(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function mo(t){const e=Er.encode(t),n=e.length;return Qt(function(t){if(!Number.isSafeInteger(t)||t<po||t>go)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}(n),e,new Uint8Array(bo(n)-n))}function vo(t,e,n){if(32!==n.length)throw new Error("AAD associated data must be 32 bytes");const r=Qt(n,e);return lr(fe,t,r)}function Eo(t,e,n=ee(32)){const{chacha_key:r,chacha_nonce:s,hmac_key:i}=wo(e,n),o=mo(t),a=nr(r,s,o),c=vo(i,a,n);return Ue.encode(Qt(new Uint8Array([2]),n,a,c))}function ko(t,e){const{nonce:n,ciphertext:r,mac:s}=function(t){if("string"!=typeof t)throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if("#"===t[0])throw new Error("unknown encryption version");let n;try{n=Ue.decode(t)}catch(t){throw new Error("invalid base64: "+t.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const s=n[0];if(2!==s)throw new Error("unknown encryption version "+s);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}(t),{chacha_key:i,chacha_nonce:o,hmac_key:a}=wo(e,n);if(!Qe(vo(a,r,n),s))throw new Error("invalid MAC");return function(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<po||e>go||n.length!==e||t.length!==2+bo(e))throw new Error("invalid padding");return vr.decode(n)}(nr(i,o,r))}var Ao={utils:{getConversationKey:yo,calcPaddedLen:bo},encrypt:Eo,decrypt:ko};function xo(t){const{pathname:e,searchParams:n}=new URL(t),r=e,s=n.get("relay"),i=n.get("secret");if(!r||!s||!i)throw new Error("invalid connection string");return{pubkey:r,relay:s,secret:i}}async function _o(t,e,n){const r={method:"pay_invoice",params:{invoice:n}},s=await Ii(e,t,JSON.stringify(r)),i={kind:Is,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",t]]};return Nr(i,e)}yr({},{makeNwcRequestEvent:()=>_o,parseConnectionString:()=>xo});var So,Ro={};yr(Ro,{getZapEndpoint:()=>Uo,makeZapReceipt:()=>No,makeZapRequest:()=>Io,useFetchImplementation:()=>Co,validateZapRequest:()=>To});try{So=fetch}catch{}function Co(t){So=t}async function Uo(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:t}=De.decode(n,1e3),r=De.fromWords(t);e=vr.decode(r)}else{if(!r)return null;{let[t,n]=r.split("@");e=new URL(`/.well-known/lnurlp/${t}`,`https://${n}`).toString()}}let s=await So(e),i=await s.json();if(i.allowsNostr&&i.nostrPubkey)return i.callback}catch(t){}return null}function Io({profile:t,event:e,amount:n,relays:r,comment:s=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let i={kind:9734,created_at:Math.round(Date.now()/1e3),content:s,tags:[["p",t],["amount",n.toString()],["relays",...r]]};return e&&i.tags.push(["e",e]),i}function To(t){let e;try{e=JSON.parse(t)}catch(t){return"Invalid zap request JSON."}if(!mr(e))return"Zap request is not a valid Nostr event.";if(!Lr(e))return"Invalid signature on zap request.";let n=e.tags.find((([t,e])=>"p"===t&&e));if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find((([t,e])=>"e"===t&&e));return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find((([t,e])=>"relays"===t&&e))?null:"Zap request doesn't have a 'relays' tag."}function No({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let s=JSON.parse(t),i=s.tags.filter((([t])=>"e"===t||"p"===t||"a"===t)),o={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...i,["P",s.pubkey],["bolt11",n],["description",t]]};return e&&o.tags.push(["preimage",e]),o}yr({},{getToken:()=>Bo,hashPayload:()=>qo,unpackEventFromToken:()=>Oo,validateEvent:()=>Ho,validateEventKind:()=>$o,validateEventMethodTag:()=>Do,validateEventPayloadTag:()=>zo,validateEventTimestamp:()=>Fo,validateEventUrlTag:()=>Mo,validateToken:()=>Po});var Lo="Nostr ";async function Bo(t,e,n,r=!1,s){const i={kind:Ls,tags:[["u",t],["method",e]],created_at:Math.round((new Date).getTime()/1e3),content:""};s&&i.tags.push(["payload",qo(s)]);const o=await n(i);return(r?Lo:"")+Ue.encode(Er.encode(JSON.stringify(o)))}async function Po(t,e,n){const r=await Oo(t).catch((t=>{throw t}));return await Ho(r,e,n).catch((t=>{throw t}))}async function Oo(t){if(!t)throw new Error("Missing token");t=t.replace(Lo,"");const e=vr.decode(Ue.decode(t));if(!e||0===e.length||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function Fo(t){return!!t.created_at&&Math.round((new Date).getTime()/1e3)-t.created_at<60}function $o(t){return t.kind===Ls}function Mo(t,e){const n=t.tags.find((t=>"u"===t[0]));return!!n&&(n.length>0&&n[1]===e)}function Do(t,e){const n=t.tags.find((t=>"method"===t[0]));return!!n&&(n.length>0&&n[1].toLowerCase()===e.toLowerCase())}function qo(t){return Jt(fe(Er.encode(JSON.stringify(t))))}function zo(t,e){const n=t.tags.find((t=>"payload"===t[0]));if(!n)return!1;const r=qo(e);return n.length>0&&n[1]===r}async function Ho(t,e,n,r){if(!Lr(t))throw new Error("Invalid nostr event, signature invalid");if(!$o(t))throw new Error("Invalid nostr event, kind invalid");if(!Fo(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!Mo(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Do(t,n))throw new Error("Invalid nostr event, method tag invalid");if(Boolean(r)&&"object"==typeof r&&Object.keys(r).length>0&&!zo(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}var Vo=__webpack_require__(706),jo=__webpack_require__(833);function Ko(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function Wo(t,...e){if(!((n=t)instanceof Uint8Array||null!=n&&"object"==typeof n&&"Uint8Array"===n.constructor.name))throw new Error("Uint8Array expected");var n;if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function Zo(t){if("function"!=typeof t||"function"!=typeof t.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Ko(t.outputLen),Ko(t.blockLen)}function Jo(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Yo(t,e){Wo(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Go="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;const Qo=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),Xo=(t,e)=>t<<32-e|t>>>e;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const ta=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function ea(t){Wo(t);let e="";for(let n=0;n<t.length;n++)e+=ta[t[n]];return e}const na={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function ra(t){return t>=na._0&&t<=na._9?t-na._0:t>=na._A&&t<=na._F?t-(na._A-10):t>=na._a&&t<=na._f?t-(na._a-10):void 0}function sa(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let e=0,s=0;e<n;e++,s+=2){const n=ra(t.charCodeAt(s)),i=ra(t.charCodeAt(s+1));if(void 0===n||void 0===i){const e=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+s)}r[e]=16*n+i}return r}function ia(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw new Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),Wo(t),t}class oa{clone(){return this._cloneInto()}}function aa(t){const e=e=>t().update(ia(e)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function ca(t=32){if(Go&&"function"==typeof Go.getRandomValues)return Go.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}const ha=(t,e,n)=>t&e^t&n^e&n;class la extends oa{constructor(t,e,n,r){super(),this.blockLen=t,this.outputLen=e,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=Qo(this.buffer)}update(t){Jo(this);const{view:e,buffer:n,blockLen:r}=this,s=(t=ia(t)).length;for(let i=0;i<s;){const o=Math.min(r-this.pos,s-i);if(o!==r)n.set(t.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(e,0),this.pos=0);else{const e=Qo(t);for(;r<=s-i;i+=r)this.process(e,i)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){Jo(this),Yo(t,this),this.finished=!0;const{buffer:e,view:n,blockLen:r,isLE:s}=this;let{pos:i}=this;e[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>r-i&&(this.process(n,0),i=0);for(let t=i;t<r;t++)e[t]=0;!function(t,e,n,r){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,n,r);const s=BigInt(32),i=BigInt(4294967295),o=Number(n>>s&i),a=Number(n&i),c=r?4:0,h=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+h,a,r)}(n,r-8,BigInt(8*this.length),s),this.process(n,0);const o=Qo(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const c=a/4,h=this.get();if(c>h.length)throw new Error("_sha2: outputLen bigger than state");for(let t=0;t<c;t++)o.setUint32(4*t,h[t],s)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const n=t.slice(0,e);return this.destroy(),n}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:n,length:r,finished:s,destroyed:i,pos:o}=this;return t.length=r,t.pos=o,t.finished=s,t.destroyed=i,r%e&&t.buffer.set(n),t}}const ua=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),da=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),fa=new Uint32Array(64);class pa extends la{constructor(){super(64,32,8,!1),this.A=0|da[0],this.B=0|da[1],this.C=0|da[2],this.D=0|da[3],this.E=0|da[4],this.F=0|da[5],this.G=0|da[6],this.H=0|da[7]}get(){const{A:t,B:e,C:n,D:r,E:s,F:i,G:o,H:a}=this;return[t,e,n,r,s,i,o,a]}set(t,e,n,r,s,i,o,a){this.A=0|t,this.B=0|e,this.C=0|n,this.D=0|r,this.E=0|s,this.F=0|i,this.G=0|o,this.H=0|a}process(t,e){for(let n=0;n<16;n++,e+=4)fa[n]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=fa[t-15],n=fa[t-2],r=Xo(e,7)^Xo(e,18)^e>>>3,s=Xo(n,17)^Xo(n,19)^n>>>10;fa[t]=s+fa[t-7]+r+fa[t-16]|0}let{A:n,B:r,C:s,D:i,E:o,F:a,G:c,H:h}=this;for(let t=0;t<64;t++){const e=h+(Xo(o,6)^Xo(o,11)^Xo(o,25))+((l=o)&a^~l&c)+ua[t]+fa[t]|0,u=(Xo(n,2)^Xo(n,13)^Xo(n,22))+ha(n,r,s)|0;h=c,c=a,a=o,o=i+e|0,i=s,s=r,r=n,n=e+u|0}var l;n=n+this.A|0,r=r+this.B|0,s=s+this.C|0,i=i+this.D|0,o=o+this.E|0,a=a+this.F|0,c=c+this.G|0,h=h+this.H|0,this.set(n,r,s,i,o,a,c,h)}roundClean(){fa.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const ga=aa((()=>new pa));class ya extends oa{constructor(t,e){super(),this.finished=!1,this.destroyed=!1,Zo(t);const n=ia(e);if(this.iHash=t.create(),"function"!=typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,s=new Uint8Array(r);s.set(n.length>r?t.create().update(n).digest():n);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=t.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return Jo(this),this.iHash.update(t),this}digestInto(t){Jo(this),Wo(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:n,finished:r,destroyed:s,blockLen:i,outputLen:o}=this;return t.finished=r,t.destroyed=s,t.blockLen=i,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=n._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const wa=(t,e,n)=>new ya(t,e).update(n).digest();wa.create=(t,e)=>new ya(t,e);const ba=BigInt(1),ma=BigInt(2);function va(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function Ea(t){if(!va(t))throw new Error("Uint8Array expected")}const ka=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Aa(t){Ea(t);let e="";for(let n=0;n<t.length;n++)e+=ka[t[n]];return e}function xa(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);return BigInt(""===t?"0":`0x${t}`)}const _a={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Sa(t){return t>=_a._0&&t<=_a._9?t-_a._0:t>=_a._A&&t<=_a._F?t-(_a._A-10):t>=_a._a&&t<=_a._f?t-(_a._a-10):void 0}function Ra(t){if("string"!=typeof t)throw new Error("hex string expected, got "+typeof t);const e=t.length,n=e/2;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(n);for(let e=0,s=0;e<n;e++,s+=2){const n=Sa(t.charCodeAt(s)),i=Sa(t.charCodeAt(s+1));if(void 0===n||void 0===i){const e=t[s]+t[s+1];throw new Error('hex string expected, got non-hex character "'+e+'" at index '+s)}r[e]=16*n+i}return r}function Ca(t){return xa(Aa(t))}function Ua(t){return Ea(t),xa(Aa(Uint8Array.from(t).reverse()))}function Ia(t,e){return Ra(t.toString(16).padStart(2*e,"0"))}function Ta(t,e){return Ia(t,e).reverse()}function Na(t,e,n){let r;if("string"==typeof e)try{r=Ra(e)}catch(n){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${n}`)}else{if(!va(e))throw new Error(`${t} must be hex string or Uint8Array`);r=Uint8Array.from(e)}const s=r.length;if("number"==typeof n&&s!==n)throw new Error(`${t} expected ${n} bytes, got ${s}`);return r}function La(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];Ea(r),e+=r.length}const n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const s=t[e];n.set(s,r),r+=s.length}return n}const Ba=t=>(ma<<BigInt(t-1))-ba,Pa=t=>new Uint8Array(t),Oa=t=>Uint8Array.from(t);function Fa(t,e,n){if("number"!=typeof t||t<2)throw new Error("hashLen must be a number");if("number"!=typeof e||e<2)throw new Error("qByteLen must be a number");if("function"!=typeof n)throw new Error("hmacFn must be a function");let r=Pa(t),s=Pa(t),i=0;const o=()=>{r.fill(1),s.fill(0),i=0},a=(...t)=>n(s,r,...t),c=(t=Pa())=>{s=a(Oa([0]),t),r=a(),0!==t.length&&(s=a(Oa([1]),t),r=a())},h=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let t=0;const n=[];for(;t<e;){r=a();const e=r.slice();n.push(e),t+=r.length}return La(...n)};return(t,e)=>{let n;for(o(),c(t);!(n=e(h()));)c();return o(),n}}const $a={bigint:t=>"bigint"==typeof t,function:t=>"function"==typeof t,boolean:t=>"boolean"==typeof t,string:t=>"string"==typeof t,stringOrUint8Array:t=>"string"==typeof t||va(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>"function"==typeof t&&Number.isSafeInteger(t.outputLen)};function Ma(t,e,n={}){const r=(e,n,r)=>{const s=$a[n];if("function"!=typeof s)throw new Error(`Invalid validator "${n}", expected function`);const i=t[e];if(!(r&&void 0===i||s(i,t)))throw new Error(`Invalid param ${String(e)}=${i} (${typeof i}), expected ${n}`)};for(const[t,n]of Object.entries(e))r(t,n,!1);for(const[t,e]of Object.entries(n))r(t,e,!0);return t}const Da=BigInt(0),qa=BigInt(1),za=BigInt(2),Ha=BigInt(3),Va=BigInt(4),ja=BigInt(5),Ka=BigInt(8);BigInt(9),BigInt(16);function Wa(t,e){const n=t%e;return n>=Da?n:e+n}function Za(t,e,n){if(n<=Da||e<Da)throw new Error("Expected power/modulo > 0");if(n===qa)return Da;let r=qa;for(;e>Da;)e&qa&&(r=r*t%n),t=t*t%n,e>>=qa;return r}function Ja(t,e,n){let r=t;for(;e-- >Da;)r*=r,r%=n;return r}function Ya(t,e){if(t===Da||e<=Da)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Wa(t,e),r=e,s=Da,i=qa,o=qa,a=Da;for(;n!==Da;){const t=r/n,e=r%n,c=s-o*t,h=i-a*t;r=n,n=e,s=o,i=a,o=c,a=h}if(r!==qa)throw new Error("invert: does not exist");return Wa(s,e)}function Ga(t){if(t%Va===Ha){const e=(t+qa)/Va;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}if(t%Ka===ja){const e=(t-ja)/Ka;return function(t,n){const r=t.mul(n,za),s=t.pow(r,e),i=t.mul(n,s),o=t.mul(t.mul(i,za),s),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(t){const e=(t-qa)/za;let n,r,s;for(n=t-qa,r=0;n%za===Da;n/=za,r++);for(s=za;s<t&&Za(s,e,t)!==t-qa;s++);if(1===r){const e=(t+qa)/Va;return function(t,n){const r=t.pow(n,e);if(!t.eql(t.sqr(r),n))throw new Error("Cannot find square root");return r}}const i=(n+qa)/za;return function(t,o){if(t.pow(o,e)===t.neg(t.ONE))throw new Error("Cannot find square root");let a=r,c=t.pow(t.mul(t.ONE,s),n),h=t.pow(o,i),l=t.pow(o,n);for(;!t.eql(l,t.ONE);){if(t.eql(l,t.ZERO))return t.ZERO;let e=1;for(let n=t.sqr(l);e<a&&!t.eql(n,t.ONE);e++)n=t.sqr(n);const n=t.pow(c,qa<<BigInt(a-e-1));c=t.sqr(n),h=t.mul(h,n),l=t.mul(l,c),a=e}return h}}(t)}const Qa=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Xa(t,e){const n=void 0!==e?e:t.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function tc(t){if("bigint"!=typeof t)throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function ec(t){const e=tc(t);return e+Math.ceil(e/2)}const nc=BigInt(0),rc=BigInt(1);function sc(t){return Ma(t.Fp,Qa.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),Ma(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Xa(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}const{Ph:ic,aT:oc}=e,ac={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(t){const{Err:e}=ac;if(t.length<2||2!==t[0])throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(128&r[0])throw new e("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new e("Invalid signature integer: unnecessary leading zero");return{d:ic(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=ac,n="string"==typeof t?oc(t):t;Ea(n);let r=n.length;if(r<2||48!=n[0])throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:s,l:i}=ac._parseInt(n.subarray(2)),{d:o,l:a}=ac._parseInt(i);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(t){const e=t=>8&Number.parseInt(t[0],16)?"00"+t:t,n=t=>{const e=t.toString(16);return 1&e.length?`0${e}`:e},r=e(n(t.s)),s=e(n(t.r)),i=r.length/2,o=s.length/2,a=n(i),c=n(o);return`30${n(o+i+4)}02${c}${s}02${a}${r}`}},cc=BigInt(0),hc=BigInt(1),lc=(BigInt(2),BigInt(3));BigInt(4);function uc(t){const e=function(t){const e=sc(t);Ma(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:s}=e;if(n){if(!r.eql(s,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!=typeof n||"bigint"!=typeof n.beta||"function"!=typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:n}=e,r=e.toBytes||((t,e,r)=>{const s=e.toAffine();return La(Uint8Array.from([4]),n.toBytes(s.x),n.toBytes(s.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:n.fromBytes(e.subarray(0,n.BYTES)),y:n.fromBytes(e.subarray(n.BYTES,2*n.BYTES))}});function i(t){const{a:r,b:s}=e,i=n.sqr(t),o=n.mul(i,t);return n.add(n.add(o,n.mul(t,r)),s)}if(!n.eql(n.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function o(t){return"bigint"==typeof t&&cc<t&&t<e.n}function a(t){if(!o(t))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(t){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:s,n:i}=e;if(n&&"bigint"!=typeof t){if(va(t)&&(t=Aa(t)),"string"!=typeof t||!n.includes(t.length))throw new Error("Invalid key");t=t.padStart(2*r,"0")}let o;try{o="bigint"==typeof t?t:Ca(Na("private key",t,r))}catch(e){throw new Error(`private key must be ${r} bytes, hex or bigint, not ${typeof t}`)}return s&&(o=Wa(o,i)),a(o),o}const h=new Map;function l(t){if(!(t instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(t,e,r){if(this.px=t,this.py=e,this.pz=r,null==t||!n.isValid(t))throw new Error("x required");if(null==e||!n.isValid(e))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(t){const{x:e,y:r}=t||{};if(!t||!n.isValid(e)||!n.isValid(r))throw new Error("invalid affine point");if(t instanceof u)throw new Error("projective point not allowed");const s=t=>n.eql(t,n.ZERO);return s(e)&&s(r)?u.ZERO:new u(e,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}static fromHex(t){const e=u.fromAffine(s(Na("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return u.BASE.multiply(c(t))}_setWindowSize(t){this._WINDOW_SIZE=t,h.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:t,y:r}=this.toAffine();if(!n.isValid(t)||!n.isValid(r))throw new Error("bad point: x or y not FE");const s=n.sqr(r),o=i(t);if(!n.eql(s,o))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:t}=this.toAffine();if(n.isOdd)return!n.isOdd(t);throw new Error("Field doesn't support isOdd")}equals(t){l(t);const{px:e,py:r,pz:s}=this,{px:i,py:o,pz:a}=t,c=n.eql(n.mul(e,a),n.mul(i,s)),h=n.eql(n.mul(r,a),n.mul(o,s));return c&&h}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:t,b:r}=e,s=n.mul(r,lc),{px:i,py:o,pz:a}=this;let c=n.ZERO,h=n.ZERO,l=n.ZERO,d=n.mul(i,i),f=n.mul(o,o),p=n.mul(a,a),g=n.mul(i,o);return g=n.add(g,g),l=n.mul(i,a),l=n.add(l,l),c=n.mul(t,l),h=n.mul(s,p),h=n.add(c,h),c=n.sub(f,h),h=n.add(f,h),h=n.mul(c,h),c=n.mul(g,c),l=n.mul(s,l),p=n.mul(t,p),g=n.sub(d,p),g=n.mul(t,g),g=n.add(g,l),l=n.add(d,d),d=n.add(l,d),d=n.add(d,p),d=n.mul(d,g),h=n.add(h,d),p=n.mul(o,a),p=n.add(p,p),d=n.mul(p,g),c=n.sub(c,d),l=n.mul(p,f),l=n.add(l,l),l=n.add(l,l),new u(c,h,l)}add(t){l(t);const{px:r,py:s,pz:i}=this,{px:o,py:a,pz:c}=t;let h=n.ZERO,d=n.ZERO,f=n.ZERO;const p=e.a,g=n.mul(e.b,lc);let y=n.mul(r,o),w=n.mul(s,a),b=n.mul(i,c),m=n.add(r,s),v=n.add(o,a);m=n.mul(m,v),v=n.add(y,w),m=n.sub(m,v),v=n.add(r,i);let E=n.add(o,c);return v=n.mul(v,E),E=n.add(y,b),v=n.sub(v,E),E=n.add(s,i),h=n.add(a,c),E=n.mul(E,h),h=n.add(w,b),E=n.sub(E,h),f=n.mul(p,v),h=n.mul(g,b),f=n.add(h,f),h=n.sub(w,f),f=n.add(w,f),d=n.mul(h,f),w=n.add(y,y),w=n.add(w,y),b=n.mul(p,b),v=n.mul(g,v),w=n.add(w,b),b=n.sub(y,b),b=n.mul(p,b),v=n.add(v,b),y=n.mul(w,v),d=n.add(d,y),y=n.mul(E,v),h=n.mul(m,h),h=n.sub(h,y),y=n.mul(m,w),f=n.mul(E,f),f=n.add(f,y),new u(h,d,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(u.ZERO)}wNAF(t){return f.wNAFCached(this,h,t,(t=>{const e=n.invertBatch(t.map((t=>t.pz)));return t.map(((t,n)=>t.toAffine(e[n]))).map(u.fromAffine)}))}multiplyUnsafe(t){const r=u.ZERO;if(t===cc)return r;if(a(t),t===hc)return this;const{endo:s}=e;if(!s)return f.unsafeLadder(this,t);let{k1neg:i,k1:o,k2neg:c,k2:h}=s.splitScalar(t),l=r,d=r,p=this;for(;o>cc||h>cc;)o&hc&&(l=l.add(p)),h&hc&&(d=d.add(p)),p=p.double(),o>>=hc,h>>=hc;return i&&(l=l.negate()),c&&(d=d.negate()),d=new u(n.mul(d.px,s.beta),d.py,d.pz),l.add(d)}multiply(t){a(t);let r,s,i=t;const{endo:o}=e;if(o){const{k1neg:t,k1:e,k2neg:a,k2:c}=o.splitScalar(i);let{p:h,f:l}=this.wNAF(e),{p:d,f:p}=this.wNAF(c);h=f.constTimeNegate(t,h),d=f.constTimeNegate(a,d),d=new u(n.mul(d.px,o.beta),d.py,d.pz),r=h.add(d),s=l.add(p)}else{const{p:t,f:e}=this.wNAF(i);r=t,s=e}return u.normalizeZ([r,s])[0]}multiplyAndAddUnsafe(t,e,n){const r=u.BASE,s=(t,e)=>e!==cc&&e!==hc&&t.equals(r)?t.multiply(e):t.multiplyUnsafe(e),i=s(this,e).add(s(t,n));return i.is0()?void 0:i}toAffine(t){const{px:e,py:r,pz:s}=this,i=this.is0();null==t&&(t=i?n.ONE:n.inv(s));const o=n.mul(e,t),a=n.mul(r,t),c=n.mul(s,t);if(i)return{x:n.ZERO,y:n.ZERO};if(!n.eql(c,n.ONE))throw new Error("invZ was invalid");return{x:o,y:a}}isTorsionFree(){const{h:t,isTorsionFree:n}=e;if(t===hc)return!0;if(n)return n(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:n}=e;return t===hc?this:n?n(u,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return this.assertValidity(),r(u,this,t)}toHex(t=!0){return Aa(this.toRawBytes(t))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const d=e.nBitLength,f=function(t,e){const n=(t,e)=>{const n=e.negate();return t?n:e},r=t=>({windows:Math.ceil(e/t)+1,windowSize:2**(t-1)});return{constTimeNegate:n,unsafeLadder(e,n){let r=t.ZERO,s=e;for(;n>nc;)n&rc&&(r=r.add(s)),s=s.double(),n>>=rc;return r},precomputeWindow(t,e){const{windows:n,windowSize:s}=r(e),i=[];let o=t,a=o;for(let t=0;t<n;t++){a=o,i.push(a);for(let t=1;t<s;t++)a=a.add(o),i.push(a);o=a.double()}return i},wNAF(e,s,i){const{windows:o,windowSize:a}=r(e);let c=t.ZERO,h=t.BASE;const l=BigInt(2**e-1),u=2**e,d=BigInt(e);for(let t=0;t<o;t++){const e=t*a;let r=Number(i&l);i>>=d,r>a&&(r-=u,i+=rc);const o=e,f=e+Math.abs(r)-1,p=t%2!=0,g=r<0;0===r?h=h.add(n(p,s[o])):c=c.add(n(g,s[f]))}return{p:c,f:h}},wNAFCached(t,e,n,r){const s=t._WINDOW_SIZE||1;let i=e.get(t);return i||(i=this.precomputeWindow(t,s),1!==s&&e.set(t,r(i))),this.wNAF(s,i,n)}}}(u,e.endo?Math.ceil(d/2):d);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:o}}function dc(t){const e=function(t){const e=sc(t);return Ma(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:n,n:r}=e,s=n.BYTES+1,i=2*n.BYTES+1;function o(t){return Wa(t,r)}function a(t){return Ya(t,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:h,weierstrassEquation:l,isWithinCurveOrder:u}=uc({...e,toBytes(t,e,r){const s=e.toAffine(),i=n.toBytes(s.x),o=La;return r?o(Uint8Array.from([e.hasEvenY()?2:3]),i):o(Uint8Array.from([4]),i,n.toBytes(s.y))},fromBytes(t){const e=t.length,r=t[0],o=t.subarray(1);if(e!==s||2!==r&&3!==r){if(e===i&&4===r){return{x:n.fromBytes(o.subarray(0,n.BYTES)),y:n.fromBytes(o.subarray(n.BYTES,2*n.BYTES))}}throw new Error(`Point of length ${e} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}{const t=Ca(o);if(!(cc<(a=t)&&a<n.ORDER))throw new Error("Point is not on curve");const e=l(t);let s;try{s=n.sqrt(e)}catch(t){const e=t instanceof Error?": "+t.message:"";throw new Error("Point is not on curve"+e)}return!(1&~r)!==((s&hc)===hc)&&(s=n.neg(s)),{x:t,y:s}}var a}}),d=t=>Aa(Ia(t,e.nByteLength));function f(t){return t>r>>hc}const p=(t,e,n)=>Ca(t.slice(e,n));class g{constructor(t,e,n){this.r=t,this.s=e,this.recovery=n,this.assertValidity()}static fromCompact(t){const n=e.nByteLength;return t=Na("compactSignature",t,2*n),new g(p(t,0,n),p(t,n,2*n))}static fromDER(t){const{r:e,s:n}=ac.toSig(Na("DER",t));return new g(e,n)}assertValidity(){if(!u(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!u(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r,s,recovery:i}=this,h=m(Na("msgHash",t));if(null==i||![0,1,2,3].includes(i))throw new Error("recovery id invalid");const l=2===i||3===i?r+e.n:r;if(l>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const u=1&i?"03":"02",f=c.fromHex(u+d(l)),p=a(l),g=o(-h*p),y=o(s*p),w=c.BASE.multiplyAndAddUnsafe(f,g,y);if(!w)throw new Error("point at infinify");return w.assertValidity(),w}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return Ra(this.toDERHex())}toDERHex(){return ac.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ra(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(t){try{return h(t),!0}catch(t){return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{const t=ec(e.n);return function(t,e,n=!1){const r=t.length,s=tc(e),i=ec(e);if(r<16||r<i||r>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${r}`);const o=Wa(n?Ca(t):Ua(t),e-qa)+qa;return n?Ta(o,s):Ia(o,s)}(e.randomBytes(t),e.n)},precompute:(t=8,e=c.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function w(t){const e=va(t),n="string"==typeof t,r=(e||n)&&t.length;return e?r===s||r===i:n?r===2*s||r===2*i:t instanceof c}const b=e.bits2int||function(t){const n=Ca(t),r=8*t.length-e.nBitLength;return r>0?n>>BigInt(r):n},m=e.bits2int_modN||function(t){return o(b(t))},v=Ba(e.nBitLength);function E(t){if("bigint"!=typeof t)throw new Error("bigint expected");if(!(cc<=t&&t<v))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Ia(t,e.nByteLength)}function k(t,r,s=A){if(["recovered","canonical"].some((t=>t in s)))throw new Error("sign() legacy options not supported");const{hash:i,randomBytes:l}=e;let{lowS:d,prehash:p,extraEntropy:y}=s;null==d&&(d=!0),t=Na("msgHash",t),p&&(t=Na("prehashed msgHash",i(t)));const w=m(t),v=h(r),k=[E(v),E(w)];if(null!=y&&!1!==y){const t=!0===y?l(n.BYTES):y;k.push(Na("extraEntropy",t))}const x=La(...k),_=w;return{seed:x,k2sig:function(t){const e=b(t);if(!u(e))return;const n=a(e),r=c.BASE.multiply(e).toAffine(),s=o(r.x);if(s===cc)return;const i=o(n*o(_+s*v));if(i===cc)return;let h=(r.x===s?0:2)|Number(r.y&hc),l=i;return d&&f(i)&&(l=function(t){return f(t)?o(-t):t}(i),h^=1),new g(s,l,h)}}}const A={lowS:e.lowS,prehash:!1},x={lowS:e.lowS,prehash:!1};return c.BASE._setWindowSize(8),{CURVE:e,getPublicKey:function(t,e=!0){return c.fromPrivateKey(t).toRawBytes(e)},getSharedSecret:function(t,e,n=!0){if(w(t))throw new Error("first arg must be private key");if(!w(e))throw new Error("second arg must be public key");return c.fromHex(e).multiply(h(t)).toRawBytes(n)},sign:function(t,n,r=A){const{seed:s,k2sig:i}=k(t,n,r),o=e;return Fa(o.hash.outputLen,o.nByteLength,o.hmac)(s,i)},verify:function(t,n,r,s=x){const i=t;if(n=Na("msgHash",n),r=Na("publicKey",r),"strict"in s)throw new Error("options.strict was renamed to lowS");const{lowS:h,prehash:l}=s;let u,d;try{if("string"==typeof i||va(i))try{u=g.fromDER(i)}catch(t){if(!(t instanceof ac.Err))throw t;u=g.fromCompact(i)}else{if("object"!=typeof i||"bigint"!=typeof i.r||"bigint"!=typeof i.s)throw new Error("PARSE");{const{r:t,s:e}=i;u=new g(t,e)}}d=c.fromHex(r)}catch(t){if("PARSE"===t.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(h&&u.hasHighS())return!1;l&&(n=e.hash(n));const{r:f,s:p}=u,y=m(n),w=a(p),b=o(y*w),v=o(f*w),E=c.BASE.multiplyAndAddUnsafe(d,b,v)?.toAffine();return!!E&&o(E.x)===f},ProjectivePoint:c,Signature:g,utils:y}}function fc(t){return{hash:t,hmac:(e,...n)=>wa(t,e,function(...t){let e=0;for(let n=0;n<t.length;n++){const r=t[n];Wo(r),e+=r.length}const n=new Uint8Array(e);for(let e=0,r=0;e<t.length;e++){const s=t[e];n.set(s,r),r+=s.length}return n}(...n)),randomBytes:ca}}const pc=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),gc=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),yc=BigInt(1),wc=BigInt(2),bc=(t,e)=>(t+e/wc)/e;function mc(t){const e=pc,n=BigInt(3),r=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),h=t*t*t%e,l=h*h*t%e,u=Ja(l,n,e)*l%e,d=Ja(u,n,e)*l%e,f=Ja(d,wc,e)*h%e,p=Ja(f,s,e)*f%e,g=Ja(p,i,e)*p%e,y=Ja(g,a,e)*g%e,w=Ja(y,c,e)*y%e,b=Ja(w,a,e)*g%e,m=Ja(b,n,e)*l%e,v=Ja(m,o,e)*p%e,E=Ja(v,r,e)*h%e,k=Ja(E,wc,e);if(!vc.eql(vc.sqr(k),t))throw new Error("Cannot find square root");return k}const vc=function(t,e,n=!1,r={}){if(t<=Da)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:s,nByteLength:i}=Xa(t,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=Ga(t),a=Object.freeze({ORDER:t,BITS:s,BYTES:i,MASK:Ba(s),ZERO:Da,ONE:qa,create:e=>Wa(e,t),isValid:e=>{if("bigint"!=typeof e)throw new Error("Invalid field element: expected bigint, got "+typeof e);return Da<=e&&e<t},is0:t=>t===Da,isOdd:t=>(t&qa)===qa,neg:e=>Wa(-e,t),eql:(t,e)=>t===e,sqr:e=>Wa(e*e,t),add:(e,n)=>Wa(e+n,t),sub:(e,n)=>Wa(e-n,t),mul:(e,n)=>Wa(e*n,t),pow:(t,e)=>function(t,e,n){if(n<Da)throw new Error("Expected power > 0");if(n===Da)return t.ONE;if(n===qa)return e;let r=t.ONE,s=e;for(;n>Da;)n&qa&&(r=t.mul(r,s)),s=t.sqr(s),n>>=qa;return r}(a,t,e),div:(e,n)=>Wa(e*Ya(n,t),t),sqrN:t=>t*t,addN:(t,e)=>t+e,subN:(t,e)=>t-e,mulN:(t,e)=>t*e,inv:e=>Ya(e,t),sqrt:r.sqrt||(t=>o(a,t)),invertBatch:t=>function(t,e){const n=new Array(e.length),r=e.reduce(((e,r,s)=>t.is0(r)?e:(n[s]=e,t.mul(e,r))),t.ONE),s=t.inv(r);return e.reduceRight(((e,r,s)=>t.is0(r)?e:(n[s]=t.mul(e,n[s]),t.mul(e,r))),s),n}(a,t),cmov:(t,e,n)=>n?e:t,toBytes:t=>n?Ta(t,i):Ia(t,i),fromBytes:t=>{if(t.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${t.length}`);return n?Ua(t):Ca(t)}});return Object.freeze(a)}(pc,void 0,void 0,{sqrt:mc}),Ec=function(t,e){const n=e=>dc({...t,...fc(e)});return Object.freeze({...n(e),create:n})}({a:BigInt(0),b:BigInt(7),Fp:vc,n:gc,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=gc,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-yc*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=n,o=BigInt("0x100000000000000000000000000000000"),a=bc(i*t,e),c=bc(-r*t,e);let h=Wa(t-a*n-c*s,e),l=Wa(-a*r-c*i,e);const u=h>o,d=l>o;if(u&&(h=e-h),d&&(l=e-l),h>o||l>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:h,k2neg:d,k2:l}}}},ga),kc=BigInt(0),Ac=t=>"bigint"==typeof t&&kc<t&&t<pc,xc=t=>"bigint"==typeof t&&kc<t&&t<gc,_c={};function Sc(t,...e){let n=_c[t];if(void 0===n){const e=ga(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=La(e,e),_c[t]=n}return ga(La(n,...e))}const Rc=t=>t.toRawBytes(!0).slice(1),Cc=t=>Ia(t,32),Uc=t=>Wa(t,pc),Ic=t=>Wa(t,gc),Tc=Ec.ProjectivePoint,Nc=(t,e,n)=>Tc.BASE.multiplyAndAddUnsafe(t,e,n);function Lc(t){let e=Ec.utils.normPrivateKeyToScalar(t),n=Tc.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:Ic(-e),bytes:Rc(n)}}function Bc(t){if(!Ac(t))throw new Error("bad x: need 0 < x < p");const e=Uc(t*t);let n=mc(Uc(e*t+BigInt(7)));n%wc!==kc&&(n=Uc(-n));const r=new Tc(t,n,yc);return r.assertValidity(),r}function Pc(...t){return Ic(Ca(Sc("BIP0340/challenge",...t)))}function Oc(t){return Lc(t).bytes}function Fc(t,e,n=ca(32)){const r=Na("message",t),{bytes:s,scalar:i}=Lc(e),o=Na("auxRand",n,32),a=Cc(i^Ca(Sc("BIP0340/aux",o))),c=Sc("BIP0340/nonce",a,s,r),h=Ic(Ca(c));if(h===kc)throw new Error("sign failed: k is zero");const{bytes:l,scalar:u}=Lc(h),d=Pc(l,s,r),f=new Uint8Array(64);if(f.set(l,0),f.set(Cc(Ic(u+d*i)),32),!$c(f,r,s))throw new Error("sign: Invalid signature produced");return f}function $c(t,e,n){const r=Na("signature",t,64),s=Na("message",e),i=Na("publicKey",n,32);try{const t=Bc(Ca(i)),e=Ca(r.subarray(0,32));if(!Ac(e))return!1;const n=Ca(r.subarray(32,64));if(!xc(n))return!1;const o=Pc(Cc(e),Rc(t),s),a=Nc(t,n,Ic(-o));return!(!a||!a.hasEvenY()||a.toAffine().x!==e)}catch(t){return!1}}const Mc=(()=>({getPublicKey:Oc,sign:Fc,verify:$c,utils:{randomPrivateKey:Ec.utils.randomPrivateKey,lift_x:Bc,pointToBytes:Rc,numberToBytesBE:Ia,bytesToNumberBE:Ca,taggedHash:Sc,mod:Wa}}))();var Dc=__webpack_require__(654);function qc(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function zc(t){return t instanceof Uint8Array||null!=t&&"object"==typeof t&&"Uint8Array"===t.constructor.name}function Hc(...t){const e=t=>t,n=(t,e)=>n=>t(e(n));return{encode:t.map((t=>t.encode)).reduceRight(n,e),decode:t.map((t=>t.decode)).reduce(n,e)}}function Vc(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("alphabet.encode input should be an array of numbers");return e.map((e=>{if(qc(e),e<0||e>=t.length)throw new Error(`Digit index outside alphabet: ${e} (alphabet: ${t.length})`);return t[e]}))},decode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("alphabet.decode input should be array of strings");return e.map((e=>{if("string"!=typeof e)throw new Error(`alphabet.decode: not string element=${e}`);const n=t.indexOf(e);if(-1===n)throw new Error(`Unknown letter: "${e}". Allowed: ${t}`);return n}))}}}function jc(t=""){if("string"!=typeof t)throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&"string"!=typeof e[0])throw new Error("join.encode input should be array of strings");for(let t of e)if("string"!=typeof t)throw new Error(`join.encode: non-string input=${t}`);return e.join(t)},decode:e=>{if("string"!=typeof e)throw new Error("join.decode input should be string");return e.split(t)}}}function Kc(t,e="="){if(qc(t),"string"!=typeof e)throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.encode: non-string input=${t}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&"string"!=typeof n[0])throw new Error("padding.encode input should be array of strings");for(let t of n)if("string"!=typeof t)throw new Error(`padding.decode: non-string input=${t}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function Wc(t){if("function"!=typeof t)throw new Error("normalize fn should be function");return{encode:t=>t,decode:e=>t(e)}}function Zc(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const s=[],i=Array.from(t);for(i.forEach((t=>{if(qc(t),t<0||t>=e)throw new Error(`Wrong integer: ${t}`)}));;){let t=0,o=!0;for(let s=r;s<i.length;s++){const a=i[s],c=e*t+a;if(!Number.isSafeInteger(c)||e*t/e!==t||c-a!=e*t)throw new Error("convertRadix: carry overflow");t=c%n;const h=Math.floor(c/n);if(i[s]=h,!Number.isSafeInteger(h)||h*n+t!==c)throw new Error("convertRadix: carry overflow");o&&(h?o=!1:r=s)}if(s.push(t),o)break}for(let e=0;e<t.length-1&&0===t[e];e++)s.push(0);return s.reverse()}const Jc=(t,e)=>e?Jc(e,t%e):t,Yc=(t,e)=>t+(e-Jc(t,e));function Gc(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Yc(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Yc(e,n)}`);let s=0,i=0;const o=2**n-1,a=[];for(const r of t){if(qc(r),r>=2**e)throw new Error(`convertRadix2: invalid data word=${r} from=${e}`);if(s=s<<e|r,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=n;i-=n)a.push((s>>i-n&o)>>>0);s&=2**i-1}if(s=s<<n-i&o,!r&&i>=e)throw new Error("Excess padding");if(!r&&s)throw new Error(`Non-zero padding: ${s}`);return r&&i>0&&a.push(s>>>0),a}function Qc(t){return qc(t),{encode:e=>{if(!zc(e))throw new Error("radix.encode input should be Uint8Array");return Zc(Array.from(e),256,t)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw new Error("radix.decode input should be array of numbers");return Uint8Array.from(Zc(e,t,256))}}}function Xc(t,e=!1){if(qc(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Yc(8,t)>32||Yc(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!zc(n))throw new Error("radix2.encode input should be Uint8Array");return Gc(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("radix2.decode input should be array of numbers");return Uint8Array.from(Gc(n,t,8,e))}}}function th(t){if("function"!=typeof t)throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch(t){}}}const eh=Hc(Xc(4),Vc("0123456789ABCDEF"),jc("")),nh=Hc(Xc(5),Vc("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Kc(5),jc("")),rh=(Xc(5),Vc("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),jc(""),Xc(5),Vc("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Kc(5),jc(""),Xc(5),Vc("0123456789ABCDEFGHIJKLMNOPQRSTUV"),jc(""),Xc(5),Vc("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),jc(""),Wc((t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),Hc(Xc(6),Vc("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Kc(6),jc(""))),sh=(Xc(6),Vc("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),jc(""),Hc(Xc(6),Vc("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Kc(6),jc(""))),ih=(Xc(6),Vc("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),jc(""),t=>Hc(Qc(58),Vc(t),jc(""))),oh=ih("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),ah=[0,2,3,5,6,7,9,10,11],ch={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=oh.encode(r).padStart(ah[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),s=ah.indexOf(r.length),i=oh.decode(r);for(let t=0;t<i.length-s;t++)if(0!==i[t])throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(i.slice(i.length-s)))}return Uint8Array.from(e)}},hh=Hc(Vc("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),jc("")),lh=[996825010,642813549,513874426,1027748829,705979059];function uh(t){const e=t>>25;let n=(33554431&t)<<5;for(let t=0;t<lh.length;t++)1==(e>>t&1)&&(n^=lh[t]);return n}function dh(t,e,n=1){const r=t.length;let s=1;for(let e=0;e<r;e++){const n=t.charCodeAt(e);if(n<33||n>126)throw new Error(`Invalid prefix (${t})`);s=uh(s)^n>>5}s=uh(s);for(let e=0;e<r;e++)s=uh(s)^31&t.charCodeAt(e);for(let t of e)s=uh(s)^t;for(let t=0;t<6;t++)s=uh(s);return s^=n,hh.encode(Gc([s%2**30],30,5,!1))}function fh(t){const e="bech32"===t?1:734539939,n=Xc(5),r=n.decode,s=n.encode,i=th(r);function o(t,n=90){if("string"!=typeof t)throw new Error("bech32.decode input should be string, not "+typeof t);if(t.length<8||!1!==n&&t.length>n)throw new TypeError(`Wrong string length: ${t.length} (${t}). Expected (8..${n})`);const r=t.toLowerCase();if(t!==r&&t!==t.toUpperCase())throw new Error("String must be lowercase or uppercase");const s=r.lastIndexOf("1");if(0===s||-1===s)throw new Error('Letter "1" must be present between prefix and data only');const i=r.slice(0,s),o=r.slice(s+1);if(o.length<6)throw new Error("Data must be at least 6 characters long");const a=hh.decode(o).slice(0,-6),c=dh(i,a,e);if(!o.endsWith(c))throw new Error(`Invalid checksum in ${t}: expected "${c}"`);return{prefix:i,words:a}}return{encode:function(t,n,r=90){if("string"!=typeof t)throw new Error("bech32.encode prefix should be string, not "+typeof t);if(!Array.isArray(n)||n.length&&"number"!=typeof n[0])throw new Error("bech32.encode words should be array of numbers, not "+typeof n);if(0===t.length)throw new TypeError(`Invalid prefix length ${t.length}`);const s=t.length+7+n.length;if(!1!==r&&s>r)throw new TypeError(`Length ${s} exceeds limit ${r}`);const i=t.toLowerCase(),o=dh(i,n,e);return`${i}1${hh.encode(n)}${o}`},decode:o,decodeToBytes:function(t){const{prefix:e,words:n}=o(t,!1);return{prefix:e,words:n,bytes:r(n)}},decodeUnsafe:th(o),fromWords:r,fromWordsUnsafe:i,toWords:s}}const ph=fh("bech32"),gh={encode:t=>(new TextDecoder).decode(t),decode:t=>(new TextEncoder).encode(t)};Xc(4),Vc("0123456789abcdef"),jc(""),Wc((t=>{if("string"!=typeof t||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()}));__webpack_require__(705);function yh(t,e,n="write"){if(!t.outboxTracker)return;const r=t.outboxTracker.data.get(e);return r?"write"===n?r.writeRelays:r.readRelays:void 0}function wh(t,e,n,{count:r,preferredRelays:s}={}){r??=2,s??=new Set;const i=t.pool,o=i.connectedRelays();o.forEach((t=>{s.add(t.url)}));const a=new Map,{pubkeysToRelays:c,authorsMissingRelays:h}=function(t,e,n="read"){const r=new Map,s=new Set;return e.forEach((e=>{const i=yh(t,e,n);i&&i.size>0?(i.forEach((t=>{(r.get(t)||new Set).add(e)})),r.set(e,i)):s.add(e)})),{pubkeysToRelays:r,authorsMissingRelays:s}}(t,e,n),l=function(t,e){const n=new Map;return e.forEach((e=>{const r=yh(t,e);r&&r.forEach((t=>{const e=n.get(t)||0;n.set(t,e+1)}))})),Array.from(n.entries()).sort(((t,e)=>e[1]-t[1])).map((t=>t[0]))}(t,e),u=(t,e)=>{const n=a.get(e)||[];n.push(t),a.set(e,n)};for(const[t,e]of c.entries()){let n=r;for(const r of o)e.has(r.url)&&(u(t,r.url),n--);for(const r of e)a.has(r)&&(u(t,r),n--);if(!(n<=0))for(const r of l){if(n<=0)break;e.has(r)&&(u(t,r),n--)}}for(const t of h)i.permanentAndConnectedRelays().forEach((e=>{const n=a.get(e.url)||[];n.push(t),a.set(e.url,n)}));return a}function bh(t){try{return mh(t)}catch{return}}function mh(t){let e=function(t,e){"string"!=typeof(e={defaultProtocol:"http",normalizeProtocol:!0,forceHttp:!1,forceHttps:!1,stripAuthentication:!0,stripHash:!1,stripTextFragment:!0,stripWWW:!0,removeQueryParameters:[/^utm_\w+/i],removeTrailingSlash:!0,removeSingleSlash:!0,removeDirectoryIndex:!1,removeExplicitPort:!1,sortQueryParameters:!0,...e}).defaultProtocol||e.defaultProtocol.endsWith(":")||(e.defaultProtocol=`${e.defaultProtocol}:`);if(t=t.trim(),/^data:/i.test(t))return xh(t,e);if(Ah(t))return t;const n=t.startsWith("//");!n&&/^\.*\//.test(t)||(t=t.replace(/^(?!(?:\w+:)?\/\/)|^\/\//,e.defaultProtocol));const r=new URL(t);if(e.forceHttp&&e.forceHttps)throw new Error("The `forceHttp` and `forceHttps` options cannot be used together");e.forceHttp&&"https:"===r.protocol&&(r.protocol="http:");e.forceHttps&&"http:"===r.protocol&&(r.protocol="https:");e.stripAuthentication&&(r.username="",r.password="");e.stripHash?r.hash="":e.stripTextFragment&&(r.hash=r.hash.replace(/#?:~:text.*?$/i,""));if(r.pathname){const t=/\b[a-z][a-z\d+\-.]{1,50}:\/\//g;let e=0,n="";for(;;){const s=t.exec(r.pathname);if(!s)break;const i=s[0],o=s.index;n+=r.pathname.slice(e,o).replace(/\/{2,}/g,"/"),n+=i,e=o+i.length}n+=r.pathname.slice(e,r.pathname.length).replace(/\/{2,}/g,"/"),r.pathname=n}if(r.pathname)try{r.pathname=decodeURI(r.pathname)}catch{}!0===e.removeDirectoryIndex&&(e.removeDirectoryIndex=[/^index\.[a-z]+$/]);if(Array.isArray(e.removeDirectoryIndex)&&e.removeDirectoryIndex.length>0){let t=r.pathname.split("/");const n=t[t.length-1];Eh(n,e.removeDirectoryIndex)&&(t=t.slice(0,-1),r.pathname=t.slice(1).join("/")+"/")}r.hostname&&(r.hostname=r.hostname.replace(/\.$/,""),e.stripWWW&&/^www\.(?!www\.)[a-z\-\d]{1,63}\.[a-z.\-\d]{2,63}$/.test(r.hostname)&&(r.hostname=r.hostname.replace(/^www\./,"")));if(Array.isArray(e.removeQueryParameters))for(const t of[...r.searchParams.keys()])Eh(t,e.removeQueryParameters)&&r.searchParams.delete(t);Array.isArray(e.keepQueryParameters)||!0!==e.removeQueryParameters||(r.search="");if(Array.isArray(e.keepQueryParameters)&&e.keepQueryParameters.length>0)for(const t of[...r.searchParams.keys()])Eh(t,e.keepQueryParameters)||r.searchParams.delete(t);if(e.sortQueryParameters){r.searchParams.sort();try{r.search=decodeURIComponent(r.search)}catch{}}e.removeTrailingSlash&&(r.pathname=r.pathname.replace(/\/$/,""));e.removeExplicitPort&&r.port&&(r.port="");const s=t;t=r.toString(),e.removeSingleSlash||"/"!==r.pathname||s.endsWith("/")||""!==r.hash||(t=t.replace(/\/$/,""));(e.removeTrailingSlash||"/"===r.pathname)&&""===r.hash&&e.removeSingleSlash&&(t=t.replace(/\/$/,""));n&&!e.normalizeProtocol&&(t=t.replace(/^http:\/\//,"//"));e.stripProtocol&&(t=t.replace(/^(?:https?:)?\/\//,""));return t}(t.toLowerCase(),{stripAuthentication:!1,stripWWW:!1,stripHash:!0});return e.endsWith("/")||(e+="/"),e}function vh(t){const e=new Set;for(const n of t)try{e.add(mh(n))}catch{}return Array.from(e)}var Eh=(t,e)=>e.some((e=>e instanceof RegExp?e.test(t):e===t)),kh=new Set(["https:","http:","file:"]),Ah=t=>{try{const{protocol:e}=new URL(t);return e.endsWith(":")&&!e.includes(".")&&!kh.has(e)}catch{return!1}},xh=(t,{stripHash:e})=>{const n=/^data:(?<type>[^,]*?),(?<data>[^#]*?)(?:#(?<hash>.*))?$/.exec(t);if(!n)throw new Error(`Invalid URL: ${t}`);let r=n.groups?.type??"",s=n.groups?.data??"",i=n.groups?.hash??"";const o=r.split(";");i=e?"":i;let a=!1;"base64"===o[o.length-1]&&(o.pop(),a=!0);const c=o.shift()?.toLowerCase()??"",h=[...o.map((t=>{let[e,n=""]=t.split("=").map((t=>t.trim()));return"charset"===e&&(n=n.toLowerCase(),"us-ascii"===n)?"":`${e}${n?`=${n}`:""}`})).filter(Boolean)];return a&&h.push("base64"),(h.length>0||c&&"text/plain"!==c)&&h.unshift(c),`data:${h.join(";")},${a?s.trim():s}${i?`#${i}`:""}`};var _h=class{ndkRelay;ws;_status;timeoutMs;connectedAt;_connectionStats={attempts:0,success:0,durations:[]};debug;connectTimeout;reconnectTimeout;ndk;openSubs=new Map;openCountRequests=new Map;openEventPublishes=new Map;serial=0;baseEoseTimeout=4400;constructor(t,e){this.ndkRelay=t,this._status=1;const n=Math.floor(1e3*Math.random());this.debug=this.ndkRelay.debug.extend("connectivity"+n),this.ndk=e}async connect(t,e=!0){if(1!==this._status||this.reconnectTimeout)this.debug("Relay requested to be connected but was in state %s or it had a reconnect timeout",this._status);else{this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),t??=this.timeoutMs,!this.timeoutMs&&t&&(this.timeoutMs=t),this.timeoutMs&&(this.connectTimeout=setTimeout((()=>this.onConnectionError(e)),this.timeoutMs));try{this.updateConnectionStats.attempt(),1===this._status?this._status=4:this._status=2,this.ws=new WebSocket(this.ndkRelay.url),this.ws.onopen=this.onConnect.bind(this),this.ws.onclose=this.onDisconnect.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onerror=this.onError.bind(this)}catch(t){throw this.debug(`Failed to connect to ${this.ndkRelay.url}`,t),this._status=1,e?this.handleReconnection():this.ndkRelay.emit("delayed-connect",1728e5),t}}}disconnect(){this._status=0;try{this.ws?.close()}catch(t){this.debug("Failed to disconnect",t),this._status=1}}onConnectionError(t){this.debug(`Error connecting to ${this.ndkRelay.url}`,this.timeoutMs),t&&!this.reconnectTimeout&&this.handleReconnection()}onConnect(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=void 0),this.connectTimeout&&(clearTimeout(this.connectTimeout),this.connectTimeout=void 0),this.updateConnectionStats.connected(),this._status=5,this.ndkRelay.emit("connect"),this.ndkRelay.emit("ready")}onDisconnect(){this.updateConnectionStats.disconnected(),this._status=1}onMessage(t){try{const e=JSON.parse(t.data),[n,r,...s]=e;switch(n){case"EVENT":{const t=this.openSubs.get(r),n=e[2];return t?void t.onevent(n):void this.debug(`Received event for unknown subscription ${r}`)}case"COUNT":{const t=e[2],n=this.openCountRequests.get(r);return void(n&&(n.resolve(t.count),this.openCountRequests.delete(r)))}case"EOSE":{const t=this.openSubs.get(r);if(!t)return;return void t.oneose()}case"OK":{const t=e[2],n=e[3],s=this.openEventPublishes.get(r),i=s?.pop();return s&&i?(t?i.resolve(n):i.reject(new Error(n)),void(0===s.length?this.openEventPublishes.delete(r):this.openEventPublishes.set(r,s))):void this.debug("Received OK for unknown event publish",r)}case"CLOSED":{const t=this.openSubs.get(r);if(!t)return;return void t.onclosed(e[2])}case"NOTICE":return void this.onNotice(e[1]);case"AUTH":return void this.onAuthRequested(e[1])}}catch(t){return void this.debug(`Error parsing message from ${this.ndkRelay.url}: ${t.message}`,t?.stack)}}async onAuthRequested(t){const e=this.ndkRelay.authPolicy??this.ndk?.relayAuthDefaultPolicy;if(this.debug("Relay requested authentication",{havePolicy:!!e}),7!==this._status)if(this._status=6,e){if(this._status>=5){let n;this._status=7;try{n=await e(this.ndkRelay,t)}catch(t){this.debug("Authentication policy threw an error",t),n=!1}if(this.debug("Authentication policy returned",!!n),n instanceof al||!0===n){n instanceof al&&await this.auth(n);const e=async()=>{if(this._status>=5&&this._status<8){const e=new al(this.ndk);e.kind=22242,e.tags=[["relay",this.ndkRelay.url],["challenge",t]],await e.sign(),this.auth(e).then((()=>{this._status=8,this.ndkRelay.emit("authed"),this.debug("Authentication successful")})).catch((t=>{this._status=6,this.ndkRelay.emit("auth:failed",t),this.debug("Authentication failed",t)}))}else this.debug("Authentication failed, it changed status, status is %d",this._status)};!0===n&&(this.ndk?.signer?e().catch((t=>{console.error("Error authenticating",t)})):(this.debug("No signer available for authentication localhost"),this.ndk?.once("signer:ready",e))),this._status=5,this.ndkRelay.emit("authed")}}}else this.ndkRelay.emit("auth",t);else this.debug("Already authenticating, ignoring")}onError(t){this.debug(`WebSocket error on ${this.ndkRelay.url}:`,t)}get status(){return this._status}isAvailable(){return 5===this._status}isFlapping(){const t=this._connectionStats.durations;if(t.length%3!=0)return!1;const e=t.reduce(((t,e)=>t+e),0)/t.length,n=t.map((t=>Math.pow(t-e,2))).reduce(((t,e)=>t+e),0)/t.length;return Math.sqrt(n)<1e3}async onNotice(t){this.ndkRelay.emit("notice",t)}handleReconnection(t=0){if(this.reconnectTimeout)return;if(this.isFlapping())return this.ndkRelay.emit("flapping",this._connectionStats),void(this._status=3);const e=this.connectedAt?Math.max(0,6e4-(Date.now()-this.connectedAt)):5e3*(this._connectionStats.attempts+1);this.reconnectTimeout=setTimeout((()=>{this.reconnectTimeout=void 0,this._status=2,this.connect().catch((e=>{t<5?setTimeout((()=>{this.handleReconnection(t+1)}),1e3*(t+1)^4):this.debug("Reconnect failed")}))}),e),this.ndkRelay.emit("delayed-connect",e),this.debug("Reconnecting in",e),this._connectionStats.nextReconnectAt=Date.now()+e}async send(t){this._status>=5&&this.ws?.readyState===WebSocket.OPEN?this.ws?.send(t):this.debug(`Not connected to ${this.ndkRelay.url} (%d), not sending message ${t}`,this._status)}async auth(t){const e=new Promise(((e,n)=>{const r=this.openEventPublishes.get(t.id)??[];r.push({resolve:e,reject:n}),this.openEventPublishes.set(t.id,r)}));return this.send('["AUTH",'+JSON.stringify(t.rawEvent())+"]"),e}async publish(t){const e=new Promise(((e,n)=>{const r=this.openEventPublishes.get(t.id)??[];r.length>0&&console.warn("Duplicate event publishing detected, you are publishing event "+t.id+" twice"),r.push({resolve:e,reject:n}),this.openEventPublishes.set(t.id,r)}));return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=e?.id||"count:"+this.serial,r=new Promise(((t,e)=>{this.openCountRequests.set(n,{resolve:t,reject:e})}));return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}close(t,e){this.send('["CLOSE","'+t+'"]');const n=this.openSubs.get(t);this.openSubs.delete(t),n&&n.onclose(e)}req(t){this.send('["REQ","'+t.subId+'",'+JSON.stringify(t.executeFilters).substring(1)),this.openSubs.set(t.subId,t)}updateConnectionStats={connected:()=>{this._connectionStats.success++,this._connectionStats.connectedAt=Date.now()},disconnected:()=>{this._connectionStats.connectedAt&&(this._connectionStats.durations.push(Date.now()-this._connectionStats.connectedAt),this._connectionStats.durations.length>100&&this._connectionStats.durations.shift()),this._connectionStats.connectedAt=void 0},attempt:()=>{this._connectionStats.attempts++,this._connectionStats.connectedAt=Date.now()}};get connectionStats(){return this._connectionStats}get url(){return this.ndkRelay.url}get connected(){return this._status>=5&&this.ws?.readyState===WebSocket.OPEN}},Sh=class{ndkRelay;debug;constructor(t){this.ndkRelay=t,this.debug=t.debug.extend("publisher")}async publish(t,e=2500){let n;const r=()=>new Promise(((e,n)=>{try{this.publishEvent(t).then((n=>{this.ndkRelay.emit("published",t),t.emit("relay:published",this.ndkRelay),e(!0)})).catch(n)}catch(t){n(t)}})),s=new Promise(((t,r)=>{n=setTimeout((()=>{n=void 0,r(new Error("Timeout: "+e+"ms"))}),e)})),i=()=>{r().then((t=>o(t))).catch((t=>a(t)))};let o,a;const c=e=>{throw this.ndkRelay.debug("Publish failed",e,t.id),this.ndkRelay.emit("publish:failed",t,e),t.emit("relay:publish:failed",this.ndkRelay,e),e},h=()=>{n&&clearTimeout(n),this.ndkRelay.removeListener("connect",i)};return this.ndkRelay.status>=5?Promise.race([r(),s]).catch(c).finally(h):Promise.race([new Promise(((t,e)=>{o=t,a=e,this.ndkRelay.once("connect",i)})),s]).catch(c).finally(h)}async publishEvent(t){return this.ndkRelay.connectivity.publish(t.rawEvent())}};function Rh(t){const e={};return t.forEach((t=>{Object.entries(t).forEach((([t,n])=>{Array.isArray(n)?void 0===e[t]?e[t]=[...n]:e[t]=Array.from(new Set([...e[t],...n])):e[t]=n}))})),e}var Ch=class{fingerprint;items=new Map;topSubscriptionManager;debug;status=0;onClose;relay;eosed=!1;itemsToRemoveAfterEose=[];executionTimer;fireTime;delayType;executeFilters;eventIds=new Set;constructor(t,e){this.relay=t;const n=Math.random().toString(36).substring(7);this.debug=t.debug.extend("subscription-"+n),this.fingerprint=e||Math.random().toString(36).substring(7)}_subId;get subId(){return this._subId||(this._subId=this.fingerprint.slice(0,15)),this._subId}subIdParts=new Set;addSubIdPart(t){this.subIdParts.add(t)}addItem(t,e){if(!this.items.has(t.internalId))switch(t.on("close",this.removeItem.bind(this,t)),this.items.set(t.internalId,{subscription:t,filters:e}),3!==this.status&&t.subId&&(!this._subId||this._subId.length<48)&&(0!==this.status&&1!==this.status||this.addSubIdPart(t.subId)),this.status){case 0:case 1:this.evaluateExecutionPlan(t);break;case 3:break;case 4:throw this.debug("Subscription is closed, cannot add new items"),new Error("Cannot add new items to a closed subscription")}}removeItem(t){this.eosed?(this.items.delete(t.internalId),0===this.items.size&&this.close()):this.itemsToRemoveAfterEose.push(t.internalId)}close(){if(4===this.status)return;const t=this.status;if(this.status=4,3===t)try{this.relay.close(this.subId)}catch(t){this.debug("Error closing subscription",t,this)}else this.debug("Subscription wanted to close but it wasn't running, this is probably ok",{subId:this.subId,prevStatus:t,sub:this});this.cleanup()}cleanup(){this.executionTimer&&clearTimeout(this.executionTimer),this.relay.off("ready",this.executeOnRelayReady),this.relay.off("authed",this.reExecuteAfterAuth),this.onClose&&this.onClose(this)}catchUpSubscription(t,e){this.debug("TODO: catch up subscription",t,e)}evaluateExecutionPlan(t){if(!t.isGroupable())return this.status=1,void this.execute();const e=t.groupableDelay,n=t.groupableDelayType;if(!e)throw new Error("Cannot group a subscription without a delay");if(0===this.status)this.schedule(e,n);else{const t=this.delayType,r=this.fireTime-Date.now();if("at-least"===t&&"at-least"===n)r<e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if("at-least"===t&&"at-most"===n)r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else if("at-most"===t&&"at-most"===n)r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n));else{if("at-most"!==t||"at-least"!==n)throw new Error("Unknown delay type combination "+t+" "+n);r>e&&(this.executionTimer&&clearTimeout(this.executionTimer),this.schedule(e,n))}}}schedule(t,e){this.status=1;const n=Date.now();this.fireTime=n+t,this.delayType=e;const r=setTimeout(this.execute.bind(this),t);"at-least"===e&&(this.executionTimer=r)}executeOnRelayReady=()=>{2===this.status&&(this.status=1,this.execute())};finalizeSubId(){this.subIdParts.size>0?this._subId=Array.from(this.subIdParts).join("-"):this._subId=this.fingerprint.slice(0,15),this._subId+="-"+Math.random().toString(36).substring(2,7)}reExecuteAfterAuth=(()=>{const t=this.subId;this.debug("Re-executing after auth",this.items.size),this.relay.close(this.subId),this._subId=void 0,this.status=1,this.execute(),this.debug("Re-executed after auth %s  %s",t,this.subId)}).bind(this);execute(){if(1===this.status){if(!this.relay.connected)return this.status=2,void this.relay.once("ready",this.executeOnRelayReady);this.relay.status<8&&this.relay.once("authed",this.reExecuteAfterAuth),this.status=3,this.finalizeSubId(),this.executeFilters=this.compileFilters(),this.relay.req(this)}}onstart(){}onevent(t){this.topSubscriptionManager?.seenEvent(t.id,this.relay);for(const{subscription:e}of this.items.values())oi(e.filters,t)&&e.eventReceived(t,this.relay,!1)}oneose(){this.eosed=!0;for(const{subscription:t}of this.items.values())t.eoseReceived(this.relay),t.closeOnEose&&this.removeItem(t)}onclose(t){this.status=4}onclosed(t){if(t)for(const{subscription:e}of this.items.values())e.closedReceived(this.relay,t)}compileFilters(){const t=[],e=Array.from(this.items.values()).map((t=>t.filters)),n=e[0].length;for(let r=0;r<n;r++){const n=e.map((t=>t[r]));t.push(Rh(n))}return t}},Uh=class{relay;subscriptions;topSubscriptionManager;debug;constructor(t,e){this.relay=t,this.subscriptions=new Map,this.debug=t.debug.extend("sub-manager"),this.topSubscriptionManager=e}addSubscription(t,e){let n;if(t.isGroupable()){const r=function(t,e){const n=[];for(const e of t){if(e.since||e.until)return;const t=Object.keys(e||{}).sort().join("-");n.push(t)}let r=e?"+":"";return r+=n.join("|"),r}(e,t.closeOnEose);r&&(n=this.subscriptions.get(r)),n??=this.createSubscription(t,e,r)}else n=this.createSubscription(t,e);n.addItem(t,e)}createSubscription(t,e,n){const r=new Ch(this.relay,n);return r.topSubscriptionManager=this.topSubscriptionManager,r.onClose=this.onRelaySubscriptionClose.bind(this),this.subscriptions.set(r.fingerprint,r),r}onRelaySubscriptionClose(t){this.subscriptions.delete(t.fingerprint)}},Ih=class t extends Vo.EventEmitter{url;scores;connectivity;subs;publisher;authPolicy;lowestValidationRatio;targetValidationRatio;validationRatioFn;validatedEventCount=0;nonValidatedEventCount=0;trusted=!1;complaining=!1;debug;static defaultValidationRatioUpdateFn=(t,e,n)=>{if(void 0===t.lowestValidationRatio||void 0===t.targetValidationRatio)return 1;let r=t.validationRatio;if(t.validationRatio>t.targetValidationRatio){const n=e/100;r=Math.max(t.lowestValidationRatio,t.validationRatio-n)}return r<t.validationRatio?r:t.validationRatio};constructor(e,n,r){super(),this.url=mh(e),this.scores=new Map,this.debug=jo(`ndk:relay:${e}`),this.connectivity=new _h(this,r),this.req=this.connectivity.req.bind(this.connectivity),this.close=this.connectivity.close.bind(this.connectivity),this.subs=new Uh(this,r?.subManager),this.publisher=new Sh(this),this.authPolicy=n,this.targetValidationRatio=r?.initialValidationRatio,this.lowestValidationRatio=r?.lowestValidationRatio,this.validationRatioFn=(r?.validationRatioFn??t.defaultValidationRatioUpdateFn).bind(this),this.updateValidationRatio(),r||console.trace("relay created without ndk")}updateValidationRatio(){setTimeout((()=>{this.updateValidationRatio()}),3e4)}get status(){return this.connectivity.status}get connectionStats(){return this.connectivity.connectionStats}async connect(t,e=!0){return this.connectivity.connect(t,e)}disconnect(){1!==this.status&&this.connectivity.disconnect()}subscribe(t,e){this.subs.addSubscription(t,e)}async publish(t,e=2500){return this.publisher.publish(t,e)}referenceTags(){return[["r",this.url]]}addValidatedEvent(){this.validatedEventCount++}addNonValidatedEvent(){this.nonValidatedEventCount++}get validationRatio(){return 0===this.nonValidatedEventCount?1:this.validatedEventCount/(this.validatedEventCount+this.nonValidatedEventCount)}shouldValidateEvent(){return!this.trusted&&(void 0===this.targetValidationRatio||this.validationRatio<this.targetValidationRatio)}get connected(){return this.connectivity.connected}req;close},Th=class extends Error{errors;publishedToRelays;intendedRelaySet;constructor(t,e,n,r){super(t),this.errors=e,this.publishedToRelays=n,this.intendedRelaySet=r}get relayErrors(){const t=[];for(const[e,n]of this.errors)t.push(`${e.url}: ${n}`);return t.join("\n")}},Nh=class t{relays;debug;ndk;constructor(t,e){this.relays=t,this.ndk=e,this.debug=e.debug.extend("relayset")}addRelay(t){this.relays.add(t)}get relayUrls(){return Array.from(this.relays).map((t=>t.url))}static fromRelayUrls(e,n,r=!0){const s=new Set;for(const t of e){const i=n.pool.relays.get(mh(t));if(i)i.status<5&&r&&i.connect(),s.add(i);else{const r=new Ih(mh(t),n?.relayAuthDefaultPolicy,n);n.pool.useTemporaryRelay(r,void 0,"requested from fromRelayUrls "+e),s.add(r)}}return new t(new Set(s),n)}async publish(t,e,n=1){const r=new Set,s=new Map,i=t.isEphemeral();t.publishStatus="pending";const o=Array.from(this.relays).map((n=>new Promise((o=>{n.publish(t,e).then((t=>{r.add(n),o()})).catch((t=>{i||s.set(n,t),o()}))}))));if(await Promise.all(o),r.size<n){if(!i){const e=new Th("Not enough relays received the event",s,r,this);throw t.publishStatus="error",t.publishError=e,this.ndk.emit("event:publish-failed",t,e,this.relayUrls),e}}else t.emit("published",{relaySet:this,publishedToRelays:r});return r}get size(){return this.relays.size}},Lh=jo("ndk:outbox:calculate");async function Bh(t,e){const n=new Set,r=await async function(t,e,n="write"){if(t.outboxTracker)return t.outboxTracker.data.has(e)||await t.outboxTracker.trackUsers([e]),yh(t,e,n)}(t,e.pubkey);r&&r.forEach((e=>{const r=t.pool?.getRelay(e);r&&n.add(r)}));let s=e.tags.filter((t=>["a","e"].includes(t[0]))).map((t=>t[2])).filter((t=>t&&t.startsWith("wss://"))).filter((t=>{try{return new URL(t),!0}catch{return!1}})).map((t=>mh(t)));s=Array.from(new Set(s)).slice(0,5),s.forEach((e=>{const r=t.pool?.getRelay(e,!0,!0);r&&(Lh("Adding relay hint %s",e),n.add(r))}));const i=e.getMatchingTags("p").map((t=>t[1]));if(i.length<5){Array.from(wh(t,i,"read",{preferredRelays:new Set(r)}).keys()).forEach((e=>{const r=t.pool?.getRelay(e,!1,!0);r&&(Lh("Adding p-tagged relay %s",e),n.add(r))}))}else Lh("Too many p-tags to consider %d",i.length);return t.pool?.permanentAndConnectedRelays().forEach((t=>n.add(t))),new Nh(n,t)}function Ph(t,e,n){const r=new Map,s=new Set;if(e.forEach((t=>{t.authors&&t.authors.forEach((t=>s.add(t)))})),s.size>0){const n=function(t,e,n=2){return wh(t,e,"write",{count:n})}(t,Array.from(s));for(const t of n.keys())r.set(t,[]);for(const t of e)if(t.authors)for(const[e,s]of n.entries()){const n=t.authors.filter((t=>s.includes(t)));r.set(e,[...r.get(e),{...t,authors:n}])}else for(const e of n.keys())r.set(e,[...r.get(e),t])}else t.explicitRelayUrls&&t.explicitRelayUrls.forEach((t=>{r.set(t,e)}));return 0===r.size&&n.permanentAndConnectedRelays().slice(0,5).forEach((t=>{r.set(t.url,e)})),0===r.size&&console.warn("No relays found for filter",e),r}function Oh(t,e,n){return Ph(t,e,n)}async function Fh(t){return""}function $h(){if(void 0===this.kind)throw new Error("Kind not set");return[0,3].includes(this.kind)||this.kind>=1e4&&this.kind<2e4||this.kind>=3e4&&this.kind<4e4}function Mh(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=2e4&&this.kind<3e4}function Dh(){if(void 0===this.kind)throw new Error("Kind not set");return this.kind>=3e4&&this.kind<4e4}async function qh(t,e){if(!this.ndk)throw new Error("No NDK instance found!");if(e||(await this.ndk.assertSigner(),e=this.ndk.signer),!t){const e=this.getMatchingTags("p");if(1!==e.length)throw new Error("No recipient could be determined and no explicit recipient was provided");t=this.ndk.getUser({pubkey:e[0][1]})}this.content=await(e?.encrypt(t,this.content))}async function zh(t,e){if(!this.ndk)throw new Error("No NDK instance found!");e||(await this.ndk.assertSigner(),e=this.ndk.signer),t||(t=this.author),this.content=await(e?.decrypt(t,this.content))}function Hh(){let t=[];return this.onRelays.length>0?t=this.onRelays.map((t=>t.url)):this.relay&&(t=[this.relay.url]),this.isParamReplaceable()?pi.naddrEncode({kind:this.kind,pubkey:this.pubkey,identifier:this.replaceableDTag(),relays:t}):t.length>0?pi.neventEncode({id:this.tagId(),relays:t,author:this.pubkey}):pi.noteEncode(this.tagId())}async function Vh(t=!0,e){if(!e&&t){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e=this.ndk.signer}const n=new al(this.ndk,{kind:jh(this),content:""});return n.tag(this),16===n.kind?n.tags.push(["k",`${this.kind}`]):n.content=JSON.stringify(this.rawEvent()),e&&await n.sign(e),t&&await n.publish(),n}function jh(t){return 1===t.kind?6:16}var Kh;function Wh(t){return t.getMatchingTags("e").some((t=>t[3]))}function Zh(t,e){e??=t.tagType();const n=t.tags.find((t=>"root"===t[3]));if(!n){if(Wh(t))return;const n=t.getMatchingTags(e);if(n.length<3)return n[0]}return n}function Jh(t,e){e??=t.tagType();let n=t.tags.find((t=>"reply"===t[3]));if(n)return n;if(n||(n=t.tags.find((t=>"root"===t[3]))),!n){if(Wh(t))return;const n=t.getMatchingTags(e);if(1===n.length)return n[0];if(2===n.length)return n[1]}}async function Yh(t,e){if(!this.ndk)throw new Error("NDK instance not found");const n=this.getMatchingTags(t,e);if(0===n.length)return;const[r,s,i]=n[0];return await this.ndk.fetchEvent(s,{},undefined)}async function Gh(t){if(!this.ndk)throw new Error("NDK instance not found");const e=Zh(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}async function Qh(t){if(!this.ndk)throw new Error("NDK instance not found");const e=Jh(this);if(e)return this.ndk.fetchEventFromTag(e,this,t)}function Xh(t=!1,e=!1){const n=[0,this.pubkey,this.created_at,this.kind,this.tags,this.content];return t&&n.push(this.sig),e&&n.push(this.id),JSON.stringify(n)}var tl={};var el=/^[a-f0-9]{64}$/;function nl(){if("number"!=typeof this.kind)return!1;if("string"!=typeof this.content)return!1;if("number"!=typeof this.created_at)return!1;if("string"!=typeof this.pubkey)return!1;if(!this.pubkey.match(el))return!1;if(!Array.isArray(this.tags))return!1;for(let t=0;t<this.tags.length;t++){const e=this.tags[t];if(!Array.isArray(e))return!1;for(let t=0;t<e.length;t++)if("object"==typeof e[t])return!1}return!0}var rl=new Dc.LRUCache({maxSize:1e3,entryExpirationTimeInMS:6e4});function sl(t){if("boolean"==typeof this.signatureVerified)return this.signatureVerified;const e=rl.get(this.id);if(null!==e)return this.signatureVerified=!!e;try{if(!this.ndk?.asyncSigVerification){const t=ga((new TextEncoder).encode(this.serialize())),e=Mc.verify(this.sig,t,this.pubkey);return e?rl.set(this.id,this.sig):rl.set(this.id,!1),this.signatureVerified=e}(async function(t,e){return new Promise((e=>{const n=t.serialize();let r=!1;tl[t.id]||(tl[t.id]={event:t,resolves:[]},r=!0),tl[t.id].resolves.push(e),r&&Kh.postMessage({serialized:n,id:t.id,sig:t.sig,pubkey:t.pubkey})}))})(this).then((e=>{t&&(this.signatureVerified=e,e&&rl.set(this.id,this.sig)),e||(this.ndk.emit("event:invalid-sig",this),rl.set(this.id,!1))}))}catch(t){return this.signatureVerified=!1}}function il(){return t=this.serialize(),ea(ga((new TextEncoder).encode(t)));var t}var ol=[3],al=class t extends Vo.EventEmitter{ndk;created_at;content="";tags=[];kind;id="";sig;pubkey="";signatureVerified;_author=void 0;relay;get onRelays(){let t=[];return this.ndk?t=this.ndk.subManager.seenEvents.get(this.id)||[]:this.relay&&t.push(this.relay),t}publishStatus="success";publishError;constructor(e,n){super(),this.ndk=e,this.created_at=n?.created_at,this.content=n?.content||"",this.tags=n?.tags||[],this.id=n?.id||"",this.sig=n?.sig,this.pubkey=n?.pubkey||"",this.kind=n?.kind,n instanceof t&&(this.relay&&(this.relay=n.relay,this.ndk?.subManager.seenEvent(n.id,this.relay)),this.publishStatus=n.publishStatus,this.publishError=n.publishError)}static deserialize(e,n){return new t(e,function(t){const e=JSON.parse(t),n={pubkey:e[1],created_at:e[2],kind:e[3],tags:e[4],content:e[5]};return 7===e.length&&(n.sig=e[6]),8===e.length&&(n.id=e[7]),n}(n))}rawEvent(){return{created_at:this.created_at,content:this.content,tags:this.tags,kind:this.kind,pubkey:this.pubkey,id:this.id,sig:this.sig}}set author(t){this.pubkey=t.pubkey,this._author=t,this._author.ndk??=this.ndk}get author(){if(this._author)return this._author;if(!this.ndk)throw new Error("No NDK instance found");const t=this.ndk.getUser({pubkey:this.pubkey});return this._author=t,t}tag(e,n,r,s){let i=[];if(void 0!==e.fetchProfile){s??="p";const t=[s,e.pubkey];n&&t.push("",n),i.push(t)}else if(e instanceof t){const t=e;r??=t?.pubkey===this.pubkey,i=t.referenceTags(n,r,s);for(const e of t.getMatchingTags("p"))e[1]!==this.pubkey&&(this.tags.find((t=>"p"===t[0]&&t[1]===e[1]))||this.tags.push(["p",e[1]]))}else{if(!Array.isArray(e))throw new Error("Invalid argument",e);i=[e]}this.tags=function(t,e){const n=new Map,r=(t,e)=>t.every(((t,n)=>t===e[n]));return t.concat(e).forEach((t=>{for(const[e,s]of n)if(r(s,t)||r(t,s))return void(t.length>=s.length&&n.set(e,t));n.set((t=>t.join(","))(t),t)})),Array.from(n.values())}(this.tags,i)}async toNostrEvent(t){if(!t&&""===this.pubkey){const t=await(this.ndk?.signer?.user());this.pubkey=t?.pubkey||""}this.created_at||(this.created_at=Math.floor(Date.now()/1e3));const{content:e,tags:n}=await this.generateTags();this.content=e||"",this.tags=n;try{this.id=this.getEventHash()}catch(t){}return this.rawEvent()}serialize=Xh.bind(this);getEventHash=il.bind(this);validate=nl.bind(this);verifySignature=sl.bind(this);isReplaceable=$h.bind(this);isEphemeral=Mh.bind(this);isParamReplaceable=Dh.bind(this);encode=Hh.bind(this);encrypt=qh.bind(this);decrypt=zh.bind(this);getMatchingTags(t,e){const n=this.tags.filter((e=>e[0]===t));return void 0===e?n:n.filter((t=>t[3]===e))}hasTag(t,e){return this.tags.some((n=>n[0]===t&&(!e||n[3]===e)))}tagValue(t){const e=this.getMatchingTags(t);if(0!==e.length)return e[0][1]}get alt(){return this.tagValue("alt")}set alt(t){this.removeTag("alt"),t&&this.tags.push(["alt",t])}get dTag(){return this.tagValue("d")}set dTag(t){this.removeTag("d"),t&&this.tags.push(["d",t])}removeTag(t){const e=Array.isArray(t)?t:[t];this.tags=this.tags.filter((t=>!e.includes(t[0])))}async sign(t){t?this.author=await t.user():(this.ndk?.assertSigner(),t=this.ndk.signer);const e=await this.toNostrEvent();return this.sig=await t.sign(e),this.sig}async publishReplaceable(t,e,n){return this.id="",this.created_at=Math.floor(Date.now()/1e3),this.sig="",this.publish(t,e,n)}async publish(t,e,n){if(this.sig||await this.sign(),!this.ndk)throw new Error("NDKEvent must be associated with an NDK instance to publish");t||(t=this.ndk.devWriteRelaySet||await Bh(this.ndk,this)),5===this.kind&&this.ndk.cacheAdapter?.deleteEvent&&this.ndk.cacheAdapter.deleteEvent(this);const r=this.rawEvent();if(this.ndk.cacheAdapter?.addUnpublishedEvent)try{this.ndk.cacheAdapter.addUnpublishedEvent(this,t.relayUrls)}catch(t){console.error("Error adding unpublished event to cache",t)}this.ndk.subManager.subscriptions.forEach((t=>{t.filters.some((t=>ii(t,r)))&&t.eventReceived(this,void 0,!1,!0)}));const s=await t.publish(this,e,n);return s.forEach((t=>this.ndk?.subManager.seenEvent(this.id,t))),s}async generateTags(){let t=[];const e=await async function(t,e=[]){const n=[],r=t=>{e.find((e=>["q",t[0]].includes(e[0])&&e[1]===t[1]))||e.push(t)};return t=t.replace(/(@|nostr:)(npub|nprofile|note|nevent|naddr)[a-zA-Z0-9]+/g,(t=>{try{const e=t.split(/(@|nostr:)/)[2],{type:s,data:i}=pi.decode(e);let o;switch(s){case"npub":o=["p",i];break;case"nprofile":o=["p",i.pubkey];break;case"note":n.push(new Promise((async t=>{r(["e",i,await Fh(),"mention"]),t()})));break;case"nevent":n.push(new Promise((async t=>{const{id:e,author:n}=i;let{relays:s}=i;s&&0!==s.length||(s=[await Fh()]),r(["e",e,s[0],"mention"]),n&&r(["p",n]),t()})));break;case"naddr":n.push(new Promise((async t=>{const e=[i.kind,i.pubkey,i.identifier].join(":");let n=i.relays??[];0===n.length&&(n=[await Fh()]),r(["a",e,n[0],"mention"]),r(["p",i.pubkey]),t()})));break;default:return t}return o&&r(o),`nostr:${e}`}catch(e){return t}})),await Promise.all(n),{content:t=t.replace(/(?<=\s|^)(#[^\s!@#$%^&*()=+./,[{\]};:'"?><]+)/g,((t,n)=>{const r=["t",n.slice(1)];return e.find((t=>t[0]===r[0]&&t[1]===r[1]))||e.push(r),t})),tags:e}}(this.content,this.tags),n=e.content;if(t=e.tags,this.kind&&this.isParamReplaceable()){if(!this.getMatchingTags("d")[0]){const e=this.tagValue("title");let n=[...Array(e?6:16)].map((()=>Math.random().toString(36)[2])).join("");e&&e.length>0&&(n=e.replace(/[^a-z0-9]+/gi,"-").replace(/^-|-$/g,"")+"-"+n),t.push(["d",n])}}if((this.ndk?.clientName||this.ndk?.clientNip89)&&ol.includes(this.kind)&&!this.tags.some((t=>"client"===t[0]))){const e=["client",this.ndk.clientName??""];this.ndk.clientNip89&&e.push(this.ndk.clientNip89),t.push(e)}return{content:n||"",tags:t}}muted(){const t=this.ndk?.mutedIds.get(this.pubkey);if(t&&"p"===t)return"author";const e=this.tagReference(),n=this.ndk?.mutedIds.get(e[1]);return n&&n===e[0]?"event":null}replaceableDTag(){if(this.kind&&this.kind>=3e4&&this.kind<=4e4){const t=this.getMatchingTags("d")[0];return t?t[1]:""}throw new Error("Event is not a parameterized replaceable event")}deduplicationKey(){return 0===this.kind||3===this.kind||this.kind&&this.kind>=1e4&&this.kind<2e4?`${this.kind}:${this.pubkey}`:this.tagId()}tagId(){return this.isParamReplaceable()?this.tagAddress():this.id}tagAddress(){if(!this.isParamReplaceable())throw new Error("This must only be called on replaceable events");const t=this.replaceableDTag();return`${this.kind}:${this.pubkey}:${t}`}tagType(){return this.isParamReplaceable()?"a":"e"}tagReference(t){let e;return e=this.isParamReplaceable()?["a",this.tagAddress()]:["e",this.tagId()],this.relay?e.push(this.relay.url):e.push(""),t&&e.push(t),e}referenceTags(t,e,n){let r=[];return r=this.isParamReplaceable()?[[n??"a",this.tagAddress()],[n??"e",this.id]]:[[n??"e",this.id]],this.relay?.url?r=r.map((t=>(t.push(this.relay?.url),t))):t&&(r=r.map((t=>(t.push(""),t)))),t&&r.forEach((e=>e.push(t))),r=[...r,...this.getMatchingTags("h")],e||r.push(...this.author.referenceTags()),r}filter(){return this.isParamReplaceable()?{"#a":[this.tagId()]}:{"#e":[this.tagId()]}}async delete(e,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new t(this.ndk,{kind:5,content:e||""});return r.tag(this,void 0,!0),r.tags.push(["k",this.kind.toString()]),n&&await r.publish(),r}fetchTaggedEvent=Yh.bind(this);fetchRootEvent=Gh.bind(this);fetchReplyEvent=Qh.bind(this);repost=Vh.bind(this);async react(e,n=!0){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner();const r=new t(this.ndk,{kind:7,content:e});return r.tag(this),n?await r.publish():await r.sign(),r}get isValid(){return this.validate()}};function cl(t){return!(!t.filter.ids||!function(t){const e=t.filter.ids;return!!e&&e.length===t.eventFirstSeen.size}(t))}function hl(t){let e;if(t.match(ll)){const[e,n,r]=t.split(":"),s={authors:[n],kinds:[parseInt(e)]};return r&&(s["#d"]=[r]),s}if(t.match(ul))try{switch(e=pi.decode(t),e.type){case"nevent":{const t={ids:[e.data.id]};return e.data.author&&(t.authors=[e.data.author]),e.data.kind&&(t.kinds=[e.data.kind]),t}case"note":return{ids:[e.data]};case"naddr":const t={authors:[e.data.pubkey],kinds:[e.data.kind]};return e.data.identifier&&(t["#d"]=[e.data.identifier]),t}}catch(e){console.error("Error decoding",t,e)}return{ids:[t]}}var ll=/^(\d+):([0-9A-Fa-f]+)(?::(.*))?$/,ul=/^n(event|ote|profile|pub|addr)1[\d\w]+$/;var dl={closeOnEose:!1,cacheUsage:"CACHE_FIRST",groupable:!0,groupableDelay:100,groupableDelayType:"at-most"},fl=class extends Vo.EventEmitter{subId;filters;opts;pool;skipVerification=!1;skipValidation=!1;relayFilters;relaySet;ndk;debug;eventFirstSeen=new Map;eosesSeen=new Set;lastEventReceivedAt;internalId;closeOnEose;poolMonitor;constructor(t,e,n,r,s){if(super(),this.ndk=t,this.pool=n?.pool||t.pool,this.opts={...dl,...n||{}},this.filters=e instanceof Array?e:[e],this.subId=s||n?.subId,this.internalId=Math.random().toString(36).substring(7),this.relaySet=r,this.debug=t.debug.extend(`subscription[${n?.subId??this.internalId}]`),this.skipVerification=n?.skipVerification||!1,this.skipValidation=n?.skipValidation||!1,this.closeOnEose=n?.closeOnEose||!1,"ONLY_CACHE"===this.opts.cacheUsage&&!this.opts.closeOnEose)throw new Error("Cannot use cache-only options with a persistent subscription")}relaysMissingEose(){if(!this.relayFilters)return[];return Array.from(this.relayFilters.keys()).filter((t=>!this.eosesSeen.has(this.pool.getRelay(t,!1,!1))))}get filter(){return this.filters[0]}get groupableDelay(){if(this.isGroupable())return this.opts?.groupableDelay}get groupableDelayType(){return this.opts?.groupableDelayType||"at-most"}isGroupable(){return this.opts?.groupable||!1}shouldQueryCache(){return"ONLY_RELAY"!==this.opts?.cacheUsage}shouldQueryRelays(){return"ONLY_CACHE"!==this.opts?.cacheUsage}shouldWaitForCache(){return this.opts.closeOnEose&&!!this.ndk.cacheAdapter?.locking&&"PARALLEL"!==this.opts.cacheUsage}async start(){let t;this.shouldQueryCache()&&(t=this.startWithCache(),this.shouldWaitForCache()&&(await t,cl(this)))?this.emit("eose",this):this.shouldQueryRelays()?(this.startWithRelays(),this.startPoolMonitor()):this.emit("eose",this)}startPoolMonitor(){this.debug.extend("pool-monitor");this.poolMonitor=t=>{if(this.relayFilters?.has(t.url))return;Oh(this.ndk,this.filters,this.pool).get(t.url)&&(this.relayFilters?.set(t.url,this.filters),t.subscribe(this,this.filters))},this.pool.on("relay:connect",this.poolMonitor)}stop(){this.emit("close",this),this.poolMonitor&&this.pool.off("relay:connect",this.poolMonitor),this.removeAllListeners()}hasAuthorsFilter(){return this.filters.some((t=>t.authors?.length))}async startWithCache(){if(this.ndk.cacheAdapter?.query){const t=this.ndk.cacheAdapter.query(this);this.ndk.cacheAdapter.locking&&await t}}startWithRelays(){if(this.relaySet){this.relayFilters=new Map;for(const t of this.relaySet.relays)this.relayFilters.set(t.url,this.filters)}else this.relayFilters=Oh(this.ndk,this.filters,this.pool);if(this.relayFilters&&0!==this.relayFilters.size)for(const[t,e]of this.relayFilters){this.pool.getRelay(t,!0,!0,e).subscribe(this,e)}}eventReceived(t,e,n=!1,r=!1){const s=t.id,i=this.eventFirstSeen.has(s);let o;if(t instanceof al&&(o=t),i){const n=Date.now()-(this.eventFirstSeen.get(s)||0);if(this.emit("event:dup",s,e,n,this),e){const n=rl.get(s);n&&"string"==typeof n&&t.sig===n&&e.addValidatedEvent()}}else{if(o??=new al(this.ndk,t),o.ndk=this.ndk,o.relay=e,!n&&!r){if(!this.skipValidation&&!o.isValid)return void this.debug("Event failed validation %s from relay %s",s,e?.url);if(e)if(!1!==e?.shouldValidateEvent()){if(!this.skipVerification){if(!o.verifySignature(!0)&&!this.ndk.asyncSigVerification)return void this.debug("Event failed signature validation",t);e&&e.addValidatedEvent()}}else e.addNonValidatedEvent();this.ndk.cacheAdapter&&this.ndk.cacheAdapter.setEvent(o,this.filters,e)}!n&&e&&this.ndk.emit("event",o,e),this.emit("event",o,e,this),this.eventFirstSeen.set(s,Date.now())}this.lastEventReceivedAt=Date.now()}closedReceived(t,e){this.emit("closed",t,e)}eoseTimeout;eosed=!1;eoseReceived(t){this.debug("Received EOSE from %s",t.url),this.eosesSeen.add(t);let e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0;const n=this.eosesSeen.size===this.relayFilters?.size,r=cl(this),s=t=>{this.eosed||(this.eoseTimeout&&clearTimeout(this.eoseTimeout),this.debug(`Performing EOSE: ${t}`),this.emit("eose",this),this.eosed=!0,this.opts?.closeOnEose&&this.stop())};if(r||n)s("query filled or seen all");else if(this.relayFilters){let t=1e3;const n=new Set(this.pool.connectedRelays().map((t=>t.url))),r=Array.from(this.relayFilters.keys()).filter((t=>n.has(t)));if(0===r.length)return;const i=this.eosesSeen.size/r.length;if(this.eosesSeen.size>=2&&i>=.5){if(t*=1-i,0===t)return void s("tiem to wait was 0");this.eoseTimeout&&clearTimeout(this.eoseTimeout);const n=()=>{e=this.lastEventReceivedAt?Date.now()-this.lastEventReceivedAt:void 0,void 0!==e&&e<20?this.eoseTimeout=setTimeout(n,t):s("send eose timeout: "+t)};this.eoseTimeout=setTimeout(n,t)}}}};async function pl(t,e,n=3){if(!this.ndk)throw new Error("NDK not set");const r=await this.ndk.fetchEvent({kinds:[n],authors:[this.pubkey]},t||{groupable:!1});if(r){const t=new Set;return r.tags.forEach((e=>{"p"===e[0]&&t.add(e[1])})),e&&this.ndk?.outboxTracker?.trackUsers(Array.from(t)),[...t].reduce(((t,e)=>{const n=new kl({pubkey:e});return n.ndk=this.ndk,t.add(n),t}),new Set)}return new Set}function gl(t){const e={};let n;try{n=JSON.parse(t.content)}catch(t){throw new Error(`Failed to parse profile event: ${t}`)}return e.created_at=t.created_at,e.profileEvent=JSON.stringify(t.rawEvent()),Object.keys(n).forEach((t=>{switch(t){case"name":e.name=n.name;break;case"display_name":e.displayName=n.display_name;break;case"image":case"picture":e.image=n.picture||n.image;break;case"banner":e.banner=n.banner;break;case"bio":e.bio=n.bio;break;case"nip05":e.nip05=n.nip05;break;case"lud06":e.lud06=n.lud06;break;case"lud16":e.lud16=n.lud16;break;case"about":e.about=n.about;break;case"zapService":e.zapService=n.zapService;break;case"website":e.website=n.website;break;default:e[t]=n[t]}})),e}function yl(t){const e={};for(const[n,r]of Object.entries(t))switch(n){case"username":case"name":e.name=r;break;case"displayName":e.display_name=r;break;case"image":case"picture":e.picture=r;break;case"bio":case"about":e.about=r;break;default:e[n]=r}return JSON.stringify(e)}var wl=/^(?:([\w.+-]+)@)?([\w.-]+)$/;async function bl(t,e,n=fetch,r={}){return await t.queuesNip05.add({id:e,func:async()=>{if(t.cacheAdapter&&t.cacheAdapter.loadNip05){const n=await t.cacheAdapter.loadNip05(e);if("missing"!==n){if(n){const e=new kl({pubkey:n.pubkey,relayUrls:n.relays,nip46Urls:n.nip46});return e.ndk=t,e}if("no-cache"!==r.cache)return null}}const s=e.match(wl);if(!s)return null;const[i,o="_",a]=s;try{const s=await n(`https://${a}/.well-known/nostr.json?name=${o}`,r),{names:i,relays:c,nip46:h}=function(t){const e={names:{}};for(const[n,r]of Object.entries(t.names))"string"==typeof n&&"string"==typeof r&&(e.names[n.toLowerCase()]=r);if(t.relays){e.relays={};for(const[n,r]of Object.entries(t.relays))"string"==typeof n&&Array.isArray(r)&&(e.relays[n]=r.filter((t=>"string"==typeof t)))}if(t.nip46){e.nip46={};for(const[n,r]of Object.entries(t.nip46))"string"==typeof n&&Array.isArray(r)&&(e.nip46[n]=r.filter((t=>"string"==typeof t)))}return e}(await s.json()),l=i[o.toLowerCase()];let u=null;return l&&(u={pubkey:l,relays:c?.[l],nip46:h?.[l]}),t?.cacheAdapter&&t.cacheAdapter.saveNip05&&t.cacheAdapter.saveNip05(e,u),u}catch(n){return t?.cacheAdapter&&t.cacheAdapter.saveNip05&&t?.cacheAdapter.saveNip05(e,null),console.error("Failed to fetch NIP05 for",e,n),null}}})}var ml=class t extends al{static kind=10019;static kinds=[10019];_p2pk;constructor(t,e){super(t,e),this.kind??=10019}static from(e){return new t(e.ndk,e)}set relays(t){this.tags=this.tags.filter((t=>"relay"!==t[0]));for(const e of t)this.tags.push(["relay",e])}get relays(){const t=[];for(const e of this.tags)"relay"===e[0]&&t.push(e[1]);return t}set mints(t){this.tags=this.tags.filter((t=>"mint"!==t[0]));for(const e of t)this.tags.push(["mint",e])}get mints(){const t=[];for(const e of this.tags)"mint"===e[0]&&t.push(e[1]);return Array.from(new Set(t))}get p2pk(){return this._p2pk||(this._p2pk=this.tagValue("pubkey")??this.pubkey),this._p2pk}set p2pk(t){this._p2pk=t,this.removeTag("pubkey"),t&&this.tags.push(["pubkey",t])}get relaySet(){return Nh.fromRelayUrls(this.relays,this.ndk)}},vl=jo("ndk:zapper:ln");async function El({lud06:t,lud16:e},n){let r;if(e&&!e.startsWith("LNURL")){const[t,n]=e.split("@");r=`https://${n}/.well-known/lnurlp/${t}`}else if(t){const{words:e}=ph.decode(t,1e3),n=ph.fromWords(e);r=new TextDecoder("utf-8").decode(n)}if(!r)throw vl("No zap endpoint found %o",{lud06:t,lud16:e}),new Error("No zap endpoint found");try{const t=n.httpFetch||fetch,e=await t(r);if(200!==e.status){const t=await e.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}return await e.json()}catch(t){throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}}var kl=class t{ndk;profile;_npub;_pubkey;relayUrls=[];nip46Urls=[];constructor(t){t.npub&&(this._npub=t.npub),t.hexpubkey&&(this._pubkey=t.hexpubkey),t.pubkey&&(this._pubkey=t.pubkey),t.relayUrls&&(this.relayUrls=t.relayUrls),t.nip46Urls&&(this.nip46Urls=t.nip46Urls)}get npub(){if(!this._npub){if(!this._pubkey)throw new Error("pubkey not set");this._npub=pi.npubEncode(this.pubkey)}return this._npub}set npub(t){this._npub=t}get hexpubkey(){return this.pubkey}set hexpubkey(t){this._pubkey=t}get pubkey(){if(!this._pubkey){if(!this._npub)throw new Error("npub not set");this._pubkey=pi.decode(this.npub).data}return this._pubkey}set pubkey(t){this._pubkey=t}async getZapInfo(t=!0,e=["nip61","nip57"]){if(!this.ndk)throw new Error("No NDK instance found");const n=[];if(e.includes("nip61")&&n.push(10019),e.includes("nip57")&&n.push(0),0===n.length)return[];let r=await this.ndk.fetchEvents({kinds:n,authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",groupable:!1});r.size<e.length&&(r=await this.ndk.fetchEvents({kinds:n,authors:[this.pubkey]},{cacheUsage:"ONLY_RELAY"}));const s=[],i=Array.from(r).find((t=>10019===t.kind)),o=Array.from(r).find((t=>0===t.kind));if(i){const e=ml.from(i);if(e.mints.length>0&&s.push({type:"nip61",data:{mints:e.mints,relays:e.relays,p2pk:e.p2pk}}),!t)return s}if(o){const t=gl(o),{lud06:e,lud16:n}=t;try{const t=await El({lud06:e,lud16:n},this.ndk);t&&s.push({type:"nip57",data:t})}catch(t){console.error("Error getting NIP-57 zap spec",t)}}return s}async getZapConfiguration(t){if(t??=this.ndk,!t)throw new Error("No NDK instance found");return await t.queuesZapConfig.add({id:this.pubkey,func:async()=>{if(this.ndk?.cacheAdapter?.loadUsersLNURLDoc){const t=await this.ndk.cacheAdapter.loadUsersLNURLDoc(this.pubkey);if("missing"!==t){if(null===t)return;if(t)return t}}let e;try{if(await this.fetchProfile({groupable:!1}),this.profile){const{lud06:n,lud16:r}=this.profile;e=await El({lud06:n,lud16:r},t)}}catch{}if(this.ndk?.cacheAdapter?.saveUsersLNURLDoc&&this.ndk.cacheAdapter.saveUsersLNURLDoc(this.pubkey,e||null),e)return e}})}async getZapperPubkey(){const t=await this.getZapConfiguration();return t?.nostrPubkey}static async fromNip05(e,n,r=!1){if(!n)throw new Error("No NDK instance found");const s={};r&&(s.cache="no-cache");const i=await bl(n,e,n?.httpFetch,s);if(i){const e=new t({pubkey:i.pubkey,relayUrls:i.relays,nip46Urls:i.nip46});return e.ndk=n,e}}async fetchProfile(t,e=!1){if(!this.ndk)throw new Error("NDK not set");this.profile||(this.profile={});let n=null;if(this.ndk.cacheAdapter&&this.ndk.cacheAdapter.fetchProfile&&"ONLY_RELAY"!==t?.cacheUsage){const t=await this.ndk.cacheAdapter.fetchProfile(this.pubkey);if(t)return this.profile=t,t}!t&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.locking&&(n=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},{cacheUsage:"ONLY_CACHE",closeOnEose:!0,groupable:!1}),t={cacheUsage:"ONLY_RELAY",closeOnEose:!0,groupable:!0,groupableDelay:250}),n&&0!==n.size||(n=await this.ndk.fetchEvents({kinds:[0],authors:[this.pubkey]},t));const r=Array.from(n).sort(((t,e)=>t.created_at-e.created_at));if(0===r.length)return null;const s=r[0];return this.profile=gl(s),e&&(this.profile.profileEvent=JSON.stringify(s)),this.profile&&this.ndk.cacheAdapter&&this.ndk.cacheAdapter.saveProfile&&this.ndk.cacheAdapter.saveProfile(this.pubkey,this.profile),this.profile}follows=pl.bind(this);tagReference(){return["p",this.pubkey]}referenceTags(t){const e=[["p",this.pubkey]];return t?(e[0].push("",t),e):e}async publish(){if(!this.ndk)throw new Error("No NDK instance found");if(!this.profile)throw new Error("No profile available");this.ndk.assertSigner();const t=new al(this.ndk,{kind:0,content:yl(this.profile)});await t.publish()}async follow(t,e,n=3){if(!this.ndk)throw new Error("No NDK instance found");if(this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,n)),e.has(t))return!1;e.add(t);const r=new al(this.ndk,{kind:n});for(const t of e)r.tag(t);return await r.publish(),!0}async unfollow(t,e,n=3){if(!this.ndk)throw new Error("No NDK instance found");this.ndk.assertSigner(),e||(e=await this.follows(void 0,void 0,n));const r=new Set;let s=!1;for(const n of e)n.pubkey!==t.pubkey?r.add(n):s=!0;if(!s)return!1;const i=new al(this.ndk,{kind:n});for(const t of r)i.tag(t);return await i.publish()}async validateNip05(t){if(!this.ndk)throw new Error("No NDK instance found");const e=await bl(this.ndk,t);return null===e?null:e.pubkey===this.pubkey}async zap(t,e,n,r){return new Promise(((s,i)=>{if(!this.ndk)return void i("No NDK instance found");let o=this.ndk.walletConfig?.onLnPay;o??=async({pr:t})=>{s(t)};this.ndk.zap(this,t,{comment:e,tags:n,signer:r,onLnPay:o}).zap().then(s).catch(i)}))}},Al=class t extends al{_encryptedTags;encryptedTagsLength;constructor(t,e){super(t,e),this.kind??=30001}static from(e){return new t(e.ndk,e)}get title(){const t=this.tagValue("title")||this.tagValue("name");return t||(3===this.kind?"Contacts":1e4===this.kind?"Mute":10001===this.kind?"Pinned Notes":10002===this.kind?"Relay Metadata":10003===this.kind?"Bookmarks":10004===this.kind?"Communities":10005===this.kind?"Public Chats":10006===this.kind?"Blocked Relays":10007===this.kind?"Search Relays":10015===this.kind?"Interests":10030===this.kind?"Emojis":this.tagValue("d"))}set title(t){this.removeTag(["title","name"]),t&&this.tags.push(["title",t])}get name(){return this.title}set name(t){this.title=t}get description(){return this.tagValue("description")}set description(t){this.removeTag("description"),t&&this.tags.push(["description",t])}get image(){return this.tagValue("image")}set image(t){this.removeTag("image"),t&&this.tags.push(["image",t])}isEncryptedTagsCacheValid(){return!(!this._encryptedTags||this.encryptedTagsLength!==this.content.length)}async encryptedTags(t=!0){if(t&&this.isEncryptedTagsCacheValid())return this._encryptedTags;if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const e=await this.ndk.signer.user();try{if(this.content.length>0)try{const t=await this.ndk.signer.decrypt(e,this.content),n=JSON.parse(t);return n&&n[0]?(this.encryptedTagsLength=this.content.length,this._encryptedTags=n):(this.encryptedTagsLength=this.content.length,this._encryptedTags=[])}catch(t){console.log(`error decrypting ${this.content}`)}}catch(t){}return[]}validateTag(t){return!0}getItems(t){return this.tags.filter((e=>e[0]===t))}get items(){return this.tags.filter((t=>!["d","L","l","title","name","description","published_at","summary","image","thumb","alt","expiration","subject","client"].includes(t[0])))}async addItem(t,e=void 0,n=!1,r="bottom"){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");let s;if(t instanceof al)s=[t.tagReference(e)];else if(t instanceof kl)s=t.referenceTags();else if(t instanceof Ih)s=t.referenceTags();else{if(!Array.isArray(t))throw new Error("Invalid object type");s=[t]}if(e&&s[0].push(e),n){const t=await this.ndk.signer.user(),e=await this.encryptedTags();"top"===r?e.unshift(...s):e.push(...s),this._encryptedTags=e,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(e),await this.encrypt(t)}else"top"===r?this.tags.unshift(...s):this.tags.push(...s);this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItemByValue(t,e=!0){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");const n=this.tags.findIndex((e=>e[1]===t));n>=0&&this.tags.splice(n,1);const r=await this.ndk.signer.user(),s=await this.encryptedTags(),i=s.findIndex((e=>e[1]===t));if(i>=0&&(s.splice(i,1),this._encryptedTags=s,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(s),await this.encrypt(r)),e)return this.publishReplaceable();this.created_at=Math.floor(Date.now()/1e3),this.emit("change")}async removeItem(t,e){if(!this.ndk)throw new Error("NDK instance not set");if(!this.ndk.signer)throw new Error("NDK signer not set");if(e){const e=await this.ndk.signer.user(),n=await this.encryptedTags();n.splice(t,1),this._encryptedTags=n,this.encryptedTagsLength=this.content.length,this.content=JSON.stringify(n),await this.encrypt(e)}else this.tags.splice(t,1);return this.created_at=Math.floor(Date.now()/1e3),this.emit("change"),this}has(t){return this.items.some((e=>e[1]===t))}filterForItems(){const t=new Set,e=new Map,n=[];for(const n of this.items)if("e"===n[0]&&n[1])t.add(n[1]);else if("a"===n[0]&&n[1]){const[t,r,s]=n[1].split(":");if(!t||!r)continue;const i=`${t}:${r}`,o=e.get(i)||[];o.push(s||""),e.set(i,o)}if(t.size>0&&n.push({ids:Array.from(t)}),e.size>0)for(const[t,r]of e.entries()){const[e,s]=t.split(":");n.push({kinds:[parseInt(e)],authors:[s],"#d":r})}return n}};var xl="read",_l="write",Sl=class t extends al{constructor(t,e){super(t,e),this.kind??=10002}static from(e){return new t(e.ndk,e.rawEvent())}get readRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2]||t[2]&&t[2]===xl)).map((t=>bh(t[1]))).filter((t=>!!t))}set readRelayUrls(t){for(const e of t)this.tags.push(["r",e,xl])}get writeRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2]||t[2]&&t[2]===_l)).map((t=>bh(t[1]))).filter((t=>!!t))}set writeRelayUrls(t){for(const e of t)this.tags.push(["r",e,_l])}get bothRelayUrls(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).filter((t=>!t[2])).map((t=>t[1]))}set bothRelayUrls(t){for(const e of t)this.tags.push(["r",e])}get relays(){return this.tags.filter((t=>"r"===t[0]||"relay"===t[0])).map((t=>t[1]))}get relaySet(){if(!this.ndk)throw new Error("NDKRelayList has no NDK instance");return new Nh(new Set(this.relays.map((t=>this.ndk.pool.getRelay(t)))),this.ndk)}};function Rl(t,e){try{const n=JSON.parse(e.content),r=new Sl(t),s=new Set,i=new Set;for(let[t,e]of Object.entries(n)){try{t=mh(t)}catch{continue}if(e){const n=e;n.write&&i.add(t),n.read&&s.add(t)}else s.add(t),i.add(t)}return r.readRelayUrls=Array.from(s),r.writeRelayUrls=Array.from(i),r}catch{}}var Cl=class t extends al{debug;_proofs=[];static kind=9321;static kinds=[t.kind];constructor(t,e){super(t,e),this.kind??=9321,this.debug=t?.debug.extend("nutzap")??jo("ndk:nutzap"),this.alt||(this.alt="This is a nutzap")}static from(t){const e=new this(t.ndk,t);try{const t=e.getMatchingTags("proof");t.length?e._proofs=t.map((t=>JSON.parse(t[1]))):e._proofs=JSON.parse(e.content)}catch{return}if(e._proofs&&e._proofs.length)return e}set comment(t){this.content=t??""}get comment(){const t=this.tagValue("comment");return t||this.content}set proofs(t){this._proofs=t,this.tags=this.tags.filter((t=>"proof"!==t[0]));for(const e of t)this.tags.push(["proof",JSON.stringify(e)]);this.removeTag("amount"),this.tags.push(["amount",this.amount.toString()])}get proofs(){return this._proofs}get p2pk(){const t=this.proofs[0];try{const e=JSON.parse(t.secret);let n={};"string"==typeof e?(n=JSON.parse(e),this.debug("stringified payload",t.secret)):"object"==typeof e&&(n=e);if("P2PK"===n[0]&&n[1]?.data){const t=n[1].data.slice(2,-1);if(t)return t}}catch(t){this.debug("error parsing p2pk pubkey",t,this.proofs[0])}}get mint(){return this.tagValue("u")}set mint(t){this.removeTag("u"),this.tag(["u",t])}get unit(){return this.tagValue("unit")??"msat"}set unit(t){this.removeTag("unit"),t&&this.tag(["unit",t])}get amount(){return 1e3*this.proofs.reduce(((t,e)=>t+e.amount),0)}sender=this.author;set target(t){this.tags=this.tags.filter((t=>"p"!==t[0])),t instanceof al&&this.tags.push()}set recipientPubkey(t){this.removeTag("p"),this.tag(["p",t])}get recipientPubkey(){return this.tagValue("p")}get recipient(){const t=this.recipientPubkey;return this.ndk?this.ndk.getUser({pubkey:t}):new kl({pubkey:t})}get isValid(){let t=0,e=0;for(const n of this.tags)"p"===n[0]&&t++,"u"===n[0]&&e++;return 1===t&&1===e&&this.proofs.length>0}};async function Ul(t){return await this.sendReq("pay_invoice",{invoice:t})}var Il=class t{_user;_privateKey;constructor(t){if(t){if("string"==typeof t)if(t.startsWith("nsec1")){const{type:e,data:n}=pi.decode(t);"nsec"===e&&(this._privateKey=n)}else{if(64!==t.length)throw new Error("Invalid private key provided.");this._privateKey=sa(t)}else this._privateKey=t;this._privateKey&&(this._user=new kl({pubkey:Tr(this._privateKey)}))}}get privateKey(){if(this._privateKey)return ea(this._privateKey)}static generate(){const e=Ir();return new t(e)}async blockUntilReady(){if(!this._user)throw new Error("NDKUser not initialized");return this._user}async user(){return await this.blockUntilReady(),this._user}async sign(t){if(!this._privateKey)throw Error("Attempted to sign without a private key");return Nr(t,this._privateKey).sig}async encrypt(t,e){if(!this._privateKey)throw Error("Attempted to encrypt without a private key");const n=t.pubkey;return await Ui.encrypt(this._privateKey,n,e)}async decrypt(t,e){if(!this._privateKey)throw Error("Attempted to decrypt without a private key");const n=t.pubkey;return await Ui.decrypt(this._privateKey,n,e)}};async function Tl(t,e){const n=new al(this.ndk,{kind:23194,tags:[["p",this.walletService.pubkey]],content:JSON.stringify({method:t,params:e})});return this.debug("Sending request",n.content),await n.encrypt(this.walletService,this.signer),await n.sign(this.signer),this.debug("Request encrypted and signed"),new Promise((async(e,r)=>{try{const s=n.tagId();if(!s)throw new Error("Failed to get e-tag");const i=t=>{this.off(s,i),this.off("event",i),this.debug("Received response",t);try{const n=JSON.parse(t);n.error&&r(n),e(n)}catch(t){this.debug("Failed to parse response",t),r({result_type:"error",error:{code:"failed_to_parse_response",message:t.message}})}},o=this.ndk.subscribe({kinds:[23195],"#e":[s],limit:1},{groupable:!1,subId:`nwc-${t}`},this.relaySet);o.on("event",(async t=>{await t.decrypt(t.author,this.signer),i(t.content),o.stop()})),this.once(s,i),this.once("event",i),this.debug("Sending request to relay",n.rawEvent()),await n.publish(this.relaySet)}catch(t){this.debug("Failed to send request",t,t.relayErrors),r({result_type:"error",error:{code:"failed_to_send_request",message:t.message}})}}))}async function Nl(){return await this.sendReq("get_balance",{})}async function Ll(){return await this.sendReq("get_info",{})}var Bl=class t extends Vo.EventEmitter{ndk;debug;walletService;relaySet;signer;active=!1;constructor({ndk:t,pubkey:e,relayUrls:n,secret:r}){super(),this.ndk=t,this.walletService=t.getUser({pubkey:e}),this.relaySet=new Nh(new Set(n.map((e=>t.pool.getRelay(e)))),t),this.signer=new Il(r instanceof Uint8Array?r:sa(r)),this.debug=t.debug.extend("nwc"),this.debug(`Starting with wallet service ${this.walletService.npub}`)}static async fromURI(e,n){const r=new URL(n);if("nostr+walletconnect:"!==r.protocol)throw new Error("Invalid protocol");return new t({ndk:e,pubkey:r.host??r.pathname,relayUrls:r.searchParams.getAll("relay")??[""],secret:r.searchParams.get("secret")??""})}async blockUntilReady(t){const e=await this.signer.user(),n=new Promise(((e,n)=>{setTimeout((()=>{n(new Error("Timeout"))}),t)})),r=[new Promise((t=>{const n=this.ndk.subscribe({kinds:[23195],"#p":[e.pubkey],limit:1},{groupable:!1,subId:"nwc"},this.relaySet);n.on("event",(async t=>{this.debug("received response",t.rawEvent());const e=t.tagValue("e");if(e){this.debug("received an event",e);try{await t.decrypt(t.author,this.signer),this.emit(e,t.content)}catch(t){return void this.debug("Failed to decrypt event",t)}}else this.debug("Received an event without an e-tag")})),n.on("eose",(()=>{this.debug("Subscription ready"),this.active=!0,t()})),n.on("close",(()=>{this.debug("Subscription closed"),this.active=!1}))}))];return t&&r.push(n),await Promise.race(r)}async sendReq(t,e){return await Tl.call(this,t,e)}async payInvoice(t){return await Ul.call(this,t)}async getInfo(){return await Ll.call(this)}getBalance=Nl.bind(this)};var Pl=class{_userPromise;nip04Queue=[];nip04Processing=!1;debug;waitTimeout;constructor(t=1e3){this.debug=jo("ndk:nip07"),this.waitTimeout=t}async blockUntilReady(){await this.waitForExtension();const t=await window.nostr.getPublicKey();if(!t)throw new Error("User rejected access");return new kl({pubkey:t})}async user(){return this._userPromise||(this._userPromise=this.blockUntilReady()),this._userPromise}async sign(t){await this.waitForExtension();return(await window.nostr.signEvent(t)).sig}async relays(t){await this.waitForExtension();const e=await(window.nostr.getRelays?.())||{},n=[];for(const t of Object.keys(e))e[t].read&&e[t].write&&n.push(t);return n.map((e=>new Ih(e,t?.relayAuthDefaultPolicy,t)))}async encrypt(t,e){await this.waitForExtension();const n=t.pubkey;return this.queueNip04("encrypt",n,e)}async decrypt(t,e){await this.waitForExtension();const n=t.pubkey;return this.queueNip04("decrypt",n,e)}async queueNip04(t,e,n){return new Promise(((r,s)=>{this.nip04Queue.push({type:t,counterpartyHexpubkey:e,value:n,resolve:r,reject:s}),this.nip04Processing||this.processNip04Queue()}))}async processNip04Queue(t,e=0){if(!t&&0===this.nip04Queue.length)return void(this.nip04Processing=!1);this.nip04Processing=!0;const{type:n,counterpartyHexpubkey:r,value:s,resolve:i,reject:o}=t||this.nip04Queue.shift();try{let t;t="encrypt"===n?await window.nostr.nip04.encrypt(r,s):await window.nostr.nip04.decrypt(r,s),i(t)}catch(i){if(i.message&&i.message.includes("call already executing")&&e<5)return this.debug("Retrying encryption queue item",{type:n,counterpartyHexpubkey:r,value:s,retries:e}),void setTimeout((()=>{this.processNip04Queue(t,e+1)}),50*e);o(i)}this.processNip04Queue()}waitForExtension(){return new Promise(((t,e)=>{if(window.nostr)return void t();let n;const r=setInterval((()=>{window.nostr&&(clearTimeout(n),clearInterval(r),t())}),100);n=setTimeout((()=>{clearInterval(r),e(new Error("NIP-07 extension not available"))}),this.waitTimeout)}))}},Ol=class extends Vo.EventEmitter{ndk;signer;relaySet;debug;constructor(t,e,n,r){super(),this.ndk=t,this.signer=e,this.relaySet=r?Nh.fromRelayUrls(r,t):void 0,this.debug=n.extend("rpc")}subscribe(t){const e=this.ndk.subscribe(t,{closeOnEose:!1,groupable:!1,cacheUsage:"ONLY_RELAY"},this.relaySet);return e.on("event",(async t=>{try{const e=await this.parseEvent(t);e.method?this.emit("request",e):this.emit(`response-${e.id}`,e)}catch(e){this.debug("error parsing event",e,t.rawEvent())}})),new Promise((t=>{e.on("eose",(()=>t(e)))}))}async parseEvent(t){const e=this.ndk.getUser({pubkey:t.pubkey});e.ndk=this.ndk;const n=await this.signer.decrypt(e,t.content),r=JSON.parse(n),{id:s,method:i,params:o,result:a,error:c}=r;return i?{id:s,pubkey:t.pubkey,method:i,params:o,event:t}:{id:s,result:a,error:c,event:t}}async sendResponse(t,e,n,r=24133,s){const i={id:t,result:n};s&&(i.error=s);const o=await this.signer.user(),a=this.ndk.getUser({pubkey:e}),c=new al(this.ndk,{kind:r,content:JSON.stringify(i),tags:[["p",e]],pubkey:o.pubkey});c.content=await this.signer.encrypt(a,c.content),await c.sign(this.signer),await c.publish(this.relaySet)}async sendRequest(t,e,n=[],r=24133,s){const i=Math.random().toString(36).substring(7),o=await this.signer.user(),a=this.ndk.getUser({pubkey:t}),c={id:i,method:e,params:n},h=new Promise((()=>{const t=e=>{"auth_url"===e.result?(this.once(`response-${i}`,t),this.emit("authUrl",e.error)):s&&s(e)};this.once(`response-${i}`,t)})),l=new al(this.ndk,{kind:r,content:JSON.stringify(c),tags:[["p",t]],pubkey:o.pubkey});return l.content=await this.signer.encrypt(a,l.content),await l.sign(this.signer),await l.publish(this.relaySet),h}};Vo.EventEmitter;async function Fl(t,e,n=!1){const r=e.outboxPool||e.pool,s=new Set;for(const t of r.relays.values())s.add(t);const i=new Map,o=new Map,a=new Nh(s,e);if(e.cacheAdapter?.locking&&!n){const n=await e.fetchEvents({kinds:[3,10002],authors:t},{cacheUsage:"ONLY_CACHE"});for(const t of n)10002===t.kind&&i.set(t.pubkey,Sl.from(t));for(const t of n)if(3===t.kind){if(i.has(t.pubkey))continue;const n=Rl(e,t);n&&o.set(t.pubkey,n)}t=t.filter((t=>!i.has(t)&&!o.has(t)))}if(0===t.length)return i;const c=new Map,h=new Map;return new Promise((async n=>{const s=e.subscribe({kinds:[3,10002],authors:t},{closeOnEose:!0,pool:r,groupable:!0,cacheUsage:"ONLY_RELAY",subId:"ndk-relay-list-fetch"},a,!1);s.on("event",(t=>{if(10002===t.kind){const e=c.get(t.pubkey);if(e&&e.created_at>t.created_at)return;c.set(t.pubkey,t)}else if(3===t.kind){const e=h.get(t.pubkey);if(e&&e.created_at>t.created_at)return;h.set(t.pubkey,t)}})),s.on("eose",(()=>{for(const t of c.values())i.set(t.pubkey,Sl.from(t));for(const n of t){if(i.has(n))continue;const t=h.get(n);if(!t)continue;const r=Rl(e,t);r&&i.set(n,r)}n(i)})),s.start()}))}var $l=class{type;relayUrlScores;readRelays;writeRelays;constructor(t){this.type=t,this.relayUrlScores=new Map,this.readRelays=new Set,this.writeRelays=new Set}},Ml=class extends Vo.EventEmitter{data;ndk;debug;constructor(t){super(),this.ndk=t,this.debug=t.debug.extend("outbox-tracker"),this.data=new Dc.LRUCache({maxSize:1e5,entryExpirationTimeInMS:12e4})}async trackUsers(t,e=!1){const n=[];for(let r=0;r<t.length;r+=400){const s=t.slice(r,r+400).map((t=>Dl(t))).filter((t=>!this.data.has(t)));if(0!==s.length){for(const t of s)this.data.set(t,new $l("user"));n.push(new Promise((t=>{Fl(s,this.ndk,e).then((t=>{for(const[e,n]of t){let t=this.data.get(e);if(t??=new $l("user"),n){t.readRelays=new Set(vh(n.readRelayUrls)),t.writeRelays=new Set(vh(n.writeRelayUrls));for(const e of t.readRelays)this.ndk.pool.blacklistRelayUrls.has(e)&&t.readRelays.delete(e);for(const e of t.writeRelays)this.ndk.pool.blacklistRelayUrls.has(e)&&t.writeRelays.delete(e);this.data.set(e,t)}}})).finally(t)})))}}return Promise.all(n)}track(t,e,n=!0){const r=Dl(t);e??=function(t){return t instanceof kl?"user":"kind"}(t);let s=this.data.get(r);return s||(s=new $l(e),t instanceof kl&&this.trackUsers([t])),s}};function Dl(t){return t instanceof kl?t.pubkey:t}var ql=class extends Vo.EventEmitter{relays=new Map;autoConnectRelays=new Set;blacklistRelayUrls;debug;temporaryRelayTimers=new Map;flappingRelays=new Set;backoffTimes=new Map;ndk;constructor(t=[],e=[],n,r){super(),this.debug=r??n.debug.extend("pool"),this.ndk=n;for(const e of t){const t=new Ih(e,void 0,this.ndk);this.addRelay(t,!1)}this.blacklistRelayUrls=new Set(e)}set name(t){this.debug=this.debug.extend(t)}useTemporaryRelay(t,e=3e4,n){const r=this.relays.has(t.url);r||(this.addRelay(t),this.debug("Adding temporary relay %s for filters %o",t.url,n));const s=this.temporaryRelayTimers.get(t.url);if(s&&clearTimeout(s),!r||s){const n=setTimeout((()=>{this.ndk.explicitRelayUrls?.includes(t.url)||this.removeRelay(t.url)}),e);this.temporaryRelayTimers.set(t.url,n)}}addRelay(t,e=!0){const n=this.relays.has(t.url),r=this.blacklistRelayUrls?.has(t.url),s=t.url.includes("/npub1");let i=!0;const o=t.url;if(n)return;if(r)return void this.debug(`Refusing to add relay ${o}: blacklisted`);if(s)return void this.debug(`Refusing to add relay ${o}: is a filter relay`);if(this.ndk.cacheAdapter?.getRelayStatus){const n=this.ndk.cacheAdapter.getRelayStatus(o);if(n&&n.dontConnectBefore){if(n.dontConnectBefore>Date.now()){const r=n.dontConnectBefore-Date.now();return this.debug(`Refusing to add relay ${o}: delayed connect for ${r}ms`),void setTimeout((()=>{this.addRelay(t,e)}),r)}i=!1}}const a=e=>this.emit("notice",t,e),c=()=>this.handleRelayConnect(o),h=()=>this.handleRelayReady(t),l=()=>this.emit("relay:disconnect",t),u=()=>this.handleFlapping(t),d=e=>this.emit("relay:auth",t,e),f=()=>this.emit("relay:authed",t);t.off("notice",a),t.off("connect",c),t.off("ready",h),t.off("disconnect",l),t.off("flapping",u),t.off("auth",d),t.off("authed",f),t.on("notice",a),t.on("connect",c),t.on("ready",h),t.on("disconnect",l),t.on("flapping",u),t.on("auth",d),t.on("authed",f),t.on("delayed-connect",(e=>{this.ndk.cacheAdapter?.updateRelayStatus&&this.ndk.cacheAdapter.updateRelayStatus(t.url,{dontConnectBefore:Date.now()+e})})),this.relays.set(o,t),e&&this.autoConnectRelays.add(o),e&&(this.emit("relay:connecting",t),t.connect(void 0,i).catch((t=>{this.debug(`Failed to connect to relay ${o}`,t)})))}removeRelay(t){const e=this.relays.get(t);if(e)return e.disconnect(),this.relays.delete(t),this.autoConnectRelays.delete(t),this.emit("relay:disconnect",e),!0;const n=this.temporaryRelayTimers.get(t);return n&&(clearTimeout(n),this.temporaryRelayTimers.delete(t)),!1}isRelayConnected(t){const e=mh(t),n=this.relays.get(e);return!!n&&5===n.status}getRelay(t,e=!0,n=!1,r){let s=this.relays.get(mh(t));return s||(s=new Ih(t,void 0,this.ndk),n?this.useTemporaryRelay(s,3e4,r):this.addRelay(s,e)),s}handleRelayConnect(t){this.emit("relay:connect",this.relays.get(t)),this.stats().connected===this.relays.size&&this.emit("connect")}handleRelayReady(t){this.emit("relay:ready",t)}async connect(t){const e=[];this.debug(`Connecting to ${this.relays.size} relays${t?`, timeout ${t}...`:""}`);const n=new Set(this.autoConnectRelays.keys());this.ndk.explicitRelayUrls?.forEach((t=>{const e=mh(t);n.add(e)}));for(const r of n){const n=this.relays.get(r);if(!n)continue;const s=new Promise(((e,r)=>(this.emit("relay:connecting",n),n.connect(t).then(e).catch(r))));if(t){const r=new Promise(((e,n)=>{setTimeout((()=>n(`Timed out after ${t}ms`)),t)}));e.push(Promise.race([s,r]).catch((t=>{this.debug(`Failed to connect to relay ${n.url}: ${t??"No reason specified"}`)})))}else e.push(s)}t&&setTimeout((()=>{const t=this.stats().connected===this.relays.size,e=this.stats().connected>0;!t&&e&&this.emit("connect")}),t),await Promise.all(e)}checkOnFlappingRelays(){if(this.flappingRelays.size/this.relays.size>=.8)for(const t of this.flappingRelays)this.backoffTimes.set(t,0)}handleFlapping(t){this.debug(`Relay ${t.url} is flapping`);let e=this.backoffTimes.get(t.url)||5e3;e*=2,this.backoffTimes.set(t.url,e),this.debug(`Backoff time for ${t.url} is ${e}ms`),setTimeout((()=>{this.debug(`Attempting to reconnect to ${t.url}`),this.emit("relay:connecting",t),t.connect(),this.checkOnFlappingRelays()}),e),t.disconnect(),this.emit("flapping",t)}size(){return this.relays.size}stats(){const t={total:0,connected:0,disconnected:0,connecting:0};for(const e of this.relays.values())t.total++,5===e.status?t.connected++:1===e.status?t.disconnected++:4===e.status&&t.connecting++;return t}connectedRelays(){return Array.from(this.relays.values()).filter((t=>5===t.status))}permanentAndConnectedRelays(){return Array.from(this.relays.values()).filter((t=>t.status>=5&&!this.temporaryRelayTimers.has(t.url)))}urls(){return Array.from(this.relays.keys())}};function zl(t){if(!t||""===t)return!1;try{return new URL(t),!0}catch(t){return!1}}async function Hl(t,e,n,r={type:"timeout"}){const s=this.debug.extend("fetch-event-from-tag"),[i,o,a]=t;s("fetching event from tag",t,n={},r);const c=yh(this,e.pubkey);if(c&&c.size>0){s("fetching event from author relays %o",Array.from(c));const t=Nh.fromRelayUrls(Array.from(c),this),e=await this.fetchEvent(o,n,t);if(e)return e}else s("no author relays found for %s",e.pubkey,e);const h=Oh(this,[{ids:[o]}],this.pool);s("fetching event without relay hint",h);const l=await this.fetchEvent(o,n);if(l)return l;if(a&&""!==a){const t=await this.fetchEvent(o,n,this.pool.getRelay(a,!0,!0,[{ids:[o]}]));if(t)return t}let u;const d=zl(a)?this.pool.getRelay(a,!1,!0,[{ids:[o]}]):void 0,f=new Promise((t=>{this.fetchEvent(o,n,d).then(t)}));if(!zl(a)||"none"===r.type)return f;const p=new Promise((async t=>{const e=r.relaySet,i=r.timeout??1500,a=new Promise((t=>setTimeout(t,i)));if("timeout"===r.type&&await a,u)t(u);else{s("fallback fetch triggered");t(await this.fetchEvent(o,n,e))}}));switch(r.type){case"timeout":return Promise.race([f,p]);case"eose":return u=await f,u||p}}var Vl=class{ndk;spec;url;nip98Required=!1;constructor(t,e){this.url=`https://${t}/.well-known/nostr/nip96.json`,this.ndk=e}async prepareUpload(t,e="POST"){if(this.validateHttpFetch(),this.spec||await this.fetchSpec(),!this.spec)throw new Error("Failed to fetch NIP96 spec");let n={};if(this.nip98Required){n={Authorization:await this.generateNip98Header(this.spec.api_url,e,t)}}return{url:this.spec.api_url,headers:n}}async xhrUpload(t,e){const n="POST",{url:r,headers:s}=await this.prepareUpload(e,n);t.open(n,r,!0),s.Authorization&&t.setRequestHeader("Authorization",s.Authorization);const i=new FormData;return i.append("file",e),new Promise(((e,n)=>{t.onload=function(){t.status>=200&&t.status<300?e(JSON.parse(t.responseText)):n(new Error(t.statusText))},t.onerror=function(){n(new Error("Network Error"))},t.send(i)}))}async upload(t){const e="POST",{url:n,headers:r}=await this.prepareUpload(t,e),s=new FormData;s.append("file",t);const i=await this.ndk.httpFetch(this.spec.api_url,{method:e,headers:r,body:s});if(200!==i.status)throw new Error(`Failed to upload file to ${n}`);const o=await i.json();if("success"!==o.status)throw new Error(o.message);return o}validateHttpFetch(){if(!this.ndk)throw new Error("NDK is required to fetch NIP96 spec");if(!this.ndk.httpFetch)throw new Error("NDK must have an httpFetch method to fetch NIP96 spec")}async fetchSpec(){this.validateHttpFetch();const t=await this.ndk.httpFetch(this.url);if(200!==t.status)throw new Error(`Failed to fetch NIP96 spec from ${this.url}`);const e=await t.json();if(!e)throw new Error(`Failed to parse NIP96 spec from ${this.url}`);this.spec=e,this.nip98Required=this.spec.plans.free.is_nip98_required}async generateNip98Header(t,e,n){const r=new al(this.ndk,{kind:27235,tags:[["u",t],["method",e]]});if(["POST","PUT","PATCH"].includes(e)){const t=await this.calculateSha256(n);r.tags.push(["payload",t])}await r.sign();return`Nostr ${btoa(JSON.stringify(r.rawEvent()))}`}async calculateSha256(t){const e=await t.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(n)).map((t=>t.toString(16).padStart(2,"0"))).join("")}},jl=class{queue=[];maxConcurrency;processing=new Set;promises=new Map;constructor(t,e){this.maxConcurrency=e}add(t){if(this.promises.has(t.id))return this.promises.get(t.id);const e=new Promise(((e,n)=>{this.queue.push({...t,func:()=>t.func().then((t=>(e(t),t)),(t=>{throw n(t),t}))}),this.process()}));return this.promises.set(t.id,e),e.finally((()=>{this.promises.delete(t.id),this.processing.delete(t.id),this.process()})),e}process(){if(this.processing.size>=this.maxConcurrency||0===this.queue.length)return;const t=this.queue.shift();t&&!this.processing.has(t.id)&&(this.processing.add(t.id),t.func())}clear(){this.queue=[]}clearProcessing(){this.processing.clear()}clearAll(){this.clear(),this.clearProcessing()}length(){return this.queue.length}},Kl=class{subscriptions;seenEvents=new Map;debug;constructor(t){this.subscriptions=new Map,this.debug=t.extend("sub-manager")}add(t){this.subscriptions.set(t.internalId,t),t.on("close",(()=>{this.subscriptions.delete(t.internalId)}))}seenEvent(t,e){const n=this.seenEvents.get(t)||[];n.push(e),this.seenEvents.set(t,n)}},Wl=jo("ndk:active-user");async function Zl(t){if(!this.autoConnectUserRelays)return;const e=await async function(t,e){return(await Fl([t],e)).get(t)}(t.pubkey,this);if(e){for(const t of e.relays){let e=this.pool.relays.get(t);e||(e=new Ih(t,this.relayAuthDefaultPolicy,this),this.pool.addRelay(e))}return e}}async function Jl(t){const e=this.outboxPool||this.pool;e.connectedRelays.length>0?Yl.call(this,t):e.once("connect",(()=>{Yl.call(this,t)}))}async function Yl(t){const e=await Zl.call(this,t),n=[{kinds:[10006],authors:[t.pubkey]}];this.autoFetchUserMutelist&&n[0].kinds.push(1e4);const r=e?e.relaySet:void 0,s=this.subscribe(n,{subId:"active-user-settings",closeOnEose:!0},r,!1),i=new Map;s.on("event",(t=>{const e=i.get(t.kind);e&&e.created_at>=t.created_at||i.set(t.kind,t)})),s.on("eose",(()=>{for(const t of i.values())Gl.call(this,t)})),s.start()}async function Gl(t){10006===t.kind?Ql.call(this,t):1e4===t.kind&&Xl.call(this,t)}function Ql(t){const e=Al.from(t);for(const t of e.items)this.pool.blacklistRelayUrls.add(t[0]);Wl("Added %d relays to relay blacklist",e.items.length)}function Xl(t){const e=Al.from(t);for(const t of e.items)this.mutedIds.set(t[1],t[0]);Wl("Added %d users to mute list",e.items.length)}async function tu(t,e,n,r,s,i,o,a,c){const h=n.callback,l=Ro.makeZapRequest({profile:r,event:null,amount:s,comment:o||"",relays:i.slice(0,4)});if(t instanceof al){const e=t.referenceTags().filter((t=>"p"!==t[0]));l.tags.push(...e)}l.tags.push(["lnurl",h]);const u=new al(e,l);return a&&(u.tags=u.tags.concat(a)),u.tags=u.tags.filter((t=>"p"!==t[0])),u.tags.push(["p",r]),await u.sign(c),u}var eu,nu=jo("ndk:zapper"),ru=class extends Vo.EventEmitter{target;ndk;comment;amount;unit;tags;signer;zapMethod;onLnPay;onCashuPay;onComplete;maxRelays=3;constructor(t,e,n="msat",r,s,i,o){if(super(),this.target=t,this.ndk=s||t.ndk,!this.ndk)throw new Error("No NDK instance provided");this.amount=e,this.comment=r,this.unit=n,this.tags=i,this.signer=o}async zap(){const t=this.getZapSplits(),e=new Map;return await Promise.all(t.map((async t=>{let n;try{n=await this.zapSplit(t)}catch(t){n=t}this.emit("split:complete",t,n),e.set(t,n)}))),this.emit("complete",e),this.onComplete&&this.onComplete(e),e}async zapSplit(t){let e,n=await this.getZapMethods(this.ndk,t.pubkey);if(0===n.length)throw new Error("No zap method available for recipient");n=n.sort(((t,e)=>"nip61"===t.type?-1:"nip61"===e.type?1:0));const r=await this.relays(t.pubkey);for(const s of n){false,nu("Zapping to %s with %d %s using %s",t.pubkey,t.amount,this.unit,s.type);try{switch(s.type){case"nip61":{const n=s.data;let i;if(i=await this.onCashuPay({target:this.target,comment:this.comment,tags:this.tags,recipientPubkey:t.pubkey,amount:t.amount,unit:this.unit,...n}),nu("NIP-61 Zap result: %o",i),i instanceof Error)e=i;else if(i){const{proofs:e,mint:n}=i;if(!e||!n)throw new Error("Invalid zap confirmation: missing proofs or mint: "+i);const s=Nh.fromRelayUrls(r,this.ndk),o=new Cl(this.ndk);return o.tags=[...o.tags,...this.tags||[]],o.proofs=e,o.mint=n,o.comment=this.comment,o.unit=this.unit,o.recipientPubkey=t.pubkey,await o.sign(this.signer),await o.publish(s),o}break}case"nip57":{const n=s.data,i=await tu(this.target,this.ndk,n,t.pubkey,t.amount,r,this.comment,this.tags,this.signer);if(!i)throw nu("Unable to generate zap request"),new Error("Unable to generate zap request");const o=await this.getLnInvoice(i,t.amount,n);if(!o)throw nu("Unable to get payment request"),new Error("Unable to get payment request");e=await this.onLnPay({target:this.target,comment:this.comment,recipientPubkey:t.pubkey,amount:t.amount,unit:this.unit,pr:o});break}}}catch(n){e=n instanceof Error?n:new Error(n),nu("Error zapping to %s with %d %s using %s: %o",t.pubkey,t.amount,this.unit,s.type,n)}}if(e instanceof Error)throw e;return e}async getLnInvoice(t,e,n){const r=n.callback,s=JSON.stringify(t.rawEvent());nu(`Fetching invoice from ${r}?`+new URLSearchParams({amount:e.toString(),nostr:s}));const i=new URL(r);i.searchParams.append("amount",e.toString()),i.searchParams.append("nostr",s),nu(`Fetching invoice from ${i.toString()}`);const o=await fetch(i.toString());if(nu(`Got response from zap endpoint: ${r}`,{status:o.status}),200!==o.status){nu(`Received non-200 status from zap endpoint: ${r}`,{status:o.status,amount:e,nostr:s});const t=await o.text();throw new Error(`Unable to fetch zap endpoint ${r}: ${t}`)}return(await o.json()).pr}getZapSplits(){if(this.target instanceof kl)return[{pubkey:this.target.pubkey,amount:this.amount}];const t=this.target.getMatchingTags("zap");if(0===t.length)return[{pubkey:this.target.pubkey,amount:this.amount}];const e=[],n=t.reduce(((t,e)=>t+parseInt(e[2])),0);for(const r of t){const t=r[1],s=Math.floor(parseInt(r[2])/n*this.amount);e.push({pubkey:t,amount:s})}return e}async getZapMethods(t,e){const n=[];this.onCashuPay&&n.push("nip61"),n.push("nip57");const r=t.getUser({pubkey:e}),s=await r.getZapInfo(!1,n);return nu("Zap info for %s: %o",r.npub,s),s}async relays(t){let e=[];if(this.ndk?.activeUser){const n=await Fl([this.ndk.activeUser.pubkey,t],this.ndk),r=new Map;for(const t of n.values())for(const e of t.readRelayUrls){const t=r.get(e)||0;r.set(e,t+1)}e=Array.from(r.entries()).sort(((t,e)=>e[1]-t[1])).map((([t])=>t)).slice(0,this.maxRelays)}return this.ndk?.pool?.permanentAndConnectedRelays().length&&(e=this.ndk.pool.permanentAndConnectedRelays().map((t=>t.url))),e.length||(e=[]),e}},su=["wss://purplepag.es/","wss://nos.lol/"],iu=["wss://brb.io/","wss://nostr.mutinywallet.com/"],ou=class extends Vo.EventEmitter{explicitRelayUrls;pool;outboxPool;_signer;_activeUser;cacheAdapter;debug;devWriteRelaySet;outboxTracker;mutedIds;clientName;clientNip89;queuesZapConfig;queuesNip05;asyncSigVerification=!1;initialValidationRatio=1;lowestValidationRatio=1;validationRatioFn;subManager;publishingFailureHandled=!1;relayAuthDefaultPolicy;httpFetch;autoConnectUserRelays=!0;autoFetchUserMutelist=!0;walletConfig;constructor(t={}){super(),this.debug=t.debug||jo("ndk"),this.explicitRelayUrls=t.explicitRelayUrls||[],this.subManager=new Kl(this.debug),this.pool=new ql(t.explicitRelayUrls||[],t.blacklistRelayUrls||iu,this),this.pool.name="main",this.pool.on("relay:auth",(async(t,e)=>{this.relayAuthDefaultPolicy&&await this.relayAuthDefaultPolicy(t,e)})),this.autoConnectUserRelays=t.autoConnectUserRelays??!0,this.autoFetchUserMutelist=t.autoFetchUserMutelist??!0,this.clientName=t.clientName,this.clientNip89=t.clientNip89,this.relayAuthDefaultPolicy=t.relayAuthDefaultPolicy,t.enableOutboxModel&&(this.outboxPool=new ql(t.outboxRelayUrls||su,t.blacklistRelayUrls||iu,this,this.debug.extend("outbox-pool")),this.outboxPool.name="outbox",this.outboxTracker=new Ml(this)),this.signer=t.signer,this.cacheAdapter=t.cacheAdapter,this.mutedIds=t.mutedIds||new Map,t.devWriteRelayUrls&&(this.devWriteRelaySet=Nh.fromRelayUrls(t.devWriteRelayUrls,this)),this.queuesZapConfig=new jl("zaps",3),this.queuesNip05=new jl("nip05",10),this.signatureVerificationWorker=t.signatureVerificationWorker,this.initialValidationRatio=t.initialValidationRatio||1,this.lowestValidationRatio=t.lowestValidationRatio||1;try{this.httpFetch=fetch}catch{}}set signatureVerificationWorker(t){this.asyncSigVerification=!!t,t&&((Kh=t).onmessage=t=>{const[e,n]=t.data,r=tl[e];if(r){delete tl[e];for(const t of r.resolves)t(n)}else console.error("No record found for event",e)})}addExplicitRelay(t,e,n=!0){let r;return r="string"==typeof t?new Ih(t,e,this):t,this.pool.addRelay(r,n),this.explicitRelayUrls.push(r.url),r}toJSON(){return{relayCount:this.pool.relays.size}.toString()}get activeUser(){return this._activeUser}set activeUser(t){const e=this._activeUser?.pubkey!==t?.pubkey;this._activeUser=t,t&&e?Jl.call(this,t):t||(this.mutedIds=new Map)}get signer(){return this._signer}set signer(t){this._signer=t,t&&this.emit("signer:ready",t),t?.user().then((t=>{t.ndk=this,this.activeUser=t}))}async connect(t){if(this._signer&&this.autoConnectUserRelays&&(this.debug("Attempting to connect to user relays specified by signer %o",await(this._signer.relays?.(this))),this._signer.relays)){(await this._signer.relays(this)).forEach((t=>this.pool.addRelay(t)))}const e=[this.pool.connect(t)];return this.outboxPool&&e.push(this.outboxPool.connect(t)),this.debug("Connecting to relays %o",{timeoutMs:t}),Promise.allSettled(e).then((()=>{}))}getUser(t){const e=new kl(t);return e.ndk=this,e}async getUserFromNip05(t,e=!1){return kl.fromNip05(t,this,e)}subscribe(t,e,n,r=!0){const s=new fl(this,t,e,n);if(this.subManager.add(s),n)for(const t of n.relays)this.pool.useTemporaryRelay(t,void 0,s.filters);if(this.outboxPool&&s.hasAuthorsFilter()){const t=s.filters.filter((t=>t.authors&&t.authors?.length>0)).map((t=>t.authors)).flat();this.outboxTracker?.trackUsers(t)}return r&&setTimeout((()=>s.start()),0),s}async publish(t,e,n){return this.debug("Deprecated: Use `event.publish()` instead"),t.publish(e,n)}fetchEventFromTag=Hl.bind(this);async fetchEvent(t,e,n){let r,s;if(n instanceof Ih?s=new Nh(new Set([n]),this):n instanceof Nh&&(s=n),!n&&"string"==typeof t&&null===t.match(ll)){const e=function(t,e){try{const n=pi.decode(t);if(["naddr","nevent"].includes(n?.type)){const t=n.data;if(t?.relays)return t.relays.map((t=>new Ih(t,e?.relayAuthDefaultPolicy,e)))}}catch(t){}return[]}(t,this);e.length>0&&(s=new Nh(new Set(e),this),s=function(t,e){const n=e.connectedRelays();if(!Array.from(t.relays).some((t=>n.map((t=>t.url)).includes(t.url))))for(const e of n)t.addRelay(e);if(0===n.length)for(const n of e.relays.values())t.addRelay(n);return t}(s,this.pool))}if(r="string"==typeof t?[hl(t)]:Array.isArray(t)?t:[t],0===r.length)throw new Error(`Invalid filter: ${JSON.stringify(t)}`);return new Promise((t=>{let n=null;const i=this.subscribe(r,{...e||{},closeOnEose:!0},s,!1),o=setTimeout((()=>{i.stop(),t(n)}),1e4);i.on("event",(e=>{e.ndk=this,e.isReplaceable()?(!n||n.created_at<e.created_at)&&(n=e):(clearTimeout(o),t(e))})),i.on("eose",(()=>{clearTimeout(o),t(n)})),i.start()}))}async fetchEvents(t,e,n){return new Promise((r=>{const s=new Map,i=this.subscribe(t,{...e||{},closeOnEose:!0},n,!1);i.on("event",(t=>{t instanceof al||(t=new al(void 0,t));const e=t.deduplicationKey(),n=s.get(e);var r,i;n&&(i=t,t=(r=n).created_at>i.created_at?r:i),t.ndk=this,s.set(e,t)})),i.on("eose",(()=>{r(new Set(s.values()))})),i.start()}))}assertSigner(){if(!this.signer)throw this.emit("signer:required"),new Error("Signer required")}getNip96(t){return new Vl(t,this)}async nwc(t,e=2e3){const n=await Bl.fromURI(this,t);return!1!==e&&await n.blockUntilReady(e),n}zap(t,e,{comment:n,unit:r,signer:s,tags:i,onLnPay:o,onCashuPay:a,onComplete:c}){s||this.assertSigner();const h=new ru(t,e,r,n,this,i,s);return!1!==o&&(h.onLnPay=o??this.walletConfig?.onLnPay),!1!==a&&(h.onCashuPay=a??this.walletConfig?.onCashuPay),h.onComplete=c??this.walletConfig?.onPaymentComplete,o&&h.zap(),h}};(eu=jQuery)(document).ready((function(){const t=15e3;let e=new ou({explicitRelayUrls:["wss://purplepag.es","wss://relay.nostr.band","wss://relay.primal.net","wss://relay.damus.io","wss://nostr.wine","wss://relay.snort.social","wss://eden.nostr.land","wss://nostr.bitcoiner.social","wss://nostrpub.yeghro.site"]});var r=eu("#loginform"),s=eu("#nostr_login_toggle"),i=eu(".nostr-login-field"),o=eu(".nostr-login-buttons"),a=eu("#nostr-wp-submit"),c=eu("#use_nostr_extension"),h=(eu("#wp-submit"),r.children().not(".nostr-login-container, .nostr-login-field, .nostr-login-buttons").detach());function l(){var t,e=s.prop("checked");r.children().not(".nostr-login-container, .nostr-login-field, .nostr-login-buttons").remove(),e?(i.show(),o.show(),r.off("submit").on("submit",u)):(i.hide(),o.hide(),r.append(h.clone()),a.val("Log In"),r.off("submit")),t=s.prop("checked"),s.next(".nostr-toggle-slider").css("background-color",t?"#2196F3":"#ccc"),s.next(".nostr-toggle-slider").find("span").css("transform",t?"translateX(26px)":"none")}async function u(t){t.preventDefault();let e=eu("#nostr_private_key").val();try{if(e.startsWith("nsec"))try{const{type:t,data:s}=n.nip19.decode(e);if("nsec"!==t)throw new Error("Invalid nsec key");r=s,e=Array.from(r).map((t=>t.toString(16).padStart(2,"0"))).join("")}catch(t){return void alert("Invalid nsec key format. Please check your private key and try again.")}if(!/^[0-9a-fA-F]{64}$/.test(e))throw new Error("Invalid private key format");await d(e)}catch(t){alert("Failed to log in with Nostr. Please check your private key and try again.")}var r}async function d(r=null,s=null,i=null){try{s||(s=(0,n.getPublicKey)(r));const o=e.connect(),a=new Promise(((e,n)=>setTimeout((()=>n(new Error("Connection to relays timed out"))),t)));try{await Promise.race([o,a])}catch(t){return void alert("Failed to connect to Nostr relays. Please try again later.")}let c=e.getUser({pubkey:s});i&&(c.signer=i);const h=c.fetchProfile(),l=new Promise(((e,n)=>setTimeout((()=>n(new Error("Fetching user profile timed out"))),t)));try{await Promise.race([h,l])}catch(t){alert("Failed to fetch user profile from Nostr. Proceeding with login using available information.")}const u=c.profile||{};eu.ajax({url:nostr_login_ajax.ajax_url,type:"POST",data:{action:"nostr_login",public_key:s,metadata:JSON.stringify(u),nonce:nostr_login_ajax.nonce},success:function(t){t.success?window.location.href=t.data.redirect:alert(t.data.message)},error:function(){alert("An error occurred. Please try again.")}})}catch(t){throw t}}!function(){var t=s.closest(".nostr-login-container");t.css({"margin-bottom":"20px",position:"relative",display:"flex","align-items":"center"}),s.css({opacity:"0",width:"0",height:"0",position:"absolute"});var e=eu('<span class="nostr-toggle-slider"></span>');e.css({position:"relative",cursor:"pointer",width:"60px",height:"34px","background-color":"#ccc",transition:".4s","border-radius":"34px",display:"inline-block","margin-right":"10px"}),e.append(eu("<span></span>").css({position:"absolute",content:'""',height:"26px",width:"26px",left:"4px",bottom:"4px","background-color":"white",transition:".4s","border-radius":"50%"})),s.after(e),t.find(".nostr-toggle-label span").css({"vertical-align":"middle"})}(),s.on("change",l),c.on("click",(async function(t){t.preventDefault();try{const t=new Pl,e=(await t.user()).pubkey;await d(null,e,t)}catch(t){alert("Failed to use Nostr extension. Please make sure you have a compatible extension installed and try again.")}})),l()}))})()})();